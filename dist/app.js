var Y0={TERMINAL_OUTPUT:0,TERMINAL_INPUT:1,TERMINAL_RESIZE:2,FILESYSTEM:16,GIT:32,STATS:48,STATS_PROCESS_INFO:49,STATS_TOKEN_USAGE:50,STATS_BUILD_STATUS:51,HEARTBEAT:255};function F1($){let Y=new ArrayBuffer(5+$.payload.length),J=new DataView(Y);return J.setUint8(0,$.feedId),J.setUint32(1,$.payload.length,!1),new Uint8Array(Y,5).set($.payload),Y}function B1($){let Y=new DataView($);if($.byteLength<5)throw Error(`incomplete frame: need 5 bytes, have ${$.byteLength}`);let J=Y.getUint8(0),j=Y.getUint32(1,!1);if(j>1048576)throw Error(`payload too large: ${j} bytes`);if($.byteLength<5+j)throw Error(`incomplete frame: need ${5+j} bytes, have ${$.byteLength}`);let Z=new Uint8Array($,5,j);return{feedId:J,payload:Z}}function b7($,Y){let J=JSON.stringify({cols:$,rows:Y});return{feedId:Y0.TERMINAL_RESIZE,payload:new TextEncoder().encode(J)}}var S4=15000,w9={CONNECTED:"connected",DISCONNECTED:"disconnected",RECONNECTING:"reconnecting"},L1=2000,g4=30000;class T7{ws=null;callbacks=new Map;openCallbacks=[];heartbeatTimer=null;url;state=w9.DISCONNECTED;retryDelay=L1;retryTimer=null;countdownTimer=null;countdownSeconds=0;bannerElement=null;intentionalClose=!1;lastCloseCode=null;lastCloseReason=null;constructor($){this.url=$}connect(){this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{console.log("tugdeck: WebSocket connected"),this.state=w9.CONNECTED,this.retryDelay=L1,this.hideDisconnectBanner(),this.startHeartbeat();for(let $ of this.openCallbacks)$()},this.ws.onmessage=($)=>{if($.data instanceof ArrayBuffer)try{let Y=B1($.data);this.dispatch(Y.feedId,Y.payload)}catch(Y){console.error("tugdeck: failed to decode frame:",Y)}},this.ws.onclose=($)=>{if(console.log("tugdeck: WebSocket closed",$.code,$.reason),this.stopHeartbeat(),this.lastCloseCode=$.code,this.lastCloseReason=$.reason||null,this.intentionalClose)return;this.state=w9.DISCONNECTED,this.scheduleReconnect(),this.retryDelay=Math.min(this.retryDelay*2,g4)},this.ws.onerror=($)=>{console.error("tugdeck: WebSocket error",$)}}scheduleReconnect(){if(this.retryTimer!==null)window.clearTimeout(this.retryTimer),this.retryTimer=null;this.countdownSeconds=Math.ceil(this.retryDelay/1000),this.showDisconnectBanner(),this.countdownTimer=window.setInterval(()=>{this.updateBannerCountdown()},1000),this.retryTimer=window.setTimeout(()=>{this.reconnect()},this.retryDelay)}reconnect(){if(this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null;this.state=w9.RECONNECTING,this.updateBannerText("Reconnecting..."),console.log("tugdeck: attempting reconnection"),this.connect()}showDisconnectBanner(){if(!this.bannerElement)this.bannerElement=document.getElementById("disconnect-banner");if(this.bannerElement)this.bannerElement.style.display="block",this.updateBannerText()}updateBannerText($){if(!this.bannerElement)return;if($){this.bannerElement.textContent=$;return}let Y="Disconnected";if(this.lastCloseReason&&this.lastCloseReason.trim()!=="")Y+=` (${this.lastCloseReason})`;Y+=` -- reconnecting in ${this.countdownSeconds}s...`,this.bannerElement.textContent=Y}updateBannerCountdown(){if(this.countdownSeconds=Math.max(0,this.countdownSeconds-1),this.updateBannerText(),this.countdownSeconds===0&&this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null}hideDisconnectBanner(){if(this.bannerElement)this.bannerElement.style.display="none";if(this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null}send($,Y){if(this.ws&&this.ws.readyState===WebSocket.OPEN){let J={feedId:$,payload:Y};this.ws.send(F1(J))}}onOpen($){this.openCallbacks.push($)}onFrame($,Y){if(!this.callbacks.has($))this.callbacks.set($,[]);this.callbacks.get($).push(Y)}close(){if(this.intentionalClose=!0,this.stopHeartbeat(),this.retryTimer!==null)window.clearTimeout(this.retryTimer),this.retryTimer=null;if(this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null;if(this.ws)this.ws.close(),this.ws=null}dispatch($,Y){let J=this.callbacks.get($);if(J)for(let j of J)j(Y)}startHeartbeat(){this.heartbeatTimer=window.setInterval(()=>{this.send(Y0.HEARTBEAT,new Uint8Array(0))},S4)}stopHeartbeat(){if(this.heartbeatTimer!==null)window.clearInterval(this.heartbeatTimer),this.heartbeatTimer=null}}var p4={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},D1=([$,Y,J])=>{let j=document.createElementNS("http://www.w3.org/2000/svg",$);if(Object.keys(Y).forEach((Z)=>{j.setAttribute(Z,String(Y[Z]))}),J?.length)J.forEach((Z)=>{let K=D1(Z);j.appendChild(K)});return j},C4=($,Y={})=>{let j={...p4,...Y};return D1(["svg",j,$])};var h4=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"}]];var d4=[["path",{d:"m6 9 6 6 6-6"}]];var u4=[["path",{d:"m18 15-6-6-6 6"}]];var c4=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m9 12 2 2 4-4"}]];var l4=[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7"}]];var s4=[["circle",{cx:"12",cy:"12",r:"10"}],["circle",{cx:"12",cy:"12",r:"1"}]];var o4=[["circle",{cx:"8",cy:"8",r:"6"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18"}],["path",{d:"M7 6h1v4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82"}]];var a4=[["path",{d:"M12.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v9.34"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"M10.378 12.622a1 1 0 0 1 3 3.003L8.36 20.637a2 2 0 0 1-.854.506l-2.867.837a.5.5 0 0 1-.62-.62l.836-2.869a2 2 0 0 1 .506-.853z"}]];var n4=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"M9 15h6"}],["path",{d:"M12 18v-6"}]];var r4=[["path",{d:"M4 11V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h7"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"m10 18 3-3-3-3"}]];var i4=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"m14.5 12.5-5 5"}],["path",{d:"m9.5 12.5 5 5"}]];var t4=[["path",{d:"M15 6a9 9 0 0 0-9 9V3"}],["circle",{cx:"18",cy:"6",r:"3"}],["circle",{cx:"6",cy:"18",r:"3"}]];var e4=[["path",{d:"m15 12-9.373 9.373a1 1 0 0 1-3.001-3L12 9"}],["path",{d:"m18 15 4-4"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172v-.344a2 2 0 0 0-.586-1.414l-1.657-1.657A6 6 0 0 0 12.516 3H9l1.243 1.243A6 6 0 0 1 12 8.485V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5"}]];var A7=h4;var f9=d4;var m9=u4;var P7=c4;var k7=l4;var w7=s4;var f7=o4;var m7=a4;var S7=n4;var g7=r4;var S9=i4;var p7=t4;var C7=e4;var W0=C4;var M1=100,b1="tugdeck-layout",T1=1,$$=500;class h7{cards=new Map;slots=new Map;gridContainer;connection;colSplit=0.667;rowSplits=[0.3333333333333333,0.6666666666666666];collapsedSlots=new Set;saveTimer=null;_isDragging=!1;constructor($,Y){this.connection=Y,this.gridContainer=document.createElement("div"),this.gridContainer.className="deck-grid",$.appendChild(this.gridContainer);for(let J of["terminal","git","files","stats"]){let j=document.createElement("div");j.className=`card-slot card-slot-${J}`,this.gridContainer.appendChild(j),this.slots.set(J,j)}this.createDragHandles(),this.loadLayout(),this.updateGridTracks(),window.addEventListener("resize",()=>this.handleResize()),Y.onOpen(()=>this.handleResize())}get isDragging(){return this._isDragging}addCard($,Y){this.cards.set(Y,$);for(let j of $.feedIds)this.connection.onFrame(j,(Z)=>{$.onFrame(j,Z)});let J=this.slots.get(Y);if(J){if($.mount(J),$.collapsible!==!1){let j=J.querySelector(".card-header");if(j){let Z=document.createElement("button");Z.className="collapse-btn";let K=this.collapsedSlots.has(Y)?W0(f9,{width:14,height:14}):W0(m9,{width:14,height:14});if(Z.appendChild(K),Z.addEventListener("click",()=>this.toggleCollapse(Y)),j.appendChild(Z),this.collapsedSlots.has(Y))this.applyCollapse(Y)}}}}toggleCollapse($){if(this.collapsedSlots.has($))this.expandCard($);else this.collapseCard($);this.scheduleSave()}collapseCard($){this.collapsedSlots.add($),this.applyCollapse($)}expandCard($){this.collapsedSlots.delete($),this.applyExpand($)}applyCollapse($){let Y=this.slots.get($);if(!Y)return;Y.classList.add("collapsed");let J=Y.querySelector(".collapse-btn");if(J)J.innerHTML="",J.appendChild(W0(f9,{width:14,height:14}));this.updateGridTracks()}applyExpand($){let Y=this.slots.get($);if(!Y)return;Y.classList.remove("collapsed");let J=Y.querySelector(".collapse-btn");if(J)J.innerHTML="",J.appendChild(W0(m9,{width:14,height:14}));this.updateGridTracks(),this.handleResize()}createDragHandles(){let $=document.createElement("div");$.className="drag-handle drag-handle-col",this.gridContainer.appendChild($),this.setupColDrag($);let Y=document.createElement("div");Y.className="drag-handle drag-handle-row",Y.dataset.index="0",this.gridContainer.appendChild(Y),this.setupRowDrag(Y,0);let J=document.createElement("div");J.className="drag-handle drag-handle-row",J.dataset.index="1",this.gridContainer.appendChild(J),this.setupRowDrag(J,1)}setupColDrag($){let Y=0,J=0;$.addEventListener("pointerdown",(j)=>{j.preventDefault(),$.setPointerCapture(j.pointerId),$.classList.add("active"),this._isDragging=!0,Y=j.clientX,J=this.colSplit;let Z=(Q)=>{let X=Q.clientX-Y,N=this.gridContainer.clientWidth,z=J+X/N,G=M1/N;z=Math.max(G,Math.min(1-G,z)),this.colSplit=z,this.updateGridTracks()},K=(Q)=>{this._isDragging=!1,$.releasePointerCapture(Q.pointerId),$.classList.remove("active"),$.removeEventListener("pointermove",Z),$.removeEventListener("pointerup",K),this.handleResize(),this.scheduleSave()};$.addEventListener("pointermove",Z),$.addEventListener("pointerup",K)})}setupRowDrag($,Y){let J=0,j=[];$.addEventListener("pointerdown",(Z)=>{Z.preventDefault(),$.setPointerCapture(Z.pointerId),$.classList.add("active"),this._isDragging=!0,J=Z.clientY,j=[...this.rowSplits];let K=(X)=>{let N=X.clientY-J,z=this.gridContainer.clientHeight,G=N/z,V=[...j],W=M1/z;if(Y===0)V[0]=Math.max(W,Math.min(V[1]-W,j[0]+G));else V[1]=Math.max(V[0]+W,Math.min(1-W,j[1]+G));this.rowSplits=V,this.updateGridTracks()},Q=(X)=>{this._isDragging=!1,$.releasePointerCapture(X.pointerId),$.classList.remove("active"),$.removeEventListener("pointermove",K),$.removeEventListener("pointerup",Q),this.handleResize(),this.scheduleSave()};$.addEventListener("pointermove",K),$.addEventListener("pointerup",Q)})}updateGridTracks(){let $=(this.colSplit*100).toFixed(2)+"%",Y=((1-this.colSplit)*100).toFixed(2)+"%";this.gridContainer.style.gridTemplateColumns=`${$} ${Y}`;let J=["git","files","stats"];if(J.some((Z)=>this.collapsedSlots.has(Z))){let Z=J.map((K)=>{return this.collapsedSlots.has(K)?"28px":"1fr"});this.gridContainer.style.gridTemplateRows=Z.join(" ")}else{let Z=(this.rowSplits[0]*100).toFixed(2)+"%",K=((this.rowSplits[1]-this.rowSplits[0])*100).toFixed(2)+"%",Q=((1-this.rowSplits[1])*100).toFixed(2)+"%";this.gridContainer.style.gridTemplateRows=`${Z} ${K} ${Q}`}this.positionHandles()}positionHandles(){let $=this.gridContainer.querySelectorAll(".drag-handle"),Y=$[0],J=$[1],j=$[2];if(Y)Y.style.left=`calc(${(this.colSplit*100).toFixed(2)}% - 3px)`;if(J)J.style.top=`calc(${(this.rowSplits[0]*100).toFixed(2)}% - 3px)`,J.style.left=`${(this.colSplit*100).toFixed(2)}%`;if(j)j.style.top=`calc(${(this.rowSplits[1]*100).toFixed(2)}% - 3px)`,j.style.left=`${(this.colSplit*100).toFixed(2)}%`}saveLayout(){try{let $={version:T1,colSplit:this.colSplit,rowSplits:this.rowSplits,collapsed:Array.from(this.collapsedSlots)};localStorage.setItem(b1,JSON.stringify($))}catch($){console.warn("tugdeck: failed to save layout to localStorage",$)}}scheduleSave(){if(this.saveTimer!==null)window.clearTimeout(this.saveTimer);this.saveTimer=window.setTimeout(()=>{this.saveLayout(),this.saveTimer=null},$$)}loadLayout(){try{let $=localStorage.getItem(b1);if(!$)return;let Y=JSON.parse($);if(Y.version!==T1){console.warn("tugdeck: layout version mismatch, using defaults");return}if(typeof Y.colSplit==="number"&&Y.colSplit>=0.1&&Y.colSplit<=0.9)this.colSplit=Y.colSplit;if(Array.isArray(Y.rowSplits)&&Y.rowSplits.length===2&&Y.rowSplits[0]>=0.1&&Y.rowSplits[1]>=Y.rowSplits[0]+0.1&&Y.rowSplits[1]<=0.9)this.rowSplits=Y.rowSplits;if(Array.isArray(Y.collapsed)){let J=["git","files","stats"],j=Y.collapsed.filter((Z)=>J.includes(Z));this.collapsedSlots=new Set(j)}}catch($){console.warn("tugdeck: failed to load layout from localStorage",$)}}handleResize(){for(let[$,Y]of this.cards){let J=this.slots.get($);if(J)Y.onResize(J.clientWidth,J.clientHeight)}}destroy(){if(this.saveTimer!==null)window.clearTimeout(this.saveTimer),this.saveTimer=null;for(let $ of this.cards.values())$.destroy();this.cards.clear()}}var{defineProperty:w5,getOwnPropertyDescriptor:Y$}=Object,J$=($,Y)=>{for(var J in Y)w5($,J,{get:Y[J],enumerable:!0})},j0=($,Y,J,j)=>{for(var Z=j>1?void 0:j?Y$(Y,J):Y,K=$.length-1,Q;K>=0;K--)(Q=$[K])&&(Z=(j?Q(Y,J,Z):Q(Z))||Z);return j&&Z&&w5(Y,J,Z),Z},T=($,Y)=>(J,j)=>Y(J,j,$),A1="Terminal input",Z6={get:()=>A1,set:($)=>A1=$},P1="Too much output to announce, navigate to rows manually to read",K6={get:()=>P1,set:($)=>P1=$};function j$($){return $.replace(/\r?\n/g,"\r")}function Z$($,Y){return Y?"\x1B[200~"+$+"\x1B[201~":$}function K$($,Y){$.clipboardData&&$.clipboardData.setData("text/plain",Y.selectionText),$.preventDefault()}function Q$($,Y,J,j){if($.stopPropagation(),$.clipboardData){let Z=$.clipboardData.getData("text/plain");f5(Z,Y,J,j)}}function f5($,Y,J,j){$=j$($),$=Z$($,J.decPrivateModes.bracketedPasteMode&&j.rawOptions.ignoreBracketedPasteMode!==!0),J.triggerDataEvent($,!0),Y.value=""}function m5($,Y,J){let j=J.getBoundingClientRect(),Z=$.clientX-j.left-10,K=$.clientY-j.top-10;Y.style.width="20px",Y.style.height="20px",Y.style.left=`${Z}px`,Y.style.top=`${K}px`,Y.style.zIndex="1000",Y.focus()}function k1($,Y,J,j,Z){m5($,Y,J),Z&&j.rightClickSelect($),Y.value=j.selectionText,Y.select()}function D8($){return $>65535?($-=65536,String.fromCharCode(($>>10)+55296)+String.fromCharCode($%1024+56320)):String.fromCharCode($)}function Q7($,Y=0,J=$.length){let j="";for(let Z=Y;Z<J;++Z){let K=$[Z];K>65535?(K-=65536,j+=String.fromCharCode((K>>10)+55296)+String.fromCharCode(K%1024+56320)):j+=String.fromCharCode(K)}return j}var X$=class{constructor(){this._interim=0}clear(){this._interim=0}decode($,Y){let J=$.length;if(!J)return 0;let j=0,Z=0;if(this._interim){let K=$.charCodeAt(Z++);56320<=K&&K<=57343?Y[j++]=(this._interim-55296)*1024+K-56320+65536:(Y[j++]=this._interim,Y[j++]=K),this._interim=0}for(let K=Z;K<J;++K){let Q=$.charCodeAt(K);if(55296<=Q&&Q<=56319){if(++K>=J)return this._interim=Q,j;let X=$.charCodeAt(K);56320<=X&&X<=57343?Y[j++]=(Q-55296)*1024+X-56320+65536:(Y[j++]=Q,Y[j++]=X);continue}Q!==65279&&(Y[j++]=Q)}return j}},z$=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode($,Y){let J=$.length;if(!J)return 0;let j=0,Z,K,Q,X,N=0,z=0;if(this.interim[0]){let W=!1,_=this.interim[0];_&=(_&224)===192?31:(_&240)===224?15:7;let H=0,U;for(;(U=this.interim[++H]&63)&&H<4;)_<<=6,_|=U;let B=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,A=B-H;for(;z<A;){if(z>=J)return 0;if(U=$[z++],(U&192)!==128){z--,W=!0;break}else this.interim[H++]=U,_<<=6,_|=U&63}W||(B===2?_<128?z--:Y[j++]=_:B===3?_<2048||_>=55296&&_<=57343||_===65279||(Y[j++]=_):_<65536||_>1114111||(Y[j++]=_)),this.interim.fill(0)}let G=J-4,V=z;for(;V<J;){for(;V<G&&!((Z=$[V])&128)&&!((K=$[V+1])&128)&&!((Q=$[V+2])&128)&&!((X=$[V+3])&128);)Y[j++]=Z,Y[j++]=K,Y[j++]=Q,Y[j++]=X,V+=4;if(Z=$[V++],Z<128)Y[j++]=Z;else if((Z&224)===192){if(V>=J)return this.interim[0]=Z,j;if(K=$[V++],(K&192)!==128){V--;continue}if(N=(Z&31)<<6|K&63,N<128){V--;continue}Y[j++]=N}else if((Z&240)===224){if(V>=J)return this.interim[0]=Z,j;if(K=$[V++],(K&192)!==128){V--;continue}if(V>=J)return this.interim[0]=Z,this.interim[1]=K,j;if(Q=$[V++],(Q&192)!==128){V--;continue}if(N=(Z&15)<<12|(K&63)<<6|Q&63,N<2048||N>=55296&&N<=57343||N===65279)continue;Y[j++]=N}else if((Z&248)===240){if(V>=J)return this.interim[0]=Z,j;if(K=$[V++],(K&192)!==128){V--;continue}if(V>=J)return this.interim[0]=Z,this.interim[1]=K,j;if(Q=$[V++],(Q&192)!==128){V--;continue}if(V>=J)return this.interim[0]=Z,this.interim[1]=K,this.interim[2]=Q,j;if(X=$[V++],(X&192)!==128){V--;continue}if(N=(Z&7)<<18|(K&63)<<12|(Q&63)<<6|X&63,N<65536||N>1114111)continue;Y[j++]=N}}return j}},S5="",M8=" ",E9=class ${constructor(){this.fg=0,this.bg=0,this.extended=new i9}static toColorRGB(Y){return[Y>>>16&255,Y>>>8&255,Y&255]}static fromColorRGB(Y){return(Y[0]&255)<<16|(Y[1]&255)<<8|Y[2]&255}clone(){let Y=new $;return Y.fg=this.fg,Y.bg=this.bg,Y.extended=this.extended.clone(),Y}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},i9=class ${constructor(Y=0,J=0){this._ext=0,this._urlId=0,this._ext=Y,this._urlId=J}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(Y){this._ext=Y}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(Y){this._ext&=-469762049,this._ext|=Y<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(Y){this._ext&=-67108864,this._ext|=Y&67108863}get urlId(){return this._urlId}set urlId(Y){this._urlId=Y}get underlineVariantOffset(){let Y=(this._ext&3758096384)>>29;return Y<0?Y^4294967288:Y}set underlineVariantOffset(Y){this._ext&=536870911,this._ext|=Y<<29&3758096384}clone(){return new $(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},o0=class $ extends E9{constructor(){super(...arguments);this.content=0,this.fg=0,this.bg=0,this.extended=new i9,this.combinedData=""}static fromCharData(Y){let J=new $;return J.setFromCharData(Y),J}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?D8(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(Y){this.fg=Y[0],this.bg=0;let J=!1;if(Y[1].length>2)J=!0;else if(Y[1].length===2){let j=Y[1].charCodeAt(0);if(55296<=j&&j<=56319){let Z=Y[1].charCodeAt(1);56320<=Z&&Z<=57343?this.content=(j-55296)*1024+Z-56320+65536|Y[2]<<22:J=!0}else J=!0}else this.content=Y[1].charCodeAt(0)|Y[2]<<22;J&&(this.combinedData=Y[1],this.content=2097152|Y[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},w1="di$target",Q6="di$dependencies",d7=new Map;function N$($){return $[Q6]||[]}function E0($){if(d7.has($))return d7.get($);let Y=function(J,j,Z){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");V$(Y,J,Z)};return Y._id=$,d7.set($,Y),Y}function V$($,Y,J){Y[w1]===Y?Y[Q6].push({id:$,index:J}):(Y[Q6]=[{id:$,index:J}],Y[w1]=Y)}var A0=E0("BufferService"),g5=E0("CoreMouseService"),h8=E0("CoreService"),G$=E0("CharsetService"),w6=E0("InstantiationService"),p5=E0("LogService"),P0=E0("OptionsService"),C5=E0("OscLinkService"),W$=E0("UnicodeService"),v9=E0("DecorationService"),X6=class{constructor($,Y,J){this._bufferService=$,this._optionsService=Y,this._oscLinkService=J}provideLinks($,Y){let J=this._bufferService.buffer.lines.get($-1);if(!J){Y(void 0);return}let j=[],Z=this._optionsService.rawOptions.linkHandler,K=new o0,Q=J.getTrimmedLength(),X=-1,N=-1,z=!1;for(let G=0;G<Q;G++)if(!(N===-1&&!J.hasContent(G))){if(J.loadCell(G,K),K.hasExtendedAttrs()&&K.extended.urlId)if(N===-1){N=G,X=K.extended.urlId;continue}else z=K.extended.urlId!==X;else N!==-1&&(z=!0);if(z||N!==-1&&G===Q-1){let V=this._oscLinkService.getLinkData(X)?.uri;if(V){let W={start:{x:N+1,y:$},end:{x:G+(!z&&G===Q-1?1:0),y:$}},_=!1;if(!Z?.allowNonHttpProtocols)try{let H=new URL(V);["http:","https:"].includes(H.protocol)||(_=!0)}catch{_=!0}_||j.push({text:V,range:W,activate:(H,U)=>Z?Z.activate(H,U,W):_$(H,U),hover:(H,U)=>Z?.hover?.(H,U,W),leave:(H,U)=>Z?.leave?.(H,U,W)})}z=!1,K.hasExtendedAttrs()&&K.extended.urlId?(N=G,X=K.extended.urlId):(N=-1,X=-1)}}Y(j)}};X6=j0([T(0,A0),T(1,P0),T(2,C5)],X6);function _$($,Y){if(confirm(`Do you want to navigate to ${Y}?

WARNING: This link could potentially be dangerous`)){let J=window.open();if(J){try{J.opener=null}catch{}J.location.href=Y}else console.warn("Opening link blocked as opener could not be cleared")}}var X7=E0("CharSizeService"),G8=E0("CoreBrowserService"),f6=E0("MouseService"),W8=E0("RenderService"),H$=E0("SelectionService"),h5=E0("CharacterJoinerService"),o8=E0("ThemeService"),d5=E0("LinkProviderService"),I$=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function($){setTimeout(()=>{throw $.stack?f1.isErrorNoTelemetry($)?new f1($.message+`

`+$.stack):Error($.message+`

`+$.stack):$},0)}}addListener($){return this.listeners.push($),()=>{this._removeListener($)}}emit($){this.listeners.forEach((Y)=>{Y($)})}_removeListener($){this.listeners.splice(this.listeners.indexOf($),1)}setUnexpectedErrorHandler($){this.unexpectedErrorHandler=$}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError($){this.unexpectedErrorHandler($),this.emit($)}onUnexpectedExternalError($){this.unexpectedErrorHandler($)}},x$=new I$;function u9($){U$($)||x$.onUnexpectedError($)}var z6="Canceled";function U$($){return $ instanceof O$?!0:$ instanceof Error&&$.name===z6&&$.message===z6}var O$=class extends Error{constructor(){super(z6),this.name=this.message}};function q$($){return $?Error(`Illegal argument: ${$}`):Error("Illegal argument")}var f1=class $ extends Error{constructor(Y){super(Y),this.name="CodeExpectedError"}static fromError(Y){if(Y instanceof $)return Y;let J=new $;return J.message=Y.message,J.stack=Y.stack,J}static isErrorNoTelemetry(Y){return Y.name==="CodeExpectedError"}},N6=class $ extends Error{constructor(Y){super(Y||"An unexpected bug occurred."),Object.setPrototypeOf(this,$.prototype)}};function E$($,Y,J=0,j=$.length){let Z=J,K=j;for(;Z<K;){let Q=Math.floor((Z+K)/2);Y($[Q])?Z=Q+1:K=Q}return Z-1}var v$=class ${constructor(Y){this._array=Y,this._findLastMonotonousLastIdx=0}findLastMonotonous(Y){if($.assertInvariants){if(this._prevFindLastPredicate){for(let j of this._array)if(this._prevFindLastPredicate(j)&&!Y(j))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=Y}let J=E$(this._array,Y,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=J+1,J===-1?void 0:this._array[J]}};v$.assertInvariants=!1;function g0($,Y=0){return $[$.length-(1+Y)]}var u5;(($)=>{function Y(K){return K<0}$.isLessThan=Y;function J(K){return K<=0}$.isLessThanOrEqual=J;function j(K){return K>0}$.isGreaterThan=j;function Z(K){return K===0}$.isNeitherLessOrGreaterThan=Z,$.greaterThan=1,$.lessThan=-1,$.neitherLessOrGreaterThan=0})(u5||={});function R$($,Y){return(J,j)=>Y($(J),$(j))}var y$=($,Y)=>$-Y,m1=class ${constructor(Y){this.iterate=Y}forEach(Y){this.iterate((J)=>(Y(J),!0))}toArray(){let Y=[];return this.iterate((J)=>(Y.push(J),!0)),Y}filter(Y){return new $((J)=>this.iterate((j)=>Y(j)?J(j):!0))}map(Y){return new $((J)=>this.iterate((j)=>J(Y(j))))}some(Y){let J=!1;return this.iterate((j)=>(J=Y(j),!J)),J}findFirst(Y){let J;return this.iterate((j)=>Y(j)?(J=j,!1):!0),J}findLast(Y){let J;return this.iterate((j)=>(Y(j)&&(J=j),!0)),J}findLastMaxBy(Y){let J,j=!0;return this.iterate((Z)=>((j||u5.isGreaterThan(Y(Z,J)))&&(j=!1,J=Z),!0)),J}};m1.empty=new m1(($)=>{});function F$($,Y){let J=Object.create(null);for(let j of $){let Z=Y(j),K=J[Z];K||(K=J[Z]=[]),K.push(j)}return J}var S1,g1,G3=class{constructor($,Y){this.toKey=Y,this._map=new Map,this[S1]="SetWithKey";for(let J of $)this.add(J)}get size(){return this._map.size}add($){let Y=this.toKey($);return this._map.set(Y,$),this}delete($){return this._map.delete(this.toKey($))}has($){return this._map.has(this.toKey($))}*entries(){for(let $ of this._map.values())yield[$,$]}keys(){return this.values()}*values(){for(let $ of this._map.values())yield $}clear(){this._map.clear()}forEach($,Y){this._map.forEach((J)=>$.call(Y,J,J,this))}[(g1=Symbol.iterator,S1=Symbol.toStringTag,g1)](){return this.values()}},B$=class{constructor(){this.map=new Map}add($,Y){let J=this.map.get($);J||(J=new Set,this.map.set($,J)),J.add(Y)}delete($,Y){let J=this.map.get($);J&&(J.delete(Y),J.size===0&&this.map.delete($))}forEach($,Y){let J=this.map.get($);J&&J.forEach(Y)}get($){return this.map.get($)||new Set}};function L$($,Y){let J=this,j=!1,Z;return function(){if(j)return Z;if(j=!0,Y)try{Z=$.apply(J,arguments)}finally{Y()}else Z=$.apply(J,arguments);return Z}}var c5;(($)=>{function Y(y){return y&&typeof y=="object"&&typeof y[Symbol.iterator]=="function"}$.is=Y;let J=Object.freeze([]);function j(){return J}$.empty=j;function*Z(y){yield y}$.single=Z;function K(y){return Y(y)?y:Z(y)}$.wrap=K;function Q(y){return y||J}$.from=Q;function*X(y){for(let b=y.length-1;b>=0;b--)yield y[b]}$.reverse=X;function N(y){return!y||y[Symbol.iterator]().next().done===!0}$.isEmpty=N;function z(y){return y[Symbol.iterator]().next().value}$.first=z;function G(y,b){let P=0;for(let p of y)if(b(p,P++))return!0;return!1}$.some=G;function V(y,b){for(let P of y)if(b(P))return P}$.find=V;function*W(y,b){for(let P of y)b(P)&&(yield P)}$.filter=W;function*_(y,b){let P=0;for(let p of y)yield b(p,P++)}$.map=_;function*H(y,b){let P=0;for(let p of y)yield*b(p,P++)}$.flatMap=H;function*U(...y){for(let b of y)yield*b}$.concat=U;function B(y,b,P){let p=P;for(let o of y)p=b(p,o);return p}$.reduce=B;function*A(y,b,P=y.length){for(b<0&&(b+=y.length),P<0?P+=y.length:P>y.length&&(P=y.length);b<P;b++)yield y[b]}$.slice=A;function k(y,b=Number.POSITIVE_INFINITY){let P=[];if(b===0)return[P,y];let p=y[Symbol.iterator]();for(let o=0;o<b;o++){let Q0=p.next();if(Q0.done)return[P,$.empty()];P.push(Q0.value)}return[P,{[Symbol.iterator](){return p}}]}$.consume=k;async function M(y){let b=[];for await(let P of y)b.push(P);return Promise.resolve(b)}$.asyncToArray=M})(c5||={});var D$=!1,g8=null,M$=class ${constructor(){this.livingDisposables=new Map}getDisposableData(Y){let J=this.livingDisposables.get(Y);return J||(J={parent:null,source:null,isSingleton:!1,value:Y,idx:$.idx++},this.livingDisposables.set(Y,J)),J}trackDisposable(Y){let J=this.getDisposableData(Y);J.source||(J.source=Error().stack)}setParent(Y,J){let j=this.getDisposableData(Y);j.parent=J}markAsDisposed(Y){this.livingDisposables.delete(Y)}markAsSingleton(Y){this.getDisposableData(Y).isSingleton=!0}getRootParent(Y,J){let j=J.get(Y);if(j)return j;let Z=Y.parent?this.getRootParent(this.getDisposableData(Y.parent),J):Y;return J.set(Y,Z),Z}getTrackedDisposables(){let Y=new Map;return[...this.livingDisposables.entries()].filter(([,J])=>J.source!==null&&!this.getRootParent(J,Y).isSingleton).flatMap(([J])=>J)}computeLeakingDisposables(Y=10,J){let j;if(J)j=J;else{let N=new Map,z=[...this.livingDisposables.values()].filter((V)=>V.source!==null&&!this.getRootParent(V,N).isSingleton);if(z.length===0)return;let G=new Set(z.map((V)=>V.value));if(j=z.filter((V)=>!(V.parent&&G.has(V.parent))),j.length===0)throw Error("There are cyclic diposable chains!")}if(!j)return;function Z(N){function z(V,W){for(;V.length>0&&W.some((_)=>typeof _=="string"?_===V[0]:V[0].match(_));)V.shift()}let G=N.source.split(`
`).map((V)=>V.trim().replace("at ","")).filter((V)=>V!=="");return z(G,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),G.reverse()}let K=new B$;for(let N of j){let z=Z(N);for(let G=0;G<=z.length;G++)K.add(z.slice(0,G).join(`
`),N)}j.sort(R$((N)=>N.idx,y$));let Q="",X=0;for(let N of j.slice(0,Y)){X++;let z=Z(N),G=[];for(let V=0;V<z.length;V++){let W=z[V];W=`(shared with ${K.get(z.slice(0,V+1).join(`
`)).size}/${j.length} leaks) at ${W}`;let _=K.get(z.slice(0,V).join(`
`)),H=F$([..._].map((U)=>Z(U)[V]),(U)=>U);delete H[z[V]];for(let[U,B]of Object.entries(H))G.unshift(`    - stacktraces of ${B.length} other leaks continue with ${U}`);G.unshift(W)}Q+=`


==================== Leaking disposable ${X}/${j.length}: ${N.value.constructor.name} ====================
${G.join(`
`)}
============================================================

`}return j.length>Y&&(Q+=`


... and ${j.length-Y} more leaking disposables

`),{leaks:j,details:Q}}};M$.idx=0;function b$($){g8=$}if(D$){let $="__is_disposable_tracked__";b$(new class{trackDisposable(Y){let J=Error("Potentially leaked disposable").stack;setTimeout(()=>{Y[$]||console.log(J)},3000)}setParent(Y,J){if(Y&&Y!==S.None)try{Y[$]=!0}catch{}}markAsDisposed(Y){if(Y&&Y!==S.None)try{Y[$]=!0}catch{}}markAsSingleton(Y){}})}function z7($){return g8?.trackDisposable($),$}function N7($){g8?.markAsDisposed($)}function x9($,Y){g8?.setParent($,Y)}function T$($,Y){if(g8)for(let J of $)g8.setParent(J,Y)}function p1($){return g8?.markAsSingleton($),$}function p8($){if(c5.is($)){let Y=[];for(let J of $)if(J)try{J.dispose()}catch(j){Y.push(j)}if(Y.length===1)throw Y[0];if(Y.length>1)throw AggregateError(Y,"Encountered errors while disposing of store");return Array.isArray($)?[]:$}else if($)return $.dispose(),$}function A$(...$){let Y=r(()=>p8($));return T$($,Y),Y}function r($){let Y=z7({dispose:L$(()=>{N7(Y),$()})});return Y}var l5=class ${constructor(){this._toDispose=new Set,this._isDisposed=!1,z7(this)}dispose(){this._isDisposed||(N7(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{p8(this._toDispose)}finally{this._toDispose.clear()}}add(Y){if(!Y)return Y;if(Y===this)throw Error("Cannot register a disposable on itself!");return x9(Y,this),this._isDisposed?$.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(Y),Y}delete(Y){if(Y){if(Y===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(Y),Y.dispose()}}deleteAndLeak(Y){Y&&this._toDispose.has(Y)&&(this._toDispose.delete(Y),x9(Y,null))}};l5.DISABLE_DISPOSED_WARNING=!1;var b8=l5,S=class{constructor(){this._store=new b8,z7(this),x9(this._store,this)}dispose(){N7(this),this._store.dispose()}_register($){if($===this)throw Error("Cannot register a disposable on itself!");return this._store.add($)}};S.None=Object.freeze({dispose(){}});var s8=class{constructor(){this._isDisposed=!1,z7(this)}get value(){return this._isDisposed?void 0:this._value}set value($){this._isDisposed||$===this._value||(this._value?.dispose(),$&&x9($,this),this._value=$)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,N7(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let $=this._value;return this._value=void 0,$&&x9($,null),$}},h0=typeof window=="object"?window:globalThis,V6=class ${constructor(Y){this.element=Y,this.next=$.Undefined,this.prev=$.Undefined}};V6.Undefined=new V6(void 0);var t=V6,C1=class{constructor(){this._first=t.Undefined,this._last=t.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===t.Undefined}clear(){let $=this._first;for(;$!==t.Undefined;){let Y=$.next;$.prev=t.Undefined,$.next=t.Undefined,$=Y}this._first=t.Undefined,this._last=t.Undefined,this._size=0}unshift($){return this._insert($,!1)}push($){return this._insert($,!0)}_insert($,Y){let J=new t($);if(this._first===t.Undefined)this._first=J,this._last=J;else if(Y){let Z=this._last;this._last=J,J.prev=Z,Z.next=J}else{let Z=this._first;this._first=J,J.next=Z,Z.prev=J}this._size+=1;let j=!1;return()=>{j||(j=!0,this._remove(J))}}shift(){if(this._first!==t.Undefined){let $=this._first.element;return this._remove(this._first),$}}pop(){if(this._last!==t.Undefined){let $=this._last.element;return this._remove(this._last),$}}_remove($){if($.prev!==t.Undefined&&$.next!==t.Undefined){let Y=$.prev;Y.next=$.next,$.next.prev=Y}else $.prev===t.Undefined&&$.next===t.Undefined?(this._first=t.Undefined,this._last=t.Undefined):$.next===t.Undefined?(this._last=this._last.prev,this._last.next=t.Undefined):$.prev===t.Undefined&&(this._first=this._first.next,this._first.prev=t.Undefined);this._size-=1}*[Symbol.iterator](){let $=this._first;for(;$!==t.Undefined;)yield $.element,$=$.next}},P$=globalThis.performance&&typeof globalThis.performance.now=="function",k$=class ${static create(Y){return new $(Y)}constructor(Y){this._now=P$&&Y===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},w$=!1,h1=!1,f$=!1,L0;(($)=>{$.None=()=>S.None;function Y(I){if(f$){let{onDidAddListener:x}=I,v=W6.create(),q=0;I.onDidAddListener=()=>{++q===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),v.print()),x?.()}}}function J(I,x){return W(I,()=>{},0,void 0,!0,void 0,x)}$.defer=J;function j(I){return(x,v=null,q)=>{let E=!1,O;return O=I((F)=>{if(!E)return O?O.dispose():E=!0,x.call(v,F)},null,q),E&&O.dispose(),O}}$.once=j;function Z(I,x,v){return G((q,E=null,O)=>I((F)=>q.call(E,x(F)),null,O),v)}$.map=Z;function K(I,x,v){return G((q,E=null,O)=>I((F)=>{x(F),q.call(E,F)},null,O),v)}$.forEach=K;function Q(I,x,v){return G((q,E=null,O)=>I((F)=>x(F)&&q.call(E,F),null,O),v)}$.filter=Q;function X(I){return I}$.signal=X;function N(...I){return(x,v=null,q)=>{let E=A$(...I.map((O)=>O((F)=>x.call(v,F))));return V(E,q)}}$.any=N;function z(I,x,v,q){let E=v;return Z(I,(O)=>(E=x(E,O),E),q)}$.reduce=z;function G(I,x){let v,q={onWillAddFirstListener(){v=I(E.fire,E)},onDidRemoveLastListener(){v?.dispose()}};x||Y(q);let E=new D(q);return x?.add(E),E.event}function V(I,x){return x instanceof Array?x.push(I):x&&x.add(I),I}function W(I,x,v=100,q=!1,E=!1,O,F){let L,w,u,C=0,d,B0={leakWarningThreshold:O,onWillAddFirstListener(){L=I((X0)=>{C++,w=x(w,X0),q&&!u&&(c.fire(w),w=void 0),d=()=>{let l=w;w=void 0,u=void 0,(!q||C>1)&&c.fire(l),C=0},typeof v=="number"?(clearTimeout(u),u=setTimeout(d,v)):u===void 0&&(u=0,queueMicrotask(d))})},onWillRemoveListener(){E&&C>0&&d?.()},onDidRemoveLastListener(){d=void 0,L.dispose()}};F||Y(B0);let c=new D(B0);return F?.add(c),c.event}$.debounce=W;function _(I,x=0,v){return $.debounce(I,(q,E)=>q?(q.push(E),q):[E],x,void 0,!0,void 0,v)}$.accumulate=_;function H(I,x=(q,E)=>q===E,v){let q=!0,E;return Q(I,(O)=>{let F=q||!x(O,E);return q=!1,E=O,F},v)}$.latch=H;function U(I,x,v){return[$.filter(I,x,v),$.filter(I,(q)=>!x(q),v)]}$.split=U;function B(I,x=!1,v=[],q){let E=v.slice(),O=I((w)=>{E?E.push(w):L.fire(w)});q&&q.add(O);let F=()=>{E?.forEach((w)=>L.fire(w)),E=null},L=new D({onWillAddFirstListener(){O||(O=I((w)=>L.fire(w)),q&&q.add(O))},onDidAddFirstListener(){E&&(x?setTimeout(F):F())},onDidRemoveLastListener(){O&&O.dispose(),O=null}});return q&&q.add(L),L.event}$.buffer=B;function A(I,x){return(v,q,E)=>{let O=x(new M);return I(function(F){let L=O.evaluate(F);L!==k&&v.call(q,L)},void 0,E)}}$.chain=A;let k=Symbol("HaltChainable");class M{constructor(){this.steps=[]}map(I){return this.steps.push(I),this}forEach(I){return this.steps.push((x)=>(I(x),x)),this}filter(I){return this.steps.push((x)=>I(x)?x:k),this}reduce(I,x){let v=x;return this.steps.push((q)=>(v=I(v,q),v)),this}latch(I=(x,v)=>x===v){let x=!0,v;return this.steps.push((q)=>{let E=x||!I(q,v);return x=!1,v=q,E?q:k}),this}evaluate(I){for(let x of this.steps)if(I=x(I),I===k)break;return I}}function y(I,x,v=(q)=>q){let q=(...L)=>F.fire(v(...L)),E=()=>I.on(x,q),O=()=>I.removeListener(x,q),F=new D({onWillAddFirstListener:E,onDidRemoveLastListener:O});return F.event}$.fromNodeEventEmitter=y;function b(I,x,v=(q)=>q){let q=(...L)=>F.fire(v(...L)),E=()=>I.addEventListener(x,q),O=()=>I.removeEventListener(x,q),F=new D({onWillAddFirstListener:E,onDidRemoveLastListener:O});return F.event}$.fromDOMEventEmitter=b;function P(I){return new Promise((x)=>j(I)(x))}$.toPromise=P;function p(I){let x=new D;return I.then((v)=>{x.fire(v)},()=>{x.fire(void 0)}).finally(()=>{x.dispose()}),x.event}$.fromPromise=p;function o(I,x){return I((v)=>x.fire(v))}$.forward=o;function Q0(I,x,v){return x(v),I((q)=>x(q))}$.runAndSubscribe=Q0;class b0{constructor(I,x){this._observable=I,this._counter=0,this._hasChanged=!1;let v={onWillAddFirstListener:()=>{I.addObserver(this)},onDidRemoveLastListener:()=>{I.removeObserver(this)}};x||Y(v),this.emitter=new D(v),x&&x.add(this.emitter)}beginUpdate(I){this._counter++}handlePossibleChange(I){}handleChange(I,x){this._hasChanged=!0}endUpdate(I){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function f(I,x){return new b0(I,x).emitter.event}$.fromObservable=f;function c0(I){return(x,v,q)=>{let E=0,O=!1,F={beginUpdate(){E++},endUpdate(){E--,E===0&&(I.reportChanges(),O&&(O=!1,x.call(v)))},handlePossibleChange(){},handleChange(){O=!0}};I.addObserver(F),I.reportChanges();let L={dispose(){I.removeObserver(F)}};return q instanceof b8?q.add(L):Array.isArray(q)&&q.push(L),L}}$.fromObservableLight=c0})(L0||={});var G6=class ${constructor(Y){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${Y}_${$._idPool++}`,$.all.add(this)}start(Y){this._stopWatch=new k$,this.listenerCount=Y}stop(){if(this._stopWatch){let Y=this._stopWatch.elapsed();this.durations.push(Y),this.elapsedOverall+=Y,this.invocationCount+=1,this._stopWatch=void 0}}};G6.all=new Set,G6._idPool=0;var m$=G6,d1=-1,s5=class ${constructor(Y,J,j=($._idPool++).toString(16).padStart(3,"0")){this._errorHandler=Y,this.threshold=J,this.name=j,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(Y,J){let j=this.threshold;if(j<=0||J<j)return;this._stacks||(this._stacks=new Map);let Z=this._stacks.get(Y.value)||0;if(this._stacks.set(Y.value,Z+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=j*0.5;let[K,Q]=this.getMostFrequentStack(),X=`[${this.name}] potential listener LEAK detected, having ${J} listeners already. MOST frequent listener (${Q}):`;console.warn(X),console.warn(K);let N=new g$(X,K);this._errorHandler(N)}return()=>{let K=this._stacks.get(Y.value)||0;this._stacks.set(Y.value,K-1)}}getMostFrequentStack(){if(!this._stacks)return;let Y,J=0;for(let[j,Z]of this._stacks)(!Y||J<Z)&&(Y=[j,Z],J=Z);return Y}};s5._idPool=1;var S$=s5,W6=class ${constructor(Y){this.value=Y}static create(){let Y=Error();return new $(Y.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},g$=class extends Error{constructor($,Y){super($),this.name="ListenerLeakError",this.stack=Y}},p$=class extends Error{constructor($,Y){super($),this.name="ListenerRefusalError",this.stack=Y}},C$=0,c9=class{constructor($){this.value=$,this.id=C$++}},h$=2,d$=($,Y)=>{if($ instanceof c9)Y($);else for(let J=0;J<$.length;J++){let j=$[J];j&&Y(j)}},l9;if(w$){let $=[];setInterval(()=>{$.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn($.join(`
`)),$.length=0)},3000),l9=new FinalizationRegistry((Y)=>{typeof Y=="string"&&$.push(Y)})}var D=class{constructor($){this._size=0,this._options=$,this._leakageMon=d1>0||this._options?.leakWarningThreshold?new S$($?.onListenerError??u9,this._options?.leakWarningThreshold??d1):void 0,this._perfMon=this._options?._profName?new m$(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(h1){let $=this._listeners;queueMicrotask(()=>{d$($,(Y)=>Y.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=($,Y,J)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let X=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(X);let N=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],z=new p$(`${X}. HINT: Stack shows most frequent listener (${N[1]}-times)`,N[0]);return(this._options?.onListenerError||u9)(z),S.None}if(this._disposed)return S.None;Y&&($=$.bind(Y));let j=new c9($),Z,K;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*0.2)&&(j.stack=W6.create(),Z=this._leakageMon.check(j.stack,this._size+1)),h1&&(j.stack=K??W6.create()),this._listeners?this._listeners instanceof c9?(this._deliveryQueue??=new u$,this._listeners=[this._listeners,j]):this._listeners.push(j):(this._options?.onWillAddFirstListener?.(this),this._listeners=j,this._options?.onDidAddFirstListener?.(this)),this._size++;let Q=r(()=>{l9?.unregister(Q),Z?.(),this._removeListener(j)});if(J instanceof b8?J.add(Q):Array.isArray(J)&&J.push(Q),l9){let X=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),N=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(X);l9.register(Q,N?.[2]??X,Q)}return Q},this._event}_removeListener($){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let Y=this._listeners,J=Y.indexOf($);if(J===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,Y[J]=void 0;let j=this._deliveryQueue.current===this;if(this._size*h$<=Y.length){let Z=0;for(let K=0;K<Y.length;K++)Y[K]?Y[Z++]=Y[K]:j&&(this._deliveryQueue.end--,Z<this._deliveryQueue.i&&this._deliveryQueue.i--);Y.length=Z}}_deliver($,Y){if(!$)return;let J=this._options?.onListenerError||u9;if(!J){$.value(Y);return}try{$.value(Y)}catch(j){J(j)}}_deliverQueue($){let Y=$.current._listeners;for(;$.i<$.end;)this._deliver(Y[$.i++],$.value);$.reset()}fire($){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof c9)this._deliver(this._listeners,$);else{let Y=this._deliveryQueue;Y.enqueue(this,$,this._listeners.length),this._deliverQueue(Y)}this._perfMon?.stop()}hasListeners(){return this._size>0}},u$=class{constructor(){this.i=-1,this.end=0}enqueue($,Y,J){this.i=0,this.end=J,this.current=$,this.value=Y}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},_6=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new D,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new D,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(Y){return this.mapWindowIdToZoomLevel.get(this.getWindowId(Y))??0}setZoomLevel(Y,J){if(this.getZoomLevel(J)===Y)return;let j=this.getWindowId(J);this.mapWindowIdToZoomLevel.set(j,Y),this._onDidChangeZoomLevel.fire(j)}getZoomFactor(Y){return this.mapWindowIdToZoomFactor.get(this.getWindowId(Y))??1}setZoomFactor(Y,J){this.mapWindowIdToZoomFactor.set(this.getWindowId(J),Y)}setFullscreen(Y,J){if(this.isFullscreen(J)===Y)return;let j=this.getWindowId(J);this.mapWindowIdToFullScreen.set(j,Y),this._onDidChangeFullscreen.fire(j)}isFullscreen(Y){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(Y))}getWindowId(Y){return Y.vscodeWindowId}};_6.INSTANCE=new _6;var m6=_6;function c$($,Y,J){typeof Y=="string"&&(Y=$.matchMedia(Y)),Y.addEventListener("change",J)}var W3=m6.INSTANCE.onDidChangeZoomLevel;function l$($){return m6.INSTANCE.getZoomFactor($)}var _3=m6.INSTANCE.onDidChangeFullscreen,a8=typeof navigator=="object"?navigator.userAgent:"",H6=a8.indexOf("Firefox")>=0,s9=a8.indexOf("AppleWebKit")>=0,S6=a8.indexOf("Chrome")>=0,o5=!S6&&a8.indexOf("Safari")>=0,H3=a8.indexOf("Electron/")>=0,I3=a8.indexOf("Android")>=0,o9=!1;if(typeof h0.matchMedia=="function"){let $=h0.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),Y=h0.matchMedia("(display-mode: fullscreen)");o9=$.matches,c$(h0,$,({matches:J})=>{o9&&Y.matches||(o9=J)})}function s$(){return o9}var l8="en",t9=!1,e9=!1,H9=!1,o$=!1,a5=!1,n5=!1,a$=!1,n$=!1,r$=!1,i$=!1,g9,a9=l8,u1=l8,t$,z8,V8=globalThis,C0;typeof V8.vscode<"u"&&typeof V8.vscode.process<"u"?C0=V8.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(C0=process);var r5=typeof C0?.versions?.electron=="string",e$=r5&&C0?.type==="renderer";if(typeof C0=="object"){t9=C0.platform==="win32",e9=C0.platform==="darwin",H9=C0.platform==="linux",o$=H9&&!!C0.env.SNAP&&!!C0.env.SNAP_REVISION,a$=r5,r$=!!C0.env.CI||!!C0.env.BUILD_ARTIFACTSTAGINGDIRECTORY,g9=l8,a9=l8;let $=C0.env.VSCODE_NLS_CONFIG;if($)try{let Y=JSON.parse($);g9=Y.userLocale,u1=Y.osLocale,a9=Y.resolvedLanguage||l8,t$=Y.languagePack?.translationsConfigFile}catch{}a5=!0}else typeof navigator=="object"&&!e$?(z8=navigator.userAgent,t9=z8.indexOf("Windows")>=0,e9=z8.indexOf("Macintosh")>=0,n$=(z8.indexOf("Macintosh")>=0||z8.indexOf("iPad")>=0||z8.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,H9=z8.indexOf("Linux")>=0,i$=z8?.indexOf("Mobi")>=0,n5=!0,a9=globalThis._VSCODE_NLS_LANGUAGE||l8,g9=navigator.language.toLowerCase(),u1=g9):console.error("Unable to resolve platform.");var u7=0;e9?u7=1:t9?u7=3:H9&&(u7=2);var i5=t9,J8=e9,$Y=H9,c7=a5,YY=n5&&typeof V8.importScripts=="function",x3=YY?V8.origin:void 0,j8=z8,y8=a9,JY;(($)=>{function Y(){return y8}$.value=Y;function J(){return y8.length===2?y8==="en":y8.length>=3?y8[0]==="e"&&y8[1]==="n"&&y8[2]==="-":!1}$.isDefaultVariant=J;function j(){return y8==="en"}$.isDefault=j})(JY||={});var jY=typeof V8.postMessage=="function"&&!V8.importScripts,ZY=(()=>{if(jY){let $=[];V8.addEventListener("message",(J)=>{if(J.data&&J.data.vscodeScheduleAsyncWork)for(let j=0,Z=$.length;j<Z;j++){let K=$[j];if(K.id===J.data.vscodeScheduleAsyncWork){$.splice(j,1),K.callback();return}}});let Y=0;return(J)=>{let j=++Y;$.push({id:j,callback:J}),V8.postMessage({vscodeScheduleAsyncWork:j},"*")}}return($)=>setTimeout($)})(),KY=!!(j8&&j8.indexOf("Chrome")>=0),U3=!!(j8&&j8.indexOf("Firefox")>=0),O3=!!(!KY&&j8&&j8.indexOf("Safari")>=0),q3=!!(j8&&j8.indexOf("Edg/")>=0),E3=!!(j8&&j8.indexOf("Android")>=0),F8=typeof navigator=="object"?navigator:{},v3={clipboard:{writeText:c7||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(F8&&F8.clipboard&&F8.clipboard.writeText),readText:c7||!!(F8&&F8.clipboard&&F8.clipboard.readText)},keyboard:c7||s$()?0:F8.keyboard||o5?1:2,touch:"ontouchstart"in h0||F8.maxTouchPoints>0,pointerEvents:h0.PointerEvent&&(("ontouchstart"in h0)||navigator.maxTouchPoints>0)},g6=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define($,Y){this._keyCodeToStr[$]=Y,this._strToKeyCode[Y.toLowerCase()]=$}keyCodeToStr($){return this._keyCodeToStr[$]}strToKeyCode($){return this._strToKeyCode[$.toLowerCase()]||0}},l7=new g6,c1=new g6,l1=new g6,QY=Array(230),t5;(($)=>{function Y(X){return l7.keyCodeToStr(X)}$.toString=Y;function J(X){return l7.strToKeyCode(X)}$.fromString=J;function j(X){return c1.keyCodeToStr(X)}$.toUserSettingsUS=j;function Z(X){return l1.keyCodeToStr(X)}$.toUserSettingsGeneral=Z;function K(X){return c1.strToKeyCode(X)||l1.strToKeyCode(X)}$.fromUserSettings=K;function Q(X){if(X>=98&&X<=113)return null;switch(X){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return l7.keyCodeToStr(X)}$.toElectronAccelerator=Q})(t5||={});var XY=class ${constructor(Y,J,j,Z,K){this.ctrlKey=Y,this.shiftKey=J,this.altKey=j,this.metaKey=Z,this.keyCode=K}equals(Y){return Y instanceof $&&this.ctrlKey===Y.ctrlKey&&this.shiftKey===Y.shiftKey&&this.altKey===Y.altKey&&this.metaKey===Y.metaKey&&this.keyCode===Y.keyCode}getHashCode(){let Y=this.ctrlKey?"1":"0",J=this.shiftKey?"1":"0",j=this.altKey?"1":"0",Z=this.metaKey?"1":"0";return`K${Y}${J}${j}${Z}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new zY([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},zY=class{constructor($){if($.length===0)throw q$("chords");this.chords=$}getHashCode(){let $="";for(let Y=0,J=this.chords.length;Y<J;Y++)Y!==0&&($+=";"),$+=this.chords[Y].getHashCode();return $}equals($){if($===null||this.chords.length!==$.chords.length)return!1;for(let Y=0;Y<this.chords.length;Y++)if(!this.chords[Y].equals($.chords[Y]))return!1;return!0}};function NY($){if($.charCode){let J=String.fromCharCode($.charCode).toUpperCase();return t5.fromString(J)}let Y=$.keyCode;if(Y===3)return 7;if(H6)switch(Y){case 59:return 85;case 60:if($Y)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(J8)return 57;break}else if(s9){if(J8&&Y===93)return 57;if(!J8&&Y===92)return 57}return QY[Y]||0}var VY=J8?256:2048,GY=512,WY=1024,_Y=J8?2048:256,I6=class{constructor($){this._standardKeyboardEventBrand=!0;let Y=$;this.browserEvent=Y,this.target=Y.target,this.ctrlKey=Y.ctrlKey,this.shiftKey=Y.shiftKey,this.altKey=Y.altKey,this.metaKey=Y.metaKey,this.altGraphKey=Y.getModifierState?.("AltGraph"),this.keyCode=NY(Y),this.code=Y.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals($){return this._asKeybinding===$}_computeKeybinding(){let $=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&($=this.keyCode);let Y=0;return this.ctrlKey&&(Y|=VY),this.altKey&&(Y|=GY),this.shiftKey&&(Y|=WY),this.metaKey&&(Y|=_Y),Y|=$,Y}_computeKeyCodeChord(){let $=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&($=this.keyCode),new XY(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,$)}},s1=new WeakMap;function HY($){if(!$.parent||$.parent===$)return null;try{let Y=$.location,J=$.parent.location;if(Y.origin!=="null"&&J.origin!=="null"&&Y.origin!==J.origin)return null}catch{return null}return $.parent}var IY=class{static getSameOriginWindowChain($){let Y=s1.get($);if(!Y){Y=[],s1.set($,Y);let J=$,j;do j=HY(J),j?Y.push({window:new WeakRef(J),iframeElement:J.frameElement||null}):Y.push({window:new WeakRef(J),iframeElement:null}),J=j;while(J)}return Y.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow($,Y){if(!Y||$===Y)return{top:0,left:0};let J=0,j=0,Z=this.getSameOriginWindowChain($);for(let K of Z){let Q=K.window.deref();if(J+=Q?.scrollY??0,j+=Q?.scrollX??0,Q===Y||!K.iframeElement)break;let X=K.iframeElement.getBoundingClientRect();J+=X.top,j+=X.left}return{top:J,left:j}}},z9=class{constructor($,Y){this.timestamp=Date.now(),this.browserEvent=Y,this.leftButton=Y.button===0,this.middleButton=Y.button===1,this.rightButton=Y.button===2,this.buttons=Y.buttons,this.target=Y.target,this.detail=Y.detail||1,Y.type==="dblclick"&&(this.detail=2),this.ctrlKey=Y.ctrlKey,this.shiftKey=Y.shiftKey,this.altKey=Y.altKey,this.metaKey=Y.metaKey,typeof Y.pageX=="number"?(this.posx=Y.pageX,this.posy=Y.pageY):(this.posx=Y.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=Y.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let J=IY.getPositionOfChildWindowRelativeToAncestorWindow($,Y.view);this.posx-=J.left,this.posy-=J.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},o1=class{constructor($,Y=0,J=0){this.browserEvent=$||null,this.target=$?$.target||$.targetNode||$.srcElement:null,this.deltaY=J,this.deltaX=Y;let j=!1;if(S6){let Z=navigator.userAgent.match(/Chrome\/(\d+)/);j=(Z?parseInt(Z[1]):123)<=122}if($){let Z=$,K=$,Q=$.view?.devicePixelRatio||1;if(typeof Z.wheelDeltaY<"u")j?this.deltaY=Z.wheelDeltaY/(120*Q):this.deltaY=Z.wheelDeltaY/120;else if(typeof K.VERTICAL_AXIS<"u"&&K.axis===K.VERTICAL_AXIS)this.deltaY=-K.detail/3;else if($.type==="wheel"){let X=$;X.deltaMode===X.DOM_DELTA_LINE?H6&&!J8?this.deltaY=-$.deltaY/3:this.deltaY=-$.deltaY:this.deltaY=-$.deltaY/40}if(typeof Z.wheelDeltaX<"u")o5&&i5?this.deltaX=-(Z.wheelDeltaX/120):j?this.deltaX=Z.wheelDeltaX/(120*Q):this.deltaX=Z.wheelDeltaX/120;else if(typeof K.HORIZONTAL_AXIS<"u"&&K.axis===K.HORIZONTAL_AXIS)this.deltaX=-$.detail/3;else if($.type==="wheel"){let X=$;X.deltaMode===X.DOM_DELTA_LINE?H6&&!J8?this.deltaX=-$.deltaX/3:this.deltaX=-$.deltaX:this.deltaX=-$.deltaX/40}this.deltaY===0&&this.deltaX===0&&$.wheelDelta&&(j?this.deltaY=$.wheelDelta/(120*Q):this.deltaY=$.wheelDelta/120)}}preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}},e5=Object.freeze(function($,Y){let J=setTimeout($.bind(Y),0);return{dispose(){clearTimeout(J)}}}),xY;(($)=>{function Y(J){return J===$.None||J===$.Cancelled||J instanceof UY?!0:!J||typeof J!="object"?!1:typeof J.isCancellationRequested=="boolean"&&typeof J.onCancellationRequested=="function"}$.isCancellationToken=Y,$.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:L0.None}),$.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:e5})})(xY||={});var UY=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?e5:(this._emitter||(this._emitter=new D),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},R3=Symbol("MicrotaskDelay"),p6=class{constructor($,Y){this._isDisposed=!1,this._token=-1,typeof $=="function"&&typeof Y=="number"&&this.setIfNotSet($,Y)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet($,Y){if(this._isDisposed)throw new N6("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,$()},Y)}setIfNotSet($,Y){if(this._isDisposed)throw new N6("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,$()},Y))}},OY=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet($,Y,J=globalThis){if(this.isDisposed)throw new N6("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let j=J.setInterval(()=>{$()},Y);this.disposable=r(()=>{J.clearInterval(j),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},qY,s7;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?s7=($,Y)=>{ZY(()=>{if(J)return;let j=Date.now()+15;Y(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,j-Date.now())}}))});let J=!1;return{dispose(){J||(J=!0)}}}:s7=($,Y,J)=>{let j=$.requestIdleCallback(Y,typeof J=="number"?{timeout:J}:void 0),Z=!1;return{dispose(){Z||(Z=!0,$.cancelIdleCallback(j))}}},qY=($)=>s7(globalThis,$)})();var EY;(($)=>{async function Y(j){let Z,K=await Promise.all(j.map((Q)=>Q.then((X)=>X,(X)=>{Z||(Z=X)})));if(typeof Z<"u")throw Z;return K}$.settled=Y;function J(j){return new Promise(async(Z,K)=>{try{await j(Z,K)}catch(Q){K(Q)}})}$.withAsyncBody=J})(EY||={});var a1=class ${static fromArray(Y){return new $((J)=>{J.emitMany(Y)})}static fromPromise(Y){return new $(async(J)=>{J.emitMany(await Y)})}static fromPromises(Y){return new $(async(J)=>{await Promise.all(Y.map(async(j)=>J.emitOne(await j)))})}static merge(Y){return new $(async(J)=>{await Promise.all(Y.map(async(j)=>{for await(let Z of j)J.emitOne(Z)}))})}constructor(Y,J){this._state=0,this._results=[],this._error=null,this._onReturn=J,this._onStateChanged=new D,queueMicrotask(async()=>{let j={emitOne:(Z)=>this.emitOne(Z),emitMany:(Z)=>this.emitMany(Z),reject:(Z)=>this.reject(Z)};try{await Promise.resolve(Y(j)),this.resolve()}catch(Z){this.reject(Z)}finally{j.emitOne=void 0,j.emitMany=void 0,j.reject=void 0}})}[Symbol.asyncIterator](){let Y=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(Y<this._results.length)return{done:!1,value:this._results[Y++]};if(this._state===1)return{done:!0,value:void 0};await L0.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(Y,J){return new $(async(j)=>{for await(let Z of Y)j.emitOne(J(Z))})}map(Y){return $.map(this,Y)}static filter(Y,J){return new $(async(j)=>{for await(let Z of Y)J(Z)&&j.emitOne(Z)})}filter(Y){return $.filter(this,Y)}static coalesce(Y){return $.filter(Y,(J)=>!!J)}coalesce(){return $.coalesce(this)}static async toPromise(Y){let J=[];for await(let j of Y)J.push(j);return J}toPromise(){return $.toPromise(this)}emitOne(Y){this._state===0&&(this._results.push(Y),this._onStateChanged.fire())}emitMany(Y){this._state===0&&(this._results=this._results.concat(Y),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(Y){this._state===0&&(this._state=2,this._error=Y,this._onStateChanged.fire())}};a1.EMPTY=a1.fromArray([]);function vY($){return 55296<=$&&$<=56319}function n1($){return 56320<=$&&$<=57343}function RY($,Y){return($-55296<<10)+(Y-56320)+65536}function yY($){return C6($,0)}function C6($,Y){switch(typeof $){case"object":return $===null?N8(349,Y):Array.isArray($)?BY($,Y):LY($,Y);case"string":return $2($,Y);case"boolean":return FY($,Y);case"number":return N8($,Y);case"undefined":return N8(937,Y);default:return N8(617,Y)}}function N8($,Y){return(Y<<5)-Y+$|0}function FY($,Y){return N8($?433:863,Y)}function $2($,Y){Y=N8(149417,Y);for(let J=0,j=$.length;J<j;J++)Y=N8($.charCodeAt(J),Y);return Y}function BY($,Y){return Y=N8(104579,Y),$.reduce((J,j)=>C6(j,J),Y)}function LY($,Y){return Y=N8(181387,Y),Object.keys($).sort().reduce((J,j)=>(J=$2(j,J),C6($[j],J)),Y)}function o7($,Y,J=32){let j=J-Y,Z=~((1<<j)-1);return($<<Y|(Z&$)>>>j)>>>0}function r1($,Y=0,J=$.byteLength,j=0){for(let Z=0;Z<J;Z++)$[Y+Z]=j}function DY($,Y,J="0"){for(;$.length<Y;)$=J+$;return $}function Y9($,Y=32){return $ instanceof ArrayBuffer?Array.from(new Uint8Array($)).map((J)=>J.toString(16).padStart(2,"0")).join(""):DY(($>>>0).toString(16),Y/4)}var MY=class ${constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(Y){let J=Y.length;if(J===0)return;let j=this._buff,Z=this._buffLen,K=this._leftoverHighSurrogate,Q,X;for(K!==0?(Q=K,X=-1,K=0):(Q=Y.charCodeAt(0),X=0);;){let N=Q;if(vY(Q))if(X+1<J){let z=Y.charCodeAt(X+1);n1(z)?(X++,N=RY(Q,z)):N=65533}else{K=Q;break}else n1(Q)&&(N=65533);if(Z=this._push(j,Z,N),X++,X<J)Q=Y.charCodeAt(X);else break}this._buffLen=Z,this._leftoverHighSurrogate=K}_push(Y,J,j){return j<128?Y[J++]=j:j<2048?(Y[J++]=192|(j&1984)>>>6,Y[J++]=128|(j&63)>>>0):j<65536?(Y[J++]=224|(j&61440)>>>12,Y[J++]=128|(j&4032)>>>6,Y[J++]=128|(j&63)>>>0):(Y[J++]=240|(j&1835008)>>>18,Y[J++]=128|(j&258048)>>>12,Y[J++]=128|(j&4032)>>>6,Y[J++]=128|(j&63)>>>0),J>=64&&(this._step(),J-=64,this._totalLen+=64,Y[0]=Y[64],Y[1]=Y[65],Y[2]=Y[66]),J}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),Y9(this._h0)+Y9(this._h1)+Y9(this._h2)+Y9(this._h3)+Y9(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,r1(this._buff,this._buffLen),this._buffLen>56&&(this._step(),r1(this._buff));let Y=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(Y/4294967296),!1),this._buffDV.setUint32(60,Y%4294967296,!1),this._step()}_step(){let Y=$._bigBlock32,J=this._buffDV;for(let V=0;V<64;V+=4)Y.setUint32(V,J.getUint32(V,!1),!1);for(let V=64;V<320;V+=4)Y.setUint32(V,o7(Y.getUint32(V-12,!1)^Y.getUint32(V-32,!1)^Y.getUint32(V-56,!1)^Y.getUint32(V-64,!1),1),!1);let j=this._h0,Z=this._h1,K=this._h2,Q=this._h3,X=this._h4,N,z,G;for(let V=0;V<80;V++)V<20?(N=Z&K|~Z&Q,z=1518500249):V<40?(N=Z^K^Q,z=1859775393):V<60?(N=Z&K|Z&Q|K&Q,z=2400959708):(N=Z^K^Q,z=3395469782),G=o7(j,5)+N+X+z+Y.getUint32(V*4,!1)&4294967295,X=Q,Q=K,K=o7(Z,30),Z=j,j=G;this._h0=this._h0+j&4294967295,this._h1=this._h1+Z&4294967295,this._h2=this._h2+K&4294967295,this._h3=this._h3+Q&4294967295,this._h4=this._h4+X&4294967295}};MY._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:y3,getWindow:r0,getDocument:F3,getWindows:B3,getWindowsCount:L3,getWindowId:i1,getWindowById:D3,hasWindow:M3,onDidRegisterWindow:bY,onWillUnregisterWindow:b3,onDidUnregisterWindow:T3}=function(){let $=new Map,Y={window:h0,disposables:new b8};$.set(h0.vscodeWindowId,Y);let J=new D,j=new D,Z=new D;function K(Q,X){return(typeof Q=="number"?$.get(Q):void 0)??(X?Y:void 0)}return{onDidRegisterWindow:J.event,onWillUnregisterWindow:Z.event,onDidUnregisterWindow:j.event,registerWindow(Q){if($.has(Q.vscodeWindowId))return S.None;let X=new b8,N={window:Q,disposables:X.add(new b8)};return $.set(Q.vscodeWindowId,N),X.add(r(()=>{$.delete(Q.vscodeWindowId),j.fire(Q)})),X.add(m(Q,x0.BEFORE_UNLOAD,()=>{Z.fire(Q)})),J.fire(N),X},getWindows(){return $.values()},getWindowsCount(){return $.size},getWindowId(Q){return Q.vscodeWindowId},hasWindow(Q){return $.has(Q)},getWindowById:K,getWindow(Q){let X=Q;if(X?.ownerDocument?.defaultView)return X.ownerDocument.defaultView.window;let N=Q;return N?.view?N.view.window:h0},getDocument(Q){return r0(Q).document}}}(),TY=class{constructor($,Y,J,j){this._node=$,this._type=Y,this._handler=J,this._options=j||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function m($,Y,J,j){return new TY($,Y,J,j)}function AY($,Y){return function(J){return Y(new z9($,J))}}function PY($){return function(Y){return $(new I6(Y))}}var t1=function($,Y,J,j){let Z=J;return Y==="click"||Y==="mousedown"||Y==="contextmenu"?Z=AY(r0($),J):(Y==="keydown"||Y==="keypress"||Y==="keyup")&&(Z=PY(J)),m($,Y,Z,j)},kY,$7,wY=class extends OY{constructor($){super(),this.defaultTarget=$&&r0($)}cancelAndSet($,Y,J){return super.cancelAndSet($,Y,J??this.defaultTarget)}},a7=class{constructor($,Y=0){this._runner=$,this.priority=Y,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch($){u9($)}}static sort($,Y){return Y.priority-$.priority}};(function(){let $=new Map,Y=new Map,J=new Map,j=new Map,Z=(K)=>{J.set(K,!1);let Q=$.get(K)??[];for(Y.set(K,Q),$.set(K,[]),j.set(K,!0);Q.length>0;)Q.sort(a7.sort),Q.shift().execute();j.set(K,!1)};$7=(K,Q,X=0)=>{let N=i1(K),z=new a7(Q,X),G=$.get(N);return G||(G=[],$.set(N,G)),G.push(z),J.get(N)||(J.set(N,!0),K.requestAnimationFrame(()=>Z(N))),z},kY=(K,Q,X)=>{let N=i1(K);if(j.get(N)){let z=new a7(Q,X),G=Y.get(N);return G||(G=[],Y.set(N,G)),G.push(z),z}else return $7(K,Q,X)}})();var e1=class ${constructor(Y,J){this.width=Y,this.height=J}with(Y=this.width,J=this.height){return Y!==this.width||J!==this.height?new $(Y,J):this}static is(Y){return typeof Y=="object"&&typeof Y.height=="number"&&typeof Y.width=="number"}static lift(Y){return Y instanceof $?Y:new $(Y.width,Y.height)}static equals(Y,J){return Y===J?!0:!Y||!J?!1:Y.width===J.width&&Y.height===J.height}};e1.None=new e1(0,0);function fY($){let Y=$.getBoundingClientRect(),J=r0($);return{left:Y.left+J.scrollX,top:Y.top+J.scrollY,width:Y.width,height:Y.height}}var A3=new class{constructor(){this.mutationObservers=new Map}observe($,Y,J){let j=this.mutationObservers.get($);j||(j=new Map,this.mutationObservers.set($,j));let Z=yY(J),K=j.get(Z);if(K)K.users+=1;else{let Q=new D,X=new MutationObserver((z)=>Q.fire(z));X.observe($,J);let N=K={users:1,observer:X,onDidMutate:Q.event};Y.add(r(()=>{N.users-=1,N.users===0&&(Q.dispose(),X.disconnect(),j?.delete(Z),j?.size===0&&this.mutationObservers.delete($))})),j.set(Z,K)}return K.onDidMutate}},x0={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:s9?"webkitAnimationStart":"animationstart",ANIMATION_END:s9?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:s9?"webkitAnimationIteration":"animationiteration"},mY=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function Y2($,Y,J,...j){let Z=mY.exec(Y);if(!Z)throw Error("Bad use of emmet");let K=Z[1]||"div",Q;return $!=="http://www.w3.org/1999/xhtml"?Q=document.createElementNS($,K):Q=document.createElement(K),Z[3]&&(Q.id=Z[3]),Z[4]&&(Q.className=Z[4].replace(/\./g," ").trim()),J&&Object.entries(J).forEach(([X,N])=>{typeof N>"u"||(/^on\w+$/.test(X)?Q[X]=N:X==="selected"?N&&Q.setAttribute(X,"true"):Q.setAttribute(X,N))}),Q.append(...j),Q}function SY($,Y,...J){return Y2("http://www.w3.org/1999/xhtml",$,Y,...J)}SY.SVG=function($,Y,...J){return Y2("http://www.w3.org/2000/svg",$,Y,...J)};var gY=class{constructor($){this.domNode=$,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth($){let Y=f0($);this._maxWidth!==Y&&(this._maxWidth=Y,this.domNode.style.maxWidth=this._maxWidth)}setWidth($){let Y=f0($);this._width!==Y&&(this._width=Y,this.domNode.style.width=this._width)}setHeight($){let Y=f0($);this._height!==Y&&(this._height=Y,this.domNode.style.height=this._height)}setTop($){let Y=f0($);this._top!==Y&&(this._top=Y,this.domNode.style.top=this._top)}setLeft($){let Y=f0($);this._left!==Y&&(this._left=Y,this.domNode.style.left=this._left)}setBottom($){let Y=f0($);this._bottom!==Y&&(this._bottom=Y,this.domNode.style.bottom=this._bottom)}setRight($){let Y=f0($);this._right!==Y&&(this._right=Y,this.domNode.style.right=this._right)}setPaddingTop($){let Y=f0($);this._paddingTop!==Y&&(this._paddingTop=Y,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft($){let Y=f0($);this._paddingLeft!==Y&&(this._paddingLeft=Y,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom($){let Y=f0($);this._paddingBottom!==Y&&(this._paddingBottom=Y,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight($){let Y=f0($);this._paddingRight!==Y&&(this._paddingRight=Y,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily($){this._fontFamily!==$&&(this._fontFamily=$,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight($){this._fontWeight!==$&&(this._fontWeight=$,this.domNode.style.fontWeight=this._fontWeight)}setFontSize($){let Y=f0($);this._fontSize!==Y&&(this._fontSize=Y,this.domNode.style.fontSize=this._fontSize)}setFontStyle($){this._fontStyle!==$&&(this._fontStyle=$,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings($){this._fontFeatureSettings!==$&&(this._fontFeatureSettings=$,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings($){this._fontVariationSettings!==$&&(this._fontVariationSettings=$,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration($){this._textDecoration!==$&&(this._textDecoration=$,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight($){let Y=f0($);this._lineHeight!==Y&&(this._lineHeight=Y,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing($){let Y=f0($);this._letterSpacing!==Y&&(this._letterSpacing=Y,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName($){this._className!==$&&(this._className=$,this.domNode.className=this._className)}toggleClassName($,Y){this.domNode.classList.toggle($,Y),this._className=this.domNode.className}setDisplay($){this._display!==$&&(this._display=$,this.domNode.style.display=this._display)}setPosition($){this._position!==$&&(this._position=$,this.domNode.style.position=this._position)}setVisibility($){this._visibility!==$&&(this._visibility=$,this.domNode.style.visibility=this._visibility)}setColor($){this._color!==$&&(this._color=$,this.domNode.style.color=this._color)}setBackgroundColor($){this._backgroundColor!==$&&(this._backgroundColor=$,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting($){this._layerHint!==$&&(this._layerHint=$,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow($){this._boxShadow!==$&&(this._boxShadow=$,this.domNode.style.boxShadow=$)}setContain($){this._contain!==$&&(this._contain=$,this.domNode.style.contain=this._contain)}setAttribute($,Y){this.domNode.setAttribute($,Y)}removeAttribute($){this.domNode.removeAttribute($)}appendChild($){this.domNode.appendChild($.domNode)}removeChild($){this.domNode.removeChild($.domNode)}};function f0($){return typeof $=="number"?`${$}px`:$}function I9($){return new gY($)}var J2=class{constructor(){this._hooks=new b8,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring($,Y){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let J=this._onStopCallback;this._onStopCallback=null,$&&J&&J(Y)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring($,Y,J,j,Z){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=j,this._onStopCallback=Z;let K=$;try{$.setPointerCapture(Y),this._hooks.add(r(()=>{try{$.releasePointerCapture(Y)}catch{}}))}catch{K=r0($)}this._hooks.add(m(K,x0.POINTER_MOVE,(Q)=>{if(Q.buttons!==J){this.stopMonitoring(!0);return}Q.preventDefault(),this._pointerMoveCallback(Q)})),this._hooks.add(m(K,x0.POINTER_UP,(Q)=>this.stopMonitoring(!0)))}};function pY($,Y,J){let j=null,Z=null;if(typeof J.value=="function"?(j="value",Z=J.value,Z.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof J.get=="function"&&(j="get",Z=J.get),!Z)throw Error("not supported");let K=`$memoize$${Y}`;J[j]=function(...Q){return this.hasOwnProperty(K)||Object.defineProperty(this,K,{configurable:!1,enumerable:!1,writable:!1,value:Z.apply(this,Q)}),this[K]}}var Y8;(($)=>($.Tap="-xterm-gesturetap",$.Change="-xterm-gesturechange",$.Start="-xterm-gesturestart",$.End="-xterm-gesturesend",$.Contextmenu="-xterm-gesturecontextmenu"))(Y8||={});var N9=class $ extends S{constructor(){super();this.dispatched=!1,this.targets=new C1,this.ignoreTargets=new C1,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(L0.runAndSubscribe(bY,({window:Y,disposables:J})=>{J.add(m(Y.document,"touchstart",(j)=>this.onTouchStart(j),{passive:!1})),J.add(m(Y.document,"touchend",(j)=>this.onTouchEnd(Y,j))),J.add(m(Y.document,"touchmove",(j)=>this.onTouchMove(j),{passive:!1}))},{window:h0,disposables:this._store}))}static addTarget(Y){if(!$.isTouchDevice())return S.None;$.INSTANCE||($.INSTANCE=p1(new $));let J=$.INSTANCE.targets.push(Y);return r(J)}static ignoreTarget(Y){if(!$.isTouchDevice())return S.None;$.INSTANCE||($.INSTANCE=p1(new $));let J=$.INSTANCE.ignoreTargets.push(Y);return r(J)}static isTouchDevice(){return"ontouchstart"in h0||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(Y){let J=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let j=0,Z=Y.targetTouches.length;j<Z;j++){let K=Y.targetTouches.item(j);this.activeTouches[K.identifier]={id:K.identifier,initialTarget:K.target,initialTimeStamp:J,initialPageX:K.pageX,initialPageY:K.pageY,rollingTimestamps:[J],rollingPageX:[K.pageX],rollingPageY:[K.pageY]};let Q=this.newGestureEvent(Y8.Start,K.target);Q.pageX=K.pageX,Q.pageY=K.pageY,this.dispatchEvent(Q)}this.dispatched&&(Y.preventDefault(),Y.stopPropagation(),this.dispatched=!1)}onTouchEnd(Y,J){let j=Date.now(),Z=Object.keys(this.activeTouches).length;for(let K=0,Q=J.changedTouches.length;K<Q;K++){let X=J.changedTouches.item(K);if(!this.activeTouches.hasOwnProperty(String(X.identifier))){console.warn("move of an UNKNOWN touch",X);continue}let N=this.activeTouches[X.identifier],z=Date.now()-N.initialTimeStamp;if(z<$.HOLD_DELAY&&Math.abs(N.initialPageX-g0(N.rollingPageX))<30&&Math.abs(N.initialPageY-g0(N.rollingPageY))<30){let G=this.newGestureEvent(Y8.Tap,N.initialTarget);G.pageX=g0(N.rollingPageX),G.pageY=g0(N.rollingPageY),this.dispatchEvent(G)}else if(z>=$.HOLD_DELAY&&Math.abs(N.initialPageX-g0(N.rollingPageX))<30&&Math.abs(N.initialPageY-g0(N.rollingPageY))<30){let G=this.newGestureEvent(Y8.Contextmenu,N.initialTarget);G.pageX=g0(N.rollingPageX),G.pageY=g0(N.rollingPageY),this.dispatchEvent(G)}else if(Z===1){let G=g0(N.rollingPageX),V=g0(N.rollingPageY),W=g0(N.rollingTimestamps)-N.rollingTimestamps[0],_=G-N.rollingPageX[0],H=V-N.rollingPageY[0],U=[...this.targets].filter((B)=>N.initialTarget instanceof Node&&B.contains(N.initialTarget));this.inertia(Y,U,j,Math.abs(_)/W,_>0?1:-1,G,Math.abs(H)/W,H>0?1:-1,V)}this.dispatchEvent(this.newGestureEvent(Y8.End,N.initialTarget)),delete this.activeTouches[X.identifier]}this.dispatched&&(J.preventDefault(),J.stopPropagation(),this.dispatched=!1)}newGestureEvent(Y,J){let j=document.createEvent("CustomEvent");return j.initEvent(Y,!1,!0),j.initialTarget=J,j.tapCount=0,j}dispatchEvent(Y){if(Y.type===Y8.Tap){let J=new Date().getTime(),j=0;J-this._lastSetTapCountTime>$.CLEAR_TAP_COUNT_TIME?j=1:j=2,this._lastSetTapCountTime=J,Y.tapCount=j}else(Y.type===Y8.Change||Y.type===Y8.Contextmenu)&&(this._lastSetTapCountTime=0);if(Y.initialTarget instanceof Node){for(let j of this.ignoreTargets)if(j.contains(Y.initialTarget))return;let J=[];for(let j of this.targets)if(j.contains(Y.initialTarget)){let Z=0,K=Y.initialTarget;for(;K&&K!==j;)Z++,K=K.parentElement;J.push([Z,j])}J.sort((j,Z)=>j[0]-Z[0]);for(let[j,Z]of J)Z.dispatchEvent(Y),this.dispatched=!0}}inertia(Y,J,j,Z,K,Q,X,N,z){this.handle=$7(Y,()=>{let G=Date.now(),V=G-j,W=0,_=0,H=!0;Z+=$.SCROLL_FRICTION*V,X+=$.SCROLL_FRICTION*V,Z>0&&(H=!1,W=K*Z*V),X>0&&(H=!1,_=N*X*V);let U=this.newGestureEvent(Y8.Change);U.translationX=W,U.translationY=_,J.forEach((B)=>B.dispatchEvent(U)),H||this.inertia(Y,J,G,Z,K,Q+W,X,N,z+_)})}onTouchMove(Y){let J=Date.now();for(let j=0,Z=Y.changedTouches.length;j<Z;j++){let K=Y.changedTouches.item(j);if(!this.activeTouches.hasOwnProperty(String(K.identifier))){console.warn("end of an UNKNOWN touch",K);continue}let Q=this.activeTouches[K.identifier],X=this.newGestureEvent(Y8.Change,Q.initialTarget);X.translationX=K.pageX-g0(Q.rollingPageX),X.translationY=K.pageY-g0(Q.rollingPageY),X.pageX=K.pageX,X.pageY=K.pageY,this.dispatchEvent(X),Q.rollingPageX.length>3&&(Q.rollingPageX.shift(),Q.rollingPageY.shift(),Q.rollingTimestamps.shift()),Q.rollingPageX.push(K.pageX),Q.rollingPageY.push(K.pageY),Q.rollingTimestamps.push(J)}this.dispatched&&(Y.preventDefault(),Y.stopPropagation(),this.dispatched=!1)}};N9.SCROLL_FRICTION=-0.005,N9.HOLD_DELAY=700,N9.CLEAR_TAP_COUNT_TIME=400,j0([pY],N9,"isTouchDevice",1);var CY=N9,h6=class extends S{onclick($,Y){this._register(m($,x0.CLICK,(J)=>Y(new z9(r0($),J))))}onmousedown($,Y){this._register(m($,x0.MOUSE_DOWN,(J)=>Y(new z9(r0($),J))))}onmouseover($,Y){this._register(m($,x0.MOUSE_OVER,(J)=>Y(new z9(r0($),J))))}onmouseleave($,Y){this._register(m($,x0.MOUSE_LEAVE,(J)=>Y(new z9(r0($),J))))}onkeydown($,Y){this._register(m($,x0.KEY_DOWN,(J)=>Y(new I6(J))))}onkeyup($,Y){this._register(m($,x0.KEY_UP,(J)=>Y(new I6(J))))}oninput($,Y){this._register(m($,x0.INPUT,Y))}onblur($,Y){this._register(m($,x0.BLUR,Y))}onfocus($,Y){this._register(m($,x0.FOCUS,Y))}onchange($,Y){this._register(m($,x0.CHANGE,Y))}ignoreGesture($){return CY.ignoreTarget($)}},$5=11,hY=class extends h6{constructor($){super(),this._onActivate=$.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=$.bgWidth+"px",this.bgDomNode.style.height=$.bgHeight+"px",typeof $.top<"u"&&(this.bgDomNode.style.top="0px"),typeof $.left<"u"&&(this.bgDomNode.style.left="0px"),typeof $.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof $.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=$.className,this.domNode.style.position="absolute",this.domNode.style.width=$5+"px",this.domNode.style.height=$5+"px",typeof $.top<"u"&&(this.domNode.style.top=$.top+"px"),typeof $.left<"u"&&(this.domNode.style.left=$.left+"px"),typeof $.bottom<"u"&&(this.domNode.style.bottom=$.bottom+"px"),typeof $.right<"u"&&(this.domNode.style.right=$.right+"px"),this._pointerMoveMonitor=this._register(new J2),this._register(t1(this.bgDomNode,x0.POINTER_DOWN,(Y)=>this._arrowPointerDown(Y))),this._register(t1(this.domNode,x0.POINTER_DOWN,(Y)=>this._arrowPointerDown(Y))),this._pointerdownRepeatTimer=this._register(new wY),this._pointerdownScheduleRepeatTimer=this._register(new p6)}_arrowPointerDown($){if(!$.target||!($.target instanceof Element))return;let Y=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),41.666666666666664,r0($))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(Y,200),this._pointerMoveMonitor.startMonitoring($.target,$.pointerId,$.buttons,(J)=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),$.preventDefault()}},dY=class ${constructor(Y,J,j,Z,K,Q,X){this._forceIntegerValues=Y,this._scrollStateBrand=void 0,this._forceIntegerValues&&(J=J|0,j=j|0,Z=Z|0,K=K|0,Q=Q|0,X=X|0),this.rawScrollLeft=Z,this.rawScrollTop=X,J<0&&(J=0),Z+J>j&&(Z=j-J),Z<0&&(Z=0),K<0&&(K=0),X+K>Q&&(X=Q-K),X<0&&(X=0),this.width=J,this.scrollWidth=j,this.scrollLeft=Z,this.height=K,this.scrollHeight=Q,this.scrollTop=X}equals(Y){return this.rawScrollLeft===Y.rawScrollLeft&&this.rawScrollTop===Y.rawScrollTop&&this.width===Y.width&&this.scrollWidth===Y.scrollWidth&&this.scrollLeft===Y.scrollLeft&&this.height===Y.height&&this.scrollHeight===Y.scrollHeight&&this.scrollTop===Y.scrollTop}withScrollDimensions(Y,J){return new $(this._forceIntegerValues,typeof Y.width<"u"?Y.width:this.width,typeof Y.scrollWidth<"u"?Y.scrollWidth:this.scrollWidth,J?this.rawScrollLeft:this.scrollLeft,typeof Y.height<"u"?Y.height:this.height,typeof Y.scrollHeight<"u"?Y.scrollHeight:this.scrollHeight,J?this.rawScrollTop:this.scrollTop)}withScrollPosition(Y){return new $(this._forceIntegerValues,this.width,this.scrollWidth,typeof Y.scrollLeft<"u"?Y.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof Y.scrollTop<"u"?Y.scrollTop:this.rawScrollTop)}createScrollEvent(Y,J){let j=this.width!==Y.width,Z=this.scrollWidth!==Y.scrollWidth,K=this.scrollLeft!==Y.scrollLeft,Q=this.height!==Y.height,X=this.scrollHeight!==Y.scrollHeight,N=this.scrollTop!==Y.scrollTop;return{inSmoothScrolling:J,oldWidth:Y.width,oldScrollWidth:Y.scrollWidth,oldScrollLeft:Y.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:Y.height,oldScrollHeight:Y.scrollHeight,oldScrollTop:Y.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:j,scrollWidthChanged:Z,scrollLeftChanged:K,heightChanged:Q,scrollHeightChanged:X,scrollTopChanged:N}}},uY=class extends S{constructor($){super();this._scrollableBrand=void 0,this._onScroll=this._register(new D),this.onScroll=this._onScroll.event,this._smoothScrollDuration=$.smoothScrollDuration,this._scheduleAtNextAnimationFrame=$.scheduleAtNextAnimationFrame,this._state=new dY($.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration($){this._smoothScrollDuration=$}validateScrollPosition($){return this._state.withScrollPosition($)}getScrollDimensions(){return this._state}setScrollDimensions($,Y){let J=this._state.withScrollDimensions($,Y);this._setState(J,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow($){let Y=this._state.withScrollPosition($);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(Y,!1)}setScrollPositionSmooth($,Y){if(this._smoothScrollDuration===0)return this.setScrollPositionNow($);if(this._smoothScrolling){$={scrollLeft:typeof $.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:$.scrollLeft,scrollTop:typeof $.scrollTop>"u"?this._smoothScrolling.to.scrollTop:$.scrollTop};let J=this._state.withScrollPosition($);if(this._smoothScrolling.to.scrollLeft===J.scrollLeft&&this._smoothScrolling.to.scrollTop===J.scrollTop)return;let j;Y?j=new J5(this._smoothScrolling.from,J,this._smoothScrolling.startTime,this._smoothScrolling.duration):j=this._smoothScrolling.combine(this._state,J,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=j}else{let J=this._state.withScrollPosition($);this._smoothScrolling=J5.start(this._state,J,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let $=this._smoothScrolling.tick(),Y=this._state.withScrollPosition($);if(this._setState(Y,!0),!!this._smoothScrolling){if($.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState($,Y){let J=this._state;J.equals($)||(this._state=$,this._onScroll.fire(this._state.createScrollEvent(J,Y)))}},Y5=class{constructor($,Y,J){this.scrollLeft=$,this.scrollTop=Y,this.isDone=J}};function n7($,Y){let J=Y-$;return function(j){return $+J*sY(j)}}function cY($,Y,J){return function(j){return j<J?$(j/J):Y((j-J)/(1-J))}}var J5=class ${constructor(Y,J,j,Z){this.from=Y,this.to=J,this.duration=Z,this.startTime=j,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(Y,J,j){if(Math.abs(Y-J)>2.5*j){let Z,K;return Y<J?(Z=Y+0.75*j,K=J-0.75*j):(Z=Y-0.75*j,K=J+0.75*j),cY(n7(Y,Z),n7(K,J),0.33)}return n7(Y,J)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(Y){this.to=Y.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(Y){let J=(Y-this.startTime)/this.duration;if(J<1){let j=this.scrollLeft(J),Z=this.scrollTop(J);return new Y5(j,Z,!1)}return new Y5(this.to.scrollLeft,this.to.scrollTop,!0)}combine(Y,J,j){return $.start(Y,J,j)}static start(Y,J,j){j=j+10;let Z=Date.now()-10;return new $(Y,J,Z,j)}};function lY($){return Math.pow($,3)}function sY($){return 1-lY(1-$)}var oY=class extends S{constructor($,Y,J){super(),this._visibility=$,this._visibleClassName=Y,this._invisibleClassName=J,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new p6)}setVisibility($){this._visibility!==$&&(this._visibility=$,this._updateShouldBeVisible())}setShouldBeVisible($){this._rawShouldBeVisible=$,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let $=this._applyVisibilitySetting();this._shouldBeVisible!==$&&(this._shouldBeVisible=$,this.ensureVisibility())}setIsNeeded($){this._isNeeded!==$&&(this._isNeeded=$,this.ensureVisibility())}setDomNode($){this._domNode=$,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{this._domNode?.setClassName(this._visibleClassName)},0))}_hide($){this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,this._domNode?.setClassName(this._invisibleClassName+($?" fade":"")))}},aY=140,j2=class extends h6{constructor($){super(),this._lazyRender=$.lazyRender,this._host=$.host,this._scrollable=$.scrollable,this._scrollByPage=$.scrollByPage,this._scrollbarState=$.scrollbarState,this._visibilityController=this._register(new oY($.visibility,"visible scrollbar "+$.extraScrollbarClassName,"invisible scrollbar "+$.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new J2),this._shouldRender=!0,this.domNode=I9(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(m(this.domNode.domNode,x0.POINTER_DOWN,(Y)=>this._domNodePointerDown(Y)))}_createArrow($){let Y=this._register(new hY($));this.domNode.domNode.appendChild(Y.bgDomNode),this.domNode.domNode.appendChild(Y.domNode)}_createSlider($,Y,J,j){this.slider=I9(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop($),this.slider.setLeft(Y),typeof J=="number"&&this.slider.setWidth(J),typeof j=="number"&&this.slider.setHeight(j),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(m(this.slider.domNode,x0.POINTER_DOWN,(Z)=>{Z.button===0&&(Z.preventDefault(),this._sliderPointerDown(Z))})),this.onclick(this.slider.domNode,(Z)=>{Z.leftButton&&Z.stopPropagation()})}_onElementSize($){return this._scrollbarState.setVisibleSize($)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize($){return this._scrollbarState.setScrollSize($)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition($){return this._scrollbarState.setScrollPosition($)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown($){$.target===this.domNode.domNode&&this._onPointerDown($)}delegatePointerDown($){let Y=this.domNode.domNode.getClientRects()[0].top,J=Y+this._scrollbarState.getSliderPosition(),j=Y+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),Z=this._sliderPointerPosition($);J<=Z&&Z<=j?$.button===0&&($.preventDefault(),this._sliderPointerDown($)):this._onPointerDown($)}_onPointerDown($){let Y,J;if($.target===this.domNode.domNode&&typeof $.offsetX=="number"&&typeof $.offsetY=="number")Y=$.offsetX,J=$.offsetY;else{let Z=fY(this.domNode.domNode);Y=$.pageX-Z.left,J=$.pageY-Z.top}let j=this._pointerDownRelativePosition(Y,J);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(j):this._scrollbarState.getDesiredScrollPositionFromOffset(j)),$.button===0&&($.preventDefault(),this._sliderPointerDown($))}_sliderPointerDown($){if(!$.target||!($.target instanceof Element))return;let Y=this._sliderPointerPosition($),J=this._sliderOrthogonalPointerPosition($),j=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring($.target,$.pointerId,$.buttons,(Z)=>{let K=this._sliderOrthogonalPointerPosition(Z),Q=Math.abs(K-J);if(i5&&Q>aY){this._setDesiredScrollPositionNow(j.getScrollPosition());return}let X=this._sliderPointerPosition(Z)-Y;this._setDesiredScrollPositionNow(j.getDesiredScrollPositionFromDelta(X))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow($){let Y={};this.writeScrollPosition(Y,$),this._scrollable.setScrollPositionNow(Y)}updateScrollbarSize($){this._updateScrollbarSize($),this._scrollbarState.setScrollbarSize($),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},Z2=class ${constructor(Y,J,j,Z,K,Q){this._scrollbarSize=Math.round(J),this._oppositeScrollbarSize=Math.round(j),this._arrowSize=Math.round(Y),this._visibleSize=Z,this._scrollSize=K,this._scrollPosition=Q,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new $(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(Y){let J=Math.round(Y);return this._visibleSize!==J?(this._visibleSize=J,this._refreshComputedValues(),!0):!1}setScrollSize(Y){let J=Math.round(Y);return this._scrollSize!==J?(this._scrollSize=J,this._refreshComputedValues(),!0):!1}setScrollPosition(Y){let J=Math.round(Y);return this._scrollPosition!==J?(this._scrollPosition=J,this._refreshComputedValues(),!0):!1}setScrollbarSize(Y){this._scrollbarSize=Math.round(Y)}setOppositeScrollbarSize(Y){this._oppositeScrollbarSize=Math.round(Y)}static _computeValues(Y,J,j,Z,K){let Q=Math.max(0,j-Y),X=Math.max(0,Q-2*J),N=Z>0&&Z>j;if(!N)return{computedAvailableSize:Math.round(Q),computedIsNeeded:N,computedSliderSize:Math.round(X),computedSliderRatio:0,computedSliderPosition:0};let z=Math.round(Math.max(20,Math.floor(j*X/Z))),G=(X-z)/(Z-j),V=K*G;return{computedAvailableSize:Math.round(Q),computedIsNeeded:N,computedSliderSize:Math.round(z),computedSliderRatio:G,computedSliderPosition:Math.round(V)}}_refreshComputedValues(){let Y=$._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=Y.computedAvailableSize,this._computedIsNeeded=Y.computedIsNeeded,this._computedSliderSize=Y.computedSliderSize,this._computedSliderRatio=Y.computedSliderRatio,this._computedSliderPosition=Y.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(Y){if(!this._computedIsNeeded)return 0;let J=Y-this._arrowSize-this._computedSliderSize/2;return Math.round(J/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(Y){if(!this._computedIsNeeded)return 0;let J=Y-this._arrowSize,j=this._scrollPosition;return J<this._computedSliderPosition?j-=this._visibleSize:j+=this._visibleSize,j}getDesiredScrollPositionFromDelta(Y){if(!this._computedIsNeeded)return 0;let J=this._computedSliderPosition+Y;return Math.round(J/this._computedSliderRatio)}},nY=class extends j2{constructor($,Y,J){let j=$.getScrollDimensions(),Z=$.getCurrentScrollPosition();if(super({lazyRender:Y.lazyRender,host:J,scrollbarState:new Z2(Y.horizontalHasArrows?Y.arrowSize:0,Y.horizontal===2?0:Y.horizontalScrollbarSize,Y.vertical===2?0:Y.verticalScrollbarSize,j.width,j.scrollWidth,Z.scrollLeft),visibility:Y.horizontal,extraScrollbarClassName:"horizontal",scrollable:$,scrollByPage:Y.scrollByPage}),Y.horizontalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((Y.horizontalScrollbarSize-Y.horizontalSliderSize)/2),0,void 0,Y.horizontalSliderSize)}_updateSlider($,Y){this.slider.setWidth($),this.slider.setLeft(Y)}_renderDomNode($,Y){this.domNode.setWidth($),this.domNode.setHeight(Y),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll($){return this._shouldRender=this._onElementScrollSize($.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition($.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize($.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition($,Y){return $}_sliderPointerPosition($){return $.pageX}_sliderOrthogonalPointerPosition($){return $.pageY}_updateScrollbarSize($){this.slider.setHeight($)}writeScrollPosition($,Y){$.scrollLeft=Y}updateOptions($){this.updateScrollbarSize($.horizontal===2?0:$.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize($.vertical===2?0:$.verticalScrollbarSize),this._visibilityController.setVisibility($.horizontal),this._scrollByPage=$.scrollByPage}},rY=class extends j2{constructor($,Y,J){let j=$.getScrollDimensions(),Z=$.getCurrentScrollPosition();if(super({lazyRender:Y.lazyRender,host:J,scrollbarState:new Z2(Y.verticalHasArrows?Y.arrowSize:0,Y.vertical===2?0:Y.verticalScrollbarSize,0,j.height,j.scrollHeight,Z.scrollTop),visibility:Y.vertical,extraScrollbarClassName:"vertical",scrollable:$,scrollByPage:Y.scrollByPage}),Y.verticalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((Y.verticalScrollbarSize-Y.verticalSliderSize)/2),Y.verticalSliderSize,void 0)}_updateSlider($,Y){this.slider.setHeight($),this.slider.setTop(Y)}_renderDomNode($,Y){this.domNode.setWidth(Y),this.domNode.setHeight($),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll($){return this._shouldRender=this._onElementScrollSize($.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition($.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize($.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition($,Y){return Y}_sliderPointerPosition($){return $.pageY}_sliderOrthogonalPointerPosition($){return $.pageX}_updateScrollbarSize($){this.slider.setWidth($)}writeScrollPosition($,Y){$.scrollTop=Y}updateOptions($){this.updateScrollbarSize($.vertical===2?0:$.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility($.vertical),this._scrollByPage=$.scrollByPage}},iY=500,j5=50,Z5=!0,tY=class{constructor($,Y,J){this.timestamp=$,this.deltaX=Y,this.deltaY=J,this.score=0}},x6=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let Y=1,J=0,j=1,Z=this._rear;do{let K=Z===this._front?Y:Math.pow(2,-j);if(Y-=K,J+=this._memory[Z].score*K,Z===this._front)break;Z=(this._capacity+Z-1)%this._capacity,j++}while(!0);return J<=0.5}acceptStandardWheelEvent(Y){if(S6){let J=r0(Y.browserEvent),j=l$(J);this.accept(Date.now(),Y.deltaX*j,Y.deltaY*j)}else this.accept(Date.now(),Y.deltaX,Y.deltaY)}accept(Y,J,j){let Z=null,K=new tY(Y,J,j);this._front===-1&&this._rear===-1?(this._memory[0]=K,this._front=0,this._rear=0):(Z=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=K),K.score=this._computeScore(K,Z)}_computeScore(Y,J){if(Math.abs(Y.deltaX)>0&&Math.abs(Y.deltaY)>0)return 1;let j=0.5;if((!this._isAlmostInt(Y.deltaX)||!this._isAlmostInt(Y.deltaY))&&(j+=0.25),J){let Z=Math.abs(Y.deltaX),K=Math.abs(Y.deltaY),Q=Math.abs(J.deltaX),X=Math.abs(J.deltaY),N=Math.max(Math.min(Z,Q),1),z=Math.max(Math.min(K,X),1),G=Math.max(Z,Q),V=Math.max(K,X);G%N===0&&V%z===0&&(j-=0.5)}return Math.min(Math.max(j,0),1)}_isAlmostInt(Y){return Math.abs(Math.round(Y)-Y)<0.01}};x6.INSTANCE=new x6;var eY=x6,$J=class extends h6{constructor($,Y,J){super();this._onScroll=this._register(new D),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new D),this.onWillScroll=this._onWillScroll.event,this._options=JJ(Y),this._scrollable=J,this._register(this._scrollable.onScroll((Z)=>{this._onWillScroll.fire(Z),this._onDidScroll(Z),this._onScroll.fire(Z)}));let j={onMouseWheel:(Z)=>this._onMouseWheel(Z),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new rY(this._scrollable,this._options,j)),this._horizontalScrollbar=this._register(new nY(this._scrollable,this._options,j)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild($),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=I9(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=I9(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=I9(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,(Z)=>this._onMouseOver(Z)),this.onmouseleave(this._listenOnDomNode,(Z)=>this._onMouseLeave(Z)),this._hideTimeout=this._register(new p6),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=p8(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown($){this._verticalScrollbar.delegatePointerDown($)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions($){this._scrollable.setScrollDimensions($,!1)}updateClassName($){this._options.className=$,J8&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions($){typeof $.handleMouseWheel<"u"&&(this._options.handleMouseWheel=$.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof $.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=$.mouseWheelScrollSensitivity),typeof $.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=$.fastScrollSensitivity),typeof $.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=$.scrollPredominantAxis),typeof $.horizontal<"u"&&(this._options.horizontal=$.horizontal),typeof $.vertical<"u"&&(this._options.vertical=$.vertical),typeof $.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=$.horizontalScrollbarSize),typeof $.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=$.verticalScrollbarSize),typeof $.scrollByPage<"u"&&(this._options.scrollByPage=$.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll($){this._revealOnScroll=$}delegateScrollFromMouseWheelEvent($){this._onMouseWheel(new o1($))}_setListeningToMouseWheel($){if(this._mouseWheelToDispose.length>0!==$&&(this._mouseWheelToDispose=p8(this._mouseWheelToDispose),$)){let Y=(J)=>{this._onMouseWheel(new o1(J))};this._mouseWheelToDispose.push(m(this._listenOnDomNode,x0.MOUSE_WHEEL,Y,{passive:!1}))}}_onMouseWheel($){if($.browserEvent?.defaultPrevented)return;let Y=eY.INSTANCE;Z5&&Y.acceptStandardWheelEvent($);let J=!1;if($.deltaY||$.deltaX){let Z=$.deltaY*this._options.mouseWheelScrollSensitivity,K=$.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&K+Z===0?K=Z=0:Math.abs(Z)>=Math.abs(K)?K=0:Z=0),this._options.flipAxes&&([Z,K]=[K,Z]);let Q=!J8&&$.browserEvent&&$.browserEvent.shiftKey;(this._options.scrollYToX||Q)&&!K&&(K=Z,Z=0),$.browserEvent&&$.browserEvent.altKey&&(K=K*this._options.fastScrollSensitivity,Z=Z*this._options.fastScrollSensitivity);let X=this._scrollable.getFutureScrollPosition(),N={};if(Z){let z=j5*Z,G=X.scrollTop-(z<0?Math.floor(z):Math.ceil(z));this._verticalScrollbar.writeScrollPosition(N,G)}if(K){let z=j5*K,G=X.scrollLeft-(z<0?Math.floor(z):Math.ceil(z));this._horizontalScrollbar.writeScrollPosition(N,G)}N=this._scrollable.validateScrollPosition(N),(X.scrollLeft!==N.scrollLeft||X.scrollTop!==N.scrollTop)&&(Z5&&this._options.mouseWheelSmoothScroll&&Y.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(N):this._scrollable.setScrollPositionNow(N),J=!0)}let j=J;!j&&this._options.alwaysConsumeMouseWheel&&(j=!0),!j&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(j=!0),j&&($.preventDefault(),$.stopPropagation())}_onDidScroll($){this._shouldRender=this._horizontalScrollbar.onDidScroll($)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll($)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let $=this._scrollable.getCurrentScrollPosition(),Y=$.scrollTop>0,J=$.scrollLeft>0,j=J?" left":"",Z=Y?" top":"",K=J||Y?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${j}`),this._topShadowDomNode.setClassName(`shadow${Z}`),this._topLeftShadowDomNode.setClassName(`shadow${K}${Z}${j}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave($){this._mouseIsOver=!1,this._hide()}_onMouseOver($){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),iY)}},YJ=class extends $J{constructor($,Y,J){super($,Y,J)}setScrollPosition($){$.reuseAnimation?this._scrollable.setScrollPositionSmooth($,$.reuseAnimation):this._scrollable.setScrollPositionNow($)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function JJ($){let Y={lazyRender:typeof $.lazyRender<"u"?$.lazyRender:!1,className:typeof $.className<"u"?$.className:"",useShadows:typeof $.useShadows<"u"?$.useShadows:!0,handleMouseWheel:typeof $.handleMouseWheel<"u"?$.handleMouseWheel:!0,flipAxes:typeof $.flipAxes<"u"?$.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof $.consumeMouseWheelIfScrollbarIsNeeded<"u"?$.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof $.alwaysConsumeMouseWheel<"u"?$.alwaysConsumeMouseWheel:!1,scrollYToX:typeof $.scrollYToX<"u"?$.scrollYToX:!1,mouseWheelScrollSensitivity:typeof $.mouseWheelScrollSensitivity<"u"?$.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof $.fastScrollSensitivity<"u"?$.fastScrollSensitivity:5,scrollPredominantAxis:typeof $.scrollPredominantAxis<"u"?$.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof $.mouseWheelSmoothScroll<"u"?$.mouseWheelSmoothScroll:!0,arrowSize:typeof $.arrowSize<"u"?$.arrowSize:11,listenOnDomNode:typeof $.listenOnDomNode<"u"?$.listenOnDomNode:null,horizontal:typeof $.horizontal<"u"?$.horizontal:1,horizontalScrollbarSize:typeof $.horizontalScrollbarSize<"u"?$.horizontalScrollbarSize:10,horizontalSliderSize:typeof $.horizontalSliderSize<"u"?$.horizontalSliderSize:0,horizontalHasArrows:typeof $.horizontalHasArrows<"u"?$.horizontalHasArrows:!1,vertical:typeof $.vertical<"u"?$.vertical:1,verticalScrollbarSize:typeof $.verticalScrollbarSize<"u"?$.verticalScrollbarSize:10,verticalHasArrows:typeof $.verticalHasArrows<"u"?$.verticalHasArrows:!1,verticalSliderSize:typeof $.verticalSliderSize<"u"?$.verticalSliderSize:0,scrollByPage:typeof $.scrollByPage<"u"?$.scrollByPage:!1};return Y.horizontalSliderSize=typeof $.horizontalSliderSize<"u"?$.horizontalSliderSize:Y.horizontalScrollbarSize,Y.verticalSliderSize=typeof $.verticalSliderSize<"u"?$.verticalSliderSize:Y.verticalScrollbarSize,J8&&(Y.className+=" mac"),Y}var U6=class extends S{constructor($,Y,J,j,Z,K,Q,X){super();this._bufferService=J,this._optionsService=Q,this._renderService=X,this._onRequestScrollLines=this._register(new D),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let N=this._register(new uY({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:(z)=>$7(j.window,z)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{N.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new YJ(Y,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},N)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(Z.onProtocolChange((z)=>{this._scrollableElement.updateOptions({handleMouseWheel:!(z&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(L0.runAndSubscribe(K.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=K.colors.background.css})),$.appendChild(this._scrollableElement.getDomNode()),this._register(r(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=j.mainDocument.createElement("style"),Y.appendChild(this._styleElement),this._register(r(()=>this._styleElement.remove())),this._register(L0.runAndSubscribe(K.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${K.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${K.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${K.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll((z)=>this._handleScroll(z)))}scrollLines($){let Y=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:Y.scrollTop+$*this._renderService.dimensions.css.cell.height})}scrollToLine($,Y){Y&&(this._latestYDisp=$),this._scrollableElement.setScrollPosition({reuseAnimation:!Y,scrollTop:$*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:this._optionsService.rawOptions.overviewRuler?.width||14}}queueSync($){$!==void 0&&(this._latestYDisp=$),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync($=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,$!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:$*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll($){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let Y=Math.round($.scrollTop/this._renderService.dimensions.css.cell.height),J=Y-this._bufferService.buffer.ydisp;J!==0&&(this._latestYDisp=Y,this._onRequestScrollLines.fire(J)),this._isHandlingScroll=!1}};U6=j0([T(2,A0),T(3,G8),T(4,g5),T(5,o8),T(6,P0),T(7,W8)],U6);var O6=class extends S{constructor($,Y,J,j,Z){super();this._screenElement=$,this._bufferService=Y,this._coreBrowserService=J,this._decorationService=j,this._renderService=Z,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved((K)=>this._removeDecoration(K))),this._register(r(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let $ of this._decorationService.decorations)this._renderDecoration($);this._dimensionsChanged=!1}_renderDecoration($){this._refreshStyle($),this._dimensionsChanged&&this._refreshXPosition($)}_createElement($){let Y=this._coreBrowserService.mainDocument.createElement("div");Y.classList.add("xterm-decoration"),Y.classList.toggle("xterm-decoration-top-layer",$?.options?.layer==="top"),Y.style.width=`${Math.round(($.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,Y.style.height=`${($.options.height||1)*this._renderService.dimensions.css.cell.height}px`,Y.style.top=`${($.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,Y.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let J=$.options.x??0;return J&&J>this._bufferService.cols&&(Y.style.display="none"),this._refreshXPosition($,Y),Y}_refreshStyle($){let Y=$.marker.line-this._bufferService.buffers.active.ydisp;if(Y<0||Y>=this._bufferService.rows)$.element&&($.element.style.display="none",$.onRenderEmitter.fire($.element));else{let J=this._decorationElements.get($);J||(J=this._createElement($),$.element=J,this._decorationElements.set($,J),this._container.appendChild(J),$.onDispose(()=>{this._decorationElements.delete($),J.remove()})),J.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(J.style.width=`${Math.round(($.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,J.style.height=`${($.options.height||1)*this._renderService.dimensions.css.cell.height}px`,J.style.top=`${Y*this._renderService.dimensions.css.cell.height}px`,J.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),$.onRenderEmitter.fire(J)}}_refreshXPosition($,Y=$.element){if(!Y)return;let J=$.options.x??0;($.options.anchor||"left")==="right"?Y.style.right=J?`${J*this._renderService.dimensions.css.cell.width}px`:"":Y.style.left=J?`${J*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration($){this._decorationElements.get($)?.remove(),this._decorationElements.delete($),$.dispose()}};O6=j0([T(1,A0),T(2,G8),T(3,v9),T(4,W8)],O6);var jJ=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration($){if($.options.overviewRulerOptions){for(let Y of this._zones)if(Y.color===$.options.overviewRulerOptions.color&&Y.position===$.options.overviewRulerOptions.position){if(this._lineIntersectsZone(Y,$.marker.line))return;if(this._lineAdjacentToZone(Y,$.marker.line,$.options.overviewRulerOptions.position)){this._addLineToZone(Y,$.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=$.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=$.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=$.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=$.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:$.options.overviewRulerOptions.color,position:$.options.overviewRulerOptions.position,startBufferLine:$.marker.line,endBufferLine:$.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding($){this._linePadding=$}_lineIntersectsZone($,Y){return Y>=$.startBufferLine&&Y<=$.endBufferLine}_lineAdjacentToZone($,Y,J){return Y>=$.startBufferLine-this._linePadding[J||"full"]&&Y<=$.endBufferLine+this._linePadding[J||"full"]}_addLineToZone($,Y){$.startBufferLine=Math.min($.startBufferLine,Y),$.endBufferLine=Math.max($.endBufferLine,Y)}},e0={full:0,left:0,center:0,right:0},B8={full:0,left:0,center:0,right:0},J9={full:0,left:0,center:0,right:0},Y7=class extends S{constructor($,Y,J,j,Z,K,Q,X){super();this._viewportElement=$,this._screenElement=Y,this._bufferService=J,this._decorationService=j,this._renderService=Z,this._optionsService=K,this._themeService=Q,this._coreBrowserService=X,this._colorZoneStore=new jJ,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement),this._register(r(()=>this._canvas?.remove()));let N=this._canvas.getContext("2d");if(N)this._ctx=N;else throw Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){return this._optionsService.options.overviewRuler?.width||0}_refreshDrawConstants(){let $=Math.floor((this._canvas.width-1)/3),Y=Math.ceil((this._canvas.width-1)/3);B8.full=this._canvas.width,B8.left=$,B8.center=Y,B8.right=$,this._refreshDrawHeightConstants(),J9.full=1,J9.left=1,J9.center=1+B8.left,J9.right=1+B8.left+B8.center}_refreshDrawHeightConstants(){e0.full=Math.round(2*this._coreBrowserService.dpr);let $=this._canvas.height/this._bufferService.buffer.lines.length,Y=Math.round(Math.max(Math.min($,12),6)*this._coreBrowserService.dpr);e0.left=Y,e0.center=Y,e0.right=Y}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e0.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e0.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e0.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e0.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let Y of this._decorationService.decorations)this._colorZoneStore.addDecoration(Y);this._ctx.lineWidth=1,this._renderRulerOutline();let $=this._colorZoneStore.zones;for(let Y of $)Y.position!=="full"&&this._renderColorZone(Y);for(let Y of $)Y.position==="full"&&this._renderColorZone(Y);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone($){this._ctx.fillStyle=$.color,this._ctx.fillRect(J9[$.position||"full"],Math.round((this._canvas.height-1)*($.startBufferLine/this._bufferService.buffers.active.lines.length)-e0[$.position||"full"]/2),B8[$.position||"full"],Math.round((this._canvas.height-1)*(($.endBufferLine-$.startBufferLine)/this._bufferService.buffers.active.lines.length)+e0[$.position||"full"]))}_queueRefresh($,Y){this._shouldUpdateDimensions=$||this._shouldUpdateDimensions,this._shouldUpdateAnchor=Y||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};Y7=j0([T(2,A0),T(3,v9),T(4,W8),T(5,P0),T(6,o8),T(7,G8)],Y7);var R;(($)=>($.NUL="\x00",$.SOH="\x01",$.STX="\x02",$.ETX="\x03",$.EOT="\x04",$.ENQ="\x05",$.ACK="\x06",$.BEL="\x07",$.BS="\b",$.HT="\t",$.LF=`
`,$.VT="\v",$.FF="\f",$.CR="\r",$.SO="\x0E",$.SI="\x0F",$.DLE="\x10",$.DC1="\x11",$.DC2="\x12",$.DC3="\x13",$.DC4="\x14",$.NAK="\x15",$.SYN="\x16",$.ETB="\x17",$.CAN="\x18",$.EM="\x19",$.SUB="\x1A",$.ESC="\x1B",$.FS="\x1C",$.GS="\x1D",$.RS="\x1E",$.US="\x1F",$.SP=" ",$.DEL=""))(R||={});var n9;(($)=>($.PAD="",$.HOP="",$.BPH="",$.NBH="",$.IND="",$.NEL="",$.SSA="",$.ESA="",$.HTS="",$.HTJ="",$.VTS="",$.PLD="",$.PLU="",$.RI="",$.SS2="",$.SS3="",$.DCS="",$.PU1="",$.PU2="",$.STS="",$.CCH="",$.MW="",$.SPA="",$.EPA="",$.SOS="",$.SGCI="",$.SCI="",$.CSI="",$.ST="",$.OSC="",$.PM="",$.APC=""))(n9||={});var K2;(($)=>$.ST=`${R.ESC}\\`)(K2||={});var q6=class{constructor($,Y,J,j,Z,K){this._textarea=$,this._compositionView=Y,this._bufferService=J,this._optionsService=j,this._coreService=Z,this._renderService=K,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate($){this._compositionView.textContent=$.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown($){if(this._isComposing||this._isSendingComposition){if($.keyCode===20||$.keyCode===229||$.keyCode===16||$.keyCode===17||$.keyCode===18)return!1;this._finalizeComposition(!1)}return $.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition($){if(this._compositionView.classList.remove("active"),this._isComposing=!1,$){let Y={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let J;Y.start+=this._dataAlreadySent.length,this._isComposing?J=this._textarea.value.substring(Y.start,this._compositionPosition.start):J=this._textarea.value.substring(Y.start),J.length>0&&this._coreService.triggerDataEvent(J,!0)}},0)}else{this._isSendingComposition=!1;let Y=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(Y,!0)}}_handleAnyTextareaChanges(){let $=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let Y=this._textarea.value,J=Y.replace($,"");this._dataAlreadySent=J,Y.length>$.length?this._coreService.triggerDataEvent(J,!0):Y.length<$.length?this._coreService.triggerDataEvent(`${R.DEL}`,!0):Y.length===$.length&&Y!==$&&this._coreService.triggerDataEvent(Y,!0)}},0)}updateCompositionElements($){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let Y=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),J=this._renderService.dimensions.css.cell.height,j=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,Z=Y*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=Z+"px",this._compositionView.style.top=j+"px",this._compositionView.style.height=J+"px",this._compositionView.style.lineHeight=J+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let K=this._compositionView.getBoundingClientRect();this._textarea.style.left=Z+"px",this._textarea.style.top=j+"px",this._textarea.style.width=Math.max(K.width,1)+"px",this._textarea.style.height=Math.max(K.height,1)+"px",this._textarea.style.lineHeight=K.height+"px"}$||setTimeout(()=>this.updateCompositionElements(!0),0)}}};q6=j0([T(2,A0),T(3,P0),T(4,h8),T(5,W8)],q6);var U0=0,O0=0,q0=0,J0=0,K5={css:"#00000000",rgba:0},V0;(($)=>{function Y(Z,K,Q,X){return X!==void 0?`#${w8(Z)}${w8(K)}${w8(Q)}${w8(X)}`:`#${w8(Z)}${w8(K)}${w8(Q)}`}$.toCss=Y;function J(Z,K,Q,X=255){return(Z<<24|K<<16|Q<<8|X)>>>0}$.toRgba=J;function j(Z,K,Q,X){return{css:$.toCss(Z,K,Q,X),rgba:$.toRgba(Z,K,Q,X)}}$.toColor=j})(V0||={});var n;(($)=>{function Y(N,z){if(J0=(z.rgba&255)/255,J0===1)return{css:z.css,rgba:z.rgba};let G=z.rgba>>24&255,V=z.rgba>>16&255,W=z.rgba>>8&255,_=N.rgba>>24&255,H=N.rgba>>16&255,U=N.rgba>>8&255;U0=_+Math.round((G-_)*J0),O0=H+Math.round((V-H)*J0),q0=U+Math.round((W-U)*J0);let B=V0.toCss(U0,O0,q0),A=V0.toRgba(U0,O0,q0);return{css:B,rgba:A}}$.blend=Y;function J(N){return(N.rgba&255)===255}$.isOpaque=J;function j(N,z,G){let V=r9.ensureContrastRatio(N.rgba,z.rgba,G);if(V)return V0.toColor(V>>24&255,V>>16&255,V>>8&255)}$.ensureContrastRatio=j;function Z(N){let z=(N.rgba|255)>>>0;return[U0,O0,q0]=r9.toChannels(z),{css:V0.toCss(U0,O0,q0),rgba:z}}$.opaque=Z;function K(N,z){return J0=Math.round(z*255),[U0,O0,q0]=r9.toChannels(N.rgba),{css:V0.toCss(U0,O0,q0,J0),rgba:V0.toRgba(U0,O0,q0,J0)}}$.opacity=K;function Q(N,z){return J0=N.rgba&255,K(N,J0*z/255)}$.multiplyOpacity=Q;function X(N){return[N.rgba>>24&255,N.rgba>>16&255,N.rgba>>8&255]}$.toColorRGB=X})(n||={});var e;(($)=>{let Y,J;try{let Z=document.createElement("canvas");Z.width=1,Z.height=1;let K=Z.getContext("2d",{willReadFrequently:!0});K&&(Y=K,Y.globalCompositeOperation="copy",J=Y.createLinearGradient(0,0,1,1))}catch{}function j(Z){if(Z.match(/#[\da-f]{3,8}/i))switch(Z.length){case 4:return U0=parseInt(Z.slice(1,2).repeat(2),16),O0=parseInt(Z.slice(2,3).repeat(2),16),q0=parseInt(Z.slice(3,4).repeat(2),16),V0.toColor(U0,O0,q0);case 5:return U0=parseInt(Z.slice(1,2).repeat(2),16),O0=parseInt(Z.slice(2,3).repeat(2),16),q0=parseInt(Z.slice(3,4).repeat(2),16),J0=parseInt(Z.slice(4,5).repeat(2),16),V0.toColor(U0,O0,q0,J0);case 7:return{css:Z,rgba:(parseInt(Z.slice(1),16)<<8|255)>>>0};case 9:return{css:Z,rgba:parseInt(Z.slice(1),16)>>>0}}let K=Z.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(K)return U0=parseInt(K[1]),O0=parseInt(K[2]),q0=parseInt(K[3]),J0=Math.round((K[5]===void 0?1:parseFloat(K[5]))*255),V0.toColor(U0,O0,q0,J0);if(!Y||!J)throw Error("css.toColor: Unsupported css format");if(Y.fillStyle=J,Y.fillStyle=Z,typeof Y.fillStyle!="string")throw Error("css.toColor: Unsupported css format");if(Y.fillRect(0,0,1,1),[U0,O0,q0,J0]=Y.getImageData(0,0,1,1).data,J0!==255)throw Error("css.toColor: Unsupported css format");return{rgba:V0.toRgba(U0,O0,q0,J0),css:Z}}$.toColor=j})(e||={});var T0;(($)=>{function Y(j){return J(j>>16&255,j>>8&255,j&255)}$.relativeLuminance=Y;function J(j,Z,K){let Q=j/255,X=Z/255,N=K/255,z=Q<=0.03928?Q/12.92:Math.pow((Q+0.055)/1.055,2.4),G=X<=0.03928?X/12.92:Math.pow((X+0.055)/1.055,2.4),V=N<=0.03928?N/12.92:Math.pow((N+0.055)/1.055,2.4);return z*0.2126+G*0.7152+V*0.0722}$.relativeLuminance2=J})(T0||={});var r9;(($)=>{function Y(Q,X){if(J0=(X&255)/255,J0===1)return X;let N=X>>24&255,z=X>>16&255,G=X>>8&255,V=Q>>24&255,W=Q>>16&255,_=Q>>8&255;return U0=V+Math.round((N-V)*J0),O0=W+Math.round((z-W)*J0),q0=_+Math.round((G-_)*J0),V0.toRgba(U0,O0,q0)}$.blend=Y;function J(Q,X,N){let z=T0.relativeLuminance(Q>>8),G=T0.relativeLuminance(X>>8);if(X8(z,G)<N){if(G<z){let _=j(Q,X,N),H=X8(z,T0.relativeLuminance(_>>8));if(H<N){let U=Z(Q,X,N),B=X8(z,T0.relativeLuminance(U>>8));return H>B?_:U}return _}let V=Z(Q,X,N),W=X8(z,T0.relativeLuminance(V>>8));if(W<N){let _=j(Q,X,N),H=X8(z,T0.relativeLuminance(_>>8));return W>H?V:_}return V}}$.ensureContrastRatio=J;function j(Q,X,N){let z=Q>>24&255,G=Q>>16&255,V=Q>>8&255,W=X>>24&255,_=X>>16&255,H=X>>8&255,U=X8(T0.relativeLuminance2(W,_,H),T0.relativeLuminance2(z,G,V));for(;U<N&&(W>0||_>0||H>0);)W-=Math.max(0,Math.ceil(W*0.1)),_-=Math.max(0,Math.ceil(_*0.1)),H-=Math.max(0,Math.ceil(H*0.1)),U=X8(T0.relativeLuminance2(W,_,H),T0.relativeLuminance2(z,G,V));return(W<<24|_<<16|H<<8|255)>>>0}$.reduceLuminance=j;function Z(Q,X,N){let z=Q>>24&255,G=Q>>16&255,V=Q>>8&255,W=X>>24&255,_=X>>16&255,H=X>>8&255,U=X8(T0.relativeLuminance2(W,_,H),T0.relativeLuminance2(z,G,V));for(;U<N&&(W<255||_<255||H<255);)W=Math.min(255,W+Math.ceil((255-W)*0.1)),_=Math.min(255,_+Math.ceil((255-_)*0.1)),H=Math.min(255,H+Math.ceil((255-H)*0.1)),U=X8(T0.relativeLuminance2(W,_,H),T0.relativeLuminance2(z,G,V));return(W<<24|_<<16|H<<8|255)>>>0}$.increaseLuminance=Z;function K(Q){return[Q>>24&255,Q>>16&255,Q>>8&255,Q&255]}$.toChannels=K})(r9||={});function w8($){let Y=$.toString(16);return Y.length<2?"0"+Y:Y}function X8($,Y){return $<Y?(Y+0.05)/($+0.05):($+0.05)/(Y+0.05)}var ZJ=class extends E9{constructor($,Y,J){super();this.content=0,this.combinedData="",this.fg=$.fg,this.bg=$.bg,this.combinedData=Y,this._width=J}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData($){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},J7=class{constructor($){this._bufferService=$,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new o0}register($){let Y={id:this._nextCharacterJoinerId++,handler:$};return this._characterJoiners.push(Y),Y.id}deregister($){for(let Y=0;Y<this._characterJoiners.length;Y++)if(this._characterJoiners[Y].id===$)return this._characterJoiners.splice(Y,1),!0;return!1}getJoinedCharacters($){if(this._characterJoiners.length===0)return[];let Y=this._bufferService.buffer.lines.get($);if(!Y||Y.length===0)return[];let J=[],j=Y.translateToString(!0),Z=0,K=0,Q=0,X=Y.getFg(0),N=Y.getBg(0);for(let z=0;z<Y.getTrimmedLength();z++)if(Y.loadCell(z,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==X||this._workCell.bg!==N){if(z-Z>1){let G=this._getJoinedRanges(j,Q,K,Y,Z);for(let V=0;V<G.length;V++)J.push(G[V])}Z=z,Q=K,X=this._workCell.fg,N=this._workCell.bg}K+=this._workCell.getChars().length||M8.length}if(this._bufferService.cols-Z>1){let z=this._getJoinedRanges(j,Q,K,Y,Z);for(let G=0;G<z.length;G++)J.push(z[G])}return J}_getJoinedRanges($,Y,J,j,Z){let K=$.substring(Y,J),Q=[];try{Q=this._characterJoiners[0].handler(K)}catch(X){console.error(X)}for(let X=1;X<this._characterJoiners.length;X++)try{let N=this._characterJoiners[X].handler(K);for(let z=0;z<N.length;z++)J7._mergeRanges(Q,N[z])}catch(N){console.error(N)}return this._stringRangesToCellRanges(Q,j,Z),Q}_stringRangesToCellRanges($,Y,J){let j=0,Z=!1,K=0,Q=$[j];if(Q){for(let X=J;X<this._bufferService.cols;X++){let N=Y.getWidth(X),z=Y.getString(X).length||M8.length;if(N!==0){if(!Z&&Q[0]<=K&&(Q[0]=X,Z=!0),Q[1]<=K){if(Q[1]=X,Q=$[++j],!Q)break;Q[0]<=K?(Q[0]=X,Z=!0):Z=!1}K+=z}}Q&&(Q[1]=this._bufferService.cols)}}static _mergeRanges($,Y){let J=!1;for(let j=0;j<$.length;j++){let Z=$[j];if(J){if(Y[1]<=Z[0])return $[j-1][1]=Y[1],$;if(Y[1]<=Z[1])return $[j-1][1]=Math.max(Y[1],Z[1]),$.splice(j,1),$;$.splice(j,1),j--}else{if(Y[1]<=Z[0])return $.splice(j,0,Y),$;if(Y[1]<=Z[1])return Z[0]=Math.min(Y[0],Z[0]),$;Y[0]<Z[1]&&(Z[0]=Math.min(Y[0],Z[0]),J=!0);continue}}return J?$[$.length-1][1]=Y[1]:$.push(Y),$}};J7=j0([T(0,A0)],J7);function KJ($){return 57508<=$&&$<=57558}function QJ($){return 9472<=$&&$<=9631}function XJ($){return KJ($)||QJ($)}function zJ(){return{css:{canvas:p9(),cell:p9()},device:{canvas:p9(),cell:p9(),char:{width:0,height:0,left:0,top:0}}}}function p9(){return{width:0,height:0}}var E6=class{constructor($,Y,J,j,Z,K,Q){this._document=$,this._characterJoinerService=Y,this._optionsService=J,this._coreBrowserService=j,this._coreService=Z,this._decorationService=K,this._themeService=Q,this._workCell=new o0,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged($,Y,J){this._selectionStart=$,this._selectionEnd=Y,this._columnSelectMode=J}createRow($,Y,J,j,Z,K,Q,X,N,z,G){let V=[],W=this._characterJoinerService.getJoinedCharacters(Y),_=this._themeService.colors,H=$.getNoBgTrimmedLength();J&&H<K+1&&(H=K+1);let U,B=0,A="",k=0,M=0,y=0,b=0,P=!1,p=0,o=!1,Q0=0,b0=0,f=[],c0=z!==-1&&G!==-1;for(let I=0;I<H;I++){$.loadCell(I,this._workCell);let x=this._workCell.getWidth();if(x===0)continue;let v=!1,q=I>=b0,E=I,O=this._workCell;if(W.length>0&&I===W[0][0]&&q){let h=W.shift(),R8=this._isCellInSelection(h[0],Y);for(k=h[0]+1;k<h[1];k++)q&&=R8===this._isCellInSelection(k,Y);q&&=!J||K<h[0]||K>=h[1],q?(v=!0,O=new ZJ(this._workCell,$.translateToString(!0,h[0],h[1]),h[1]-h[0]),E=h[1]-1,x=O.getWidth()):b0=h[1]}let F=this._isCellInSelection(I,Y),L=J&&I===K,w=c0&&I>=z&&I<=G,u=!1;this._decorationService.forEachDecorationAtCell(I,Y,void 0,(h)=>{u=!0});let C=O.getChars()||M8;if(C===" "&&(O.isUnderline()||O.isOverline())&&(C=""),Q0=x*X-N.get(C,O.isBold(),O.isItalic()),!U)U=this._document.createElement("span");else if(B&&(F&&o||!F&&!o&&O.bg===M)&&(F&&o&&_.selectionForeground||O.fg===y)&&O.extended.ext===b&&w===P&&Q0===p&&!L&&!v&&!u&&q){O.isInvisible()?A+=M8:A+=C,B++;continue}else B&&(U.textContent=A),U=this._document.createElement("span"),B=0,A="";if(M=O.bg,y=O.fg,b=O.extended.ext,P=w,p=Q0,o=F,v&&K>=I&&K<=E&&(K=I),!this._coreService.isCursorHidden&&L&&this._coreService.isCursorInitialized){if(f.push("xterm-cursor"),this._coreBrowserService.isFocused)Q&&f.push("xterm-cursor-blink"),f.push(j==="bar"?"xterm-cursor-bar":j==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(Z)switch(Z){case"outline":f.push("xterm-cursor-outline");break;case"block":f.push("xterm-cursor-block");break;case"bar":f.push("xterm-cursor-bar");break;case"underline":f.push("xterm-cursor-underline");break;default:break}}if(O.isBold()&&f.push("xterm-bold"),O.isItalic()&&f.push("xterm-italic"),O.isDim()&&f.push("xterm-dim"),O.isInvisible()?A=M8:A=O.getChars()||M8,O.isUnderline()&&(f.push(`xterm-underline-${O.extended.underlineStyle}`),A===" "&&(A=""),!O.isUnderlineColorDefault()))if(O.isUnderlineColorRGB())U.style.textDecorationColor=`rgb(${E9.toColorRGB(O.getUnderlineColor()).join(",")})`;else{let h=O.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&O.isBold()&&h<8&&(h+=8),U.style.textDecorationColor=_.ansi[h].css}O.isOverline()&&(f.push("xterm-overline"),A===" "&&(A="")),O.isStrikethrough()&&f.push("xterm-strikethrough"),w&&(U.style.textDecoration="underline");let d=O.getFgColor(),B0=O.getFgColorMode(),c=O.getBgColor(),X0=O.getBgColorMode(),l=!!O.isInverse();if(l){let h=d;d=c,c=h;let R8=B0;B0=X0,X0=R8}let $0,v8,t0=!1;this._decorationService.forEachDecorationAtCell(I,Y,void 0,(h)=>{h.options.layer!=="top"&&t0||(h.backgroundColorRGB&&(X0=50331648,c=h.backgroundColorRGB.rgba>>8&16777215,$0=h.backgroundColorRGB),h.foregroundColorRGB&&(B0=50331648,d=h.foregroundColorRGB.rgba>>8&16777215,v8=h.foregroundColorRGB),t0=h.options.layer==="top")}),!t0&&F&&($0=this._coreBrowserService.isFocused?_.selectionBackgroundOpaque:_.selectionInactiveBackgroundOpaque,c=$0.rgba>>8&16777215,X0=50331648,t0=!0,_.selectionForeground&&(B0=50331648,d=_.selectionForeground.rgba>>8&16777215,v8=_.selectionForeground)),t0&&f.push("xterm-decoration-top");let S0;switch(X0){case 16777216:case 33554432:S0=_.ansi[c],f.push(`xterm-bg-${c}`);break;case 50331648:S0=V0.toColor(c>>16,c>>8&255,c&255),this._addStyle(U,`background-color:#${Q5((c>>>0).toString(16),"0",6)}`);break;case 0:default:l?(S0=_.foreground,f.push("xterm-bg-257")):S0=_.background}switch($0||O.isDim()&&($0=n.multiplyOpacity(S0,0.5)),B0){case 16777216:case 33554432:O.isBold()&&d<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(d+=8),this._applyMinimumContrast(U,S0,_.ansi[d],O,$0,void 0)||f.push(`xterm-fg-${d}`);break;case 50331648:let h=V0.toColor(d>>16&255,d>>8&255,d&255);this._applyMinimumContrast(U,S0,h,O,$0,v8)||this._addStyle(U,`color:#${Q5(d.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(U,S0,_.foreground,O,$0,v8)||l&&f.push("xterm-fg-257")}f.length&&(U.className=f.join(" "),f.length=0),!L&&!v&&!u&&q?B++:U.textContent=A,Q0!==this.defaultSpacing&&(U.style.letterSpacing=`${Q0}px`),V.push(U),I=E}return U&&B&&(U.textContent=A),V}_applyMinimumContrast($,Y,J,j,Z,K){if(this._optionsService.rawOptions.minimumContrastRatio===1||XJ(j.getCode()))return!1;let Q=this._getContrastCache(j),X;if(!Z&&!K&&(X=Q.getColor(Y.rgba,J.rgba)),X===void 0){let N=this._optionsService.rawOptions.minimumContrastRatio/(j.isDim()?2:1);X=n.ensureContrastRatio(Z||Y,K||J,N),Q.setColor((Z||Y).rgba,(K||J).rgba,X??null)}return X?(this._addStyle($,`color:${X.css}`),!0):!1}_getContrastCache($){return $.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle($,Y){$.setAttribute("style",`${$.getAttribute("style")||""}${Y};`)}_isCellInSelection($,Y){let J=this._selectionStart,j=this._selectionEnd;return!J||!j?!1:this._columnSelectMode?J[0]<=j[0]?$>=J[0]&&Y>=J[1]&&$<j[0]&&Y<=j[1]:$<J[0]&&Y>=J[1]&&$>=j[0]&&Y<=j[1]:Y>J[1]&&Y<j[1]||J[1]===j[1]&&Y===J[1]&&$>=J[0]&&$<j[0]||J[1]<j[1]&&Y===j[1]&&$<j[0]||J[1]<j[1]&&Y===J[1]&&$>=J[0]}};E6=j0([T(1,h5),T(2,P0),T(3,G8),T(4,h8),T(5,v9),T(6,o8)],E6);function Q5($,Y,J){for(;$.length<J;)$=Y+$;return $}var NJ=class{constructor($,Y){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=$.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let J=$.createElement("span");J.classList.add("xterm-char-measure-element");let j=$.createElement("span");j.classList.add("xterm-char-measure-element"),j.style.fontWeight="bold";let Z=$.createElement("span");Z.classList.add("xterm-char-measure-element"),Z.style.fontStyle="italic";let K=$.createElement("span");K.classList.add("xterm-char-measure-element"),K.style.fontWeight="bold",K.style.fontStyle="italic",this._measureElements=[J,j,Z,K],this._container.appendChild(J),this._container.appendChild(j),this._container.appendChild(Z),this._container.appendChild(K),Y.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont($,Y,J,j){$===this._font&&Y===this._fontSize&&J===this._weight&&j===this._weightBold||(this._font=$,this._fontSize=Y,this._weight=J,this._weightBold=j,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${J}`,this._measureElements[1].style.fontWeight=`${j}`,this._measureElements[2].style.fontWeight=`${J}`,this._measureElements[3].style.fontWeight=`${j}`,this.clear())}get($,Y,J){let j=0;if(!Y&&!J&&$.length===1&&(j=$.charCodeAt(0))<256){if(this._flat[j]!==-9999)return this._flat[j];let Q=this._measure($,0);return Q>0&&(this._flat[j]=Q),Q}let Z=$;Y&&(Z+="B"),J&&(Z+="I");let K=this._holey.get(Z);if(K===void 0){let Q=0;Y&&(Q|=1),J&&(Q|=2),K=this._measure($,Q),K>0&&this._holey.set(Z,K)}return K}_measure($,Y){let J=this._measureElements[Y];return J.textContent=$.repeat(32),J.offsetWidth/32}},VJ=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update($,Y,J,j=!1){if(this.selectionStart=Y,this.selectionEnd=J,!Y||!J||Y[0]===J[0]&&Y[1]===J[1]){this.clear();return}let Z=$.buffers.active.ydisp,K=Y[1]-Z,Q=J[1]-Z,X=Math.max(K,0),N=Math.min(Q,$.rows-1);if(X>=$.rows||N<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=j,this.viewportStartRow=K,this.viewportEndRow=Q,this.viewportCappedStartRow=X,this.viewportCappedEndRow=N,this.startCol=Y[0],this.endCol=J[0]}isCellSelected($,Y,J){return this.hasSelection?(J-=$.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?Y>=this.startCol&&J>=this.viewportCappedStartRow&&Y<this.endCol&&J<=this.viewportCappedEndRow:Y<this.startCol&&J>=this.viewportCappedStartRow&&Y>=this.endCol&&J<=this.viewportCappedEndRow:J>this.viewportStartRow&&J<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&J===this.viewportStartRow&&Y>=this.startCol&&Y<this.endCol||this.viewportStartRow<this.viewportEndRow&&J===this.viewportEndRow&&Y<this.endCol||this.viewportStartRow<this.viewportEndRow&&J===this.viewportStartRow&&Y>=this.startCol):!1}};function GJ(){return new VJ}var r7="xterm-dom-renderer-owner-",l0="xterm-rows",C9="xterm-fg-",X5="xterm-bg-",j9="xterm-focus",h9="xterm-selection",WJ=1,v6=class extends S{constructor($,Y,J,j,Z,K,Q,X,N,z,G,V,W,_){super();this._terminal=$,this._document=Y,this._element=J,this._screenElement=j,this._viewportElement=Z,this._helperContainer=K,this._linkifier2=Q,this._charSizeService=N,this._optionsService=z,this._bufferService=G,this._coreService=V,this._coreBrowserService=W,this._themeService=_,this._terminalClass=WJ++,this._rowElements=[],this._selectionRenderModel=GJ(),this.onRequestRedraw=this._register(new D).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(l0),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(h9),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=zJ(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors((H)=>this._injectCss(H))),this._injectCss(this._themeService.colors),this._rowFactory=X.createInstance(E6,document),this._element.classList.add(r7+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline((H)=>this._handleLinkHover(H))),this._register(this._linkifier2.onHideLinkUnderline((H)=>this._handleLinkLeave(H))),this._register(r(()=>{this._element.classList.remove(r7+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new NJ(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let $=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*$,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*$),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/$),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/$),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let J of this._rowElements)J.style.width=`${this.dimensions.css.canvas.width}px`,J.style.height=`${this.dimensions.css.cell.height}px`,J.style.lineHeight=`${this.dimensions.css.cell.height}px`,J.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let Y=`${this._terminalSelector} .${l0} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=Y,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss($){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let Y=`${this._terminalSelector} .${l0} { pointer-events: none; color: ${$.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;Y+=`${this._terminalSelector} .${l0} .xterm-dim { color: ${n.multiplyOpacity($.foreground,0.5).css};}`,Y+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let J=`blink_underline_${this._terminalClass}`,j=`blink_bar_${this._terminalClass}`,Z=`blink_block_${this._terminalClass}`;Y+=`@keyframes ${J} { 50% {  border-bottom-style: hidden; }}`,Y+=`@keyframes ${j} { 50% {  box-shadow: none; }}`,Y+=`@keyframes ${Z} { 0% {  background-color: ${$.cursor.css};  color: ${$.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${$.cursor.css}; }}`,Y+=`${this._terminalSelector} .${l0}.${j9} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${J} 1s step-end infinite;}${this._terminalSelector} .${l0}.${j9} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${j} 1s step-end infinite;}${this._terminalSelector} .${l0}.${j9} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${Z} 1s step-end infinite;}${this._terminalSelector} .${l0} .xterm-cursor.xterm-cursor-block { background-color: ${$.cursor.css}; color: ${$.cursorAccent.css};}${this._terminalSelector} .${l0} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${$.cursor.css} !important; color: ${$.cursorAccent.css} !important;}${this._terminalSelector} .${l0} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${$.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${l0} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${$.cursor.css} inset;}${this._terminalSelector} .${l0} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${$.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,Y+=`${this._terminalSelector} .${h9} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${h9} div { position: absolute; background-color: ${$.selectionBackgroundOpaque.css};}${this._terminalSelector} .${h9} div { position: absolute; background-color: ${$.selectionInactiveBackgroundOpaque.css};}`;for(let[K,Q]of $.ansi.entries())Y+=`${this._terminalSelector} .${C9}${K} { color: ${Q.css}; }${this._terminalSelector} .${C9}${K}.xterm-dim { color: ${n.multiplyOpacity(Q,0.5).css}; }${this._terminalSelector} .${X5}${K} { background-color: ${Q.css}; }`;Y+=`${this._terminalSelector} .${C9}257 { color: ${n.opaque($.background).css}; }${this._terminalSelector} .${C9}257.xterm-dim { color: ${n.multiplyOpacity(n.opaque($.background),0.5).css}; }${this._terminalSelector} .${X5}257 { background-color: ${$.foreground.css}; }`,this._themeStyleElement.textContent=Y}_setDefaultSpacing(){let $=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${$}px`,this._rowFactory.defaultSpacing=$}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements($,Y){for(let J=this._rowElements.length;J<=Y;J++){let j=this._document.createElement("div");this._rowContainer.appendChild(j),this._rowElements.push(j)}for(;this._rowElements.length>Y;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize($,Y){this._refreshRowElements($,Y),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(j9),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(j9),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged($,Y,J){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged($,Y,J),this.renderRows(0,this._bufferService.rows-1),!$||!Y||(this._selectionRenderModel.update(this._terminal,$,Y,J),!this._selectionRenderModel.hasSelection))return;let j=this._selectionRenderModel.viewportStartRow,Z=this._selectionRenderModel.viewportEndRow,K=this._selectionRenderModel.viewportCappedStartRow,Q=this._selectionRenderModel.viewportCappedEndRow,X=this._document.createDocumentFragment();if(J){let N=$[0]>Y[0];X.appendChild(this._createSelectionElement(K,N?Y[0]:$[0],N?$[0]:Y[0],Q-K+1))}else{let N=j===K?$[0]:0,z=K===Z?Y[0]:this._bufferService.cols;X.appendChild(this._createSelectionElement(K,N,z));let G=Q-K-1;if(X.appendChild(this._createSelectionElement(K+1,0,this._bufferService.cols,G)),K!==Q){let V=Z===Q?Y[0]:this._bufferService.cols;X.appendChild(this._createSelectionElement(Q,0,V))}}this._selectionContainer.appendChild(X)}_createSelectionElement($,Y,J,j=1){let Z=this._document.createElement("div"),K=Y*this.dimensions.css.cell.width,Q=this.dimensions.css.cell.width*(J-Y);return K+Q>this.dimensions.css.canvas.width&&(Q=this.dimensions.css.canvas.width-K),Z.style.height=`${j*this.dimensions.css.cell.height}px`,Z.style.top=`${$*this.dimensions.css.cell.height}px`,Z.style.left=`${K}px`,Z.style.width=`${Q}px`,Z}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let $ of this._rowElements)$.replaceChildren()}renderRows($,Y){let J=this._bufferService.buffer,j=J.ybase+J.y,Z=Math.min(J.x,this._bufferService.cols-1),K=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,Q=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,X=this._optionsService.rawOptions.cursorInactiveStyle;for(let N=$;N<=Y;N++){let z=N+J.ydisp,G=this._rowElements[N],V=J.lines.get(z);if(!G||!V)break;G.replaceChildren(...this._rowFactory.createRow(V,z,z===j,Q,X,Z,K,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${r7}${this._terminalClass}`}_handleLinkHover($){this._setCellUnderline($.x1,$.x2,$.y1,$.y2,$.cols,!0)}_handleLinkLeave($){this._setCellUnderline($.x1,$.x2,$.y1,$.y2,$.cols,!1)}_setCellUnderline($,Y,J,j,Z,K){J<0&&($=0),j<0&&(Y=0);let Q=this._bufferService.rows-1;J=Math.max(Math.min(J,Q),0),j=Math.max(Math.min(j,Q),0),Z=Math.min(Z,this._bufferService.cols);let X=this._bufferService.buffer,N=X.ybase+X.y,z=Math.min(X.x,Z-1),G=this._optionsService.rawOptions.cursorBlink,V=this._optionsService.rawOptions.cursorStyle,W=this._optionsService.rawOptions.cursorInactiveStyle;for(let _=J;_<=j;++_){let H=_+X.ydisp,U=this._rowElements[_],B=X.lines.get(H);if(!U||!B)break;U.replaceChildren(...this._rowFactory.createRow(B,H,H===N,V,W,z,G,this.dimensions.css.cell.width,this._widthCache,K?_===J?$:0:-1,K?(_===j?Y:Z)-1:-1))}}};v6=j0([T(7,w6),T(8,X7),T(9,P0),T(10,A0),T(11,h8),T(12,G8),T(13,o8)],v6);var R6=class extends S{constructor($,Y,J){super();this._optionsService=J,this.width=0,this.height=0,this._onCharSizeChange=this._register(new D),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new HJ(this._optionsService))}catch{this._measureStrategy=this._register(new _J($,Y,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let $=this._measureStrategy.measure();($.width!==this.width||$.height!==this.height)&&(this.width=$.width,this.height=$.height,this._onCharSizeChange.fire())}};R6=j0([T(2,P0)],R6);var Q2=class extends S{constructor(){super(...arguments);this._result={width:0,height:0}}_validateAndSet($,Y){$!==void 0&&$>0&&Y!==void 0&&Y>0&&(this._result.width=$,this._result.height=Y)}},_J=class extends Q2{constructor($,Y,J){super();this._document=$,this._parentElement=Y,this._optionsService=J,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},HJ=class extends Q2{constructor($){super();this._optionsService=$,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let Y=this._ctx.measureText("W");if(!(("width"in Y)&&("fontBoundingBoxAscent"in Y)&&("fontBoundingBoxDescent"in Y)))throw Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let $=this._ctx.measureText("W");return this._validateAndSet($.width,$.fontBoundingBoxAscent+$.fontBoundingBoxDescent),this._result}},IJ=class extends S{constructor($,Y,J){super();this._textarea=$,this._window=Y,this.mainDocument=J,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new xJ(this._window)),this._onDprChange=this._register(new D),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new D),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange((j)=>this._screenDprMonitor.setWindow(j))),this._register(L0.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(m(this._textarea,"focus",()=>this._isFocused=!0)),this._register(m(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window($){this._window!==$&&(this._window=$,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},xJ=class extends S{constructor($){super();this._parentWindow=$,this._windowResizeListener=this._register(new s8),this._onDprChange=this._register(new D),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(r(()=>this.clearListener()))}setWindow($){this._parentWindow=$,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=m(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},UJ=class extends S{constructor(){super();this.linkProviders=[],this._register(r(()=>this.linkProviders.length=0))}registerLinkProvider($){return this.linkProviders.push($),{dispose:()=>{let Y=this.linkProviders.indexOf($);Y!==-1&&this.linkProviders.splice(Y,1)}}}};function d6($,Y,J){let j=J.getBoundingClientRect(),Z=$.getComputedStyle(J),K=parseInt(Z.getPropertyValue("padding-left")),Q=parseInt(Z.getPropertyValue("padding-top"));return[Y.clientX-j.left-K,Y.clientY-j.top-Q]}function OJ($,Y,J,j,Z,K,Q,X,N){if(!K)return;let z=d6($,Y,J);if(z)return z[0]=Math.ceil((z[0]+(N?Q/2:0))/Q),z[1]=Math.ceil(z[1]/X),z[0]=Math.min(Math.max(z[0],1),j+(N?1:0)),z[1]=Math.min(Math.max(z[1],1),Z),z}var y6=class{constructor($,Y){this._renderService=$,this._charSizeService=Y}getCoords($,Y,J,j,Z){return OJ(window,$,Y,J,j,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,Z)}getMouseReportCoords($,Y){let J=d6(window,$,Y);if(this._charSizeService.hasValidSize)return J[0]=Math.min(Math.max(J[0],0),this._renderService.dimensions.css.canvas.width-1),J[1]=Math.min(Math.max(J[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(J[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(J[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(J[0]),y:Math.floor(J[1])}}};y6=j0([T(0,W8),T(1,X7)],y6);var qJ=class{constructor($,Y){this._renderCallback=$,this._coreBrowserService=Y,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback($){return this._refreshCallbacks.push($),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh($,Y,J){this._rowCount=J,$=$!==void 0?$:0,Y=Y!==void 0?Y:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,$):$,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,Y):Y,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let $=Math.max(this._rowStart,0),Y=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback($,Y),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let $ of this._refreshCallbacks)$(0);this._refreshCallbacks=[]}},X2={};J$(X2,{getSafariVersion:()=>vJ,isChromeOS:()=>G2,isFirefox:()=>z2,isIpad:()=>RJ,isIphone:()=>yJ,isLegacyEdge:()=>EJ,isLinux:()=>u6,isMac:()=>j7,isNode:()=>V7,isSafari:()=>N2,isWindows:()=>V2});var V7=typeof process<"u"&&"title"in process,R9=V7?"node":navigator.userAgent,y9=V7?"node":navigator.platform,z2=R9.includes("Firefox"),EJ=R9.includes("Edge"),N2=/^((?!chrome|android).)*safari/i.test(R9);function vJ(){if(!N2)return 0;let $=R9.match(/Version\/(\d+)/);return $===null||$.length<2?0:parseInt($[1])}var j7=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(y9),RJ=y9==="iPad",yJ=y9==="iPhone",V2=["Windows","Win16","Win32","WinCE"].includes(y9),u6=y9.indexOf("Linux")>=0,G2=/\bCrOS\b/.test(R9),W2=class{constructor(){this._tasks=[],this._i=0}enqueue($){this._tasks.push($),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process($){this._idleCallback=void 0;let Y=0,J=0,j=$.timeRemaining(),Z=0;for(;this._i<this._tasks.length;){if(Y=performance.now(),this._tasks[this._i]()||this._i++,Y=Math.max(1,performance.now()-Y),J=Math.max(Y,J),Z=$.timeRemaining(),J*1.5>Z){j-Y<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(j-Y))}ms`),this._start();return}j=Z}this.clear()}},FJ=class extends W2{_requestCallback($){return setTimeout(()=>$(this._createDeadline(16)))}_cancelCallback($){clearTimeout($)}_createDeadline($){let Y=performance.now()+$;return{timeRemaining:()=>Math.max(0,Y-performance.now())}}},BJ=class extends W2{_requestCallback($){return requestIdleCallback($)}_cancelCallback($){cancelIdleCallback($)}},Z7=!V7&&"requestIdleCallback"in window?BJ:FJ,LJ=class{constructor(){this._queue=new Z7}set($){this._queue.clear(),this._queue.enqueue($)}flush(){this._queue.flush()}},F6=class extends S{constructor($,Y,J,j,Z,K,Q,X,N){super();this._rowCount=$,this._optionsService=J,this._charSizeService=j,this._coreService=Z,this._coreBrowserService=X,this._renderer=this._register(new s8),this._pausedResizeTask=new LJ,this._observerDisposable=this._register(new s8),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new D),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new D),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new D),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new D),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new qJ((z,G)=>this._renderRows(z,G),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new DJ(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(r(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(Q.onResize(()=>this._fullRefresh())),this._register(Q.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(K.onDecorationRegistered(()=>this._fullRefresh())),this._register(K.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(Q.cols,Q.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(Q.buffer.y,Q.buffer.y,!0))),this._register(N.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,Y),this._register(this._coreBrowserService.onWindowChange((z)=>this._registerIntersectionObserver(z,Y)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver($,Y){if("IntersectionObserver"in $){let J=new $.IntersectionObserver((j)=>this._handleIntersectionChange(j[j.length-1]),{threshold:0});J.observe(Y),this._observerDisposable.value=r(()=>J.disconnect())}}_handleIntersectionChange($){this._isPaused=$.isIntersecting===void 0?$.intersectionRatio===0:!$.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows($,Y,J=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows($,Y);return}let j=this._syncOutputHandler.flush();j&&($=Math.min($,j.start),Y=Math.max(Y,j.end)),J||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh($,Y,this._rowCount)}_renderRows($,Y){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows($,Y);return}$=Math.min($,this._rowCount-1),Y=Math.min(Y,this._rowCount-1),this._renderer.value.renderRows($,Y),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:$,end:Y}),this._onRender.fire({start:$,end:Y}),this._isNextRenderRedrawOnly=!0}}resize($,Y){this._rowCount=Y,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer($){this._renderer.value=$,this._renderer.value&&(this._renderer.value.onRequestRedraw((Y)=>this.refreshRows(Y.start,Y.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback($){return this._renderDebouncer.addRefreshCallback($)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize($,Y){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize($,Y)):this._renderer.value.handleResize($,Y),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged($,Y,J){this._selectionState.start=$,this._selectionState.end=Y,this._selectionState.columnSelectMode=J,this._renderer.value?.handleSelectionChanged($,Y,J)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};F6=j0([T(2,P0),T(3,X7),T(4,h8),T(5,v9),T(6,A0),T(7,G8),T(8,o8)],F6);var DJ=class{constructor($,Y,J){this._coreBrowserService=$,this._coreService=Y,this._onTimeout=J,this._start=0,this._end=0,this._isBuffering=!1}bufferRows($,Y){this._isBuffering?(this._start=Math.min(this._start,$),this._end=Math.max(this._end,Y)):(this._start=$,this._end=Y,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1000))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let $={start:this._start,end:this._end};return this._isBuffering=!1,$}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function MJ($,Y,J,j){let Z=J.buffer.x,K=J.buffer.y;if(!J.buffer.hasScrollback)return AJ(Z,K,$,Y,J,j)+G7(K,Y,J,j)+PJ(Z,K,$,Y,J,j);let Q;if(K===Y)return Q=Z>$?"D":"C",O9(Math.abs(Z-$),U9(Q,j));Q=K>Y?"D":"C";let X=Math.abs(K-Y),N=TJ(K>Y?$:Z,J)+(X-1)*J.cols+1+bJ(K>Y?Z:$,J);return O9(N,U9(Q,j))}function bJ($,Y){return $-1}function TJ($,Y){return Y.cols-$}function AJ($,Y,J,j,Z,K){return G7(Y,j,Z,K).length===0?"":O9(H2($,Y,$,Y-C8(Y,Z),!1,Z).length,U9("D",K))}function G7($,Y,J,j){let Z=$-C8($,J),K=Y-C8(Y,J),Q=Math.abs(Z-K)-kJ($,Y,J);return O9(Q,U9(_2($,Y),j))}function PJ($,Y,J,j,Z,K){let Q;G7(Y,j,Z,K).length>0?Q=j-C8(j,Z):Q=Y;let X=j,N=wJ($,Y,J,j,Z,K);return O9(H2($,Q,J,X,N==="C",Z).length,U9(N,K))}function kJ($,Y,J){let j=0,Z=$-C8($,J),K=Y-C8(Y,J);for(let Q=0;Q<Math.abs(Z-K);Q++){let X=_2($,Y)==="A"?-1:1;J.buffer.lines.get(Z+X*Q)?.isWrapped&&j++}return j}function C8($,Y){let J=0,j=Y.buffer.lines.get($),Z=j?.isWrapped;for(;Z&&$>=0&&$<Y.rows;)J++,j=Y.buffer.lines.get(--$),Z=j?.isWrapped;return J}function wJ($,Y,J,j,Z,K){let Q;return G7(J,j,Z,K).length>0?Q=j-C8(j,Z):Q=Y,$<J&&Q<=j||$>=J&&Q<j?"C":"D"}function _2($,Y){return $>Y?"A":"B"}function H2($,Y,J,j,Z,K){let Q=$,X=Y,N="";for(;(Q!==J||X!==j)&&X>=0&&X<K.buffer.lines.length;)Q+=Z?1:-1,Z&&Q>K.cols-1?(N+=K.buffer.translateBufferLineToString(X,!1,$,Q),Q=0,$=0,X++):!Z&&Q<0&&(N+=K.buffer.translateBufferLineToString(X,!1,0,$+1),Q=K.cols-1,$=Q,X--);return N+K.buffer.translateBufferLineToString(X,!1,$,Q)}function U9($,Y){let J=Y?"O":"[";return R.ESC+J+$}function O9($,Y){$=Math.floor($);let J="";for(let j=0;j<$;j++)J+=Y;return J}var fJ=class{constructor($){this._bufferService=$,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let $=this.selectionStart[0]+this.selectionStartLength;return $>this._bufferService.cols?$%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor($/this._bufferService.cols)-1]:[$%this._bufferService.cols,this.selectionStart[1]+Math.floor($/this._bufferService.cols)]:[$,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let $=this.selectionStart[0]+this.selectionStartLength;return $>this._bufferService.cols?[$%this._bufferService.cols,this.selectionStart[1]+Math.floor($/this._bufferService.cols)]:[Math.max($,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let $=this.selectionStart,Y=this.selectionEnd;return!$||!Y?!1:$[1]>Y[1]||$[1]===Y[1]&&$[0]>Y[0]}handleTrim($){return this.selectionStart&&(this.selectionStart[1]-=$),this.selectionEnd&&(this.selectionEnd[1]-=$),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function z5($,Y){if($.start.y>$.end.y)throw Error(`Buffer range end (${$.end.x}, ${$.end.y}) cannot be before start (${$.start.x}, ${$.start.y})`);return Y*($.end.y-$.start.y)+($.end.x-$.start.x+1)}var i7=50,mJ=15,SJ=50,gJ=500,pJ="",CJ=new RegExp(pJ,"g"),B6=class extends S{constructor($,Y,J,j,Z,K,Q,X,N){super();this._element=$,this._screenElement=Y,this._linkifier=J,this._bufferService=j,this._coreService=Z,this._mouseService=K,this._optionsService=Q,this._renderService=X,this._coreBrowserService=N,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new o0,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new D),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new D),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new D),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new D),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=(z)=>this._handleMouseMove(z),this._mouseUpListener=(z)=>this._handleMouseUp(z),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim((z)=>this._handleTrim(z)),this._register(this._bufferService.buffers.onBufferActivate((z)=>this._handleBufferActivate(z))),this.enable(),this._model=new fJ(this._bufferService),this._activeSelectionMode=0,this._register(r(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize((z)=>{z.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let $=this._model.finalSelectionStart,Y=this._model.finalSelectionEnd;return!$||!Y?!1:$[0]!==Y[0]||$[1]!==Y[1]}get selectionText(){let $=this._model.finalSelectionStart,Y=this._model.finalSelectionEnd;if(!$||!Y)return"";let J=this._bufferService.buffer,j=[];if(this._activeSelectionMode===3){if($[0]===Y[0])return"";let Z=$[0]<Y[0]?$[0]:Y[0],K=$[0]<Y[0]?Y[0]:$[0];for(let Q=$[1];Q<=Y[1];Q++){let X=J.translateBufferLineToString(Q,!0,Z,K);j.push(X)}}else{let Z=$[1]===Y[1]?Y[0]:void 0;j.push(J.translateBufferLineToString($[1],!0,$[0],Z));for(let K=$[1]+1;K<=Y[1]-1;K++){let Q=J.lines.get(K),X=J.translateBufferLineToString(K,!0);Q?.isWrapped?j[j.length-1]+=X:j.push(X)}if($[1]!==Y[1]){let K=J.lines.get(Y[1]),Q=J.translateBufferLineToString(Y[1],!0,0,Y[0]);K&&K.isWrapped?j[j.length-1]+=Q:j.push(Q)}}return j.map((Z)=>Z.replace(CJ," ")).join(V2?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh($){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),u6&&$&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection($){let Y=this._getMouseBufferCoords($),J=this._model.finalSelectionStart,j=this._model.finalSelectionEnd;return!J||!j||!Y?!1:this._areCoordsInSelection(Y,J,j)}isCellInSelection($,Y){let J=this._model.finalSelectionStart,j=this._model.finalSelectionEnd;return!J||!j?!1:this._areCoordsInSelection([$,Y],J,j)}_areCoordsInSelection($,Y,J){return $[1]>Y[1]&&$[1]<J[1]||Y[1]===J[1]&&$[1]===Y[1]&&$[0]>=Y[0]&&$[0]<J[0]||Y[1]<J[1]&&$[1]===J[1]&&$[0]<J[0]||Y[1]<J[1]&&$[1]===Y[1]&&$[0]>=Y[0]}_selectWordAtCursor($,Y){let J=this._linkifier.currentLink?.link?.range;if(J)return this._model.selectionStart=[J.start.x-1,J.start.y-1],this._model.selectionStartLength=z5(J,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let j=this._getMouseBufferCoords($);return j?(this._selectWordAt(j,Y),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines($,Y){this._model.clearSelection(),$=Math.max($,0),Y=Math.min(Y,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,$],this._model.selectionEnd=[this._bufferService.cols,Y],this.refresh(),this._onSelectionChange.fire()}_handleTrim($){this._model.handleTrim($)&&this.refresh()}_getMouseBufferCoords($){let Y=this._mouseService.getCoords($,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(Y)return Y[0]--,Y[1]--,Y[1]+=this._bufferService.buffer.ydisp,Y}_getMouseEventScrollAmount($){let Y=d6(this._coreBrowserService.window,$,this._screenElement)[1],J=this._renderService.dimensions.css.canvas.height;return Y>=0&&Y<=J?0:(Y>J&&(Y-=J),Y=Math.min(Math.max(Y,-i7),i7),Y/=i7,Y/Math.abs(Y)+Math.round(Y*(mJ-1)))}shouldForceSelection($){return j7?$.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:$.shiftKey}handleMouseDown($){if(this._mouseDownTimeStamp=$.timeStamp,!($.button===2&&this.hasSelection)&&$.button===0){if(!this._enabled){if(!this.shouldForceSelection($))return;$.stopPropagation()}$.preventDefault(),this._dragScrollAmount=0,this._enabled&&$.shiftKey?this._handleIncrementalClick($):$.detail===1?this._handleSingleClick($):$.detail===2?this._handleDoubleClick($):$.detail===3&&this._handleTripleClick($),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),SJ)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick($){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords($))}_handleSingleClick($){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect($)?3:0,this._model.selectionStart=this._getMouseBufferCoords($),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let Y=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);Y&&Y.length!==this._model.selectionStart[0]&&Y.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick($){this._selectWordAtCursor($,!0)&&(this._activeSelectionMode=1)}_handleTripleClick($){let Y=this._getMouseBufferCoords($);Y&&(this._activeSelectionMode=2,this._selectLineAt(Y[1]))}shouldColumnSelect($){return $.altKey&&!(j7&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove($){if($.stopImmediatePropagation(),!this._model.selectionStart)return;let Y=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords($),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount($),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let J=this._bufferService.buffer;if(this._model.selectionEnd[1]<J.lines.length){let j=J.lines.get(this._model.selectionEnd[1]);j&&j.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!Y||Y[0]!==this._model.selectionEnd[0]||Y[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let $=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min($.ydisp+this._bufferService.rows,$.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=$.ydisp),this.refresh()}}_handleMouseUp($){let Y=$.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&Y<gJ&&$.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let J=this._mouseService.getCoords($,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(J&&J[0]!==void 0&&J[1]!==void 0){let j=MJ(J[0]-1,J[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(j,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let $=this._model.finalSelectionStart,Y=this._model.finalSelectionEnd,J=!!$&&!!Y&&($[0]!==Y[0]||$[1]!==Y[1]);if(!J){this._oldHasSelection&&this._fireOnSelectionChange($,Y,J);return}!$||!Y||(!this._oldSelectionStart||!this._oldSelectionEnd||$[0]!==this._oldSelectionStart[0]||$[1]!==this._oldSelectionStart[1]||Y[0]!==this._oldSelectionEnd[0]||Y[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange($,Y,J)}_fireOnSelectionChange($,Y,J){this._oldSelectionStart=$,this._oldSelectionEnd=Y,this._oldHasSelection=J,this._onSelectionChange.fire()}_handleBufferActivate($){this.clearSelection(),this._trimListener.dispose(),this._trimListener=$.activeBuffer.lines.onTrim((Y)=>this._handleTrim(Y))}_convertViewportColToCharacterIndex($,Y){let J=Y;for(let j=0;Y>=j;j++){let Z=$.loadCell(j,this._workCell).getChars().length;this._workCell.getWidth()===0?J--:Z>1&&Y!==j&&(J+=Z-1)}return J}setSelection($,Y,J){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[$,Y],this._model.selectionStartLength=J,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect($){this._isClickInSelection($)||(this._selectWordAtCursor($,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt($,Y,J=!0,j=!0){if($[0]>=this._bufferService.cols)return;let Z=this._bufferService.buffer,K=Z.lines.get($[1]);if(!K)return;let Q=Z.translateBufferLineToString($[1],!1),X=this._convertViewportColToCharacterIndex(K,$[0]),N=X,z=$[0]-X,G=0,V=0,W=0,_=0;if(Q.charAt(X)===" "){for(;X>0&&Q.charAt(X-1)===" ";)X--;for(;N<Q.length&&Q.charAt(N+1)===" ";)N++}else{let B=$[0],A=$[0];K.getWidth(B)===0&&(G++,B--),K.getWidth(A)===2&&(V++,A++);let k=K.getString(A).length;for(k>1&&(_+=k-1,N+=k-1);B>0&&X>0&&!this._isCharWordSeparator(K.loadCell(B-1,this._workCell));){K.loadCell(B-1,this._workCell);let M=this._workCell.getChars().length;this._workCell.getWidth()===0?(G++,B--):M>1&&(W+=M-1,X-=M-1),X--,B--}for(;A<K.length&&N+1<Q.length&&!this._isCharWordSeparator(K.loadCell(A+1,this._workCell));){K.loadCell(A+1,this._workCell);let M=this._workCell.getChars().length;this._workCell.getWidth()===2?(V++,A++):M>1&&(_+=M-1,N+=M-1),N++,A++}}N++;let H=X+z-G+W,U=Math.min(this._bufferService.cols,N-X+G+V-W-_);if(!(!Y&&Q.slice(X,N).trim()==="")){if(J&&H===0&&K.getCodePoint(0)!==32){let B=Z.lines.get($[1]-1);if(B&&K.isWrapped&&B.getCodePoint(this._bufferService.cols-1)!==32){let A=this._getWordAt([this._bufferService.cols-1,$[1]-1],!1,!0,!1);if(A){let k=this._bufferService.cols-A.start;H-=k,U+=k}}}if(j&&H+U===this._bufferService.cols&&K.getCodePoint(this._bufferService.cols-1)!==32){let B=Z.lines.get($[1]+1);if(B?.isWrapped&&B.getCodePoint(0)!==32){let A=this._getWordAt([0,$[1]+1],!1,!1,!0);A&&(U+=A.length)}}return{start:H,length:U}}}_selectWordAt($,Y){let J=this._getWordAt($,Y);if(J){for(;J.start<0;)J.start+=this._bufferService.cols,$[1]--;this._model.selectionStart=[J.start,$[1]],this._model.selectionStartLength=J.length}}_selectToWordAt($){let Y=this._getWordAt($,!0);if(Y){let J=$[1];for(;Y.start<0;)Y.start+=this._bufferService.cols,J--;if(!this._model.areSelectionValuesReversed())for(;Y.start+Y.length>this._bufferService.cols;)Y.length-=this._bufferService.cols,J++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?Y.start:Y.start+Y.length,J]}}_isCharWordSeparator($){return $.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf($.getChars())>=0}_selectLineAt($){let Y=this._bufferService.buffer.getWrappedRangeForLine($),J={start:{x:0,y:Y.first},end:{x:this._bufferService.cols-1,y:Y.last}};this._model.selectionStart=[0,Y.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=z5(J,this._bufferService.cols)}};B6=j0([T(3,A0),T(4,h8),T(5,f6),T(6,P0),T(7,W8),T(8,G8)],B6);var N5=class{constructor(){this._data={}}set($,Y,J){this._data[$]||(this._data[$]={}),this._data[$][Y]=J}get($,Y){return this._data[$]?this._data[$][Y]:void 0}clear(){this._data={}}},V5=class{constructor(){this._color=new N5,this._css=new N5}setCss($,Y,J){this._css.set($,Y,J)}getCss($,Y){return this._css.get($,Y)}setColor($,Y,J){this._color.set($,Y,J)}getColor($,Y){return this._color.get($,Y)}clear(){this._color.clear(),this._css.clear()}},_0=Object.freeze((()=>{let $=[e.toColor("#2e3436"),e.toColor("#cc0000"),e.toColor("#4e9a06"),e.toColor("#c4a000"),e.toColor("#3465a4"),e.toColor("#75507b"),e.toColor("#06989a"),e.toColor("#d3d7cf"),e.toColor("#555753"),e.toColor("#ef2929"),e.toColor("#8ae234"),e.toColor("#fce94f"),e.toColor("#729fcf"),e.toColor("#ad7fa8"),e.toColor("#34e2e2"),e.toColor("#eeeeec")],Y=[0,95,135,175,215,255];for(let J=0;J<216;J++){let j=Y[J/36%6|0],Z=Y[J/6%6|0],K=Y[J%6];$.push({css:V0.toCss(j,Z,K),rgba:V0.toRgba(j,Z,K)})}for(let J=0;J<24;J++){let j=8+J*10;$.push({css:V0.toCss(j,j,j),rgba:V0.toRgba(j,j,j)})}return $})()),f8=e.toColor("#ffffff"),V9=e.toColor("#000000"),G5=e.toColor("#ffffff"),W5=V9,Z9={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},hJ=f8,L6=class extends S{constructor($){super();this._optionsService=$,this._contrastCache=new V5,this._halfContrastCache=new V5,this._onChangeColors=this._register(new D),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:f8,background:V9,cursor:G5,cursorAccent:W5,selectionForeground:void 0,selectionBackgroundTransparent:Z9,selectionBackgroundOpaque:n.blend(V9,Z9),selectionInactiveBackgroundTransparent:Z9,selectionInactiveBackgroundOpaque:n.blend(V9,Z9),scrollbarSliderBackground:n.opacity(f8,0.2),scrollbarSliderHoverBackground:n.opacity(f8,0.4),scrollbarSliderActiveBackground:n.opacity(f8,0.5),overviewRulerBorder:f8,ansi:_0.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme($={}){let Y=this._colors;if(Y.foreground=s($.foreground,f8),Y.background=s($.background,V9),Y.cursor=n.blend(Y.background,s($.cursor,G5)),Y.cursorAccent=n.blend(Y.background,s($.cursorAccent,W5)),Y.selectionBackgroundTransparent=s($.selectionBackground,Z9),Y.selectionBackgroundOpaque=n.blend(Y.background,Y.selectionBackgroundTransparent),Y.selectionInactiveBackgroundTransparent=s($.selectionInactiveBackground,Y.selectionBackgroundTransparent),Y.selectionInactiveBackgroundOpaque=n.blend(Y.background,Y.selectionInactiveBackgroundTransparent),Y.selectionForeground=$.selectionForeground?s($.selectionForeground,K5):void 0,Y.selectionForeground===K5&&(Y.selectionForeground=void 0),n.isOpaque(Y.selectionBackgroundTransparent)&&(Y.selectionBackgroundTransparent=n.opacity(Y.selectionBackgroundTransparent,0.3)),n.isOpaque(Y.selectionInactiveBackgroundTransparent)&&(Y.selectionInactiveBackgroundTransparent=n.opacity(Y.selectionInactiveBackgroundTransparent,0.3)),Y.scrollbarSliderBackground=s($.scrollbarSliderBackground,n.opacity(Y.foreground,0.2)),Y.scrollbarSliderHoverBackground=s($.scrollbarSliderHoverBackground,n.opacity(Y.foreground,0.4)),Y.scrollbarSliderActiveBackground=s($.scrollbarSliderActiveBackground,n.opacity(Y.foreground,0.5)),Y.overviewRulerBorder=s($.overviewRulerBorder,hJ),Y.ansi=_0.slice(),Y.ansi[0]=s($.black,_0[0]),Y.ansi[1]=s($.red,_0[1]),Y.ansi[2]=s($.green,_0[2]),Y.ansi[3]=s($.yellow,_0[3]),Y.ansi[4]=s($.blue,_0[4]),Y.ansi[5]=s($.magenta,_0[5]),Y.ansi[6]=s($.cyan,_0[6]),Y.ansi[7]=s($.white,_0[7]),Y.ansi[8]=s($.brightBlack,_0[8]),Y.ansi[9]=s($.brightRed,_0[9]),Y.ansi[10]=s($.brightGreen,_0[10]),Y.ansi[11]=s($.brightYellow,_0[11]),Y.ansi[12]=s($.brightBlue,_0[12]),Y.ansi[13]=s($.brightMagenta,_0[13]),Y.ansi[14]=s($.brightCyan,_0[14]),Y.ansi[15]=s($.brightWhite,_0[15]),$.extendedAnsi){let J=Math.min(Y.ansi.length-16,$.extendedAnsi.length);for(let j=0;j<J;j++)Y.ansi[j+16]=s($.extendedAnsi[j],_0[j+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor($){this._restoreColor($),this._onChangeColors.fire(this.colors)}_restoreColor($){if($===void 0){for(let Y=0;Y<this._restoreColors.ansi.length;++Y)this._colors.ansi[Y]=this._restoreColors.ansi[Y];return}switch($){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[$]=this._restoreColors.ansi[$]}}modifyColors($){$(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};L6=j0([T(0,P0)],L6);function s($,Y){if($!==void 0)try{return e.toColor($)}catch{}return Y}var dJ=class{constructor(...$){this._entries=new Map;for(let[Y,J]of $)this.set(Y,J)}set($,Y){let J=this._entries.get($);return this._entries.set($,Y),J}forEach($){for(let[Y,J]of this._entries.entries())$(Y,J)}has($){return this._entries.has($)}get($){return this._entries.get($)}},uJ=class{constructor(){this._services=new dJ,this._services.set(w6,this)}setService($,Y){this._services.set($,Y)}getService($){return this._services.get($)}createInstance($,...Y){let J=N$($).sort((K,Q)=>K.index-Q.index),j=[];for(let K of J){let Q=this._services.get(K.id);if(!Q)throw Error(`[createInstance] ${$.name} depends on UNKNOWN service ${K.id._id}.`);j.push(Q)}let Z=J.length>0?J[0].index:Y.length;if(Y.length!==Z)throw Error(`[createInstance] First service dependency of ${$.name} at position ${Z+1} conflicts with ${Y.length} static arguments`);return new $(...Y,...j)}},cJ={trace:0,debug:1,info:2,warn:3,error:4,off:5},lJ="xterm.js: ",D6=class extends S{constructor($){super();this._optionsService=$,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),sJ=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=cJ[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams($){for(let Y=0;Y<$.length;Y++)typeof $[Y]=="function"&&($[Y]=$[Y]())}_log($,Y,J){this._evalLazyOptionalParams(J),$.call(console,(this._optionsService.options.logger?"":lJ)+Y,...J)}trace($,...Y){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,$,Y)}debug($,...Y){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,$,Y)}info($,...Y){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,$,Y)}warn($,...Y){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,$,Y)}error($,...Y){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,$,Y)}};D6=j0([T(0,P0)],D6);var sJ,_5=class extends S{constructor($){super();this._maxLength=$,this.onDeleteEmitter=this._register(new D),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new D),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new D),this.onTrim=this.onTrimEmitter.event,this._array=Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength($){if(this._maxLength===$)return;let Y=Array($);for(let J=0;J<Math.min($,this.length);J++)Y[J]=this._array[this._getCyclicIndex(J)];this._array=Y,this._maxLength=$,this._startIndex=0}get length(){return this._length}set length($){if($>this._length)for(let Y=this._length;Y<$;Y++)this._array[Y]=void 0;this._length=$}get($){return this._array[this._getCyclicIndex($)]}set($,Y){this._array[this._getCyclicIndex($)]=Y}push($){this._array[this._getCyclicIndex(this._length)]=$,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice($,Y,...J){if(Y){for(let j=$;j<this._length-Y;j++)this._array[this._getCyclicIndex(j)]=this._array[this._getCyclicIndex(j+Y)];this._length-=Y,this.onDeleteEmitter.fire({index:$,amount:Y})}for(let j=this._length-1;j>=$;j--)this._array[this._getCyclicIndex(j+J.length)]=this._array[this._getCyclicIndex(j)];for(let j=0;j<J.length;j++)this._array[this._getCyclicIndex($+j)]=J[j];if(J.length&&this.onInsertEmitter.fire({index:$,amount:J.length}),this._length+J.length>this._maxLength){let j=this._length+J.length-this._maxLength;this._startIndex+=j,this._length=this._maxLength,this.onTrimEmitter.fire(j)}else this._length+=J.length}trimStart($){$>this._length&&($=this._length),this._startIndex+=$,this._length-=$,this.onTrimEmitter.fire($)}shiftElements($,Y,J){if(!(Y<=0)){if($<0||$>=this._length)throw Error("start argument out of range");if($+J<0)throw Error("Cannot shift elements in list beyond index 0");if(J>0){for(let Z=Y-1;Z>=0;Z--)this.set($+Z+J,this.get($+Z));let j=$+Y+J-this._length;if(j>0)for(this._length+=j;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let j=0;j<Y;j++)this.set($+j+J,this.get($+j))}}_getCyclicIndex($){return(this._startIndex+$)%this._maxLength}},g=3,N0=Object.freeze(new E9),d9=0,t7=2,G9=class ${constructor(Y,J,j=!1){this.isWrapped=j,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(Y*g);let Z=J||o0.fromCharData([0,S5,1,0]);for(let K=0;K<Y;++K)this.setCell(K,Z);this.length=Y}get(Y){let J=this._data[Y*g+0],j=J&2097151;return[this._data[Y*g+1],J&2097152?this._combined[Y]:j?D8(j):"",J>>22,J&2097152?this._combined[Y].charCodeAt(this._combined[Y].length-1):j]}set(Y,J){this._data[Y*g+1]=J[0],J[1].length>1?(this._combined[Y]=J[1],this._data[Y*g+0]=Y|2097152|J[2]<<22):this._data[Y*g+0]=J[1].charCodeAt(0)|J[2]<<22}getWidth(Y){return this._data[Y*g+0]>>22}hasWidth(Y){return this._data[Y*g+0]&12582912}getFg(Y){return this._data[Y*g+1]}getBg(Y){return this._data[Y*g+2]}hasContent(Y){return this._data[Y*g+0]&4194303}getCodePoint(Y){let J=this._data[Y*g+0];return J&2097152?this._combined[Y].charCodeAt(this._combined[Y].length-1):J&2097151}isCombined(Y){return this._data[Y*g+0]&2097152}getString(Y){let J=this._data[Y*g+0];return J&2097152?this._combined[Y]:J&2097151?D8(J&2097151):""}isProtected(Y){return this._data[Y*g+2]&536870912}loadCell(Y,J){return d9=Y*g,J.content=this._data[d9+0],J.fg=this._data[d9+1],J.bg=this._data[d9+2],J.content&2097152&&(J.combinedData=this._combined[Y]),J.bg&268435456&&(J.extended=this._extendedAttrs[Y]),J}setCell(Y,J){J.content&2097152&&(this._combined[Y]=J.combinedData),J.bg&268435456&&(this._extendedAttrs[Y]=J.extended),this._data[Y*g+0]=J.content,this._data[Y*g+1]=J.fg,this._data[Y*g+2]=J.bg}setCellFromCodepoint(Y,J,j,Z){Z.bg&268435456&&(this._extendedAttrs[Y]=Z.extended),this._data[Y*g+0]=J|j<<22,this._data[Y*g+1]=Z.fg,this._data[Y*g+2]=Z.bg}addCodepointToCell(Y,J,j){let Z=this._data[Y*g+0];Z&2097152?this._combined[Y]+=D8(J):Z&2097151?(this._combined[Y]=D8(Z&2097151)+D8(J),Z&=-2097152,Z|=2097152):Z=J|4194304,j&&(Z&=-12582913,Z|=j<<22),this._data[Y*g+0]=Z}insertCells(Y,J,j){if(Y%=this.length,Y&&this.getWidth(Y-1)===2&&this.setCellFromCodepoint(Y-1,0,1,j),J<this.length-Y){let Z=new o0;for(let K=this.length-Y-J-1;K>=0;--K)this.setCell(Y+J+K,this.loadCell(Y+K,Z));for(let K=0;K<J;++K)this.setCell(Y+K,j)}else for(let Z=Y;Z<this.length;++Z)this.setCell(Z,j);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,j)}deleteCells(Y,J,j){if(Y%=this.length,J<this.length-Y){let Z=new o0;for(let K=0;K<this.length-Y-J;++K)this.setCell(Y+K,this.loadCell(Y+J+K,Z));for(let K=this.length-J;K<this.length;++K)this.setCell(K,j)}else for(let Z=Y;Z<this.length;++Z)this.setCell(Z,j);Y&&this.getWidth(Y-1)===2&&this.setCellFromCodepoint(Y-1,0,1,j),this.getWidth(Y)===0&&!this.hasContent(Y)&&this.setCellFromCodepoint(Y,0,1,j)}replaceCells(Y,J,j,Z=!1){if(Z){for(Y&&this.getWidth(Y-1)===2&&!this.isProtected(Y-1)&&this.setCellFromCodepoint(Y-1,0,1,j),J<this.length&&this.getWidth(J-1)===2&&!this.isProtected(J)&&this.setCellFromCodepoint(J,0,1,j);Y<J&&Y<this.length;)this.isProtected(Y)||this.setCell(Y,j),Y++;return}for(Y&&this.getWidth(Y-1)===2&&this.setCellFromCodepoint(Y-1,0,1,j),J<this.length&&this.getWidth(J-1)===2&&this.setCellFromCodepoint(J,0,1,j);Y<J&&Y<this.length;)this.setCell(Y++,j)}resize(Y,J){if(Y===this.length)return this._data.length*4*t7<this._data.buffer.byteLength;let j=Y*g;if(Y>this.length){if(this._data.buffer.byteLength>=j*4)this._data=new Uint32Array(this._data.buffer,0,j);else{let Z=new Uint32Array(j);Z.set(this._data),this._data=Z}for(let Z=this.length;Z<Y;++Z)this.setCell(Z,J)}else{this._data=this._data.subarray(0,j);let Z=Object.keys(this._combined);for(let Q=0;Q<Z.length;Q++){let X=parseInt(Z[Q],10);X>=Y&&delete this._combined[X]}let K=Object.keys(this._extendedAttrs);for(let Q=0;Q<K.length;Q++){let X=parseInt(K[Q],10);X>=Y&&delete this._extendedAttrs[X]}}return this.length=Y,j*4*t7<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*t7<this._data.buffer.byteLength){let Y=new Uint32Array(this._data.length);return Y.set(this._data),this._data=Y,1}return 0}fill(Y,J=!1){if(J){for(let j=0;j<this.length;++j)this.isProtected(j)||this.setCell(j,Y);return}this._combined={},this._extendedAttrs={};for(let j=0;j<this.length;++j)this.setCell(j,Y)}copyFrom(Y){this.length!==Y.length?this._data=new Uint32Array(Y._data):this._data.set(Y._data),this.length=Y.length,this._combined={};for(let J in Y._combined)this._combined[J]=Y._combined[J];this._extendedAttrs={};for(let J in Y._extendedAttrs)this._extendedAttrs[J]=Y._extendedAttrs[J];this.isWrapped=Y.isWrapped}clone(){let Y=new $(0);Y._data=new Uint32Array(this._data),Y.length=this.length;for(let J in this._combined)Y._combined[J]=this._combined[J];for(let J in this._extendedAttrs)Y._extendedAttrs[J]=this._extendedAttrs[J];return Y.isWrapped=this.isWrapped,Y}getTrimmedLength(){for(let Y=this.length-1;Y>=0;--Y)if(this._data[Y*g+0]&4194303)return Y+(this._data[Y*g+0]>>22);return 0}getNoBgTrimmedLength(){for(let Y=this.length-1;Y>=0;--Y)if(this._data[Y*g+0]&4194303||this._data[Y*g+2]&50331648)return Y+(this._data[Y*g+0]>>22);return 0}copyCellsFrom(Y,J,j,Z,K){let Q=Y._data;if(K)for(let N=Z-1;N>=0;N--){for(let z=0;z<g;z++)this._data[(j+N)*g+z]=Q[(J+N)*g+z];Q[(J+N)*g+2]&268435456&&(this._extendedAttrs[j+N]=Y._extendedAttrs[J+N])}else for(let N=0;N<Z;N++){for(let z=0;z<g;z++)this._data[(j+N)*g+z]=Q[(J+N)*g+z];Q[(J+N)*g+2]&268435456&&(this._extendedAttrs[j+N]=Y._extendedAttrs[J+N])}let X=Object.keys(Y._combined);for(let N=0;N<X.length;N++){let z=parseInt(X[N],10);z>=J&&(this._combined[z-J+j]=Y._combined[z])}}translateToString(Y,J,j,Z){J=J??0,j=j??this.length,Y&&(j=Math.min(j,this.getTrimmedLength())),Z&&(Z.length=0);let K="";for(;J<j;){let Q=this._data[J*g+0],X=Q&2097151,N=Q&2097152?this._combined[J]:X?D8(X):M8;if(K+=N,Z)for(let z=0;z<N.length;++z)Z.push(J);J+=Q>>22||1}return Z&&Z.push(J),K}};function oJ($,Y,J,j,Z,K){let Q=[];for(let X=0;X<$.length-1;X++){let N=X,z=$.get(++N);if(!z.isWrapped)continue;let G=[$.get(X)];for(;N<$.length&&z.isWrapped;)G.push(z),z=$.get(++N);if(!K&&j>=X&&j<N){X+=G.length-1;continue}let V=0,W=q9(G,V,Y),_=1,H=0;for(;_<G.length;){let B=q9(G,_,Y),A=B-H,k=J-W,M=Math.min(A,k);G[V].copyCellsFrom(G[_],H,W,M,!1),W+=M,W===J&&(V++,W=0),H+=M,H===B&&(_++,H=0),W===0&&V!==0&&G[V-1].getWidth(J-1)===2&&(G[V].copyCellsFrom(G[V-1],J-1,W++,1,!1),G[V-1].setCell(J-1,Z))}G[V].replaceCells(W,J,Z);let U=0;for(let B=G.length-1;B>0&&(B>V||G[B].getTrimmedLength()===0);B--)U++;U>0&&(Q.push(X+G.length-U),Q.push(U)),X+=G.length-1}return Q}function aJ($,Y){let J=[],j=0,Z=Y[j],K=0;for(let Q=0;Q<$.length;Q++)if(Z===Q){let X=Y[++j];$.onDeleteEmitter.fire({index:Q-K,amount:X}),Q+=X-1,K+=X,Z=Y[++j]}else J.push(Q);return{layout:J,countRemoved:K}}function nJ($,Y){let J=[];for(let j=0;j<Y.length;j++)J.push($.get(Y[j]));for(let j=0;j<J.length;j++)$.set(j,J[j]);$.length=Y.length}function rJ($,Y,J){let j=[],Z=$.map((N,z)=>q9($,z,Y)).reduce((N,z)=>N+z),K=0,Q=0,X=0;for(;X<Z;){if(Z-X<J){j.push(Z-X);break}K+=J;let N=q9($,Q,Y);K>N&&(K-=N,Q++);let z=$[Q].getWidth(K-1)===2;z&&K--;let G=z?J-1:J;j.push(G),X+=G}return j}function q9($,Y,J){if(Y===$.length-1)return $[Y].getTrimmedLength();let j=!$[Y].hasContent(J-1)&&$[Y].getWidth(J-1)===1,Z=$[Y+1].getWidth(0)===2;return j&&Z?J-1:J}var I2=class ${constructor(Y){this.line=Y,this.isDisposed=!1,this._disposables=[],this._id=$._nextId++,this._onDispose=this.register(new D),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),p8(this._disposables),this._disposables.length=0)}register(Y){return this._disposables.push(Y),Y}};I2._nextId=1;var iJ=I2,I0={},m8=I0.B;I0[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""};I0.A={"#":""};I0.B=void 0;I0[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""};I0.C=I0[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};I0.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};I0.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};I0.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};I0.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""};I0.E=I0[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};I0.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""};I0.H=I0[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};I0["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var H5=4294967295,I5=class{constructor($,Y,J){this._hasScrollback=$,this._optionsService=Y,this._bufferService=J,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=N0.clone(),this.savedCharset=m8,this.markers=[],this._nullCell=o0.fromCharData([0,S5,1,0]),this._whitespaceCell=o0.fromCharData([0,M8,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new Z7,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new _5(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell($){return $?(this._nullCell.fg=$.fg,this._nullCell.bg=$.bg,this._nullCell.extended=$.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new i9),this._nullCell}getWhitespaceCell($){return $?(this._whitespaceCell.fg=$.fg,this._whitespaceCell.bg=$.bg,this._whitespaceCell.extended=$.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new i9),this._whitespaceCell}getBlankLine($,Y){return new G9(this._bufferService.cols,this.getNullCell($),Y)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let $=this.ybase+this.y-this.ydisp;return $>=0&&$<this._rows}_getCorrectBufferLength($){if(!this._hasScrollback)return $;let Y=$+this._optionsService.rawOptions.scrollback;return Y>H5?H5:Y}fillViewportRows($){if(this.lines.length===0){$===void 0&&($=N0);let Y=this._rows;for(;Y--;)this.lines.push(this.getBlankLine($))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new _5(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize($,Y){let J=this.getNullCell(N0),j=0,Z=this._getCorrectBufferLength(Y);if(Z>this.lines.maxLength&&(this.lines.maxLength=Z),this.lines.length>0){if(this._cols<$)for(let Q=0;Q<this.lines.length;Q++)j+=+this.lines.get(Q).resize($,J);let K=0;if(this._rows<Y)for(let Q=this._rows;Q<Y;Q++)this.lines.length<Y+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new G9($,J)):this.ybase>0&&this.lines.length<=this.ybase+this.y+K+1?(this.ybase--,K++,this.ydisp>0&&this.ydisp--):this.lines.push(new G9($,J)));else for(let Q=this._rows;Q>Y;Q--)this.lines.length>Y+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(Z<this.lines.maxLength){let Q=this.lines.length-Z;Q>0&&(this.lines.trimStart(Q),this.ybase=Math.max(this.ybase-Q,0),this.ydisp=Math.max(this.ydisp-Q,0),this.savedY=Math.max(this.savedY-Q,0)),this.lines.maxLength=Z}this.x=Math.min(this.x,$-1),this.y=Math.min(this.y,Y-1),K&&(this.y+=K),this.savedX=Math.min(this.savedX,$-1),this.scrollTop=0}if(this.scrollBottom=Y-1,this._isReflowEnabled&&(this._reflow($,Y),this._cols>$))for(let K=0;K<this.lines.length;K++)j+=+this.lines.get(K).resize($,J);this._cols=$,this._rows=Y,this._memoryCleanupQueue.clear(),j>0.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let $=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,$=!1);let Y=0;for(;this._memoryCleanupPosition<this.lines.length;)if(Y+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),Y>100)return!0;return $}get _isReflowEnabled(){let $=this._optionsService.rawOptions.windowsPty;return $&&$.buildNumber?this._hasScrollback&&$.backend==="conpty"&&$.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow($,Y){this._cols!==$&&($>this._cols?this._reflowLarger($,Y):this._reflowSmaller($,Y))}_reflowLarger($,Y){let J=this._optionsService.rawOptions.reflowCursorLine,j=oJ(this.lines,this._cols,$,this.ybase+this.y,this.getNullCell(N0),J);if(j.length>0){let Z=aJ(this.lines,j);nJ(this.lines,Z.layout),this._reflowLargerAdjustViewport($,Y,Z.countRemoved)}}_reflowLargerAdjustViewport($,Y,J){let j=this.getNullCell(N0),Z=J;for(;Z-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<Y&&this.lines.push(new G9($,j))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-J,0)}_reflowSmaller($,Y){let J=this._optionsService.rawOptions.reflowCursorLine,j=this.getNullCell(N0),Z=[],K=0;for(let Q=this.lines.length-1;Q>=0;Q--){let X=this.lines.get(Q);if(!X||!X.isWrapped&&X.getTrimmedLength()<=$)continue;let N=[X];for(;X.isWrapped&&Q>0;)X=this.lines.get(--Q),N.unshift(X);if(!J){let M=this.ybase+this.y;if(M>=Q&&M<Q+N.length)continue}let z=N[N.length-1].getTrimmedLength(),G=rJ(N,this._cols,$),V=G.length-N.length,W;this.ybase===0&&this.y!==this.lines.length-1?W=Math.max(0,this.y-this.lines.maxLength+V):W=Math.max(0,this.lines.length-this.lines.maxLength+V);let _=[];for(let M=0;M<V;M++){let y=this.getBlankLine(N0,!0);_.push(y)}_.length>0&&(Z.push({start:Q+N.length+K,newLines:_}),K+=_.length),N.push(..._);let H=G.length-1,U=G[H];U===0&&(H--,U=G[H]);let B=N.length-V-1,A=z;for(;B>=0;){let M=Math.min(A,U);if(N[H]===void 0)break;if(N[H].copyCellsFrom(N[B],A-M,U-M,M,!0),U-=M,U===0&&(H--,U=G[H]),A-=M,A===0){B--;let y=Math.max(B,0);A=q9(N,y,this._cols)}}for(let M=0;M<N.length;M++)G[M]<$&&N[M].setCell(G[M],j);let k=V-W;for(;k-- >0;)this.ybase===0?this.y<Y-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+K)-Y&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+V,this.ybase+Y-1)}if(Z.length>0){let Q=[],X=[];for(let U=0;U<this.lines.length;U++)X.push(this.lines.get(U));let N=this.lines.length,z=N-1,G=0,V=Z[G];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+K);let W=0;for(let U=Math.min(this.lines.maxLength-1,N+K-1);U>=0;U--)if(V&&V.start>z+W){for(let B=V.newLines.length-1;B>=0;B--)this.lines.set(U--,V.newLines[B]);U++,Q.push({index:z+1,amount:V.newLines.length}),W+=V.newLines.length,V=Z[++G]}else this.lines.set(U,X[z--]);let _=0;for(let U=Q.length-1;U>=0;U--)Q[U].index+=_,this.lines.onInsertEmitter.fire(Q[U]),_+=Q[U].amount;let H=Math.max(0,N+K-this.lines.maxLength);H>0&&this.lines.onTrimEmitter.fire(H)}}translateBufferLineToString($,Y,J=0,j){let Z=this.lines.get($);return Z?Z.translateToString(Y,J,j):""}getWrappedRangeForLine($){let Y=$,J=$;for(;Y>0&&this.lines.get(Y).isWrapped;)Y--;for(;J+1<this.lines.length&&this.lines.get(J+1).isWrapped;)J++;return{first:Y,last:J}}setupTabStops($){for($!=null?this.tabs[$]||($=this.prevStop($)):(this.tabs={},$=0);$<this._cols;$+=this._optionsService.rawOptions.tabStopWidth)this.tabs[$]=!0}prevStop($){for($==null&&($=this.x);!this.tabs[--$]&&$>0;);return $>=this._cols?this._cols-1:$<0?0:$}nextStop($){for($==null&&($=this.x);!this.tabs[++$]&&$<this._cols;);return $>=this._cols?this._cols-1:$<0?0:$}clearMarkers($){this._isClearing=!0;for(let Y=0;Y<this.markers.length;Y++)this.markers[Y].line===$&&(this.markers[Y].dispose(),this.markers.splice(Y--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let $=0;$<this.markers.length;$++)this.markers[$].dispose();this.markers.length=0,this._isClearing=!1}addMarker($){let Y=new iJ($);return this.markers.push(Y),Y.register(this.lines.onTrim((J)=>{Y.line-=J,Y.line<0&&Y.dispose()})),Y.register(this.lines.onInsert((J)=>{Y.line>=J.index&&(Y.line+=J.amount)})),Y.register(this.lines.onDelete((J)=>{Y.line>=J.index&&Y.line<J.index+J.amount&&Y.dispose(),Y.line>J.index&&(Y.line-=J.amount)})),Y.register(Y.onDispose(()=>this._removeMarker(Y))),Y}_removeMarker($){this._isClearing||this.markers.splice(this.markers.indexOf($),1)}},tJ=class extends S{constructor($,Y){super();this._optionsService=$,this._bufferService=Y,this._onBufferActivate=this._register(new D),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new I5(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new I5(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer($){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows($),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize($,Y){this._normal.resize($,Y),this._alt.resize($,Y),this.setupTabStops($)}setupTabStops($){this._normal.setupTabStops($),this._alt.setupTabStops($)}},x2=2,U2=1,M6=class extends S{constructor($){super();this.isUserScrolling=!1,this._onResize=this._register(new D),this.onResize=this._onResize.event,this._onScroll=this._register(new D),this.onScroll=this._onScroll.event,this.cols=Math.max($.rawOptions.cols||0,x2),this.rows=Math.max($.rawOptions.rows||0,U2),this.buffers=this._register(new tJ($,this)),this._register(this.buffers.onBufferActivate((Y)=>{this._onScroll.fire(Y.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize($,Y){let J=this.cols!==$,j=this.rows!==Y;this.cols=$,this.rows=Y,this.buffers.resize($,Y),this._onResize.fire({cols:$,rows:Y,colsChanged:J,rowsChanged:j})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll($,Y=!1){let J=this.buffer,j;j=this._cachedBlankLine,(!j||j.length!==this.cols||j.getFg(0)!==$.fg||j.getBg(0)!==$.bg)&&(j=J.getBlankLine($,Y),this._cachedBlankLine=j),j.isWrapped=Y;let Z=J.ybase+J.scrollTop,K=J.ybase+J.scrollBottom;if(J.scrollTop===0){let Q=J.lines.isFull;K===J.lines.length-1?Q?J.lines.recycle().copyFrom(j):J.lines.push(j.clone()):J.lines.splice(K+1,0,j.clone()),Q?this.isUserScrolling&&(J.ydisp=Math.max(J.ydisp-1,0)):(J.ybase++,this.isUserScrolling||J.ydisp++)}else{let Q=K-Z+1;J.lines.shiftElements(Z+1,Q-1,-1),J.lines.set(K,j.clone())}this.isUserScrolling||(J.ydisp=J.ybase),this._onScroll.fire(J.ydisp)}scrollLines($,Y){let J=this.buffer;if($<0){if(J.ydisp===0)return;this.isUserScrolling=!0}else $+J.ydisp>=J.ybase&&(this.isUserScrolling=!1);let j=J.ydisp;J.ydisp=Math.max(Math.min(J.ydisp+$,J.ybase),0),j!==J.ydisp&&(Y||this._onScroll.fire(J.ydisp))}};M6=j0([T(0,P0)],M6);var c8={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1000,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:j7,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},eJ=["normal","bold","100","200","300","400","500","600","700","800","900"],$j=class extends S{constructor($){super();this._onOptionChange=this._register(new D),this.onOptionChange=this._onOptionChange.event;let Y={...c8};for(let J in $)if(J in Y)try{let j=$[J];Y[J]=this._sanitizeAndValidateOption(J,j)}catch(j){console.error(j)}this.rawOptions=Y,this.options={...Y},this._setupOptions(),this._register(r(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange($,Y){return this.onOptionChange((J)=>{J===$&&Y(this.rawOptions[$])})}onMultipleOptionChange($,Y){return this.onOptionChange((J)=>{$.indexOf(J)!==-1&&Y()})}_setupOptions(){let $=(J)=>{if(!(J in c8))throw Error(`No option with key "${J}"`);return this.rawOptions[J]},Y=(J,j)=>{if(!(J in c8))throw Error(`No option with key "${J}"`);j=this._sanitizeAndValidateOption(J,j),this.rawOptions[J]!==j&&(this.rawOptions[J]=j,this._onOptionChange.fire(J))};for(let J in this.rawOptions){let j={get:$.bind(this,J),set:Y.bind(this,J)};Object.defineProperty(this.options,J,j)}}_sanitizeAndValidateOption($,Y){switch($){case"cursorStyle":if(Y||(Y=c8[$]),!Yj(Y))throw Error(`"${Y}" is not a valid value for ${$}`);break;case"wordSeparator":Y||(Y=c8[$]);break;case"fontWeight":case"fontWeightBold":if(typeof Y=="number"&&1<=Y&&Y<=1000)break;Y=eJ.includes(Y)?Y:c8[$];break;case"cursorWidth":Y=Math.floor(Y);case"lineHeight":case"tabStopWidth":if(Y<1)throw Error(`${$} cannot be less than 1, value: ${Y}`);break;case"minimumContrastRatio":Y=Math.max(1,Math.min(21,Math.round(Y*10)/10));break;case"scrollback":if(Y=Math.min(Y,4294967295),Y<0)throw Error(`${$} cannot be less than 0, value: ${Y}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(Y<=0)throw Error(`${$} cannot be less than or equal to 0, value: ${Y}`);break;case"rows":case"cols":if(!Y&&Y!==0)throw Error(`${$} must be numeric, value: ${Y}`);break;case"windowsPty":Y=Y??{};break}return Y}};function Yj($){return $==="block"||$==="underline"||$==="bar"}function W9($,Y=5){if(typeof $!="object")return $;let J=Array.isArray($)?[]:{};for(let j in $)J[j]=Y<=1?$[j]:$[j]&&W9($[j],Y-1);return J}var x5=Object.freeze({insertMode:!1}),U5=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),b6=class extends S{constructor($,Y,J){super();this._bufferService=$,this._logService=Y,this._optionsService=J,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new D),this.onData=this._onData.event,this._onUserInput=this._register(new D),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new D),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new D),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=W9(x5),this.decPrivateModes=W9(U5)}reset(){this.modes=W9(x5),this.decPrivateModes=W9(U5)}triggerDataEvent($,Y=!1){if(this._optionsService.rawOptions.disableStdin)return;let J=this._bufferService.buffer;Y&&this._optionsService.rawOptions.scrollOnUserInput&&J.ybase!==J.ydisp&&this._onRequestScrollToBottom.fire(),Y&&this._onUserInput.fire(),this._logService.debug(`sending data "${$}"`),this._logService.trace("sending data (codes)",()=>$.split("").map((j)=>j.charCodeAt(0))),this._onData.fire($)}triggerBinaryEvent($){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${$}"`),this._logService.trace("sending binary (codes)",()=>$.split("").map((Y)=>Y.charCodeAt(0))),this._onBinary.fire($))}};b6=j0([T(0,A0),T(1,p5),T(2,P0)],b6);var O5={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:($)=>$.button===4||$.action!==1?!1:($.ctrl=!1,$.alt=!1,$.shift=!1,!0)},VT200:{events:19,restrict:($)=>$.action!==32},DRAG:{events:23,restrict:($)=>!($.action===32&&$.button===3)},ANY:{events:31,restrict:($)=>!0}};function e7($,Y){let J=($.ctrl?16:0)|($.shift?4:0)|($.alt?8:0);return $.button===4?(J|=64,J|=$.action):(J|=$.button&3,$.button&4&&(J|=64),$.button&8&&(J|=128),$.action===32?J|=32:$.action===0&&!Y&&(J|=3)),J}var $6=String.fromCharCode,q5={DEFAULT:($)=>{let Y=[e7($,!1)+32,$.col+32,$.row+32];return Y[0]>255||Y[1]>255||Y[2]>255?"":`\x1B[M${$6(Y[0])}${$6(Y[1])}${$6(Y[2])}`},SGR:($)=>{let Y=$.action===0&&$.button!==4?"m":"M";return`\x1B[<${e7($,!0)};${$.col};${$.row}${Y}`},SGR_PIXELS:($)=>{let Y=$.action===0&&$.button!==4?"m":"M";return`\x1B[<${e7($,!0)};${$.x};${$.y}${Y}`}},T6=class extends S{constructor($,Y,J){super();this._bufferService=$,this._coreService=Y,this._optionsService=J,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new D),this.onProtocolChange=this._onProtocolChange.event;for(let j of Object.keys(O5))this.addProtocol(j,O5[j]);for(let j of Object.keys(q5))this.addEncoding(j,q5[j]);this.reset()}addProtocol($,Y){this._protocols[$]=Y}addEncoding($,Y){this._encodings[$]=Y}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol($){if(!this._protocols[$])throw Error(`unknown protocol "${$}"`);this._activeProtocol=$,this._onProtocolChange.fire(this._protocols[$].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding($){if(!this._encodings[$])throw Error(`unknown encoding "${$}"`);this._activeEncoding=$}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent($,Y,J){if($.deltaY===0||$.shiftKey||Y===void 0||J===void 0)return 0;let j=Y/J,Z=this._applyScrollModifier($.deltaY,$);return $.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(Z/=j+0,Math.abs($.deltaY)<50&&(Z*=0.3),this._wheelPartialScroll+=Z,Z=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):$.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(Z*=this._bufferService.rows),Z}_applyScrollModifier($,Y){return Y.altKey||Y.ctrlKey||Y.shiftKey?$*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:$*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent($){if($.col<0||$.col>=this._bufferService.cols||$.row<0||$.row>=this._bufferService.rows||$.button===4&&$.action===32||$.button===3&&$.action!==32||$.button!==4&&($.action===2||$.action===3)||($.col++,$.row++,$.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,$,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict($))return!1;let Y=this._encodings[this._activeEncoding]($);return Y&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(Y):this._coreService.triggerDataEvent(Y,!0)),this._lastEvent=$,!0}explainEvents($){return{down:!!($&1),up:!!($&2),drag:!!($&4),move:!!($&8),wheel:!!($&16)}}_equalEvents($,Y,J){if(J){if($.x!==Y.x||$.y!==Y.y)return!1}else if($.col!==Y.col||$.row!==Y.row)return!1;return!($.button!==Y.button||$.action!==Y.action||$.ctrl!==Y.ctrl||$.alt!==Y.alt||$.shift!==Y.shift)}};T6=j0([T(0,A0),T(1,h8),T(2,P0)],T6);var Y6=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],Jj=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],H0;function jj($,Y){let J=0,j=Y.length-1,Z;if($<Y[0][0]||$>Y[j][1])return!1;for(;j>=J;)if(Z=J+j>>1,$>Y[Z][1])J=Z+1;else if($<Y[Z][0])j=Z-1;else return!0;return!1}var Zj=class{constructor(){if(this.version="6",!H0){H0=new Uint8Array(65536),H0.fill(1),H0[0]=0,H0.fill(0,1,32),H0.fill(0,127,160),H0.fill(2,4352,4448),H0[9001]=2,H0[9002]=2,H0.fill(2,11904,42192),H0[12351]=1,H0.fill(2,44032,55204),H0.fill(2,63744,64256),H0.fill(2,65040,65050),H0.fill(2,65072,65136),H0.fill(2,65280,65377),H0.fill(2,65504,65511);for(let $=0;$<Y6.length;++$)H0.fill(0,Y6[$][0],Y6[$][1]+1)}}wcwidth($){return $<32?0:$<127?1:$<65536?H0[$]:jj($,Jj)?0:$>=131072&&$<=196605||$>=196608&&$<=262141?2:1}charProperties($,Y){let J=this.wcwidth($),j=J===0&&Y!==0;if(j){let Z=S8.extractWidth(Y);Z===0?j=!1:Z>J&&(J=Z)}return S8.createPropertyValue(0,J,j)}},S8=class ${constructor(){this._providers=Object.create(null),this._active="",this._onChange=new D,this.onChange=this._onChange.event;let Y=new Zj;this.register(Y),this._active=Y.version,this._activeProvider=Y}static extractShouldJoin(Y){return(Y&1)!==0}static extractWidth(Y){return Y>>1&3}static extractCharKind(Y){return Y>>3}static createPropertyValue(Y,J,j=!1){return(Y&16777215)<<3|(J&3)<<1|(j?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(Y){if(!this._providers[Y])throw Error(`unknown Unicode version "${Y}"`);this._active=Y,this._activeProvider=this._providers[Y],this._onChange.fire(Y)}register(Y){this._providers[Y.version]=Y}wcwidth(Y){return this._activeProvider.wcwidth(Y)}getStringCellWidth(Y){let J=0,j=0,Z=Y.length;for(let K=0;K<Z;++K){let Q=Y.charCodeAt(K);if(55296<=Q&&Q<=56319){if(++K>=Z)return J+this.wcwidth(Q);let z=Y.charCodeAt(K);56320<=z&&z<=57343?Q=(Q-55296)*1024+z-56320+65536:J+=this.wcwidth(z)}let X=this.charProperties(Q,j),N=$.extractWidth(X);$.extractShouldJoin(X)&&(N-=$.extractWidth(j)),J+=N,j=X}return J}charProperties(Y,J){return this._activeProvider.charProperties(Y,J)}},Kj=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel($){this.glevel=$,this.charset=this._charsets[$]}setgCharset($,Y){this._charsets[$]=Y,this.glevel===$&&(this.charset=Y)}};function E5($){let Y=$.buffer.lines.get($.buffer.ybase+$.buffer.y-1)?.get($.cols-1),J=$.buffer.lines.get($.buffer.ybase+$.buffer.y);J&&Y&&(J.isWrapped=Y[3]!==0&&Y[3]!==32)}var K9=2147483647,Qj=256,O2=class ${constructor(Y=32,J=32){if(this.maxLength=Y,this.maxSubParamsLength=J,J>Qj)throw Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(Y),this.length=0,this._subParams=new Int32Array(J),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(Y),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(Y){let J=new $;if(!Y.length)return J;for(let j=Array.isArray(Y[0])?1:0;j<Y.length;++j){let Z=Y[j];if(Array.isArray(Z))for(let K=0;K<Z.length;++K)J.addSubParam(Z[K]);else J.addParam(Z)}return J}clone(){let Y=new $(this.maxLength,this.maxSubParamsLength);return Y.params.set(this.params),Y.length=this.length,Y._subParams.set(this._subParams),Y._subParamsLength=this._subParamsLength,Y._subParamsIdx.set(this._subParamsIdx),Y._rejectDigits=this._rejectDigits,Y._rejectSubDigits=this._rejectSubDigits,Y._digitIsSub=this._digitIsSub,Y}toArray(){let Y=[];for(let J=0;J<this.length;++J){Y.push(this.params[J]);let j=this._subParamsIdx[J]>>8,Z=this._subParamsIdx[J]&255;Z-j>0&&Y.push(Array.prototype.slice.call(this._subParams,j,Z))}return Y}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(Y){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(Y<-1)throw Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=Y>K9?K9:Y}addSubParam(Y){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(Y<-1)throw Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=Y>K9?K9:Y,this._subParamsIdx[this.length-1]++}}hasSubParams(Y){return(this._subParamsIdx[Y]&255)-(this._subParamsIdx[Y]>>8)>0}getSubParams(Y){let J=this._subParamsIdx[Y]>>8,j=this._subParamsIdx[Y]&255;return j-J>0?this._subParams.subarray(J,j):null}getSubParamsAll(){let Y={};for(let J=0;J<this.length;++J){let j=this._subParamsIdx[J]>>8,Z=this._subParamsIdx[J]&255;Z-j>0&&(Y[J]=this._subParams.slice(j,Z))}return Y}addDigit(Y){let J;if(this._rejectDigits||!(J=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let j=this._digitIsSub?this._subParams:this.params,Z=j[J-1];j[J-1]=~Z?Math.min(Z*10+Y,K9):Y}},Q9=[],Xj=class{constructor(){this._state=0,this._active=Q9,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler($,Y){this._handlers[$]===void 0&&(this._handlers[$]=[]);let J=this._handlers[$];return J.push(Y),{dispose:()=>{let j=J.indexOf(Y);j!==-1&&J.splice(j,1)}}}clearHandler($){this._handlers[$]&&delete this._handlers[$]}setHandlerFallback($){this._handlerFb=$}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=Q9}reset(){if(this._state===2)for(let $=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;$>=0;--$)this._active[$].end(!1);this._stack.paused=!1,this._active=Q9,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||Q9,!this._active.length)this._handlerFb(this._id,"START");else for(let $=this._active.length-1;$>=0;$--)this._active[$].start()}_put($,Y,J){if(!this._active.length)this._handlerFb(this._id,"PUT",Q7($,Y,J));else for(let j=this._active.length-1;j>=0;j--)this._active[j].put($,Y,J)}start(){this.reset(),this._state=1}put($,Y,J){if(this._state!==3){if(this._state===1)for(;Y<J;){let j=$[Y++];if(j===59){this._state=2,this._start();break}if(j<48||57<j){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+j-48}this._state===2&&J-Y>0&&this._put($,Y,J)}}end($,Y=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",$);else{let J=!1,j=this._active.length-1,Z=!1;if(this._stack.paused&&(j=this._stack.loopPosition-1,J=Y,Z=this._stack.fallThrough,this._stack.paused=!1),!Z&&J===!1){for(;j>=0&&(J=this._active[j].end($),J!==!0);j--)if(J instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=j,this._stack.fallThrough=!1,J;j--}for(;j>=0;j--)if(J=this._active[j].end(!1),J instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=j,this._stack.fallThrough=!0,J}this._active=Q9,this._id=-1,this._state=0}}},p0=class{constructor($){this._handler=$,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put($,Y,J){this._hitLimit||(this._data+=Q7($,Y,J),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end($){let Y=!1;if(this._hitLimit)Y=!1;else if($&&(Y=this._handler(this._data),Y instanceof Promise))return Y.then((J)=>(this._data="",this._hitLimit=!1,J));return this._data="",this._hitLimit=!1,Y}},X9=[],zj=class{constructor(){this._handlers=Object.create(null),this._active=X9,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=X9}registerHandler($,Y){this._handlers[$]===void 0&&(this._handlers[$]=[]);let J=this._handlers[$];return J.push(Y),{dispose:()=>{let j=J.indexOf(Y);j!==-1&&J.splice(j,1)}}}clearHandler($){this._handlers[$]&&delete this._handlers[$]}setHandlerFallback($){this._handlerFb=$}reset(){if(this._active.length)for(let $=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;$>=0;--$)this._active[$].unhook(!1);this._stack.paused=!1,this._active=X9,this._ident=0}hook($,Y){if(this.reset(),this._ident=$,this._active=this._handlers[$]||X9,!this._active.length)this._handlerFb(this._ident,"HOOK",Y);else for(let J=this._active.length-1;J>=0;J--)this._active[J].hook(Y)}put($,Y,J){if(!this._active.length)this._handlerFb(this._ident,"PUT",Q7($,Y,J));else for(let j=this._active.length-1;j>=0;j--)this._active[j].put($,Y,J)}unhook($,Y=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",$);else{let J=!1,j=this._active.length-1,Z=!1;if(this._stack.paused&&(j=this._stack.loopPosition-1,J=Y,Z=this._stack.fallThrough,this._stack.paused=!1),!Z&&J===!1){for(;j>=0&&(J=this._active[j].unhook($),J!==!0);j--)if(J instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=j,this._stack.fallThrough=!1,J;j--}for(;j>=0;j--)if(J=this._active[j].unhook(!1),J instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=j,this._stack.fallThrough=!0,J}this._active=X9,this._ident=0}},_9=new O2;_9.addParam(0);var v5=class{constructor($){this._handler=$,this._data="",this._params=_9,this._hitLimit=!1}hook($){this._params=$.length>1||$.params[0]?$.clone():_9,this._data="",this._hitLimit=!1}put($,Y,J){this._hitLimit||(this._data+=Q7($,Y,J),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook($){let Y=!1;if(this._hitLimit)Y=!1;else if($&&(Y=this._handler(this._data,this._params),Y instanceof Promise))return Y.then((J)=>(this._params=_9,this._data="",this._hitLimit=!1,J));return this._params=_9,this._data="",this._hitLimit=!1,Y}},Nj=class{constructor($){this.table=new Uint8Array($)}setDefault($,Y){this.table.fill($<<4|Y)}add($,Y,J,j){this.table[Y<<8|$]=J<<4|j}addMany($,Y,J,j){for(let Z=0;Z<$.length;Z++)this.table[Y<<8|$[Z]]=J<<4|j}},s0=160,Vj=function(){let $=new Nj(4095),Y=Array.apply(null,Array(256)).map((X,N)=>N),J=(X,N)=>Y.slice(X,N),j=J(32,127),Z=J(0,24);Z.push(25),Z.push.apply(Z,J(28,32));let K=J(0,14),Q;$.setDefault(1,0),$.addMany(j,0,2,0);for(Q in K)$.addMany([24,26,153,154],Q,3,0),$.addMany(J(128,144),Q,3,0),$.addMany(J(144,152),Q,3,0),$.add(156,Q,0,0),$.add(27,Q,11,1),$.add(157,Q,4,8),$.addMany([152,158,159],Q,0,7),$.add(155,Q,11,3),$.add(144,Q,11,9);return $.addMany(Z,0,3,0),$.addMany(Z,1,3,1),$.add(127,1,0,1),$.addMany(Z,8,0,8),$.addMany(Z,3,3,3),$.add(127,3,0,3),$.addMany(Z,4,3,4),$.add(127,4,0,4),$.addMany(Z,6,3,6),$.addMany(Z,5,3,5),$.add(127,5,0,5),$.addMany(Z,2,3,2),$.add(127,2,0,2),$.add(93,1,4,8),$.addMany(j,8,5,8),$.add(127,8,5,8),$.addMany([156,27,24,26,7],8,6,0),$.addMany(J(28,32),8,0,8),$.addMany([88,94,95],1,0,7),$.addMany(j,7,0,7),$.addMany(Z,7,0,7),$.add(156,7,0,0),$.add(127,7,0,7),$.add(91,1,11,3),$.addMany(J(64,127),3,7,0),$.addMany(J(48,60),3,8,4),$.addMany([60,61,62,63],3,9,4),$.addMany(J(48,60),4,8,4),$.addMany(J(64,127),4,7,0),$.addMany([60,61,62,63],4,0,6),$.addMany(J(32,64),6,0,6),$.add(127,6,0,6),$.addMany(J(64,127),6,0,0),$.addMany(J(32,48),3,9,5),$.addMany(J(32,48),5,9,5),$.addMany(J(48,64),5,0,6),$.addMany(J(64,127),5,7,0),$.addMany(J(32,48),4,9,5),$.addMany(J(32,48),1,9,2),$.addMany(J(32,48),2,9,2),$.addMany(J(48,127),2,10,0),$.addMany(J(48,80),1,10,0),$.addMany(J(81,88),1,10,0),$.addMany([89,90,92],1,10,0),$.addMany(J(96,127),1,10,0),$.add(80,1,11,9),$.addMany(Z,9,0,9),$.add(127,9,0,9),$.addMany(J(28,32),9,0,9),$.addMany(J(32,48),9,9,12),$.addMany(J(48,60),9,8,10),$.addMany([60,61,62,63],9,9,10),$.addMany(Z,11,0,11),$.addMany(J(32,128),11,0,11),$.addMany(J(28,32),11,0,11),$.addMany(Z,10,0,10),$.add(127,10,0,10),$.addMany(J(28,32),10,0,10),$.addMany(J(48,60),10,8,10),$.addMany([60,61,62,63],10,0,11),$.addMany(J(32,48),10,9,12),$.addMany(Z,12,0,12),$.add(127,12,0,12),$.addMany(J(28,32),12,0,12),$.addMany(J(32,48),12,9,12),$.addMany(J(48,64),12,0,11),$.addMany(J(64,127),12,12,13),$.addMany(J(64,127),10,12,13),$.addMany(J(64,127),9,12,13),$.addMany(Z,13,13,13),$.addMany(j,13,13,13),$.add(127,13,0,13),$.addMany([27,156,24,26],13,14,0),$.add(s0,0,2,0),$.add(s0,8,5,8),$.add(s0,6,0,6),$.add(s0,11,0,11),$.add(s0,13,13,13),$}(),Gj=class extends S{constructor($=Vj){super();this._transitions=$,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new O2,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(Y,J,j)=>{},this._executeHandlerFb=(Y)=>{},this._csiHandlerFb=(Y,J)=>{},this._escHandlerFb=(Y)=>{},this._errorHandlerFb=(Y)=>Y,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(r(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new Xj),this._dcsParser=this._register(new zj),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier($,Y=[64,126]){let J=0;if($.prefix){if($.prefix.length>1)throw Error("only one byte as prefix supported");if(J=$.prefix.charCodeAt(0),J&&60>J||J>63)throw Error("prefix must be in range 0x3c .. 0x3f")}if($.intermediates){if($.intermediates.length>2)throw Error("only two bytes as intermediates are supported");for(let Z=0;Z<$.intermediates.length;++Z){let K=$.intermediates.charCodeAt(Z);if(32>K||K>47)throw Error("intermediate must be in range 0x20 .. 0x2f");J<<=8,J|=K}}if($.final.length!==1)throw Error("final must be a single byte");let j=$.final.charCodeAt(0);if(Y[0]>j||j>Y[1])throw Error(`final must be in range ${Y[0]} .. ${Y[1]}`);return J<<=8,J|=j,J}identToString($){let Y=[];for(;$;)Y.push(String.fromCharCode($&255)),$>>=8;return Y.reverse().join("")}setPrintHandler($){this._printHandler=$}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler($,Y){let J=this._identifier($,[48,126]);this._escHandlers[J]===void 0&&(this._escHandlers[J]=[]);let j=this._escHandlers[J];return j.push(Y),{dispose:()=>{let Z=j.indexOf(Y);Z!==-1&&j.splice(Z,1)}}}clearEscHandler($){this._escHandlers[this._identifier($,[48,126])]&&delete this._escHandlers[this._identifier($,[48,126])]}setEscHandlerFallback($){this._escHandlerFb=$}setExecuteHandler($,Y){this._executeHandlers[$.charCodeAt(0)]=Y}clearExecuteHandler($){this._executeHandlers[$.charCodeAt(0)]&&delete this._executeHandlers[$.charCodeAt(0)]}setExecuteHandlerFallback($){this._executeHandlerFb=$}registerCsiHandler($,Y){let J=this._identifier($);this._csiHandlers[J]===void 0&&(this._csiHandlers[J]=[]);let j=this._csiHandlers[J];return j.push(Y),{dispose:()=>{let Z=j.indexOf(Y);Z!==-1&&j.splice(Z,1)}}}clearCsiHandler($){this._csiHandlers[this._identifier($)]&&delete this._csiHandlers[this._identifier($)]}setCsiHandlerFallback($){this._csiHandlerFb=$}registerDcsHandler($,Y){return this._dcsParser.registerHandler(this._identifier($),Y)}clearDcsHandler($){this._dcsParser.clearHandler(this._identifier($))}setDcsHandlerFallback($){this._dcsParser.setHandlerFallback($)}registerOscHandler($,Y){return this._oscParser.registerHandler($,Y)}clearOscHandler($){this._oscParser.clearHandler($)}setOscHandlerFallback($){this._oscParser.setHandlerFallback($)}setErrorHandler($){this._errorHandler=$}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack($,Y,J,j,Z){this._parseStack.state=$,this._parseStack.handlers=Y,this._parseStack.handlerPos=J,this._parseStack.transition=j,this._parseStack.chunkPos=Z}parse($,Y,J){let j=0,Z=0,K=0,Q;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,K=this._parseStack.chunkPos+1;else{if(J===void 0||this._parseStack.state===1)throw this._parseStack.state=1,Error("improper continuation due to previous async handler, giving up parsing");let X=this._parseStack.handlers,N=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(J===!1&&N>-1){for(;N>=0&&(Q=X[N](this._params),Q!==!0);N--)if(Q instanceof Promise)return this._parseStack.handlerPos=N,Q}this._parseStack.handlers=[];break;case 4:if(J===!1&&N>-1){for(;N>=0&&(Q=X[N](),Q!==!0);N--)if(Q instanceof Promise)return this._parseStack.handlerPos=N,Q}this._parseStack.handlers=[];break;case 6:if(j=$[this._parseStack.chunkPos],Q=this._dcsParser.unhook(j!==24&&j!==26,J),Q)return Q;j===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(j=$[this._parseStack.chunkPos],Q=this._oscParser.end(j!==24&&j!==26,J),Q)return Q;j===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,K=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let X=K;X<Y;++X){switch(j=$[X],Z=this._transitions.table[this.currentState<<8|(j<160?j:s0)],Z>>4){case 2:for(let W=X+1;;++W){if(W>=Y||(j=$[W])<32||j>126&&j<s0){this._printHandler($,X,W),X=W-1;break}if(++W>=Y||(j=$[W])<32||j>126&&j<s0){this._printHandler($,X,W),X=W-1;break}if(++W>=Y||(j=$[W])<32||j>126&&j<s0){this._printHandler($,X,W),X=W-1;break}if(++W>=Y||(j=$[W])<32||j>126&&j<s0){this._printHandler($,X,W),X=W-1;break}}break;case 3:this._executeHandlers[j]?this._executeHandlers[j]():this._executeHandlerFb(j),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:X,code:j,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let N=this._csiHandlers[this._collect<<8|j],z=N?N.length-1:-1;for(;z>=0&&(Q=N[z](this._params),Q!==!0);z--)if(Q instanceof Promise)return this._preserveStack(3,N,z,Z,X),Q;z<0&&this._csiHandlerFb(this._collect<<8|j,this._params),this.precedingJoinState=0;break;case 8:do switch(j){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(j-48)}while(++X<Y&&(j=$[X])>47&&j<60);X--;break;case 9:this._collect<<=8,this._collect|=j;break;case 10:let G=this._escHandlers[this._collect<<8|j],V=G?G.length-1:-1;for(;V>=0&&(Q=G[V](),Q!==!0);V--)if(Q instanceof Promise)return this._preserveStack(4,G,V,Z,X),Q;V<0&&this._escHandlerFb(this._collect<<8|j),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|j,this._params);break;case 13:for(let W=X+1;;++W)if(W>=Y||(j=$[W])===24||j===26||j===27||j>127&&j<s0){this._dcsParser.put($,X,W),X=W-1;break}break;case 14:if(Q=this._dcsParser.unhook(j!==24&&j!==26),Q)return this._preserveStack(6,[],0,Z,X),Q;j===27&&(Z|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let W=X+1;;W++)if(W>=Y||(j=$[W])<32||j>127&&j<s0){this._oscParser.put($,X,W),X=W-1;break}break;case 6:if(Q=this._oscParser.end(j!==24&&j!==26),Q)return this._preserveStack(5,[],0,Z,X),Q;j===27&&(Z|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=Z&15}}},Wj=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,_j=/^[\da-f]+$/;function R5($){if(!$)return;let Y=$.toLowerCase();if(Y.indexOf("rgb:")===0){Y=Y.slice(4);let J=Wj.exec(Y);if(J){let j=J[1]?15:J[4]?255:J[7]?4095:65535;return[Math.round(parseInt(J[1]||J[4]||J[7]||J[10],16)/j*255),Math.round(parseInt(J[2]||J[5]||J[8]||J[11],16)/j*255),Math.round(parseInt(J[3]||J[6]||J[9]||J[12],16)/j*255)]}}else if(Y.indexOf("#")===0&&(Y=Y.slice(1),_j.exec(Y)&&[3,6,9,12].includes(Y.length))){let J=Y.length/3,j=[0,0,0];for(let Z=0;Z<3;++Z){let K=parseInt(Y.slice(J*Z,J*Z+J),16);j[Z]=J===1?K<<4:J===2?K:J===3?K>>4:K>>8}return j}}function J6($,Y){let J=$.toString(16),j=J.length<2?"0"+J:J;switch(Y){case 4:return J[0];case 8:return j;case 12:return(j+j).slice(0,3);default:return j+j}}function Hj($,Y=16){let[J,j,Z]=$;return`rgb:${J6(J,Y)}/${J6(j,Y)}/${J6(Z,Y)}`}var Ij={"(":0,")":1,"*":2,"+":3,"-":1,".":2},L8=131072,y5=10;function F5($,Y){if($>24)return Y.setWinLines||!1;switch($){case 1:return!!Y.restoreWin;case 2:return!!Y.minimizeWin;case 3:return!!Y.setWinPosition;case 4:return!!Y.setWinSizePixels;case 5:return!!Y.raiseWin;case 6:return!!Y.lowerWin;case 7:return!!Y.refreshWin;case 8:return!!Y.setWinSizeChars;case 9:return!!Y.maximizeWin;case 10:return!!Y.fullscreenWin;case 11:return!!Y.getWinState;case 13:return!!Y.getWinPosition;case 14:return!!Y.getWinSizePixels;case 15:return!!Y.getScreenSizePixels;case 16:return!!Y.getCellSizePixels;case 18:return!!Y.getWinSizeChars;case 19:return!!Y.getScreenSizeChars;case 20:return!!Y.getIconTitle;case 21:return!!Y.getWinTitle;case 22:return!!Y.pushTitle;case 23:return!!Y.popTitle;case 24:return!!Y.setWinLines}return!1}var B5=5000,L5=0,xj=class extends S{constructor($,Y,J,j,Z,K,Q,X,N=new Gj){super();this._bufferService=$,this._charsetService=Y,this._coreService=J,this._logService=j,this._optionsService=Z,this._oscLinkService=K,this._coreMouseService=Q,this._unicodeService=X,this._parser=N,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new X$,this._utf8Decoder=new z$,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=N0.clone(),this._eraseAttrDataInternal=N0.clone(),this._onRequestBell=this._register(new D),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new D),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new D),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new D),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new D),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new D),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new D),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new D),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new D),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new D),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new D),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new D),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new D),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new A6(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate((z)=>this._activeBuffer=z.activeBuffer)),this._parser.setCsiHandlerFallback((z,G)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(z),params:G.toArray()})}),this._parser.setEscHandlerFallback((z)=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(z)})}),this._parser.setExecuteHandlerFallback((z)=>{this._logService.debug("Unknown EXECUTE code: ",{code:z})}),this._parser.setOscHandlerFallback((z,G,V)=>{this._logService.debug("Unknown OSC code: ",{identifier:z,action:G,data:V})}),this._parser.setDcsHandlerFallback((z,G,V)=>{G==="HOOK"&&(V=V.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(z),action:G,payload:V})}),this._parser.setPrintHandler((z,G,V)=>this.print(z,G,V)),this._parser.registerCsiHandler({final:"@"},(z)=>this.insertChars(z)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(z)=>this.scrollLeft(z)),this._parser.registerCsiHandler({final:"A"},(z)=>this.cursorUp(z)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(z)=>this.scrollRight(z)),this._parser.registerCsiHandler({final:"B"},(z)=>this.cursorDown(z)),this._parser.registerCsiHandler({final:"C"},(z)=>this.cursorForward(z)),this._parser.registerCsiHandler({final:"D"},(z)=>this.cursorBackward(z)),this._parser.registerCsiHandler({final:"E"},(z)=>this.cursorNextLine(z)),this._parser.registerCsiHandler({final:"F"},(z)=>this.cursorPrecedingLine(z)),this._parser.registerCsiHandler({final:"G"},(z)=>this.cursorCharAbsolute(z)),this._parser.registerCsiHandler({final:"H"},(z)=>this.cursorPosition(z)),this._parser.registerCsiHandler({final:"I"},(z)=>this.cursorForwardTab(z)),this._parser.registerCsiHandler({final:"J"},(z)=>this.eraseInDisplay(z,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},(z)=>this.eraseInDisplay(z,!0)),this._parser.registerCsiHandler({final:"K"},(z)=>this.eraseInLine(z,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},(z)=>this.eraseInLine(z,!0)),this._parser.registerCsiHandler({final:"L"},(z)=>this.insertLines(z)),this._parser.registerCsiHandler({final:"M"},(z)=>this.deleteLines(z)),this._parser.registerCsiHandler({final:"P"},(z)=>this.deleteChars(z)),this._parser.registerCsiHandler({final:"S"},(z)=>this.scrollUp(z)),this._parser.registerCsiHandler({final:"T"},(z)=>this.scrollDown(z)),this._parser.registerCsiHandler({final:"X"},(z)=>this.eraseChars(z)),this._parser.registerCsiHandler({final:"Z"},(z)=>this.cursorBackwardTab(z)),this._parser.registerCsiHandler({final:"`"},(z)=>this.charPosAbsolute(z)),this._parser.registerCsiHandler({final:"a"},(z)=>this.hPositionRelative(z)),this._parser.registerCsiHandler({final:"b"},(z)=>this.repeatPrecedingCharacter(z)),this._parser.registerCsiHandler({final:"c"},(z)=>this.sendDeviceAttributesPrimary(z)),this._parser.registerCsiHandler({prefix:">",final:"c"},(z)=>this.sendDeviceAttributesSecondary(z)),this._parser.registerCsiHandler({final:"d"},(z)=>this.linePosAbsolute(z)),this._parser.registerCsiHandler({final:"e"},(z)=>this.vPositionRelative(z)),this._parser.registerCsiHandler({final:"f"},(z)=>this.hVPosition(z)),this._parser.registerCsiHandler({final:"g"},(z)=>this.tabClear(z)),this._parser.registerCsiHandler({final:"h"},(z)=>this.setMode(z)),this._parser.registerCsiHandler({prefix:"?",final:"h"},(z)=>this.setModePrivate(z)),this._parser.registerCsiHandler({final:"l"},(z)=>this.resetMode(z)),this._parser.registerCsiHandler({prefix:"?",final:"l"},(z)=>this.resetModePrivate(z)),this._parser.registerCsiHandler({final:"m"},(z)=>this.charAttributes(z)),this._parser.registerCsiHandler({final:"n"},(z)=>this.deviceStatus(z)),this._parser.registerCsiHandler({prefix:"?",final:"n"},(z)=>this.deviceStatusPrivate(z)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(z)=>this.softReset(z)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(z)=>this.setCursorStyle(z)),this._parser.registerCsiHandler({final:"r"},(z)=>this.setScrollRegion(z)),this._parser.registerCsiHandler({final:"s"},(z)=>this.saveCursor(z)),this._parser.registerCsiHandler({final:"t"},(z)=>this.windowOptions(z)),this._parser.registerCsiHandler({final:"u"},(z)=>this.restoreCursor(z)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(z)=>this.insertColumns(z)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(z)=>this.deleteColumns(z)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(z)=>this.selectProtected(z)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(z)=>this.requestMode(z,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(z)=>this.requestMode(z,!1)),this._parser.setExecuteHandler(R.BEL,()=>this.bell()),this._parser.setExecuteHandler(R.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(R.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(R.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(R.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(R.BS,()=>this.backspace()),this._parser.setExecuteHandler(R.HT,()=>this.tab()),this._parser.setExecuteHandler(R.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(R.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(n9.IND,()=>this.index()),this._parser.setExecuteHandler(n9.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(n9.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new p0((z)=>(this.setTitle(z),this.setIconName(z),!0))),this._parser.registerOscHandler(1,new p0((z)=>this.setIconName(z))),this._parser.registerOscHandler(2,new p0((z)=>this.setTitle(z))),this._parser.registerOscHandler(4,new p0((z)=>this.setOrReportIndexedColor(z))),this._parser.registerOscHandler(8,new p0((z)=>this.setHyperlink(z))),this._parser.registerOscHandler(10,new p0((z)=>this.setOrReportFgColor(z))),this._parser.registerOscHandler(11,new p0((z)=>this.setOrReportBgColor(z))),this._parser.registerOscHandler(12,new p0((z)=>this.setOrReportCursorColor(z))),this._parser.registerOscHandler(104,new p0((z)=>this.restoreIndexedColor(z))),this._parser.registerOscHandler(110,new p0((z)=>this.restoreFgColor(z))),this._parser.registerOscHandler(111,new p0((z)=>this.restoreBgColor(z))),this._parser.registerOscHandler(112,new p0((z)=>this.restoreCursorColor(z))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let z in I0)this._parser.registerEscHandler({intermediates:"(",final:z},()=>this.selectCharset("("+z)),this._parser.registerEscHandler({intermediates:")",final:z},()=>this.selectCharset(")"+z)),this._parser.registerEscHandler({intermediates:"*",final:z},()=>this.selectCharset("*"+z)),this._parser.registerEscHandler({intermediates:"+",final:z},()=>this.selectCharset("+"+z)),this._parser.registerEscHandler({intermediates:"-",final:z},()=>this.selectCharset("-"+z)),this._parser.registerEscHandler({intermediates:".",final:z},()=>this.selectCharset("."+z)),this._parser.registerEscHandler({intermediates:"/",final:z},()=>this.selectCharset("/"+z));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler((z)=>(this._logService.error("Parsing error: ",z),z)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new v5((z,G)=>this.requestStatusString(z,G)))}getAttrData(){return this._curAttrData}_preserveStack($,Y,J,j){this._parseStack.paused=!0,this._parseStack.cursorStartX=$,this._parseStack.cursorStartY=Y,this._parseStack.decodedLength=J,this._parseStack.position=j}_logSlowResolvingAsync($){this._logService.logLevel<=3&&Promise.race([$,new Promise((Y,J)=>setTimeout(()=>J("#SLOW_TIMEOUT"),B5))]).catch((Y)=>{if(Y!=="#SLOW_TIMEOUT")throw Y;console.warn(`async parser handler taking longer than ${B5} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse($,Y){let J,j=this._activeBuffer.x,Z=this._activeBuffer.y,K=0,Q=this._parseStack.paused;if(Q){if(J=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,Y))return this._logSlowResolvingAsync(J),J;j=this._parseStack.cursorStartX,Z=this._parseStack.cursorStartY,this._parseStack.paused=!1,$.length>L8&&(K=this._parseStack.position+L8)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof $=="string"?` "${$}"`:` "${Array.prototype.map.call($,(z)=>String.fromCharCode(z)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof $=="string"?$.split("").map((z)=>z.charCodeAt(0)):$),this._parseBuffer.length<$.length&&this._parseBuffer.length<L8&&(this._parseBuffer=new Uint32Array(Math.min($.length,L8))),Q||this._dirtyRowTracker.clearRange(),$.length>L8)for(let z=K;z<$.length;z+=L8){let G=z+L8<$.length?z+L8:$.length,V=typeof $=="string"?this._stringDecoder.decode($.substring(z,G),this._parseBuffer):this._utf8Decoder.decode($.subarray(z,G),this._parseBuffer);if(J=this._parser.parse(this._parseBuffer,V))return this._preserveStack(j,Z,V,z),this._logSlowResolvingAsync(J),J}else if(!Q){let z=typeof $=="string"?this._stringDecoder.decode($,this._parseBuffer):this._utf8Decoder.decode($,this._parseBuffer);if(J=this._parser.parse(this._parseBuffer,z))return this._preserveStack(j,Z,z,0),this._logSlowResolvingAsync(J),J}(this._activeBuffer.x!==j||this._activeBuffer.y!==Z)&&this._onCursorMove.fire();let X=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),N=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);N<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(N,this._bufferService.rows-1),end:Math.min(X,this._bufferService.rows-1)})}print($,Y,J){let j,Z,K=this._charsetService.charset,Q=this._optionsService.rawOptions.screenReaderMode,X=this._bufferService.cols,N=this._coreService.decPrivateModes.wraparound,z=this._coreService.modes.insertMode,G=this._curAttrData,V=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&J-Y>0&&V.getWidth(this._activeBuffer.x-1)===2&&V.setCellFromCodepoint(this._activeBuffer.x-1,0,1,G);let W=this._parser.precedingJoinState;for(let _=Y;_<J;++_){if(j=$[_],j<127&&K){let A=K[String.fromCharCode(j)];A&&(j=A.charCodeAt(0))}let H=this._unicodeService.charProperties(j,W);Z=S8.extractWidth(H);let U=S8.extractShouldJoin(H),B=U?S8.extractWidth(W):0;if(W=H,Q&&this._onA11yChar.fire(D8(j)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+Z-B>X){if(N){let A=V,k=this._activeBuffer.x-B;for(this._activeBuffer.x=B,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),V=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),B>0&&V instanceof G9&&V.copyCellsFrom(A,k,0,B,!1);k<X;)A.setCellFromCodepoint(k++,0,1,G)}else if(this._activeBuffer.x=X-1,Z===2)continue}if(U&&this._activeBuffer.x){let A=V.getWidth(this._activeBuffer.x-1)?1:2;V.addCodepointToCell(this._activeBuffer.x-A,j,Z);for(let k=Z-B;--k>=0;)V.setCellFromCodepoint(this._activeBuffer.x++,0,0,G);continue}if(z&&(V.insertCells(this._activeBuffer.x,Z-B,this._activeBuffer.getNullCell(G)),V.getWidth(X-1)===2&&V.setCellFromCodepoint(X-1,0,1,G)),V.setCellFromCodepoint(this._activeBuffer.x++,j,Z,G),Z>0)for(;--Z;)V.setCellFromCodepoint(this._activeBuffer.x++,0,0,G)}this._parser.precedingJoinState=W,this._activeBuffer.x<X&&J-Y>0&&V.getWidth(this._activeBuffer.x)===0&&!V.hasContent(this._activeBuffer.x)&&V.setCellFromCodepoint(this._activeBuffer.x,0,1,G),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler($,Y){return $.final==="t"&&!$.prefix&&!$.intermediates?this._parser.registerCsiHandler($,(J)=>F5(J.params[0],this._optionsService.rawOptions.windowOptions)?Y(J):!0):this._parser.registerCsiHandler($,Y)}registerDcsHandler($,Y){return this._parser.registerDcsHandler($,new v5(Y))}registerEscHandler($,Y){return this._parser.registerEscHandler($,Y)}registerOscHandler($,Y){return this._parser.registerOscHandler($,new p0(Y))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let $=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);$.hasWidth(this._activeBuffer.x)&&!$.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let $=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-$),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor($=this._bufferService.cols-1){this._activeBuffer.x=Math.min($,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor($,Y){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=$,this._activeBuffer.y=this._activeBuffer.scrollTop+Y):(this._activeBuffer.x=$,this._activeBuffer.y=Y),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor($,Y){this._restrictCursor(),this._setCursor(this._activeBuffer.x+$,this._activeBuffer.y+Y)}cursorUp($){let Y=this._activeBuffer.y-this._activeBuffer.scrollTop;return Y>=0?this._moveCursor(0,-Math.min(Y,$.params[0]||1)):this._moveCursor(0,-($.params[0]||1)),!0}cursorDown($){let Y=this._activeBuffer.scrollBottom-this._activeBuffer.y;return Y>=0?this._moveCursor(0,Math.min(Y,$.params[0]||1)):this._moveCursor(0,$.params[0]||1),!0}cursorForward($){return this._moveCursor($.params[0]||1,0),!0}cursorBackward($){return this._moveCursor(-($.params[0]||1),0),!0}cursorNextLine($){return this.cursorDown($),this._activeBuffer.x=0,!0}cursorPrecedingLine($){return this.cursorUp($),this._activeBuffer.x=0,!0}cursorCharAbsolute($){return this._setCursor(($.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition($){return this._setCursor($.length>=2?($.params[1]||1)-1:0,($.params[0]||1)-1),!0}charPosAbsolute($){return this._setCursor(($.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative($){return this._moveCursor($.params[0]||1,0),!0}linePosAbsolute($){return this._setCursor(this._activeBuffer.x,($.params[0]||1)-1),!0}vPositionRelative($){return this._moveCursor(0,$.params[0]||1),!0}hVPosition($){return this.cursorPosition($),!0}tabClear($){let Y=$.params[0];return Y===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:Y===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab($){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let Y=$.params[0]||1;for(;Y--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab($){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let Y=$.params[0]||1;for(;Y--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected($){let Y=$.params[0];return Y===1&&(this._curAttrData.bg|=536870912),(Y===2||Y===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine($,Y,J,j=!1,Z=!1){let K=this._activeBuffer.lines.get(this._activeBuffer.ybase+$);K.replaceCells(Y,J,this._activeBuffer.getNullCell(this._eraseAttrData()),Z),j&&(K.isWrapped=!1)}_resetBufferLine($,Y=!1){let J=this._activeBuffer.lines.get(this._activeBuffer.ybase+$);J&&(J.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),Y),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+$),J.isWrapped=!1)}eraseInDisplay($,Y=!1){this._restrictCursor(this._bufferService.cols);let J;switch($.params[0]){case 0:for(J=this._activeBuffer.y,this._dirtyRowTracker.markDirty(J),this._eraseInBufferLine(J++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,Y);J<this._bufferService.rows;J++)this._resetBufferLine(J,Y);this._dirtyRowTracker.markDirty(J);break;case 1:for(J=this._activeBuffer.y,this._dirtyRowTracker.markDirty(J),this._eraseInBufferLine(J,0,this._activeBuffer.x+1,!0,Y),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(J+1).isWrapped=!1);J--;)this._resetBufferLine(J,Y);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(J=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,J-1);J--&&!this._activeBuffer.lines.get(this._activeBuffer.ybase+J)?.getTrimmedLength(););for(;J>=0;J--)this._bufferService.scroll(this._eraseAttrData())}else{for(J=this._bufferService.rows,this._dirtyRowTracker.markDirty(J-1);J--;)this._resetBufferLine(J,Y);this._dirtyRowTracker.markDirty(0)}break;case 3:let j=this._activeBuffer.lines.length-this._bufferService.rows;j>0&&(this._activeBuffer.lines.trimStart(j),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-j,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-j,0),this._onScroll.fire(0));break}return!0}eraseInLine($,Y=!1){switch(this._restrictCursor(this._bufferService.cols),$.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,Y);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,Y);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,Y);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines($){this._restrictCursor();let Y=$.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let J=this._activeBuffer.ybase+this._activeBuffer.y,j=this._bufferService.rows-1-this._activeBuffer.scrollBottom,Z=this._bufferService.rows-1+this._activeBuffer.ybase-j+1;for(;Y--;)this._activeBuffer.lines.splice(Z-1,1),this._activeBuffer.lines.splice(J,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines($){this._restrictCursor();let Y=$.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let J=this._activeBuffer.ybase+this._activeBuffer.y,j;for(j=this._bufferService.rows-1-this._activeBuffer.scrollBottom,j=this._bufferService.rows-1+this._activeBuffer.ybase-j;Y--;)this._activeBuffer.lines.splice(J,1),this._activeBuffer.lines.splice(j,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars($){this._restrictCursor();let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return Y&&(Y.insertCells(this._activeBuffer.x,$.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars($){this._restrictCursor();let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return Y&&(Y.deleteCells(this._activeBuffer.x,$.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp($){let Y=$.params[0]||1;for(;Y--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown($){let Y=$.params[0]||1;for(;Y--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(N0));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft($){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=$.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){let j=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);j.deleteCells(0,Y,this._activeBuffer.getNullCell(this._eraseAttrData())),j.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight($){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=$.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){let j=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);j.insertCells(0,Y,this._activeBuffer.getNullCell(this._eraseAttrData())),j.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns($){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=$.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){let j=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);j.insertCells(this._activeBuffer.x,Y,this._activeBuffer.getNullCell(this._eraseAttrData())),j.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns($){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=$.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){let j=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);j.deleteCells(this._activeBuffer.x,Y,this._activeBuffer.getNullCell(this._eraseAttrData())),j.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars($){this._restrictCursor();let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return Y&&(Y.replaceCells(this._activeBuffer.x,this._activeBuffer.x+($.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter($){let Y=this._parser.precedingJoinState;if(!Y)return!0;let J=$.params[0]||1,j=S8.extractWidth(Y),Z=this._activeBuffer.x-j,K=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(Z),Q=new Uint32Array(K.length*J),X=0;for(let z=0;z<K.length;){let G=K.codePointAt(z)||0;Q[X++]=G,z+=G>65535?2:1}let N=X;for(let z=1;z<J;++z)Q.copyWithin(N,0,X),N+=X;return this.print(Q,0,N),!0}sendDeviceAttributesPrimary($){return $.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(R.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(R.ESC+"[?6c")),!0}sendDeviceAttributesSecondary($){return $.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(R.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(R.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent($.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(R.ESC+"[>83;40003;0c")),!0}_is($){return(this._optionsService.rawOptions.termName+"").indexOf($)===0}setMode($){for(let Y=0;Y<$.length;Y++)switch($.params[Y]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate($){for(let Y=0;Y<$.length;Y++)switch($.params[Y]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,m8),this._charsetService.setgCharset(1,m8),this._charsetService.setgCharset(2,m8),this._charsetService.setgCharset(3,m8);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1000:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode($){for(let Y=0;Y<$.length;Y++)switch($.params[Y]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate($){for(let Y=0;Y<$.length;Y++)switch($.params[Y]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1000:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),$.params[Y]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode($,Y){let J;((U)=>(U[U.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",U[U.SET=1]="SET",U[U.RESET=2]="RESET",U[U.PERMANENTLY_SET=3]="PERMANENTLY_SET",U[U.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(J||={});let j=this._coreService.decPrivateModes,{activeProtocol:Z,activeEncoding:K}=this._coreMouseService,Q=this._coreService,{buffers:X,cols:N}=this._bufferService,{active:z,alt:G}=X,V=this._optionsService.rawOptions,W=(U,B)=>(Q.triggerDataEvent(`${R.ESC}[${Y?"":"?"}${U};${B}$y`),!0),_=(U)=>U?1:2,H=$.params[0];return Y?H===2?W(H,4):H===4?W(H,_(Q.modes.insertMode)):H===12?W(H,3):H===20?W(H,_(V.convertEol)):W(H,0):H===1?W(H,_(j.applicationCursorKeys)):H===3?W(H,V.windowOptions.setWinLines?N===80?2:N===132?1:0:0):H===6?W(H,_(j.origin)):H===7?W(H,_(j.wraparound)):H===8?W(H,3):H===9?W(H,_(Z==="X10")):H===12?W(H,_(V.cursorBlink)):H===25?W(H,_(!Q.isCursorHidden)):H===45?W(H,_(j.reverseWraparound)):H===66?W(H,_(j.applicationKeypad)):H===67?W(H,4):H===1000?W(H,_(Z==="VT200")):H===1002?W(H,_(Z==="DRAG")):H===1003?W(H,_(Z==="ANY")):H===1004?W(H,_(j.sendFocus)):H===1005?W(H,4):H===1006?W(H,_(K==="SGR")):H===1015?W(H,4):H===1016?W(H,_(K==="SGR_PIXELS")):H===1048?W(H,1):H===47||H===1047||H===1049?W(H,_(z===G)):H===2004?W(H,_(j.bracketedPasteMode)):H===2026?W(H,_(j.synchronizedOutput)):W(H,0)}_updateAttrColor($,Y,J,j,Z){return Y===2?($|=50331648,$&=-16777216,$|=E9.fromColorRGB([J,j,Z])):Y===5&&($&=-50331904,$|=33554432|J&255),$}_extractColor($,Y,J){let j=[0,0,-1,0,0,0],Z=0,K=0;do{if(j[K+Z]=$.params[Y+K],$.hasSubParams(Y+K)){let Q=$.getSubParams(Y+K),X=0;do j[1]===5&&(Z=1),j[K+X+1+Z]=Q[X];while(++X<Q.length&&X+K+1+Z<j.length);break}if(j[1]===5&&K+Z>=2||j[1]===2&&K+Z>=5)break;j[1]&&(Z=1)}while(++K+Y<$.length&&K+Z<j.length);for(let Q=2;Q<j.length;++Q)j[Q]===-1&&(j[Q]=0);switch(j[0]){case 38:J.fg=this._updateAttrColor(J.fg,j[1],j[3],j[4],j[5]);break;case 48:J.bg=this._updateAttrColor(J.bg,j[1],j[3],j[4],j[5]);break;case 58:J.extended=J.extended.clone(),J.extended.underlineColor=this._updateAttrColor(J.extended.underlineColor,j[1],j[3],j[4],j[5])}return K}_processUnderline($,Y){Y.extended=Y.extended.clone(),(!~$||$>5)&&($=1),Y.extended.underlineStyle=$,Y.fg|=268435456,$===0&&(Y.fg&=-268435457),Y.updateExtended()}_processSGR0($){$.fg=N0.fg,$.bg=N0.bg,$.extended=$.extended.clone(),$.extended.underlineStyle=0,$.extended.underlineColor&=-67108864,$.updateExtended()}charAttributes($){if($.length===1&&$.params[0]===0)return this._processSGR0(this._curAttrData),!0;let Y=$.length,J,j=this._curAttrData;for(let Z=0;Z<Y;Z++)J=$.params[Z],J>=30&&J<=37?(j.fg&=-50331904,j.fg|=16777216|J-30):J>=40&&J<=47?(j.bg&=-50331904,j.bg|=16777216|J-40):J>=90&&J<=97?(j.fg&=-50331904,j.fg|=16777216|J-90|8):J>=100&&J<=107?(j.bg&=-50331904,j.bg|=16777216|J-100|8):J===0?this._processSGR0(j):J===1?j.fg|=134217728:J===3?j.bg|=67108864:J===4?(j.fg|=268435456,this._processUnderline($.hasSubParams(Z)?$.getSubParams(Z)[0]:1,j)):J===5?j.fg|=536870912:J===7?j.fg|=67108864:J===8?j.fg|=1073741824:J===9?j.fg|=2147483648:J===2?j.bg|=134217728:J===21?this._processUnderline(2,j):J===22?(j.fg&=-134217729,j.bg&=-134217729):J===23?j.bg&=-67108865:J===24?(j.fg&=-268435457,this._processUnderline(0,j)):J===25?j.fg&=-536870913:J===27?j.fg&=-67108865:J===28?j.fg&=-1073741825:J===29?j.fg&=2147483647:J===39?(j.fg&=-67108864,j.fg|=N0.fg&16777215):J===49?(j.bg&=-67108864,j.bg|=N0.bg&16777215):J===38||J===48||J===58?Z+=this._extractColor($,Z,j):J===53?j.bg|=1073741824:J===55?j.bg&=-1073741825:J===59?(j.extended=j.extended.clone(),j.extended.underlineColor=-1,j.updateExtended()):J===100?(j.fg&=-67108864,j.fg|=N0.fg&16777215,j.bg&=-67108864,j.bg|=N0.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",J);return!0}deviceStatus($){switch($.params[0]){case 5:this._coreService.triggerDataEvent(`${R.ESC}[0n`);break;case 6:let Y=this._activeBuffer.y+1,J=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${R.ESC}[${Y};${J}R`);break}return!0}deviceStatusPrivate($){switch($.params[0]){case 6:let Y=this._activeBuffer.y+1,J=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${R.ESC}[?${Y};${J}R`);break;case 15:break;case 25:break;case 26:break;case 53:break}return!0}softReset($){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=N0.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle($){let Y=$.length===0?1:$.params[0];if(Y===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(Y){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let J=Y%2===1;this._coreService.decPrivateModes.cursorBlink=J}return!0}setScrollRegion($){let Y=$.params[0]||1,J;return($.length<2||(J=$.params[1])>this._bufferService.rows||J===0)&&(J=this._bufferService.rows),J>Y&&(this._activeBuffer.scrollTop=Y-1,this._activeBuffer.scrollBottom=J-1,this._setCursor(0,0)),!0}windowOptions($){if(!F5($.params[0],this._optionsService.rawOptions.windowOptions))return!0;let Y=$.length>1?$.params[1]:0;switch($.params[0]){case 14:Y!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${R.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(Y===0||Y===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>y5&&this._windowTitleStack.shift()),(Y===0||Y===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>y5&&this._iconNameStack.shift());break;case 23:(Y===0||Y===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(Y===0||Y===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor($){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor($){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle($){return this._windowTitle=$,this._onTitleChange.fire($),!0}setIconName($){return this._iconName=$,!0}setOrReportIndexedColor($){let Y=[],J=$.split(";");for(;J.length>1;){let j=J.shift(),Z=J.shift();if(/^\d+$/.exec(j)){let K=parseInt(j);if(D5(K))if(Z==="?")Y.push({type:0,index:K});else{let Q=R5(Z);Q&&Y.push({type:1,index:K,color:Q})}}}return Y.length&&this._onColor.fire(Y),!0}setHyperlink($){let Y=$.indexOf(";");if(Y===-1)return!0;let J=$.slice(0,Y).trim(),j=$.slice(Y+1);return j?this._createHyperlink(J,j):J.trim()?!1:this._finishHyperlink()}_createHyperlink($,Y){this._getCurrentLinkId()&&this._finishHyperlink();let J=$.split(":"),j,Z=J.findIndex((K)=>K.startsWith("id="));return Z!==-1&&(j=J[Z].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:j,uri:Y}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor($,Y){let J=$.split(";");for(let j=0;j<J.length&&!(Y>=this._specialColors.length);++j,++Y)if(J[j]==="?")this._onColor.fire([{type:0,index:this._specialColors[Y]}]);else{let Z=R5(J[j]);Z&&this._onColor.fire([{type:1,index:this._specialColors[Y],color:Z}])}return!0}setOrReportFgColor($){return this._setOrReportSpecialColor($,0)}setOrReportBgColor($){return this._setOrReportSpecialColor($,1)}setOrReportCursorColor($){return this._setOrReportSpecialColor($,2)}restoreIndexedColor($){if(!$)return this._onColor.fire([{type:2}]),!0;let Y=[],J=$.split(";");for(let j=0;j<J.length;++j)if(/^\d+$/.exec(J[j])){let Z=parseInt(J[j]);D5(Z)&&Y.push({type:2,index:Z})}return Y.length&&this._onColor.fire(Y),!0}restoreFgColor($){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor($){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor($){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,m8),!0}selectCharset($){return $.length!==2?(this.selectDefaultCharset(),!0):($[0]==="/"||this._charsetService.setgCharset(Ij[$[0]],I0[$[1]]||m8),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let $=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,$,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=N0.clone(),this._eraseAttrDataInternal=N0.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel($){return this._charsetService.setgLevel($),!0}screenAlignmentPattern(){let $=new o0;$.content=4194373,$.fg=this._curAttrData.fg,$.bg=this._curAttrData.bg,this._setCursor(0,0);for(let Y=0;Y<this._bufferService.rows;++Y){let J=this._activeBuffer.ybase+this._activeBuffer.y+Y,j=this._activeBuffer.lines.get(J);j&&(j.fill($),j.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString($,Y){let J=(Q)=>(this._coreService.triggerDataEvent(`${R.ESC}${Q}${R.ESC}\\`),!0),j=this._bufferService.buffer,Z=this._optionsService.rawOptions;return J($==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:$==='"p'?'P1$r61;1"p':$==="r"?`P1$r${j.scrollTop+1};${j.scrollBottom+1}r`:$==="m"?"P1$r0m":$===" q"?`P1$r${{block:2,underline:4,bar:6}[Z.cursorStyle]-(Z.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty($,Y){this._dirtyRowTracker.markRangeDirty($,Y)}},A6=class{constructor($){this._bufferService=$,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty($){$<this.start?this.start=$:$>this.end&&(this.end=$)}markRangeDirty($,Y){$>Y&&(L5=$,$=Y,Y=L5),$<this.start&&(this.start=$),Y>this.end&&(this.end=Y)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};A6=j0([T(0,A0)],A6);function D5($){return 0<=$&&$<256}var Uj=50000000,M5=12,Oj=50,qj=class extends S{constructor($){super();this._action=$,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new D),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync($,Y){if(Y!==void 0&&this._syncCalls>Y){this._syncCalls=0;return}if(this._pendingData+=$.length,this._writeBuffer.push($),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let J;for(;J=this._writeBuffer.shift();){this._action(J);let j=this._callbacks.shift();j&&j()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write($,Y){if(this._pendingData>Uj)throw Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=$.length,this._writeBuffer.push($),this._callbacks.push(Y),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=$.length,this._writeBuffer.push($),this._callbacks.push(Y)}_innerWrite($=0,Y=!0){let J=$||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let j=this._writeBuffer[this._bufferOffset],Z=this._action(j,Y);if(Z){let Q=(X)=>performance.now()-J>=M5?setTimeout(()=>this._innerWrite(0,X)):this._innerWrite(J,X);Z.catch((X)=>(queueMicrotask(()=>{throw X}),Promise.resolve(!1))).then(Q);return}let K=this._callbacks[this._bufferOffset];if(K&&K(),this._bufferOffset++,this._pendingData-=j.length,performance.now()-J>=M5)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>Oj&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},P6=class{constructor($){this._bufferService=$,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink($){let Y=this._bufferService.buffer;if($.id===void 0){let X=Y.addMarker(Y.ybase+Y.y),N={data:$,id:this._nextId++,lines:[X]};return X.onDispose(()=>this._removeMarkerFromLink(N,X)),this._dataByLinkId.set(N.id,N),N.id}let J=$,j=this._getEntryIdKey(J),Z=this._entriesWithId.get(j);if(Z)return this.addLineToLink(Z.id,Y.ybase+Y.y),Z.id;let K=Y.addMarker(Y.ybase+Y.y),Q={id:this._nextId++,key:this._getEntryIdKey(J),data:J,lines:[K]};return K.onDispose(()=>this._removeMarkerFromLink(Q,K)),this._entriesWithId.set(Q.key,Q),this._dataByLinkId.set(Q.id,Q),Q.id}addLineToLink($,Y){let J=this._dataByLinkId.get($);if(J&&J.lines.every((j)=>j.line!==Y)){let j=this._bufferService.buffer.addMarker(Y);J.lines.push(j),j.onDispose(()=>this._removeMarkerFromLink(J,j))}}getLinkData($){return this._dataByLinkId.get($)?.data}_getEntryIdKey($){return`${$.id};;${$.uri}`}_removeMarkerFromLink($,Y){let J=$.lines.indexOf(Y);J!==-1&&($.lines.splice(J,1),$.lines.length===0&&($.data.id!==void 0&&this._entriesWithId.delete($.key),this._dataByLinkId.delete($.id)))}};P6=j0([T(0,A0)],P6);var b5=!1,Ej=class extends S{constructor($){super();this._windowsWrappingHeuristics=this._register(new s8),this._onBinary=this._register(new D),this.onBinary=this._onBinary.event,this._onData=this._register(new D),this.onData=this._onData.event,this._onLineFeed=this._register(new D),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new D),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new D),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new D),this._instantiationService=new uJ,this.optionsService=this._register(new $j($)),this._instantiationService.setService(P0,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(M6)),this._instantiationService.setService(A0,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(D6)),this._instantiationService.setService(p5,this._logService),this.coreService=this._register(this._instantiationService.createInstance(b6)),this._instantiationService.setService(h8,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(T6)),this._instantiationService.setService(g5,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(S8)),this._instantiationService.setService(W$,this.unicodeService),this._charsetService=this._instantiationService.createInstance(Kj),this._instantiationService.setService(G$,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(P6),this._instantiationService.setService(C5,this._oscLinkService),this._inputHandler=this._register(new xj(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(L0.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(L0.forward(this._bufferService.onResize,this._onResize)),this._register(L0.forward(this.coreService.onData,this._onData)),this._register(L0.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new qj((Y,J)=>this._inputHandler.parse(Y,J))),this._register(L0.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new D),this._onScroll.event(($)=>{this._onScrollApi?.fire($.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options($){for(let Y in $)this.optionsService.options[Y]=$[Y]}write($,Y){this._writeBuffer.write($,Y)}writeSync($,Y){this._logService.logLevel<=3&&!b5&&(this._logService.warn("writeSync is unreliable and will be removed soon."),b5=!0),this._writeBuffer.writeSync($,Y)}input($,Y=!0){this.coreService.triggerDataEvent($,Y)}resize($,Y){isNaN($)||isNaN(Y)||($=Math.max($,x2),Y=Math.max(Y,U2),this._bufferService.resize($,Y))}scroll($,Y=!1){this._bufferService.scroll($,Y)}scrollLines($,Y){this._bufferService.scrollLines($,Y)}scrollPages($){this.scrollLines($*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom($){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine($){let Y=$-this._bufferService.buffer.ydisp;Y!==0&&this.scrollLines(Y)}registerEscHandler($,Y){return this._inputHandler.registerEscHandler($,Y)}registerDcsHandler($,Y){return this._inputHandler.registerDcsHandler($,Y)}registerCsiHandler($,Y){return this._inputHandler.registerCsiHandler($,Y)}registerOscHandler($,Y){return this._inputHandler.registerOscHandler($,Y)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let $=!1,Y=this.optionsService.rawOptions.windowsPty;Y&&Y.buildNumber!==void 0&&Y.buildNumber!==void 0?$=Y.backend==="conpty"&&Y.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&($=!0),$?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let $=[];$.push(this.onLineFeed(E5.bind(null,this._bufferService))),$.push(this.registerCsiHandler({final:"H"},()=>(E5(this._bufferService),!1))),this._windowsWrappingHeuristics.value=r(()=>{for(let Y of $)Y.dispose()})}}},vj={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function Rj($,Y,J,j){let Z={type:0,cancel:!1,key:void 0},K=($.shiftKey?1:0)|($.altKey?2:0)|($.ctrlKey?4:0)|($.metaKey?8:0);switch($.keyCode){case 0:$.key==="UIKeyInputUpArrow"?Y?Z.key=R.ESC+"OA":Z.key=R.ESC+"[A":$.key==="UIKeyInputLeftArrow"?Y?Z.key=R.ESC+"OD":Z.key=R.ESC+"[D":$.key==="UIKeyInputRightArrow"?Y?Z.key=R.ESC+"OC":Z.key=R.ESC+"[C":$.key==="UIKeyInputDownArrow"&&(Y?Z.key=R.ESC+"OB":Z.key=R.ESC+"[B");break;case 8:Z.key=$.ctrlKey?"\b":R.DEL,$.altKey&&(Z.key=R.ESC+Z.key);break;case 9:if($.shiftKey){Z.key=R.ESC+"[Z";break}Z.key=R.HT,Z.cancel=!0;break;case 13:Z.key=$.altKey?R.ESC+R.CR:R.CR,Z.cancel=!0;break;case 27:Z.key=R.ESC,$.altKey&&(Z.key=R.ESC+R.ESC),Z.cancel=!0;break;case 37:if($.metaKey)break;K?Z.key=R.ESC+"[1;"+(K+1)+"D":Y?Z.key=R.ESC+"OD":Z.key=R.ESC+"[D";break;case 39:if($.metaKey)break;K?Z.key=R.ESC+"[1;"+(K+1)+"C":Y?Z.key=R.ESC+"OC":Z.key=R.ESC+"[C";break;case 38:if($.metaKey)break;K?Z.key=R.ESC+"[1;"+(K+1)+"A":Y?Z.key=R.ESC+"OA":Z.key=R.ESC+"[A";break;case 40:if($.metaKey)break;K?Z.key=R.ESC+"[1;"+(K+1)+"B":Y?Z.key=R.ESC+"OB":Z.key=R.ESC+"[B";break;case 45:!$.shiftKey&&!$.ctrlKey&&(Z.key=R.ESC+"[2~");break;case 46:K?Z.key=R.ESC+"[3;"+(K+1)+"~":Z.key=R.ESC+"[3~";break;case 36:K?Z.key=R.ESC+"[1;"+(K+1)+"H":Y?Z.key=R.ESC+"OH":Z.key=R.ESC+"[H";break;case 35:K?Z.key=R.ESC+"[1;"+(K+1)+"F":Y?Z.key=R.ESC+"OF":Z.key=R.ESC+"[F";break;case 33:$.shiftKey?Z.type=2:$.ctrlKey?Z.key=R.ESC+"[5;"+(K+1)+"~":Z.key=R.ESC+"[5~";break;case 34:$.shiftKey?Z.type=3:$.ctrlKey?Z.key=R.ESC+"[6;"+(K+1)+"~":Z.key=R.ESC+"[6~";break;case 112:K?Z.key=R.ESC+"[1;"+(K+1)+"P":Z.key=R.ESC+"OP";break;case 113:K?Z.key=R.ESC+"[1;"+(K+1)+"Q":Z.key=R.ESC+"OQ";break;case 114:K?Z.key=R.ESC+"[1;"+(K+1)+"R":Z.key=R.ESC+"OR";break;case 115:K?Z.key=R.ESC+"[1;"+(K+1)+"S":Z.key=R.ESC+"OS";break;case 116:K?Z.key=R.ESC+"[15;"+(K+1)+"~":Z.key=R.ESC+"[15~";break;case 117:K?Z.key=R.ESC+"[17;"+(K+1)+"~":Z.key=R.ESC+"[17~";break;case 118:K?Z.key=R.ESC+"[18;"+(K+1)+"~":Z.key=R.ESC+"[18~";break;case 119:K?Z.key=R.ESC+"[19;"+(K+1)+"~":Z.key=R.ESC+"[19~";break;case 120:K?Z.key=R.ESC+"[20;"+(K+1)+"~":Z.key=R.ESC+"[20~";break;case 121:K?Z.key=R.ESC+"[21;"+(K+1)+"~":Z.key=R.ESC+"[21~";break;case 122:K?Z.key=R.ESC+"[23;"+(K+1)+"~":Z.key=R.ESC+"[23~";break;case 123:K?Z.key=R.ESC+"[24;"+(K+1)+"~":Z.key=R.ESC+"[24~";break;default:if($.ctrlKey&&!$.shiftKey&&!$.altKey&&!$.metaKey)$.keyCode>=65&&$.keyCode<=90?Z.key=String.fromCharCode($.keyCode-64):$.keyCode===32?Z.key=R.NUL:$.keyCode>=51&&$.keyCode<=55?Z.key=String.fromCharCode($.keyCode-51+27):$.keyCode===56?Z.key=R.DEL:$.keyCode===219?Z.key=R.ESC:$.keyCode===220?Z.key=R.FS:$.keyCode===221&&(Z.key=R.GS);else if((!J||j)&&$.altKey&&!$.metaKey){let Q=vj[$.keyCode]?.[$.shiftKey?1:0];if(Q)Z.key=R.ESC+Q;else if($.keyCode>=65&&$.keyCode<=90){let X=$.ctrlKey?$.keyCode-64:$.keyCode+32,N=String.fromCharCode(X);$.shiftKey&&(N=N.toUpperCase()),Z.key=R.ESC+N}else if($.keyCode===32)Z.key=R.ESC+($.ctrlKey?R.NUL:" ");else if($.key==="Dead"&&$.code.startsWith("Key")){let X=$.code.slice(3,4);$.shiftKey||(X=X.toLowerCase()),Z.key=R.ESC+X,Z.cancel=!0}}else J&&!$.altKey&&!$.ctrlKey&&!$.shiftKey&&$.metaKey?$.keyCode===65&&(Z.type=1):$.key&&!$.ctrlKey&&!$.altKey&&!$.metaKey&&$.keyCode>=48&&$.key.length===1?Z.key=$.key:$.key&&$.ctrlKey&&($.key==="_"&&(Z.key=R.US),$.key==="@"&&(Z.key=R.NUL));break}return Z}var z0=0,yj=class{constructor($){this._getKey=$,this._array=[],this._insertedValues=[],this._flushInsertedTask=new Z7,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new Z7,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert($){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push($)}_flushInserted(){let $=this._insertedValues.sort((Z,K)=>this._getKey(Z)-this._getKey(K)),Y=0,J=0,j=Array(this._array.length+this._insertedValues.length);for(let Z=0;Z<j.length;Z++)J>=this._array.length||this._getKey($[Y])<=this._getKey(this._array[J])?(j[Z]=$[Y],Y++):j[Z]=this._array[J++];this._array=j,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete($){if(this._flushCleanupInserted(),this._array.length===0)return!1;let Y=this._getKey($);if(Y===void 0||(z0=this._search(Y),z0===-1)||this._getKey(this._array[z0])!==Y)return!1;do if(this._array[z0]===$)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(z0),!0;while(++z0<this._array.length&&this._getKey(this._array[z0])===Y);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let $=this._deletedIndices.sort((Z,K)=>Z-K),Y=0,J=Array(this._array.length-$.length),j=0;for(let Z=0;Z<this._array.length;Z++)$[Y]===Z?Y++:J[j++]=this._array[Z];this._array=J,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator($){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(z0=this._search($),!(z0<0||z0>=this._array.length)&&this._getKey(this._array[z0])===$))do yield this._array[z0];while(++z0<this._array.length&&this._getKey(this._array[z0])===$)}forEachByKey($,Y){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(z0=this._search($),!(z0<0||z0>=this._array.length)&&this._getKey(this._array[z0])===$))do Y(this._array[z0]);while(++z0<this._array.length&&this._getKey(this._array[z0])===$)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search($){let Y=0,J=this._array.length-1;for(;J>=Y;){let j=Y+J>>1,Z=this._getKey(this._array[j]);if(Z>$)J=j-1;else if(Z<$)Y=j+1;else{for(;j>0&&this._getKey(this._array[j-1])===$;)j--;return j}}return Y}},j6=0,T5=0,Fj=class extends S{constructor(){super();this._decorations=new yj(($)=>$?.marker.line),this._onDecorationRegistered=this._register(new D),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new D),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(r(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration($){if($.marker.isDisposed)return;let Y=new Bj($);if(Y){let J=Y.marker.onDispose(()=>Y.dispose()),j=Y.onDispose(()=>{j.dispose(),Y&&(this._decorations.delete(Y)&&this._onDecorationRemoved.fire(Y),J.dispose())});this._decorations.insert(Y),this._onDecorationRegistered.fire(Y)}return Y}reset(){for(let $ of this._decorations.values())$.dispose();this._decorations.clear()}*getDecorationsAtCell($,Y,J){let j=0,Z=0;for(let K of this._decorations.getKeyIterator(Y))j=K.options.x??0,Z=j+(K.options.width??1),$>=j&&$<Z&&(!J||(K.options.layer??"bottom")===J)&&(yield K)}forEachDecorationAtCell($,Y,J,j){this._decorations.forEachByKey(Y,(Z)=>{j6=Z.options.x??0,T5=j6+(Z.options.width??1),$>=j6&&$<T5&&(!J||(Z.options.layer??"bottom")===J)&&j(Z)})}},Bj=class extends b8{constructor($){super();this.options=$,this.onRenderEmitter=this.add(new D),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new D),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=$.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=e.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=e.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},Lj=1000,Dj=class{constructor($,Y=Lj){this._renderCallback=$,this._debounceThresholdMS=Y,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh($,Y,J){this._rowCount=J,$=$!==void 0?$:0,Y=Y!==void 0?Y:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,$):$,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,Y):Y;let j=performance.now();if(j-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=j,this._innerRefresh();else if(!this._additionalRefreshRequested){let Z=j-this._lastRefreshMs,K=this._debounceThresholdMS-Z;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},K)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let $=Math.max(this._rowStart,0),Y=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback($,Y)}},A5=20,P5=!1,K7=class extends S{constructor($,Y,J,j){super();this._terminal=$,this._coreBrowserService=J,this._renderService=j,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let Z=this._coreBrowserService.mainDocument;this._accessibilityContainer=Z.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=Z.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let K=0;K<this._terminal.rows;K++)this._rowElements[K]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[K]);if(this._topBoundaryFocusListener=(K)=>this._handleBoundaryFocus(K,0),this._bottomBoundaryFocusListener=(K)=>this._handleBoundaryFocus(K,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=Z.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new Dj(this._renderRows.bind(this))),!this._terminal.element)throw Error("Cannot enable accessibility before Terminal.open");P5?(this._accessibilityContainer.classList.add("debug"),this._rowContainer.classList.add("debug"),this._debugRootContainer=Z.createElement("div"),this._debugRootContainer.classList.add("xterm"),this._debugRootContainer.appendChild(Z.createTextNode("------start a11y------")),this._debugRootContainer.appendChild(this._accessibilityContainer),this._debugRootContainer.appendChild(Z.createTextNode("------end a11y------")),this._terminal.element.insertAdjacentElement("afterend",this._debugRootContainer)):this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize((K)=>this._handleResize(K.rows))),this._register(this._terminal.onRender((K)=>this._refreshRows(K.start,K.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar((K)=>this._handleChar(K))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab((K)=>this._handleTab(K))),this._register(this._terminal.onKey((K)=>this._handleKey(K.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(m(Z,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(r(()=>{P5?this._debugRootContainer.remove():this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab($){for(let Y=0;Y<$;Y++)this._handleChar(" ")}_handleChar($){this._liveRegionLineCount<A5+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==$&&(this._charsToAnnounce+=$):this._charsToAnnounce+=$,$===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===A5+1&&(this._liveRegion.textContent+=K6.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey($){this._clearLiveRegion(),/\p{Control}/u.test($)||this._charsToConsume.push($)}_refreshRows($,Y){this._liveRegionDebouncer.refresh($,Y,this._terminal.rows)}_renderRows($,Y){let J=this._terminal.buffer,j=J.lines.length.toString();for(let Z=$;Z<=Y;Z++){let K=J.lines.get(J.ydisp+Z),Q=[],X=K?.translateToString(!0,void 0,void 0,Q)||"",N=(J.ydisp+Z+1).toString(),z=this._rowElements[Z];z&&(X.length===0?(z.textContent="",this._rowColumns.set(z,[0,1])):(z.textContent=X,this._rowColumns.set(z,Q)),z.setAttribute("aria-posinset",N),z.setAttribute("aria-setsize",j),this._alignRowWidth(z))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus($,Y){let J=$.target,j=this._rowElements[Y===0?1:this._rowElements.length-2],Z=J.getAttribute("aria-posinset"),K=Y===0?"1":`${this._terminal.buffer.lines.length}`;if(Z===K||$.relatedTarget!==j)return;let Q,X;if(Y===0?(Q=J,X=this._rowElements.pop(),this._rowContainer.removeChild(X)):(Q=this._rowElements.shift(),X=J,this._rowContainer.removeChild(Q)),Q.removeEventListener("focus",this._topBoundaryFocusListener),X.removeEventListener("focus",this._bottomBoundaryFocusListener),Y===0){let N=this._createAccessibilityTreeNode();this._rowElements.unshift(N),this._rowContainer.insertAdjacentElement("afterbegin",N)}else{let N=this._createAccessibilityTreeNode();this._rowElements.push(N),this._rowContainer.appendChild(N)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(Y===0?-1:1),this._rowElements[Y===0?1:this._rowElements.length-2].focus(),$.preventDefault(),$.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;let $=this._coreBrowserService.mainDocument.getSelection();if(!$)return;if($.isCollapsed){this._rowContainer.contains($.anchorNode)&&this._terminal.clearSelection();return}if(!$.anchorNode||!$.focusNode){console.error("anchorNode and/or focusNode are null");return}let Y={node:$.anchorNode,offset:$.anchorOffset},J={node:$.focusNode,offset:$.focusOffset};if((Y.node.compareDocumentPosition(J.node)&Node.DOCUMENT_POSITION_PRECEDING||Y.node===J.node&&Y.offset>J.offset)&&([Y,J]=[J,Y]),Y.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(Y={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(Y.node))return;let j=this._rowElements.slice(-1)[0];if(J.node.compareDocumentPosition(j)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(J={node:j,offset:j.textContent?.length??0}),!this._rowContainer.contains(J.node))return;let Z=({node:X,offset:N})=>{let z=X instanceof Text?X.parentNode:X,G=parseInt(z?.getAttribute("aria-posinset"),10)-1;if(isNaN(G))return console.warn("row is invalid. Race condition?"),null;let V=this._rowColumns.get(z);if(!V)return console.warn("columns is null. Race condition?"),null;let W=N<V.length?V[N]:V.slice(-1)[0]+1;return W>=this._terminal.cols&&(++G,W=0),{row:G,column:W}},K=Z(Y),Q=Z(J);if(!(!K||!Q)){if(K.row>Q.row||K.row===Q.row&&K.column>=Q.column)throw Error("invalid range");this._terminal.select(K.column,K.row,(Q.row-K.row)*this._terminal.cols-K.column+Q.column)}}_handleResize($){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let Y=this._rowContainer.children.length;Y<this._terminal.rows;Y++)this._rowElements[Y]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[Y]);for(;this._rowElements.length>$;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let $=this._coreBrowserService.mainDocument.createElement("div");return $.setAttribute("role","listitem"),$.tabIndex=-1,this._refreshRowDimensions($),$}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let $=0;$<this._terminal.rows;$++)this._refreshRowDimensions(this._rowElements[$]),this._alignRowWidth(this._rowElements[$])}}_refreshRowDimensions($){$.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth($){$.style.transform="";let Y=$.getBoundingClientRect().width,J=this._rowColumns.get($)?.slice(-1)?.[0];if(!J)return;let j=J*this._renderService.dimensions.css.cell.width;$.style.transform=`scaleX(${j/Y})`}};K7=j0([T(1,w6),T(2,G8),T(3,W8)],K7);var k6=class extends S{constructor($,Y,J,j,Z){super();this._element=$,this._mouseService=Y,this._renderService=J,this._bufferService=j,this._linkProviderService=Z,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new D),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new D),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(r(()=>{p8(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(m(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(m(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(m(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(m(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove($){this._lastMouseEvent=$;let Y=this._positionFromMouseEvent($,this._element,this._mouseService);if(!Y)return;this._isMouseOut=!1;let J=$.composedPath();for(let j=0;j<J.length;j++){let Z=J[j];if(Z.classList.contains("xterm"))break;if(Z.classList.contains("xterm-hover"))return}(!this._lastBufferCell||Y.x!==this._lastBufferCell.x||Y.y!==this._lastBufferCell.y)&&(this._handleHover(Y),this._lastBufferCell=Y)}_handleHover($){if(this._activeLine!==$.y||this._wasResized){this._clearCurrentLink(),this._askForLink($,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,$)||(this._clearCurrentLink(),this._askForLink($,!0))}_askForLink($,Y){(!this._activeProviderReplies||!Y)&&(this._activeProviderReplies?.forEach((j)=>{j?.forEach((Z)=>{Z.link.dispose&&Z.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=$.y);let J=!1;for(let[j,Z]of this._linkProviderService.linkProviders.entries())Y?this._activeProviderReplies?.get(j)&&(J=this._checkLinkProviderResult(j,$,J)):Z.provideLinks($.y,(K)=>{if(this._isMouseOut)return;let Q=K?.map((X)=>({link:X}));this._activeProviderReplies?.set(j,Q),J=this._checkLinkProviderResult(j,$,J),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks($.y,this._activeProviderReplies)})}_removeIntersectingLinks($,Y){let J=new Set;for(let j=0;j<Y.size;j++){let Z=Y.get(j);if(Z)for(let K=0;K<Z.length;K++){let Q=Z[K],X=Q.link.range.start.y<$?0:Q.link.range.start.x,N=Q.link.range.end.y>$?this._bufferService.cols:Q.link.range.end.x;for(let z=X;z<=N;z++){if(J.has(z)){Z.splice(K--,1);break}J.add(z)}}}}_checkLinkProviderResult($,Y,J){if(!this._activeProviderReplies)return J;let j=this._activeProviderReplies.get($),Z=!1;for(let K=0;K<$;K++)(!this._activeProviderReplies.has(K)||this._activeProviderReplies.get(K))&&(Z=!0);if(!Z&&j){let K=j.find((Q)=>this._linkAtPosition(Q.link,Y));K&&(J=!0,this._handleNewLink(K))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!J)for(let K=0;K<this._activeProviderReplies.size;K++){let Q=this._activeProviderReplies.get(K)?.find((X)=>this._linkAtPosition(X.link,Y));if(Q){J=!0,this._handleNewLink(Q);break}}return J}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp($){if(!this._currentLink)return;let Y=this._positionFromMouseEvent($,this._element,this._mouseService);Y&&this._mouseDownLink&&Mj(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,Y)&&this._currentLink.link.activate($,this._currentLink.link.text)}_clearCurrentLink($,Y){!this._currentLink||!this._lastMouseEvent||(!$||!Y||this._currentLink.link.range.start.y>=$&&this._currentLink.link.range.end.y<=Y)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,p8(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink($){if(!this._lastMouseEvent)return;let Y=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);Y&&this._linkAtPosition($.link,Y)&&(this._currentLink=$,this._currentLink.state={decorations:{underline:$.link.decorations===void 0?!0:$.link.decorations.underline,pointerCursor:$.link.decorations===void 0?!0:$.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,$.link,this._lastMouseEvent),$.link.decorations={},Object.defineProperties($.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:(J)=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==J&&(this._currentLink.state.decorations.pointerCursor=J,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",J))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:(J)=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==J&&(this._currentLink.state.decorations.underline=J,this._currentLink.state.isHovered&&this._fireUnderlineEvent($.link,J))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((J)=>{if(!this._currentLink)return;let j=J.start===0?0:J.start+1+this._bufferService.buffer.ydisp,Z=this._bufferService.buffer.ydisp+1+J.end;if(this._currentLink.link.range.start.y>=j&&this._currentLink.link.range.end.y<=Z&&(this._clearCurrentLink(j,Z),this._lastMouseEvent)){let K=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);K&&this._askForLink(K,!1)}})))}_linkHover($,Y,J){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(Y,!0),this._currentLink.state.decorations.pointerCursor&&$.classList.add("xterm-cursor-pointer")),Y.hover&&Y.hover(J,Y.text)}_fireUnderlineEvent($,Y){let J=$.range,j=this._bufferService.buffer.ydisp,Z=this._createLinkUnderlineEvent(J.start.x-1,J.start.y-j-1,J.end.x,J.end.y-j-1,void 0);(Y?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(Z)}_linkLeave($,Y,J){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(Y,!1),this._currentLink.state.decorations.pointerCursor&&$.classList.remove("xterm-cursor-pointer")),Y.leave&&Y.leave(J,Y.text)}_linkAtPosition($,Y){let J=$.range.start.y*this._bufferService.cols+$.range.start.x,j=$.range.end.y*this._bufferService.cols+$.range.end.x,Z=Y.y*this._bufferService.cols+Y.x;return J<=Z&&Z<=j}_positionFromMouseEvent($,Y,J){let j=J.getCoords($,Y,this._bufferService.cols,this._bufferService.rows);if(j)return{x:j[0],y:j[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent($,Y,J,j,Z){return{x1:$,y1:Y,x2:J,y2:j,cols:this._bufferService.cols,fg:Z}}};k6=j0([T(1,f6),T(2,W8),T(3,A0),T(4,d5)],k6);function Mj($,Y){return $.text===Y.text&&$.range.start.x===Y.range.start.x&&$.range.start.y===Y.range.start.y&&$.range.end.x===Y.range.end.x&&$.range.end.y===Y.range.end.y}var bj=class extends Ej{constructor($={}){super($);this._linkifier=this._register(new s8),this.browser=X2,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new s8),this._onCursorMove=this._register(new D),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new D),this.onKey=this._onKey.event,this._onRender=this._register(new D),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new D),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new D),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new D),this.onBell=this._onBell.event,this._onFocus=this._register(new D),this._onBlur=this._register(new D),this._onA11yCharEmitter=this._register(new D),this._onA11yTabEmitter=this._register(new D),this._onWillOpen=this._register(new D),this._setup(),this._decorationService=this._instantiationService.createInstance(Fj),this._instantiationService.setService(v9,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(UJ),this._instantiationService.setService(d5,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(X6)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows((Y)=>this.refresh(Y?.start??0,Y?.end??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport((Y)=>this._reportWindowsOptions(Y))),this._register(this._inputHandler.onColor((Y)=>this._handleColorEvent(Y))),this._register(L0.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(L0.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(L0.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(L0.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize((Y)=>this._afterResize(Y.cols,Y.rows))),this._register(r(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent($){if(this._themeService)for(let Y of $){let J,j="";switch(Y.index){case 256:J="foreground",j="10";break;case 257:J="background",j="11";break;case 258:J="cursor",j="12";break;default:J="ansi",j="4;"+Y.index}switch(Y.type){case 0:let Z=n.toColorRGB(J==="ansi"?this._themeService.colors.ansi[Y.index]:this._themeService.colors[J]);this.coreService.triggerDataEvent(`${R.ESC}]${j};${Hj(Z)}${K2.ST}`);break;case 1:if(J==="ansi")this._themeService.modifyColors((K)=>K.ansi[Y.index]=V0.toColor(...Y.color));else{let K=J;this._themeService.modifyColors((Q)=>Q[K]=V0.toColor(...Y.color))}break;case 2:this._themeService.restoreColor(Y.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange($){$?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(K7,this)):this._accessibilityManager.clear()}_handleTextAreaFocus($){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(R.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(R.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let $=this.buffer.ybase+this.buffer.y,Y=this.buffer.lines.get($);if(!Y)return;let J=Math.min(this.buffer.x,this.cols-1),j=this._renderService.dimensions.css.cell.height,Z=Y.getWidth(J),K=this._renderService.dimensions.css.cell.width*Z,Q=this.buffer.y*this._renderService.dimensions.css.cell.height,X=J*this._renderService.dimensions.css.cell.width;this.textarea.style.left=X+"px",this.textarea.style.top=Q+"px",this.textarea.style.width=K+"px",this.textarea.style.height=j+"px",this.textarea.style.lineHeight=j+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(m(this.element,"copy",(Y)=>{this.hasSelection()&&K$(Y,this._selectionService)}));let $=(Y)=>Q$(Y,this.textarea,this.coreService,this.optionsService);this._register(m(this.textarea,"paste",$)),this._register(m(this.element,"paste",$)),z2?this._register(m(this.element,"mousedown",(Y)=>{Y.button===2&&k1(Y,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(m(this.element,"contextmenu",(Y)=>{k1(Y,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),u6&&this._register(m(this.element,"auxclick",(Y)=>{Y.button===1&&m5(Y,this.textarea,this.screenElement)}))}_bindKeys(){this._register(m(this.textarea,"keyup",($)=>this._keyUp($),!0)),this._register(m(this.textarea,"keydown",($)=>this._keyDown($),!0)),this._register(m(this.textarea,"keypress",($)=>this._keyPress($),!0)),this._register(m(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(m(this.textarea,"compositionupdate",($)=>this._compositionHelper.compositionupdate($))),this._register(m(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(m(this.textarea,"input",($)=>this._inputEvent($),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open($){if(!$)throw Error("Terminal requires a parent element.");if($.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=$.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),$.appendChild(this.element);let Y=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),Y.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(m(this.screenElement,"mousemove",(Z)=>this.updateCursorStyle(Z))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),Y.appendChild(this.screenElement);let J=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",Z6.get()),G2||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>J.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(IJ,this.textarea,$.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(G8,this._coreBrowserService),this._register(m(this.textarea,"focus",(Z)=>this._handleTextAreaFocus(Z))),this._register(m(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(R6,this._document,this._helperContainer),this._instantiationService.setService(X7,this._charSizeService),this._themeService=this._instantiationService.createInstance(L6),this._instantiationService.setService(o8,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(J7),this._instantiationService.setService(h5,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(F6,this.rows,this.screenElement)),this._instantiationService.setService(W8,this._renderService),this._register(this._renderService.onRenderedViewportChange((Z)=>this._onRender.fire(Z))),this.onResize((Z)=>this._renderService.resize(Z.cols,Z.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(q6,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(y6),this._instantiationService.setService(f6,this._mouseService);let j=this._linkifier.value=this._register(this._instantiationService.createInstance(k6,this.screenElement));this.element.appendChild(Y);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(U6,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines((Z)=>{super.scrollLines(Z,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(B6,this.element,this.screenElement,j)),this._instantiationService.setService(H$,this._selectionService),this._register(this._selectionService.onRequestScrollLines((Z)=>this.scrollLines(Z.amount,Z.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw((Z)=>this._renderService.handleSelectionChanged(Z.start,Z.end,Z.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection((Z)=>{this.textarea.value=Z,this.textarea.focus(),this.textarea.select()})),this._register(L0.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{this._selectionService.refresh(),this._viewport?.queueSync()})),this._register(this._instantiationService.createInstance(O6,this.screenElement)),this._register(m(this.element,"mousedown",(Z)=>this._selectionService.handleMouseDown(Z))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(K7,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",(Z)=>this._handleScreenReaderModeOptionChange(Z))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(Y7,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",(Z)=>{!this._overviewRulerRenderer&&Z&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(Y7,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(v6,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let $=this,Y=this.element;function J(K){let Q=$._mouseService.getMouseReportCoords(K,$.screenElement);if(!Q)return!1;let X,N;switch(K.overrideType||K.type){case"mousemove":N=32,K.buttons===void 0?(X=3,K.button!==void 0&&(X=K.button<3?K.button:3)):X=K.buttons&1?0:K.buttons&4?1:K.buttons&2?2:3;break;case"mouseup":N=0,X=K.button<3?K.button:3;break;case"mousedown":N=1,X=K.button<3?K.button:3;break;case"wheel":if($._customWheelEventHandler&&$._customWheelEventHandler(K)===!1)return!1;let z=K.deltaY;if(z===0||$.coreMouseService.consumeWheelEvent(K,$._renderService?.dimensions?.device?.cell?.height,$._coreBrowserService?.dpr)===0)return!1;N=z<0?0:1,X=4;break;default:return!1}return N===void 0||X===void 0||X>4?!1:$.coreMouseService.triggerMouseEvent({col:Q.col,row:Q.row,x:Q.x,y:Q.y,button:X,action:N,ctrl:K.ctrlKey,alt:K.altKey,shift:K.shiftKey})}let j={mouseup:null,wheel:null,mousedrag:null,mousemove:null},Z={mouseup:(K)=>(J(K),K.buttons||(this._document.removeEventListener("mouseup",j.mouseup),j.mousedrag&&this._document.removeEventListener("mousemove",j.mousedrag)),this.cancel(K)),wheel:(K)=>(J(K),this.cancel(K,!0)),mousedrag:(K)=>{K.buttons&&J(K)},mousemove:(K)=>{K.buttons||J(K)}};this._register(this.coreMouseService.onProtocolChange((K)=>{K?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(K)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),K&8?j.mousemove||(Y.addEventListener("mousemove",Z.mousemove),j.mousemove=Z.mousemove):(Y.removeEventListener("mousemove",j.mousemove),j.mousemove=null),K&16?j.wheel||(Y.addEventListener("wheel",Z.wheel,{passive:!1}),j.wheel=Z.wheel):(Y.removeEventListener("wheel",j.wheel),j.wheel=null),K&2?j.mouseup||(j.mouseup=Z.mouseup):(this._document.removeEventListener("mouseup",j.mouseup),j.mouseup=null),K&4?j.mousedrag||(j.mousedrag=Z.mousedrag):(this._document.removeEventListener("mousemove",j.mousedrag),j.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(m(Y,"mousedown",(K)=>{if(K.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(K)))return J(K),j.mouseup&&this._document.addEventListener("mouseup",j.mouseup),j.mousedrag&&this._document.addEventListener("mousemove",j.mousedrag),this.cancel(K)})),this._register(m(Y,"wheel",(K)=>{if(!j.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(K)===!1)return!1;if(!this.buffer.hasScrollback){if(K.deltaY===0)return!1;if($.coreMouseService.consumeWheelEvent(K,$._renderService?.dimensions?.device?.cell?.height,$._coreBrowserService?.dpr)===0)return this.cancel(K,!0);let Q=R.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(K.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(Q,!0),this.cancel(K,!0)}}},{passive:!1}))}refresh($,Y){this._renderService?.refreshRows($,Y)}updateCursorStyle($){this._selectionService?.shouldColumnSelect($)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines($,Y){this._viewport?this._viewport.scrollLines($):super.scrollLines($,Y),this.refresh(0,this.rows-1)}scrollPages($){this.scrollLines($*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom($){$&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine($){let Y=$-this._bufferService.buffer.ydisp;Y!==0&&this.scrollLines(Y)}paste($){f5($,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler($){this._customKeyEventHandler=$}attachCustomWheelEventHandler($){this._customWheelEventHandler=$}registerLinkProvider($){return this._linkProviderService.registerLinkProvider($)}registerCharacterJoiner($){if(!this._characterJoinerService)throw Error("Terminal must be opened first");let Y=this._characterJoinerService.register($);return this.refresh(0,this.rows-1),Y}deregisterCharacterJoiner($){if(!this._characterJoinerService)throw Error("Terminal must be opened first");this._characterJoinerService.deregister($)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker($){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+$)}registerDecoration($){return this._decorationService.registerDecoration($)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select($,Y,J){this._selectionService.setSelection($,Y,J)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines($,Y){this._selectionService?.selectLines($,Y)}_keyDown($){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler($)===!1)return!1;let Y=this.browser.isMac&&this.options.macOptionIsMeta&&$.altKey;if(!Y&&!this._compositionHelper.keydown($))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!Y&&($.key==="Dead"||$.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let J=Rj($,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle($),J.type===3||J.type===2){let j=this.rows-1;return this.scrollLines(J.type===2?-j:j),this.cancel($,!0)}if(J.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,$)||(J.cancel&&this.cancel($,!0),!J.key)||$.key&&!$.ctrlKey&&!$.altKey&&!$.metaKey&&$.key.length===1&&$.key.charCodeAt(0)>=65&&$.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((J.key===R.ETX||J.key===R.CR)&&(this.textarea.value=""),this._onKey.fire({key:J.key,domEvent:$}),this._showCursor(),this.coreService.triggerDataEvent(J.key,!0),!this.optionsService.rawOptions.screenReaderMode||$.altKey||$.ctrlKey)return this.cancel($,!0);this._keyDownHandled=!0}_isThirdLevelShift($,Y){let J=$.isMac&&!this.options.macOptionIsMeta&&Y.altKey&&!Y.ctrlKey&&!Y.metaKey||$.isWindows&&Y.altKey&&Y.ctrlKey&&!Y.metaKey||$.isWindows&&Y.getModifierState("AltGraph");return Y.type==="keypress"?J:J&&(!Y.keyCode||Y.keyCode>47)}_keyUp($){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler($)===!1)&&(Tj($)||this.focus(),this.updateCursorStyle($),this._keyPressHandled=!1)}_keyPress($){let Y;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler($)===!1)return!1;if(this.cancel($),$.charCode)Y=$.charCode;else if($.which===null||$.which===void 0)Y=$.keyCode;else if($.which!==0&&$.charCode!==0)Y=$.which;else return!1;return!Y||($.altKey||$.ctrlKey||$.metaKey)&&!this._isThirdLevelShift(this.browser,$)?!1:(Y=String.fromCharCode(Y),this._onKey.fire({key:Y,domEvent:$}),this._showCursor(),this.coreService.triggerDataEvent(Y,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent($){if($.data&&$.inputType==="insertText"&&(!$.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let Y=$.data;return this.coreService.triggerDataEvent(Y,!0),this.cancel($),!0}return!1}resize($,Y){if($===this.cols&&Y===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize($,Y)}_afterResize($,Y){this._charSizeService?.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let $=1;$<this.rows;$++)this.buffer.lines.push(this.buffer.getBlankLine(N0));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let $=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this._customKeyEventHandler=$,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(R.ESC+"[I"):this.coreService.triggerDataEvent(R.ESC+"[O")}_reportWindowsOptions($){if(this._renderService)switch($){case 0:let Y=this._renderService.dimensions.css.canvas.width.toFixed(0),J=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${R.ESC}[4;${J};${Y}t`);break;case 1:let j=this._renderService.dimensions.css.cell.width.toFixed(0),Z=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${R.ESC}[6;${Z};${j}t`);break}}cancel($,Y){if(!(!this.options.cancelEvents&&!Y))return $.preventDefault(),$.stopPropagation(),!1}};function Tj($){return $.keyCode===16||$.keyCode===17||$.keyCode===18}var Aj=class{constructor(){this._addons=[]}dispose(){for(let $=this._addons.length-1;$>=0;$--)this._addons[$].instance.dispose()}loadAddon($,Y){let J={instance:Y,dispose:Y.dispose,isDisposed:!1};this._addons.push(J),Y.dispose=()=>this._wrappedAddonDispose(J),Y.activate($)}_wrappedAddonDispose($){if($.isDisposed)return;let Y=-1;for(let J=0;J<this._addons.length;J++)if(this._addons[J]===$){Y=J;break}if(Y===-1)throw Error("Could not dispose an addon that has not been loaded");$.isDisposed=!0,$.dispose.apply($.instance),this._addons.splice(Y,1)}},Pj=class{constructor($){this._line=$}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell($,Y){if(!($<0||$>=this._line.length))return Y?(this._line.loadCell($,Y),Y):this._line.loadCell($,new o0)}translateToString($,Y,J){return this._line.translateToString($,Y,J)}},k5=class{constructor($,Y){this._buffer=$,this.type=Y}init($){return this._buffer=$,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine($){let Y=this._buffer.lines.get($);if(Y)return new Pj(Y)}getNullCell(){return new o0}},kj=class extends S{constructor($){super();this._core=$,this._onBufferChange=this._register(new D),this.onBufferChange=this._onBufferChange.event,this._normal=new k5(this._core.buffers.normal,"normal"),this._alternate=new k5(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},wj=class{constructor($){this._core=$}registerCsiHandler($,Y){return this._core.registerCsiHandler($,(J)=>Y(J.toArray()))}addCsiHandler($,Y){return this.registerCsiHandler($,Y)}registerDcsHandler($,Y){return this._core.registerDcsHandler($,(J,j)=>Y(J,j.toArray()))}addDcsHandler($,Y){return this.registerDcsHandler($,Y)}registerEscHandler($,Y){return this._core.registerEscHandler($,Y)}addEscHandler($,Y){return this.registerEscHandler($,Y)}registerOscHandler($,Y){return this._core.registerOscHandler($,Y)}addOscHandler($,Y){return this.registerOscHandler($,Y)}},fj=class{constructor($){this._core=$}register($){this._core.unicodeService.register($)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion($){this._core.unicodeService.activeVersion=$}},mj=["cols","rows"],$8=0,q2=class extends S{constructor($){super(),this._core=this._register(new bj($)),this._addonManager=this._register(new Aj),this._publicOptions={...this._core.options};let Y=(j)=>this._core.options[j],J=(j,Z)=>{this._checkReadonlyOptions(j),this._core.options[j]=Z};for(let j in this._core.options){let Z={get:Y.bind(this,j),set:J.bind(this,j)};Object.defineProperty(this._publicOptions,j,Z)}}_checkReadonlyOptions($){if(mj.includes($))throw Error(`Option "${$}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new wj(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new fj(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new kj(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let $=this._core.coreService.decPrivateModes,Y="none";switch(this._core.coreMouseService.activeProtocol){case"X10":Y="x10";break;case"VT200":Y="vt200";break;case"DRAG":Y="drag";break;case"ANY":Y="any";break}return{applicationCursorKeysMode:$.applicationCursorKeys,applicationKeypadMode:$.applicationKeypad,bracketedPasteMode:$.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:Y,originMode:$.origin,reverseWraparoundMode:$.reverseWraparound,sendFocusMode:$.sendFocus,synchronizedOutputMode:$.synchronizedOutput,wraparoundMode:$.wraparound}}get options(){return this._publicOptions}set options($){for(let Y in $)this._publicOptions[Y]=$[Y]}blur(){this._core.blur()}focus(){this._core.focus()}input($,Y=!0){this._core.input($,Y)}resize($,Y){this._verifyIntegers($,Y),this._core.resize($,Y)}open($){this._core.open($)}attachCustomKeyEventHandler($){this._core.attachCustomKeyEventHandler($)}attachCustomWheelEventHandler($){this._core.attachCustomWheelEventHandler($)}registerLinkProvider($){return this._core.registerLinkProvider($)}registerCharacterJoiner($){return this._checkProposedApi(),this._core.registerCharacterJoiner($)}deregisterCharacterJoiner($){this._checkProposedApi(),this._core.deregisterCharacterJoiner($)}registerMarker($=0){return this._verifyIntegers($),this._core.registerMarker($)}registerDecoration($){return this._checkProposedApi(),this._verifyPositiveIntegers($.x??0,$.width??0,$.height??0),this._core.registerDecoration($)}hasSelection(){return this._core.hasSelection()}select($,Y,J){this._verifyIntegers($,Y,J),this._core.select($,Y,J)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines($,Y){this._verifyIntegers($,Y),this._core.selectLines($,Y)}dispose(){super.dispose()}scrollLines($){this._verifyIntegers($),this._core.scrollLines($)}scrollPages($){this._verifyIntegers($),this._core.scrollPages($)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine($){this._verifyIntegers($),this._core.scrollToLine($)}clear(){this._core.clear()}write($,Y){this._core.write($,Y)}writeln($,Y){this._core.write($),this._core.write(`\r
`,Y)}paste($){this._core.paste($)}refresh($,Y){this._verifyIntegers($,Y),this._core.refresh($,Y)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon($){this._addonManager.loadAddon(this,$)}static get strings(){return{get promptLabel(){return Z6.get()},set promptLabel($){Z6.set($)},get tooMuchOutput(){return K6.get()},set tooMuchOutput($){K6.set($)}}}_verifyIntegers(...$){for($8 of $)if($8===1/0||isNaN($8)||$8%1!==0)throw Error("This API only accepts integers")}_verifyPositiveIntegers(...$){for($8 of $)if($8&&($8===1/0||isNaN($8)||$8%1!==0||$8<0))throw Error("This API only accepts positive integers")}};var Sj=2,gj=1,E2=class{activate($){this._terminal=$}dispose(){}fit(){let $=this.proposeDimensions();if(!$||!this._terminal||isNaN($.cols)||isNaN($.rows))return;let Y=this._terminal._core;(this._terminal.rows!==$.rows||this._terminal.cols!==$.cols)&&(Y._renderService.clear(),this._terminal.resize($.cols,$.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let $=this._terminal._core._renderService.dimensions;if($.css.cell.width===0||$.css.cell.height===0)return;let Y=this._terminal.options.scrollback===0?0:this._terminal.options.overviewRuler?.width||14,J=window.getComputedStyle(this._terminal.element.parentElement),j=parseInt(J.getPropertyValue("height")),Z=Math.max(0,parseInt(J.getPropertyValue("width"))),K=window.getComputedStyle(this._terminal.element),Q={top:parseInt(K.getPropertyValue("padding-top")),bottom:parseInt(K.getPropertyValue("padding-bottom")),right:parseInt(K.getPropertyValue("padding-right")),left:parseInt(K.getPropertyValue("padding-left"))},X=Q.top+Q.bottom,N=Q.right+Q.left,z=j-X,G=Z-N-Y;return{cols:Math.max(Sj,Math.floor(G/$.css.cell.width)),rows:Math.max(gj,Math.floor(z/$.css.cell.height))}}};var pj=class{constructor($,Y,J,j={}){this._terminal=$,this._regex=Y,this._handler=J,this._options=j}provideLinks($,Y){let J=hj.computeLink($,this._regex,this._terminal,this._handler);Y(this._addCallbacks(J))}_addCallbacks($){return $.map((Y)=>(Y.leave=this._options.leave,Y.hover=(J,j)=>{if(this._options.hover){let{range:Z}=Y;this._options.hover(J,j,Z)}},Y))}};function Cj($){try{let Y=new URL($),J=Y.password&&Y.username?`${Y.protocol}//${Y.username}:${Y.password}@${Y.host}`:Y.username?`${Y.protocol}//${Y.username}@${Y.host}`:`${Y.protocol}//${Y.host}`;return $.toLocaleLowerCase().startsWith(J.toLocaleLowerCase())}catch{return!1}}var hj=class ${static computeLink(Y,J,j,Z){let K=new RegExp(J.source,(J.flags||"")+"g"),[Q,X]=$._getWindowedLineStrings(Y-1,j),N=Q.join(""),z,G=[];for(;z=K.exec(N);){let V=z[0];if(!Cj(V))continue;let[W,_]=$._mapStrIdx(j,X,0,z.index),[H,U]=$._mapStrIdx(j,W,_,V.length);if(W===-1||_===-1||H===-1||U===-1)continue;let B={start:{x:_+1,y:W+1},end:{x:U,y:H+1}};G.push({range:B,text:V,activate:Z})}return G}static _getWindowedLineStrings(Y,J){let j,Z=Y,K=Y,Q=0,X="",N=[];if(j=J.buffer.active.getLine(Y)){let z=j.translateToString(!0);if(j.isWrapped&&z[0]!==" "){for(Q=0;(j=J.buffer.active.getLine(--Z))&&Q<2048&&(X=j.translateToString(!0),Q+=X.length,N.push(X),!(!j.isWrapped||X.indexOf(" ")!==-1)););N.reverse()}for(N.push(z),Q=0;(j=J.buffer.active.getLine(++K))&&j.isWrapped&&Q<2048&&(X=j.translateToString(!0),Q+=X.length,N.push(X),X.indexOf(" ")===-1););}return[N,Z]}static _mapStrIdx(Y,J,j,Z){let K=Y.buffer.active,Q=K.getNullCell(),X=j;for(;Z;){let N=K.getLine(J);if(!N)return[-1,-1];for(let z=X;z<N.length;++z){N.getCell(z,Q);let G=Q.getChars();if(Q.getWidth()&&(Z-=G.length||1,z===N.length-1&&G==="")){let V=K.getLine(J+1);V&&V.isWrapped&&(V.getCell(0,Q),Q.getWidth()===2&&(Z+=1))}if(Z<0)return[J,z]}J++,X=0}return[J,X]}},dj=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function uj($,Y){let J=window.open();if(J){try{J.opener=null}catch{}J.location.href=Y}else console.warn("Opening link blocked as opener could not be cleared")}var v2=class{constructor($=uj,Y={}){this._handler=$,this._options=Y}activate($){this._terminal=$;let Y=this._options,J=Y.urlRegex||dj;this._linkProvider=this._terminal.registerLinkProvider(new pj(this._terminal,J,this._handler,Y))}dispose(){this._linkProvider?.dispose()}};var{defineProperty:cj,getOwnPropertyDescriptor:lj}=Object,sj=($,Y,J,j)=>{for(var Z=j>1?void 0:j?lj(Y,J):Y,K=$.length-1,Q;K>=0;K--)(Q=$[K])&&(Z=(j?Q(Y,J,Z):Q(Z))||Z);return j&&Z&&cj(Y,J,Z),Z},oj=($,Y)=>(J,j)=>Y(J,j,$),aj=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function($){setTimeout(()=>{throw $.stack?R2.isErrorNoTelemetry($)?new R2($.message+`

`+$.stack):Error($.message+`

`+$.stack):$},0)}}addListener($){return this.listeners.push($),()=>{this._removeListener($)}}emit($){this.listeners.forEach((Y)=>{Y($)})}_removeListener($){this.listeners.splice(this.listeners.indexOf($),1)}setUnexpectedErrorHandler($){this.unexpectedErrorHandler=$}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError($){this.unexpectedErrorHandler($),this.emit($)}onUnexpectedExternalError($){this.unexpectedErrorHandler($)}},nj=new aj;function x7($){rj($)||nj.onUnexpectedError($)}var Z1="Canceled";function rj($){return $ instanceof ij?!0:$ instanceof Error&&$.name===Z1&&$.message===Z1}var ij=class extends Error{constructor(){super(Z1),this.name=this.message}},R2=class $ extends Error{constructor(Y){super(Y),this.name="CodeExpectedError"}static fromError(Y){if(Y instanceof $)return Y;let J=new $;return J.message=Y.message,J.stack=Y.stack,J}static isErrorNoTelemetry(Y){return Y.name==="CodeExpectedError"}};function tj($,Y,J=0,j=$.length){let Z=J,K=j;for(;Z<K;){let Q=Math.floor((Z+K)/2);Y($[Q])?Z=Q+1:K=Q}return Z-1}var ej=class ${constructor(Y){this._array=Y,this._findLastMonotonousLastIdx=0}findLastMonotonous(Y){if($.assertInvariants){if(this._prevFindLastPredicate){for(let j of this._array)if(this._prevFindLastPredicate(j)&&!Y(j))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=Y}let J=tj(this._array,Y,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=J+1,J===-1?void 0:this._array[J]}};ej.assertInvariants=!1;var K4;(($)=>{function Y(K){return K<0}$.isLessThan=Y;function J(K){return K<=0}$.isLessThanOrEqual=J;function j(K){return K>0}$.isGreaterThan=j;function Z(K){return K===0}$.isNeitherLessOrGreaterThan=Z,$.greaterThan=1,$.lessThan=-1,$.neitherLessOrGreaterThan=0})(K4||={});function $Z($,Y){return(J,j)=>Y($(J),$(j))}var YZ=($,Y)=>$-Y,y2=class ${constructor(Y){this.iterate=Y}forEach(Y){this.iterate((J)=>(Y(J),!0))}toArray(){let Y=[];return this.iterate((J)=>(Y.push(J),!0)),Y}filter(Y){return new $((J)=>this.iterate((j)=>Y(j)?J(j):!0))}map(Y){return new $((J)=>this.iterate((j)=>J(Y(j))))}some(Y){let J=!1;return this.iterate((j)=>(J=Y(j),!J)),J}findFirst(Y){let J;return this.iterate((j)=>Y(j)?(J=j,!1):!0),J}findLast(Y){let J;return this.iterate((j)=>(Y(j)&&(J=j),!0)),J}findLastMaxBy(Y){let J,j=!0;return this.iterate((Z)=>((j||K4.isGreaterThan(Y(Z,J)))&&(j=!1,J=Z),!0)),J}};y2.empty=new y2(($)=>{});function JZ($,Y){let J=Object.create(null);for(let j of $){let Z=Y(j),K=J[Z];K||(K=J[Z]=[]),K.push(j)}return J}var F2,B2,CX=class{constructor($,Y){this.toKey=Y,this._map=new Map,this[F2]="SetWithKey";for(let J of $)this.add(J)}get size(){return this._map.size}add($){let Y=this.toKey($);return this._map.set(Y,$),this}delete($){return this._map.delete(this.toKey($))}has($){return this._map.has(this.toKey($))}*entries(){for(let $ of this._map.values())yield[$,$]}keys(){return this.values()}*values(){for(let $ of this._map.values())yield $}clear(){this._map.clear()}forEach($,Y){this._map.forEach((J)=>$.call(Y,J,J,this))}[(B2=Symbol.iterator,F2=Symbol.toStringTag,B2)](){return this.values()}},jZ=class{constructor(){this.map=new Map}add($,Y){let J=this.map.get($);J||(J=new Set,this.map.set($,J)),J.add(Y)}delete($,Y){let J=this.map.get($);J&&(J.delete(Y),J.size===0&&this.map.delete($))}forEach($,Y){let J=this.map.get($);J&&J.forEach(Y)}get($){return this.map.get($)||new Set}};function ZZ($,Y){let J=this,j=!1,Z;return function(){if(j)return Z;if(j=!0,Y)try{Z=$.apply(J,arguments)}finally{Y()}else Z=$.apply(J,arguments);return Z}}var Q4;(($)=>{function Y(y){return y&&typeof y=="object"&&typeof y[Symbol.iterator]=="function"}$.is=Y;let J=Object.freeze([]);function j(){return J}$.empty=j;function*Z(y){yield y}$.single=Z;function K(y){return Y(y)?y:Z(y)}$.wrap=K;function Q(y){return y||J}$.from=Q;function*X(y){for(let b=y.length-1;b>=0;b--)yield y[b]}$.reverse=X;function N(y){return!y||y[Symbol.iterator]().next().done===!0}$.isEmpty=N;function z(y){return y[Symbol.iterator]().next().value}$.first=z;function G(y,b){let P=0;for(let p of y)if(b(p,P++))return!0;return!1}$.some=G;function V(y,b){for(let P of y)if(b(P))return P}$.find=V;function*W(y,b){for(let P of y)b(P)&&(yield P)}$.filter=W;function*_(y,b){let P=0;for(let p of y)yield b(p,P++)}$.map=_;function*H(y,b){let P=0;for(let p of y)yield*b(p,P++)}$.flatMap=H;function*U(...y){for(let b of y)yield*b}$.concat=U;function B(y,b,P){let p=P;for(let o of y)p=b(p,o);return p}$.reduce=B;function*A(y,b,P=y.length){for(b<0&&(b+=y.length),P<0?P+=y.length:P>y.length&&(P=y.length);b<P;b++)yield y[b]}$.slice=A;function k(y,b=Number.POSITIVE_INFINITY){let P=[];if(b===0)return[P,y];let p=y[Symbol.iterator]();for(let o=0;o<b;o++){let Q0=p.next();if(Q0.done)return[P,$.empty()];P.push(Q0.value)}return[P,{[Symbol.iterator](){return p}}]}$.consume=k;async function M(y){let b=[];for await(let P of y)b.push(P);return Promise.resolve(b)}$.asyncToArray=M})(Q4||={});var KZ=!1,e8=null,QZ=class ${constructor(){this.livingDisposables=new Map}getDisposableData(Y){let J=this.livingDisposables.get(Y);return J||(J={parent:null,source:null,isSingleton:!1,value:Y,idx:$.idx++},this.livingDisposables.set(Y,J)),J}trackDisposable(Y){let J=this.getDisposableData(Y);J.source||(J.source=Error().stack)}setParent(Y,J){let j=this.getDisposableData(Y);j.parent=J}markAsDisposed(Y){this.livingDisposables.delete(Y)}markAsSingleton(Y){this.getDisposableData(Y).isSingleton=!0}getRootParent(Y,J){let j=J.get(Y);if(j)return j;let Z=Y.parent?this.getRootParent(this.getDisposableData(Y.parent),J):Y;return J.set(Y,Z),Z}getTrackedDisposables(){let Y=new Map;return[...this.livingDisposables.entries()].filter(([,J])=>J.source!==null&&!this.getRootParent(J,Y).isSingleton).flatMap(([J])=>J)}computeLeakingDisposables(Y=10,J){let j;if(J)j=J;else{let N=new Map,z=[...this.livingDisposables.values()].filter((V)=>V.source!==null&&!this.getRootParent(V,N).isSingleton);if(z.length===0)return;let G=new Set(z.map((V)=>V.value));if(j=z.filter((V)=>!(V.parent&&G.has(V.parent))),j.length===0)throw Error("There are cyclic diposable chains!")}if(!j)return;function Z(N){function z(V,W){for(;V.length>0&&W.some((_)=>typeof _=="string"?_===V[0]:V[0].match(_));)V.shift()}let G=N.source.split(`
`).map((V)=>V.trim().replace("at ","")).filter((V)=>V!=="");return z(G,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),G.reverse()}let K=new jZ;for(let N of j){let z=Z(N);for(let G=0;G<=z.length;G++)K.add(z.slice(0,G).join(`
`),N)}j.sort($Z((N)=>N.idx,YZ));let Q="",X=0;for(let N of j.slice(0,Y)){X++;let z=Z(N),G=[];for(let V=0;V<z.length;V++){let W=z[V];W=`(shared with ${K.get(z.slice(0,V+1).join(`
`)).size}/${j.length} leaks) at ${W}`;let _=K.get(z.slice(0,V).join(`
`)),H=JZ([..._].map((U)=>Z(U)[V]),(U)=>U);delete H[z[V]];for(let[U,B]of Object.entries(H))G.unshift(`    - stacktraces of ${B.length} other leaks continue with ${U}`);G.unshift(W)}Q+=`


==================== Leaking disposable ${X}/${j.length}: ${N.value.constructor.name} ====================
${G.join(`
`)}
============================================================

`}return j.length>Y&&(Q+=`


... and ${j.length-Y} more leaking disposables

`),{leaks:j,details:Q}}};QZ.idx=0;function XZ($){e8=$}if(KZ){let $="__is_disposable_tracked__";XZ(new class{trackDisposable(Y){let J=Error("Potentially leaked disposable").stack;setTimeout(()=>{Y[$]||console.log(J)},3000)}setParent(Y,J){if(Y&&Y!==u0.None)try{Y[$]=!0}catch{}}markAsDisposed(Y){if(Y&&Y!==u0.None)try{Y[$]=!0}catch{}}markAsSingleton(Y){}})}function B7($){return e8?.trackDisposable($),$}function L7($){e8?.markAsDisposed($)}function T9($,Y){e8?.setParent($,Y)}function zZ($,Y){if(e8)for(let J of $)e8.setParent(J,Y)}function X4($){if(Q4.is($)){let Y=[];for(let J of $)if(J)try{J.dispose()}catch(j){Y.push(j)}if(Y.length===1)throw Y[0];if(Y.length>1)throw AggregateError(Y,"Encountered errors while disposing of store");return Array.isArray($)?[]:$}else if($)return $.dispose(),$}function z4(...$){let Y=M0(()=>X4($));return zZ($,Y),Y}function M0($){let Y=B7({dispose:ZZ(()=>{L7(Y),$()})});return Y}var N4=class ${constructor(){this._toDispose=new Set,this._isDisposed=!1,B7(this)}dispose(){this._isDisposed||(L7(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{X4(this._toDispose)}finally{this._toDispose.clear()}}add(Y){if(!Y)return Y;if(Y===this)throw Error("Cannot register a disposable on itself!");return T9(Y,this),this._isDisposed?$.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(Y),Y}delete(Y){if(Y){if(Y===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(Y),Y.dispose()}}deleteAndLeak(Y){Y&&this._toDispose.has(Y)&&(this._toDispose.delete(Y),T9(Y,null))}};N4.DISABLE_DISPOSED_WARNING=!1;var t8=N4,u0=class{constructor(){this._store=new t8,B7(this),T9(this._store,this)}dispose(){L7(this),this._store.dispose()}_register($){if($===this)throw Error("Cannot register a disposable on itself!");return this._store.add($)}};u0.None=Object.freeze({dispose(){}});var F9=class{constructor(){this._isDisposed=!1,B7(this)}get value(){return this._isDisposed?void 0:this._value}set value($){this._isDisposed||$===this._value||(this._value?.dispose(),$&&T9($,this),this._value=$)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,L7(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let $=this._value;return this._value=void 0,$&&T9($,null),$}},G1=typeof process<"u"&&"title"in process,P9=G1?"node":navigator.userAgent,W1=G1?"node":navigator.platform,NZ=P9.includes("Firefox"),VZ=P9.includes("Edge"),V4=/^((?!chrome|android).)*safari/i.test(P9);function GZ(){if(!V4)return 0;let $=P9.match(/Version\/(\d+)/);return $===null||$.length<2?0:parseInt($[1])}var hX=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(W1),dX=["Windows","Win16","Win32","WinCE"].includes(W1),uX=W1.indexOf("Linux")>=0,cX=/\bCrOS\b/.test(P9),WZ="",R0=0,y0=0,F0=0,K0=0,a0={css:"#00000000",rgba:0},w0;(($)=>{function Y(Z,K,Q,X){return X!==void 0?`#${d8(Z)}${d8(K)}${d8(Q)}${d8(X)}`:`#${d8(Z)}${d8(K)}${d8(Q)}`}$.toCss=Y;function J(Z,K,Q,X=255){return(Z<<24|K<<16|Q<<8|X)>>>0}$.toRgba=J;function j(Z,K,Q,X){return{css:$.toCss(Z,K,Q,X),rgba:$.toRgba(Z,K,Q,X)}}$.toColor=j})(w0||={});var b9;(($)=>{function Y(N,z){if(K0=(z.rgba&255)/255,K0===1)return{css:z.css,rgba:z.rgba};let G=z.rgba>>24&255,V=z.rgba>>16&255,W=z.rgba>>8&255,_=N.rgba>>24&255,H=N.rgba>>16&255,U=N.rgba>>8&255;R0=_+Math.round((G-_)*K0),y0=H+Math.round((V-H)*K0),F0=U+Math.round((W-U)*K0);let B=w0.toCss(R0,y0,F0),A=w0.toRgba(R0,y0,F0);return{css:B,rgba:A}}$.blend=Y;function J(N){return(N.rgba&255)===255}$.isOpaque=J;function j(N,z,G){let V=u8.ensureContrastRatio(N.rgba,z.rgba,G);if(V)return w0.toColor(V>>24&255,V>>16&255,V>>8&255)}$.ensureContrastRatio=j;function Z(N){let z=(N.rgba|255)>>>0;return[R0,y0,F0]=u8.toChannels(z),{css:w0.toCss(R0,y0,F0),rgba:z}}$.opaque=Z;function K(N,z){return K0=Math.round(z*255),[R0,y0,F0]=u8.toChannels(N.rgba),{css:w0.toCss(R0,y0,F0,K0),rgba:w0.toRgba(R0,y0,F0,K0)}}$.opacity=K;function Q(N,z){return K0=N.rgba&255,K(N,K0*z/255)}$.multiplyOpacity=Q;function X(N){return[N.rgba>>24&255,N.rgba>>16&255,N.rgba>>8&255]}$.toColorRGB=X})(b9||={});var _Z;(($)=>{let Y,J;try{let Z=document.createElement("canvas");Z.width=1,Z.height=1;let K=Z.getContext("2d",{willReadFrequently:!0});K&&(Y=K,Y.globalCompositeOperation="copy",J=Y.createLinearGradient(0,0,1,1))}catch{}function j(Z){if(Z.match(/#[\da-f]{3,8}/i))switch(Z.length){case 4:return R0=parseInt(Z.slice(1,2).repeat(2),16),y0=parseInt(Z.slice(2,3).repeat(2),16),F0=parseInt(Z.slice(3,4).repeat(2),16),w0.toColor(R0,y0,F0);case 5:return R0=parseInt(Z.slice(1,2).repeat(2),16),y0=parseInt(Z.slice(2,3).repeat(2),16),F0=parseInt(Z.slice(3,4).repeat(2),16),K0=parseInt(Z.slice(4,5).repeat(2),16),w0.toColor(R0,y0,F0,K0);case 7:return{css:Z,rgba:(parseInt(Z.slice(1),16)<<8|255)>>>0};case 9:return{css:Z,rgba:parseInt(Z.slice(1),16)>>>0}}let K=Z.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(K)return R0=parseInt(K[1]),y0=parseInt(K[2]),F0=parseInt(K[3]),K0=Math.round((K[5]===void 0?1:parseFloat(K[5]))*255),w0.toColor(R0,y0,F0,K0);if(!Y||!J)throw Error("css.toColor: Unsupported css format");if(Y.fillStyle=J,Y.fillStyle=Z,typeof Y.fillStyle!="string")throw Error("css.toColor: Unsupported css format");if(Y.fillRect(0,0,1,1),[R0,y0,F0,K0]=Y.getImageData(0,0,1,1).data,K0!==255)throw Error("css.toColor: Unsupported css format");return{rgba:w0.toRgba(R0,y0,F0,K0),css:Z}}$.toColor=j})(_Z||={});var k0;(($)=>{function Y(j){return J(j>>16&255,j>>8&255,j&255)}$.relativeLuminance=Y;function J(j,Z,K){let Q=j/255,X=Z/255,N=K/255,z=Q<=0.03928?Q/12.92:Math.pow((Q+0.055)/1.055,2.4),G=X<=0.03928?X/12.92:Math.pow((X+0.055)/1.055,2.4),V=N<=0.03928?N/12.92:Math.pow((N+0.055)/1.055,2.4);return z*0.2126+G*0.7152+V*0.0722}$.relativeLuminance2=J})(k0||={});var u8;(($)=>{function Y(Q,X){if(K0=(X&255)/255,K0===1)return X;let N=X>>24&255,z=X>>16&255,G=X>>8&255,V=Q>>24&255,W=Q>>16&255,_=Q>>8&255;return R0=V+Math.round((N-V)*K0),y0=W+Math.round((z-W)*K0),F0=_+Math.round((G-_)*K0),w0.toRgba(R0,y0,F0)}$.blend=Y;function J(Q,X,N){let z=k0.relativeLuminance(Q>>8),G=k0.relativeLuminance(X>>8);if(_8(z,G)<N){if(G<z){let _=j(Q,X,N),H=_8(z,k0.relativeLuminance(_>>8));if(H<N){let U=Z(Q,X,N),B=_8(z,k0.relativeLuminance(U>>8));return H>B?_:U}return _}let V=Z(Q,X,N),W=_8(z,k0.relativeLuminance(V>>8));if(W<N){let _=j(Q,X,N),H=_8(z,k0.relativeLuminance(_>>8));return W>H?V:_}return V}}$.ensureContrastRatio=J;function j(Q,X,N){let z=Q>>24&255,G=Q>>16&255,V=Q>>8&255,W=X>>24&255,_=X>>16&255,H=X>>8&255,U=_8(k0.relativeLuminance2(W,_,H),k0.relativeLuminance2(z,G,V));for(;U<N&&(W>0||_>0||H>0);)W-=Math.max(0,Math.ceil(W*0.1)),_-=Math.max(0,Math.ceil(_*0.1)),H-=Math.max(0,Math.ceil(H*0.1)),U=_8(k0.relativeLuminance2(W,_,H),k0.relativeLuminance2(z,G,V));return(W<<24|_<<16|H<<8|255)>>>0}$.reduceLuminance=j;function Z(Q,X,N){let z=Q>>24&255,G=Q>>16&255,V=Q>>8&255,W=X>>24&255,_=X>>16&255,H=X>>8&255,U=_8(k0.relativeLuminance2(W,_,H),k0.relativeLuminance2(z,G,V));for(;U<N&&(W<255||_<255||H<255);)W=Math.min(255,W+Math.ceil((255-W)*0.1)),_=Math.min(255,_+Math.ceil((255-_)*0.1)),H=Math.min(255,H+Math.ceil((255-H)*0.1)),U=_8(k0.relativeLuminance2(W,_,H),k0.relativeLuminance2(z,G,V));return(W<<24|_<<16|H<<8|255)>>>0}$.increaseLuminance=Z;function K(Q){return[Q>>24&255,Q>>16&255,Q>>8&255,Q&255]}$.toChannels=K})(u8||={});function d8($){let Y=$.toString(16);return Y.length<2?"0"+Y:Y}function _8($,Y){return $<Y?(Y+0.05)/($+0.05):($+0.05)/(Y+0.05)}function G0($){if(!$)throw Error("value must not be falsy");return $}function _1($){return 57508<=$&&$<=57558}function HZ($){return 57520<=$&&$<=57527}function IZ($){return 57344<=$&&$<=63743}function xZ($){return 9472<=$&&$<=9631}function UZ($){return $>=128512&&$<=128591||$>=127744&&$<=128511||$>=128640&&$<=128767||$>=9728&&$<=9983||$>=9984&&$<=10175||$>=65024&&$<=65039||$>=129280&&$<=129535||$>=127462&&$<=127487}function OZ($,Y,J,j){return Y===1&&J>Math.ceil(j*1.5)&&$!==void 0&&$>255&&!UZ($)&&!_1($)&&!IZ($)}function G4($){return _1($)||xZ($)}function qZ(){return{css:{canvas:W7(),cell:W7()},device:{canvas:W7(),cell:W7(),char:{width:0,height:0,left:0,top:0}}}}function W7(){return{width:0,height:0}}function EZ($,Y,J=0){return($-(Math.round(Y)*2-J))%(Math.round(Y)*2)}var D0=0,v0=0,Z8=!1,H8=!1,_7=!1,m0,c6=0,vZ=class{constructor($,Y,J,j,Z,K){this._terminal=$,this._optionService=Y,this._selectionRenderModel=J,this._decorationService=j,this._coreBrowserService=Z,this._themeService=K,this.result={fg:0,bg:0,ext:0}}resolve($,Y,J,j){if(this.result.bg=$.bg,this.result.fg=$.fg,this.result.ext=$.bg&268435456?$.extended.ext:0,v0=0,D0=0,H8=!1,Z8=!1,_7=!1,m0=this._themeService.colors,c6=0,$.getCode()!==0&&$.extended.underlineStyle===4){let Z=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));c6=Y*j%(Math.round(Z)*2)}if(this._decorationService.forEachDecorationAtCell(Y,J,"bottom",(Z)=>{Z.backgroundColorRGB&&(v0=Z.backgroundColorRGB.rgba>>8&16777215,H8=!0),Z.foregroundColorRGB&&(D0=Z.foregroundColorRGB.rgba>>8&16777215,Z8=!0)}),_7=this._selectionRenderModel.isCellSelected(this._terminal,Y,J),_7){if(this.result.fg&67108864||(this.result.bg&50331648)!==0){if(this.result.fg&67108864)switch(this.result.fg&50331648){case 16777216:case 33554432:v0=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:v0=(this.result.fg&16777215)<<8|255;break;case 0:default:v0=this._themeService.colors.foreground.rgba}else switch(this.result.bg&50331648){case 16777216:case 33554432:v0=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:v0=(this.result.bg&16777215)<<8|255;break}v0=u8.blend(v0,(this._coreBrowserService.isFocused?m0.selectionBackgroundOpaque:m0.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}else v0=(this._coreBrowserService.isFocused?m0.selectionBackgroundOpaque:m0.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(H8=!0,m0.selectionForeground&&(D0=m0.selectionForeground.rgba>>8&16777215,Z8=!0),G4($.getCode())){if(this.result.fg&67108864&&(this.result.bg&50331648)===0)D0=(this._coreBrowserService.isFocused?m0.selectionBackgroundOpaque:m0.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(this.result.fg&67108864)switch(this.result.bg&50331648){case 16777216:case 33554432:D0=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:D0=(this.result.bg&16777215)<<8|255;break}else switch(this.result.fg&50331648){case 16777216:case 33554432:D0=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:D0=(this.result.fg&16777215)<<8|255;break;case 0:default:D0=this._themeService.colors.foreground.rgba}D0=u8.blend(D0,(this._coreBrowserService.isFocused?m0.selectionBackgroundOpaque:m0.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}Z8=!0}}this._decorationService.forEachDecorationAtCell(Y,J,"top",(Z)=>{Z.backgroundColorRGB&&(v0=Z.backgroundColorRGB.rgba>>8&16777215,H8=!0),Z.foregroundColorRGB&&(D0=Z.foregroundColorRGB.rgba>>8&16777215,Z8=!0)}),H8&&(_7?v0=$.bg&-16777216&-134217729|v0|50331648:v0=$.bg&-16777216|v0|50331648),Z8&&(D0=$.fg&-16777216&-67108865|D0|50331648),this.result.fg&67108864&&(H8&&!Z8&&((this.result.bg&50331648)===0?D0=this.result.fg&-134217728|m0.background.rgba>>8&16777215&16777215|50331648:D0=this.result.fg&-134217728|this.result.bg&67108863,Z8=!0),!H8&&Z8&&((this.result.fg&50331648)===0?v0=this.result.bg&-67108864|m0.foreground.rgba>>8&16777215&16777215|50331648:v0=this.result.bg&-67108864|this.result.fg&67108863,H8=!0)),m0=void 0,this.result.bg=H8?v0:this.result.bg,this.result.fg=Z8?D0:this.result.fg,this.result.ext&=536870911,this.result.ext|=c6<<29&3758096384}},RZ=0.5,W4=NZ||VZ?"bottom":"ideographic",yZ={"":[{x:0,y:0,w:8,h:4}],"":[{x:0,y:7,w:8,h:1}],"":[{x:0,y:6,w:8,h:2}],"":[{x:0,y:5,w:8,h:3}],"":[{x:0,y:4,w:8,h:4}],"":[{x:0,y:3,w:8,h:5}],"":[{x:0,y:2,w:8,h:6}],"":[{x:0,y:1,w:8,h:7}],"":[{x:0,y:0,w:8,h:8}],"":[{x:0,y:0,w:7,h:8}],"":[{x:0,y:0,w:6,h:8}],"":[{x:0,y:0,w:5,h:8}],"":[{x:0,y:0,w:4,h:8}],"":[{x:0,y:0,w:3,h:8}],"":[{x:0,y:0,w:2,h:8}],"":[{x:0,y:0,w:1,h:8}],"":[{x:4,y:0,w:4,h:8}],"":[{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8}],"":[{x:0,y:4,w:4,h:4}],"":[{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"":[{x:4,y:0,w:4,h:4}],"":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\uD83E\uDF70":[{x:1,y:0,w:1,h:8}],"\uD83E\uDF71":[{x:2,y:0,w:1,h:8}],"\uD83E\uDF72":[{x:3,y:0,w:1,h:8}],"\uD83E\uDF73":[{x:4,y:0,w:1,h:8}],"\uD83E\uDF74":[{x:5,y:0,w:1,h:8}],"\uD83E\uDF75":[{x:6,y:0,w:1,h:8}],"\uD83E\uDF76":[{x:0,y:1,w:8,h:1}],"\uD83E\uDF77":[{x:0,y:2,w:8,h:1}],"\uD83E\uDF78":[{x:0,y:3,w:8,h:1}],"\uD83E\uDF79":[{x:0,y:4,w:8,h:1}],"\uD83E\uDF7A":[{x:0,y:5,w:8,h:1}],"\uD83E\uDF7B":[{x:0,y:6,w:8,h:1}],"\uD83E\uDF7C":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF7D":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7E":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7F":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF80":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF81":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF82":[{x:0,y:0,w:8,h:2}],"\uD83E\uDF83":[{x:0,y:0,w:8,h:3}],"\uD83E\uDF84":[{x:0,y:0,w:8,h:5}],"\uD83E\uDF85":[{x:0,y:0,w:8,h:6}],"\uD83E\uDF86":[{x:0,y:0,w:8,h:7}],"\uD83E\uDF87":[{x:6,y:0,w:2,h:8}],"\uD83E\uDF88":[{x:5,y:0,w:3,h:8}],"\uD83E\uDF89":[{x:3,y:0,w:5,h:8}],"\uD83E\uDF8A":[{x:2,y:0,w:6,h:8}],"\uD83E\uDF8B":[{x:1,y:0,w:7,h:8}],"\uD83E\uDF95":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\uD83E\uDF96":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\uD83E\uDF97":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]},FZ={"":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"":[[1,0],[0,0],[0,1],[0,0]],"":[[0,1],[1,1],[1,0],[1,1]]},BZ={"":{1:"M0,.5 L1,.5"},"":{3:"M0,.5 L1,.5"},"":{1:"M.5,0 L.5,1"},"":{3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5"},"":{3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M0,.5 L.5,.5 L.5,1"},"":{3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L1,.5"},"":{3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L0,.5"},"":{3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{1:"M.5,.5 L0,.5"},"":{3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0"},"":{3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5"},"":{3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1"},"":{3:"M.5,.5 L.5,1"},"":{1:($,Y)=>`M0,${0.5-Y} L1,${0.5-Y} M0,${0.5+Y} L1,${0.5+Y}`},"":{1:($,Y)=>`M${0.5-$},0 L${0.5-$},1 M${0.5+$},0 L${0.5+$},1`},"":{1:($,Y)=>`M.5,1 L.5,${0.5-Y} L1,${0.5-Y} M.5,${0.5+Y} L1,${0.5+Y}`},"":{1:($,Y)=>`M${0.5-$},1 L${0.5-$},.5 L1,.5 M${0.5+$},.5 L${0.5+$},1`},"":{1:($,Y)=>`M1,${0.5-Y} L${0.5-$},${0.5-Y} L${0.5-$},1 M1,${0.5+Y} L${0.5+$},${0.5+Y} L${0.5+$},1`},"":{1:($,Y)=>`M0,${0.5-Y} L.5,${0.5-Y} L.5,1 M0,${0.5+Y} L.5,${0.5+Y}`},"":{1:($,Y)=>`M${0.5+$},1 L${0.5+$},.5 L0,.5 M${0.5-$},.5 L${0.5-$},1`},"":{1:($,Y)=>`M0,${0.5+Y} L${0.5-$},${0.5+Y} L${0.5-$},1 M0,${0.5-Y} L${0.5+$},${0.5-Y} L${0.5+$},1`},"":{1:($,Y)=>`M.5,0 L.5,${0.5+Y} L1,${0.5+Y} M.5,${0.5-Y} L1,${0.5-Y}`},"":{1:($,Y)=>`M1,.5 L${0.5-$},.5 L${0.5-$},0 M${0.5+$},.5 L${0.5+$},0`},"":{1:($,Y)=>`M1,${0.5-Y} L${0.5+$},${0.5-Y} L${0.5+$},0 M1,${0.5+Y} L${0.5-$},${0.5+Y} L${0.5-$},0`},"":{1:($,Y)=>`M0,${0.5+Y} L.5,${0.5+Y} L.5,0 M0,${0.5-Y} L.5,${0.5-Y}`},"":{1:($,Y)=>`M0,.5 L${0.5+$},.5 L${0.5+$},0 M${0.5-$},.5 L${0.5-$},0`},"":{1:($,Y)=>`M0,${0.5-Y} L${0.5-$},${0.5-Y} L${0.5-$},0 M0,${0.5+Y} L${0.5+$},${0.5+Y} L${0.5+$},0`},"":{1:($,Y)=>`M.5,0 L.5,1 M.5,${0.5-Y} L1,${0.5-Y} M.5,${0.5+Y} L1,${0.5+Y}`},"":{1:($,Y)=>`M${0.5-$},0 L${0.5-$},1 M${0.5+$},0 L${0.5+$},1 M${0.5+$},.5 L1,.5`},"":{1:($,Y)=>`M${0.5-$},0 L${0.5-$},1 M1,${0.5+Y} L${0.5+$},${0.5+Y} L${0.5+$},1 M1,${0.5-Y} L${0.5+$},${0.5-Y} L${0.5+$},0`},"":{1:($,Y)=>`M.5,0 L.5,1 M0,${0.5-Y} L.5,${0.5-Y} M0,${0.5+Y} L.5,${0.5+Y}`},"":{1:($,Y)=>`M0,.5 L${0.5-$},.5 M${0.5-$},0 L${0.5-$},1 M${0.5+$},0 L${0.5+$},1`},"":{1:($,Y)=>`M${0.5+$},0 L${0.5+$},1 M0,${0.5+Y} L${0.5-$},${0.5+Y} L${0.5-$},1 M0,${0.5-Y} L${0.5-$},${0.5-Y} L${0.5-$},0`},"":{1:($,Y)=>`M0,${0.5-Y} L1,${0.5-Y} M0,${0.5+Y} L1,${0.5+Y} M.5,${0.5+Y} L.5,1`},"":{1:($,Y)=>`M0,.5 L1,.5 M${0.5-$},.5 L${0.5-$},1 M${0.5+$},.5 L${0.5+$},1`},"":{1:($,Y)=>`M0,${0.5-Y} L1,${0.5-Y} M0,${0.5+Y} L${0.5-$},${0.5+Y} L${0.5-$},1 M1,${0.5+Y} L${0.5+$},${0.5+Y} L${0.5+$},1`},"":{1:($,Y)=>`M.5,0 L.5,${0.5-Y} M0,${0.5-Y} L1,${0.5-Y} M0,${0.5+Y} L1,${0.5+Y}`},"":{1:($,Y)=>`M0,.5 L1,.5 M${0.5-$},.5 L${0.5-$},0 M${0.5+$},.5 L${0.5+$},0`},"":{1:($,Y)=>`M0,${0.5+Y} L1,${0.5+Y} M0,${0.5-Y} L${0.5-$},${0.5-Y} L${0.5-$},0 M1,${0.5-Y} L${0.5+$},${0.5-Y} L${0.5+$},0`},"":{1:($,Y)=>`M.5,0 L.5,1 M0,${0.5-Y} L1,${0.5-Y} M0,${0.5+Y} L1,${0.5+Y}`},"":{1:($,Y)=>`M0,.5 L1,.5 M${0.5-$},0 L${0.5-$},1 M${0.5+$},0 L${0.5+$},1`},"":{1:($,Y)=>`M0,${0.5+Y} L${0.5-$},${0.5+Y} L${0.5-$},1 M1,${0.5+Y} L${0.5+$},${0.5+Y} L${0.5+$},1 M0,${0.5-Y} L${0.5-$},${0.5-Y} L${0.5-$},0 M1,${0.5-Y} L${0.5+$},${0.5-Y} L${0.5+$},0`},"":{1:"M1,0 L0,1"},"":{1:"M0,0 L1,1"},"":{1:"M1,0 L0,1 M0,0 L1,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{1:($,Y)=>`M.5,1 L.5,${0.5+Y/0.15*0.5} C.5,${0.5+Y/0.15*0.5},.5,.5,1,.5`},"":{1:($,Y)=>`M.5,1 L.5,${0.5+Y/0.15*0.5} C.5,${0.5+Y/0.15*0.5},.5,.5,0,.5`},"":{1:($,Y)=>`M.5,0 L.5,${0.5-Y/0.15*0.5} C.5,${0.5-Y/0.15*0.5},.5,.5,0,.5`},"":{1:($,Y)=>`M.5,0 L.5,${0.5-Y/0.15*0.5} C.5,${0.5-Y/0.15*0.5},.5,.5,1,.5`}},A9={"":{d:"M.3,1 L.03,1 L.03,.88 C.03,.82,.06,.78,.11,.73 C.15,.7,.2,.68,.28,.65 L.43,.6 C.49,.58,.53,.56,.56,.53 C.59,.5,.6,.47,.6,.43 L.6,.27 L.4,.27 L.69,.1 L.98,.27 L.78,.27 L.78,.46 C.78,.52,.76,.56,.72,.61 C.68,.66,.63,.67,.56,.7 L.48,.72 C.42,.74,.38,.76,.35,.78 C.32,.8,.31,.84,.31,.88 L.31,1 M.3,.5 L.03,.59 L.03,.09 L.3,.09 L.3,.655",type:0},"":{d:"M.7,.4 L.7,.47 L.2,.47 L.2,.03 L.355,.03 L.355,.4 L.705,.4 M.7,.5 L.86,.5 L.86,.95 L.69,.95 L.44,.66 L.46,.86 L.46,.95 L.3,.95 L.3,.49 L.46,.49 L.71,.78 L.69,.565 L.69,.5",type:0},"":{d:"M.25,.94 C.16,.94,.11,.92,.11,.87 L.11,.53 C.11,.48,.15,.455,.23,.45 L.23,.3 C.23,.25,.26,.22,.31,.19 C.36,.16,.43,.15,.51,.15 C.59,.15,.66,.16,.71,.19 C.77,.22,.79,.26,.79,.3 L.79,.45 C.87,.45,.91,.48,.91,.53 L.91,.87 C.91,.92,.86,.94,.77,.94 L.24,.94 M.53,.2 C.49,.2,.45,.21,.42,.23 C.39,.25,.38,.27,.38,.3 L.38,.45 L.68,.45 L.68,.3 C.68,.27,.67,.25,.64,.23 C.61,.21,.58,.2,.53,.2 M.58,.82 L.58,.66 C.63,.65,.65,.63,.65,.6 C.65,.58,.64,.57,.61,.56 C.58,.55,.56,.54,.52,.54 C.48,.54,.46,.55,.43,.56 C.4,.57,.39,.59,.39,.6 C.39,.63,.41,.64,.46,.66 L.46,.82 L.57,.82",type:0},"":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}};A9[""]=A9[""];A9[""]=A9[""];function LZ($,Y,J,j,Z,K,Q,X){let N=yZ[Y];if(N)return DZ($,N,J,j,Z,K),!0;let z=FZ[Y];if(z)return MZ($,z,J,j,Z,K),!0;let G=BZ[Y];if(G)return bZ($,G,J,j,Z,K,X),!0;let V=A9[Y];return V?(TZ($,V,J,j,Z,K,Q,X),!0):!1}function DZ($,Y,J,j,Z,K){for(let Q=0;Q<Y.length;Q++){let X=Y[Q],N=Z/8,z=K/8;$.fillRect(J+X.x*N,j+X.y*z,X.w*N,X.h*z)}}var L2=new Map;function MZ($,Y,J,j,Z,K){let Q=L2.get(Y);Q||(Q=new Map,L2.set(Y,Q));let X=$.fillStyle;if(typeof X!="string")throw Error(`Unexpected fillStyle type "${X}"`);let N=Q.get(X);if(!N){let z=Y[0].length,G=Y.length,V=$.canvas.ownerDocument.createElement("canvas");V.width=z,V.height=G;let W=G0(V.getContext("2d")),_=new ImageData(z,G),H,U,B,A;if(X.startsWith("#"))H=parseInt(X.slice(1,3),16),U=parseInt(X.slice(3,5),16),B=parseInt(X.slice(5,7),16),A=X.length>7&&parseInt(X.slice(7,9),16)||1;else if(X.startsWith("rgba"))[H,U,B,A]=X.substring(5,X.length-1).split(",").map((k)=>parseFloat(k));else throw Error(`Unexpected fillStyle color format "${X}" when drawing pattern glyph`);for(let k=0;k<G;k++)for(let M=0;M<z;M++)_.data[(k*z+M)*4]=H,_.data[(k*z+M)*4+1]=U,_.data[(k*z+M)*4+2]=B,_.data[(k*z+M)*4+3]=Y[k][M]*(A*255);W.putImageData(_,0,0),N=G0($.createPattern(V,null)),Q.set(X,N)}$.fillStyle=N,$.fillRect(J,j,Z,K)}function bZ($,Y,J,j,Z,K,Q){$.strokeStyle=$.fillStyle;for(let[X,N]of Object.entries(Y)){$.beginPath(),$.lineWidth=Q*Number.parseInt(X);let z;if(typeof N=="function"){let G=0.15/K*Z;z=N(0.15,G)}else z=N;for(let G of z.split(" ")){let V=G[0],W=_4[V];if(!W){console.error(`Could not find drawing instructions for "${V}"`);continue}let _=G.substring(1).split(",");!_[0]||!_[1]||W($,H4(_,Z,K,J,j,!0,Q))}$.stroke(),$.closePath()}}function TZ($,Y,J,j,Z,K,Q,X){let N=new Path2D;N.rect(J,j,Z,K),$.clip(N),$.beginPath();let z=Q/12;$.lineWidth=X*z;for(let G of Y.d.split(" ")){let V=G[0],W=_4[V];if(!W){console.error(`Could not find drawing instructions for "${V}"`);continue}let _=G.substring(1).split(",");!_[0]||!_[1]||W($,H4(_,Z,K,J,j,!1,X,(Y.leftPadding??0)*(z/2),(Y.rightPadding??0)*(z/2)))}Y.type===1?($.strokeStyle=$.fillStyle,$.stroke()):$.fill(),$.closePath()}function D2($,Y,J=0){return Math.max(Math.min($,Y),J)}var _4={C:($,Y)=>$.bezierCurveTo(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),L:($,Y)=>$.lineTo(Y[0],Y[1]),M:($,Y)=>$.moveTo(Y[0],Y[1])};function H4($,Y,J,j,Z,K,Q,X=0,N=0){let z=$.map((G)=>parseFloat(G)||parseInt(G));if(z.length<2)throw Error("Too few arguments for instruction");for(let G=0;G<z.length;G+=2)z[G]*=Y-X*Q-N*Q,K&&z[G]!==0&&(z[G]=D2(Math.round(z[G]+0.5)-0.5,Y,0)),z[G]+=j+X*Q;for(let G=1;G<z.length;G+=2)z[G]*=J,K&&z[G]!==0&&(z[G]=D2(Math.round(z[G]+0.5)-0.5,J,0)),z[G]+=Z;return z}var M2=class{constructor(){this._data={}}set($,Y,J){this._data[$]||(this._data[$]={}),this._data[$][Y]=J}get($,Y){return this._data[$]?this._data[$][Y]:void 0}clear(){this._data={}}},b2=class{constructor(){this._data=new M2}set($,Y,J,j,Z){this._data.get($,Y)||this._data.set($,Y,new M2),this._data.get($,Y).set(J,j,Z)}get($,Y,J,j){return this._data.get($,Y)?.get(J,j)}clear(){this._data.clear()}},I4=class{constructor(){this._tasks=[],this._i=0}enqueue($){this._tasks.push($),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process($){this._idleCallback=void 0;let Y=0,J=0,j=$.timeRemaining(),Z=0;for(;this._i<this._tasks.length;){if(Y=performance.now(),this._tasks[this._i]()||this._i++,Y=Math.max(1,performance.now()-Y),J=Math.max(Y,J),Z=$.timeRemaining(),J*1.5>Z){j-Y<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(j-Y))}ms`),this._start();return}j=Z}this.clear()}},AZ=class extends I4{_requestCallback($){return setTimeout(()=>$(this._createDeadline(16)))}_cancelCallback($){clearTimeout($)}_createDeadline($){let Y=performance.now()+$;return{timeRemaining:()=>Math.max(0,Y-performance.now())}}},PZ=class extends I4{_requestCallback($){return requestIdleCallback($)}_cancelCallback($){cancelIdleCallback($)}},kZ=!G1&&"requestIdleCallback"in window?PZ:AZ,r8=class ${constructor(){this.fg=0,this.bg=0,this.extended=new x4}static toColorRGB(Y){return[Y>>>16&255,Y>>>8&255,Y&255]}static fromColorRGB(Y){return(Y[0]&255)<<16|(Y[1]&255)<<8|Y[2]&255}clone(){let Y=new $;return Y.fg=this.fg,Y.bg=this.bg,Y.extended=this.extended.clone(),Y}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},x4=class ${constructor(Y=0,J=0){this._ext=0,this._urlId=0,this._ext=Y,this._urlId=J}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(Y){this._ext=Y}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(Y){this._ext&=-469762049,this._ext|=Y<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(Y){this._ext&=-67108864,this._ext|=Y&67108863}get urlId(){return this._urlId}set urlId(Y){this._urlId=Y}get underlineVariantOffset(){let Y=(this._ext&3758096384)>>29;return Y<0?Y^4294967288:Y}set underlineVariantOffset(Y){this._ext&=536870911,this._ext|=Y<<29&3758096384}clone(){return new $(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},T2=class ${constructor(Y){this.element=Y,this.next=$.Undefined,this.prev=$.Undefined}};T2.Undefined=new T2(void 0);var wZ=globalThis.performance&&typeof globalThis.performance.now=="function",fZ=class ${static create(Y){return new $(Y)}constructor(Y){this._now=wZ&&Y===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},mZ=!1,A2=!1,SZ=!1,O8;(($)=>{$.None=()=>u0.None;function Y(I){if(SZ){let{onDidAddListener:x}=I,v=Q1.create(),q=0;I.onDidAddListener=()=>{++q===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),v.print()),x?.()}}}function J(I,x){return W(I,()=>{},0,void 0,!0,void 0,x)}$.defer=J;function j(I){return(x,v=null,q)=>{let E=!1,O;return O=I((F)=>{if(!E)return O?O.dispose():E=!0,x.call(v,F)},null,q),E&&O.dispose(),O}}$.once=j;function Z(I,x,v){return G((q,E=null,O)=>I((F)=>q.call(E,x(F)),null,O),v)}$.map=Z;function K(I,x,v){return G((q,E=null,O)=>I((F)=>{x(F),q.call(E,F)},null,O),v)}$.forEach=K;function Q(I,x,v){return G((q,E=null,O)=>I((F)=>x(F)&&q.call(E,F),null,O),v)}$.filter=Q;function X(I){return I}$.signal=X;function N(...I){return(x,v=null,q)=>{let E=z4(...I.map((O)=>O((F)=>x.call(v,F))));return V(E,q)}}$.any=N;function z(I,x,v,q){let E=v;return Z(I,(O)=>(E=x(E,O),E),q)}$.reduce=z;function G(I,x){let v,q={onWillAddFirstListener(){v=I(E.fire,E)},onDidRemoveLastListener(){v?.dispose()}};x||Y(q);let E=new a(q);return x?.add(E),E.event}function V(I,x){return x instanceof Array?x.push(I):x&&x.add(I),I}function W(I,x,v=100,q=!1,E=!1,O,F){let L,w,u,C=0,d,B0={leakWarningThreshold:O,onWillAddFirstListener(){L=I((X0)=>{C++,w=x(w,X0),q&&!u&&(c.fire(w),w=void 0),d=()=>{let l=w;w=void 0,u=void 0,(!q||C>1)&&c.fire(l),C=0},typeof v=="number"?(clearTimeout(u),u=setTimeout(d,v)):u===void 0&&(u=0,queueMicrotask(d))})},onWillRemoveListener(){E&&C>0&&d?.()},onDidRemoveLastListener(){d=void 0,L.dispose()}};F||Y(B0);let c=new a(B0);return F?.add(c),c.event}$.debounce=W;function _(I,x=0,v){return $.debounce(I,(q,E)=>q?(q.push(E),q):[E],x,void 0,!0,void 0,v)}$.accumulate=_;function H(I,x=(q,E)=>q===E,v){let q=!0,E;return Q(I,(O)=>{let F=q||!x(O,E);return q=!1,E=O,F},v)}$.latch=H;function U(I,x,v){return[$.filter(I,x,v),$.filter(I,(q)=>!x(q),v)]}$.split=U;function B(I,x=!1,v=[],q){let E=v.slice(),O=I((w)=>{E?E.push(w):L.fire(w)});q&&q.add(O);let F=()=>{E?.forEach((w)=>L.fire(w)),E=null},L=new a({onWillAddFirstListener(){O||(O=I((w)=>L.fire(w)),q&&q.add(O))},onDidAddFirstListener(){E&&(x?setTimeout(F):F())},onDidRemoveLastListener(){O&&O.dispose(),O=null}});return q&&q.add(L),L.event}$.buffer=B;function A(I,x){return(v,q,E)=>{let O=x(new M);return I(function(F){let L=O.evaluate(F);L!==k&&v.call(q,L)},void 0,E)}}$.chain=A;let k=Symbol("HaltChainable");class M{constructor(){this.steps=[]}map(I){return this.steps.push(I),this}forEach(I){return this.steps.push((x)=>(I(x),x)),this}filter(I){return this.steps.push((x)=>I(x)?x:k),this}reduce(I,x){let v=x;return this.steps.push((q)=>(v=I(v,q),v)),this}latch(I=(x,v)=>x===v){let x=!0,v;return this.steps.push((q)=>{let E=x||!I(q,v);return x=!1,v=q,E?q:k}),this}evaluate(I){for(let x of this.steps)if(I=x(I),I===k)break;return I}}function y(I,x,v=(q)=>q){let q=(...L)=>F.fire(v(...L)),E=()=>I.on(x,q),O=()=>I.removeListener(x,q),F=new a({onWillAddFirstListener:E,onDidRemoveLastListener:O});return F.event}$.fromNodeEventEmitter=y;function b(I,x,v=(q)=>q){let q=(...L)=>F.fire(v(...L)),E=()=>I.addEventListener(x,q),O=()=>I.removeEventListener(x,q),F=new a({onWillAddFirstListener:E,onDidRemoveLastListener:O});return F.event}$.fromDOMEventEmitter=b;function P(I){return new Promise((x)=>j(I)(x))}$.toPromise=P;function p(I){let x=new a;return I.then((v)=>{x.fire(v)},()=>{x.fire(void 0)}).finally(()=>{x.dispose()}),x.event}$.fromPromise=p;function o(I,x){return I((v)=>x.fire(v))}$.forward=o;function Q0(I,x,v){return x(v),I((q)=>x(q))}$.runAndSubscribe=Q0;class b0{constructor(I,x){this._observable=I,this._counter=0,this._hasChanged=!1;let v={onWillAddFirstListener:()=>{I.addObserver(this)},onDidRemoveLastListener:()=>{I.removeObserver(this)}};x||Y(v),this.emitter=new a(v),x&&x.add(this.emitter)}beginUpdate(I){this._counter++}handlePossibleChange(I){}handleChange(I,x){this._hasChanged=!0}endUpdate(I){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function f(I,x){return new b0(I,x).emitter.event}$.fromObservable=f;function c0(I){return(x,v,q)=>{let E=0,O=!1,F={beginUpdate(){E++},endUpdate(){E--,E===0&&(I.reportChanges(),O&&(O=!1,x.call(v)))},handlePossibleChange(){},handleChange(){O=!0}};I.addObserver(F),I.reportChanges();let L={dispose(){I.removeObserver(F)}};return q instanceof t8?q.add(L):Array.isArray(q)&&q.push(L),L}}$.fromObservableLight=c0})(O8||={});var K1=class ${constructor(Y){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${Y}_${$._idPool++}`,$.all.add(this)}start(Y){this._stopWatch=new fZ,this.listenerCount=Y}stop(){if(this._stopWatch){let Y=this._stopWatch.elapsed();this.durations.push(Y),this.elapsedOverall+=Y,this.invocationCount+=1,this._stopWatch=void 0}}};K1.all=new Set,K1._idPool=0;var gZ=K1,P2=-1,U4=class ${constructor(Y,J,j=($._idPool++).toString(16).padStart(3,"0")){this._errorHandler=Y,this.threshold=J,this.name=j,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(Y,J){let j=this.threshold;if(j<=0||J<j)return;this._stacks||(this._stacks=new Map);let Z=this._stacks.get(Y.value)||0;if(this._stacks.set(Y.value,Z+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=j*0.5;let[K,Q]=this.getMostFrequentStack(),X=`[${this.name}] potential listener LEAK detected, having ${J} listeners already. MOST frequent listener (${Q}):`;console.warn(X),console.warn(K);let N=new CZ(X,K);this._errorHandler(N)}return()=>{let K=this._stacks.get(Y.value)||0;this._stacks.set(Y.value,K-1)}}getMostFrequentStack(){if(!this._stacks)return;let Y,J=0;for(let[j,Z]of this._stacks)(!Y||J<Z)&&(Y=[j,Z],J=Z);return Y}};U4._idPool=1;var pZ=U4,Q1=class ${constructor(Y){this.value=Y}static create(){let Y=Error();return new $(Y.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},CZ=class extends Error{constructor($,Y){super($),this.name="ListenerLeakError",this.stack=Y}},hZ=class extends Error{constructor($,Y){super($),this.name="ListenerRefusalError",this.stack=Y}},dZ=0,U7=class{constructor($){this.value=$,this.id=dZ++}},uZ=2,cZ=($,Y)=>{if($ instanceof U7)Y($);else for(let J=0;J<$.length;J++){let j=$[J];j&&Y(j)}},O7;if(mZ){let $=[];setInterval(()=>{$.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn($.join(`
`)),$.length=0)},3000),O7=new FinalizationRegistry((Y)=>{typeof Y=="string"&&$.push(Y)})}var a=class{constructor($){this._size=0,this._options=$,this._leakageMon=P2>0||this._options?.leakWarningThreshold?new pZ($?.onListenerError??x7,this._options?.leakWarningThreshold??P2):void 0,this._perfMon=this._options?._profName?new gZ(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(A2){let $=this._listeners;queueMicrotask(()=>{cZ($,(Y)=>Y.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=($,Y,J)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let X=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(X);let N=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],z=new hZ(`${X}. HINT: Stack shows most frequent listener (${N[1]}-times)`,N[0]);return(this._options?.onListenerError||x7)(z),u0.None}if(this._disposed)return u0.None;Y&&($=$.bind(Y));let j=new U7($),Z,K;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*0.2)&&(j.stack=Q1.create(),Z=this._leakageMon.check(j.stack,this._size+1)),A2&&(j.stack=K??Q1.create()),this._listeners?this._listeners instanceof U7?(this._deliveryQueue??=new lZ,this._listeners=[this._listeners,j]):this._listeners.push(j):(this._options?.onWillAddFirstListener?.(this),this._listeners=j,this._options?.onDidAddFirstListener?.(this)),this._size++;let Q=M0(()=>{O7?.unregister(Q),Z?.(),this._removeListener(j)});if(J instanceof t8?J.add(Q):Array.isArray(J)&&J.push(Q),O7){let X=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),N=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(X);O7.register(Q,N?.[2]??X,Q)}return Q},this._event}_removeListener($){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let Y=this._listeners,J=Y.indexOf($);if(J===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,Y[J]=void 0;let j=this._deliveryQueue.current===this;if(this._size*uZ<=Y.length){let Z=0;for(let K=0;K<Y.length;K++)Y[K]?Y[Z++]=Y[K]:j&&(this._deliveryQueue.end--,Z<this._deliveryQueue.i&&this._deliveryQueue.i--);Y.length=Z}}_deliver($,Y){if(!$)return;let J=this._options?.onListenerError||x7;if(!J){$.value(Y);return}try{$.value(Y)}catch(j){J(j)}}_deliverQueue($){let Y=$.current._listeners;for(;$.i<$.end;)this._deliver(Y[$.i++],$.value);$.reset()}fire($){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof U7)this._deliver(this._listeners,$);else{let Y=this._deliveryQueue;Y.enqueue(this,$,this._listeners.length),this._deliverQueue(Y)}this._perfMon?.stop()}hasListeners(){return this._size>0}},lZ=class{constructor(){this.i=-1,this.end=0}enqueue($,Y,J){this.i=0,this.end=J,this.current=$,this.value=Y}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},k2={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},B9=2,L9,P8=class ${constructor(Y,J,j){this._document=Y,this._config=J,this._unicodeService=j,this._didWarmUp=!1,this._cacheMap=new b2,this._cacheMapCombined=new b2,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new r8,this._textureSize=512,this._onAddTextureAtlasCanvas=new a,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new a,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=O4(Y,this._config.deviceCellWidth*4+B9*2,this._config.deviceCellHeight+B9*2),this._tmpCtx=G0(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}get pages(){return this._pages}dispose(){this._tmpCanvas.remove();for(let Y of this.pages)Y.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){let Y=new kZ;for(let J=33;J<126;J++)Y.enqueue(()=>{if(!this._cacheMap.get(J,0,0,0)){let j=this._drawToCache(J,0,0,0,!1,void 0);this._cacheMap.set(J,0,0,0,j)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(!(this._pages[0].currentRow.x===0&&this._pages[0].currentRow.y===0)){for(let Y of this._pages)Y.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if($.maxAtlasPages&&this._pages.length>=Math.max(4,$.maxAtlasPages)){let J=this._pages.filter((z)=>z.canvas.width*2<=($.maxTextureSize||4096)).sort((z,G)=>G.canvas.width!==z.canvas.width?G.canvas.width-z.canvas.width:G.percentageUsed-z.percentageUsed),j=-1,Z=0;for(let z=0;z<J.length;z++)if(J[z].canvas.width!==Z)j=z,Z=J[z].canvas.width;else if(z-j===3)break;let K=J.slice(j,j+4),Q=K.map((z)=>z.glyphs[0].texturePage).sort((z,G)=>z>G?1:-1),X=this.pages.length-K.length,N=this._mergePages(K,X);N.version++;for(let z=Q.length-1;z>=0;z--)this._deletePage(Q[z]);this.pages.push(N),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(N.canvas)}let Y=new l6(this._document,this._textureSize);return this._pages.push(Y),this._activePages.push(Y),this._onAddTextureAtlasCanvas.fire(Y.canvas),Y}_mergePages(Y,J){let j=Y[0].canvas.width*2,Z=new l6(this._document,j,Y);for(let[K,Q]of Y.entries()){let X=K*Q.canvas.width%j,N=Math.floor(K/2)*Q.canvas.height;Z.ctx.drawImage(Q.canvas,X,N);for(let G of Q.glyphs)G.texturePage=J,G.sizeClipSpace.x=G.size.x/j,G.sizeClipSpace.y=G.size.y/j,G.texturePosition.x+=X,G.texturePosition.y+=N,G.texturePositionClipSpace.x=G.texturePosition.x/j,G.texturePositionClipSpace.y=G.texturePosition.y/j;this._onRemoveTextureAtlasCanvas.fire(Q.canvas);let z=this._activePages.indexOf(Q);z!==-1&&this._activePages.splice(z,1)}return Z}_deletePage(Y){this._pages.splice(Y,1);for(let J=Y;J<this._pages.length;J++){let j=this._pages[J];for(let Z of j.glyphs)Z.texturePage--;j.version++}}getRasterizedGlyphCombinedChar(Y,J,j,Z,K,Q){return this._getFromCacheMap(this._cacheMapCombined,Y,J,j,Z,K,Q)}getRasterizedGlyph(Y,J,j,Z,K,Q){return this._getFromCacheMap(this._cacheMap,Y,J,j,Z,K,Q)}_getFromCacheMap(Y,J,j,Z,K,Q,X){return L9=Y.get(J,j,Z,K),L9||(L9=this._drawToCache(J,j,Z,K,Q,X),Y.set(J,j,Z,K,L9)),L9}_getColorFromAnsiIndex(Y){if(Y>=this._config.colors.ansi.length)throw Error("No color found for idx "+Y);return this._config.colors.ansi[Y]}_getBackgroundColor(Y,J,j,Z){if(this._config.allowTransparency)return a0;let K;switch(Y){case 16777216:case 33554432:K=this._getColorFromAnsiIndex(J);break;case 50331648:let Q=r8.toColorRGB(J);K=w0.toColor(Q[0],Q[1],Q[2]);break;case 0:default:j?K=b9.opaque(this._config.colors.foreground):K=this._config.colors.background;break}return this._config.allowTransparency||(K=b9.opaque(K)),K}_getForegroundColor(Y,J,j,Z,K,Q,X,N,z,G){let V=this._getMinimumContrastColor(Y,J,j,Z,K,Q,X,z,N,G);if(V)return V;let W;switch(K){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&z&&Q<8&&(Q+=8),W=this._getColorFromAnsiIndex(Q);break;case 50331648:let _=r8.toColorRGB(Q);W=w0.toColor(_[0],_[1],_[2]);break;case 0:default:X?W=this._config.colors.background:W=this._config.colors.foreground}return this._config.allowTransparency&&(W=b9.opaque(W)),N&&(W=b9.multiplyOpacity(W,RZ)),W}_resolveBackgroundRgba(Y,J,j){switch(Y){case 16777216:case 33554432:return this._getColorFromAnsiIndex(J).rgba;case 50331648:return J<<8;case 0:default:return j?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(Y,J,j,Z){switch(Y){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&Z&&J<8&&(J+=8),this._getColorFromAnsiIndex(J).rgba;case 50331648:return J<<8;case 0:default:return j?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(Y,J,j,Z,K,Q,X,N,z,G){if(this._config.minimumContrastRatio===1||G)return;let V=this._getContrastCache(z),W=V.getColor(Y,Z);if(W!==void 0)return W||void 0;let _=this._resolveBackgroundRgba(J,j,X),H=this._resolveForegroundRgba(K,Q,X,N),U=u8.ensureContrastRatio(_,H,this._config.minimumContrastRatio/(z?2:1));if(!U){V.setColor(Y,Z,null);return}let B=w0.toColor(U>>24&255,U>>16&255,U>>8&255);return V.setColor(Y,Z,B),B}_getContrastCache(Y){return Y?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(Y,J,j,Z,K,Q){let X=typeof Y=="number"?String.fromCharCode(Y):Y;Q&&this._tmpCanvas.parentElement!==Q&&(this._tmpCanvas.style.display="none",Q.append(this._tmpCanvas));let N=Math.min(this._config.deviceCellWidth*Math.max(X.length,2)+B9*2,this._config.deviceMaxTextureSize);this._tmpCanvas.width<N&&(this._tmpCanvas.width=N);let z=Math.min(this._config.deviceCellHeight+B9*4,this._textureSize);if(this._tmpCanvas.height<z&&(this._tmpCanvas.height=z),this._tmpCtx.save(),this._workAttributeData.fg=j,this._workAttributeData.bg=J,this._workAttributeData.extended.ext=Z,!!this._workAttributeData.isInvisible())return k2;let G=!!this._workAttributeData.isBold(),V=!!this._workAttributeData.isInverse(),W=!!this._workAttributeData.isDim(),_=!!this._workAttributeData.isItalic(),H=!!this._workAttributeData.isUnderline(),U=!!this._workAttributeData.isStrikethrough(),B=!!this._workAttributeData.isOverline(),A=this._workAttributeData.getFgColor(),k=this._workAttributeData.getFgColorMode(),M=this._workAttributeData.getBgColor(),y=this._workAttributeData.getBgColorMode();if(V){let L=A;A=M,M=L;let w=k;k=y,y=w}let b=this._getBackgroundColor(y,M,V,W);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=b.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let P=G?this._config.fontWeightBold:this._config.fontWeight,p=_?"italic":"";this._tmpCtx.font=`${p} ${P} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=W4;let o=X.length===1&&_1(X.charCodeAt(0)),Q0=X.length===1&&HZ(X.charCodeAt(0)),b0=this._getForegroundColor(J,y,M,j,k,A,V,W,G,G4(X.charCodeAt(0)));this._tmpCtx.fillStyle=b0.css;let f=Q0?0:B9*2,c0=!1;this._config.customGlyphs!==!1&&(c0=LZ(this._tmpCtx,X,f,f,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let I=!o,x;if(typeof Y=="number"?x=this._unicodeService.wcwidth(Y):x=this._unicodeService.getStringCellWidth(Y),H){this._tmpCtx.save();let L=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),w=L%2===1?0.5:0;if(this._tmpCtx.lineWidth=L,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())I=!1,this._tmpCtx.strokeStyle=`rgb(${r8.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{I=!1;let X0=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&X0<8&&(X0+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(X0).css}this._tmpCtx.beginPath();let u=f,C=Math.ceil(f+this._config.deviceCharHeight)-w-(K?L*2:0),d=C+L,B0=C+L*2,c=this._workAttributeData.getUnderlineVariantOffset();for(let X0=0;X0<x;X0++){this._tmpCtx.save();let l=u+X0*this._config.deviceCellWidth,$0=u+(X0+1)*this._config.deviceCellWidth,v8=l+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(l,C),this._tmpCtx.lineTo($0,C),this._tmpCtx.moveTo(l,B0),this._tmpCtx.lineTo($0,B0);break;case 3:let t0=L<=1?B0:Math.ceil(f+this._config.deviceCharHeight-L/2)-w,S0=L<=1?C:Math.ceil(f+this._config.deviceCharHeight+L/2)-w,h=new Path2D;h.rect(l,C,this._config.deviceCellWidth,B0-C),this._tmpCtx.clip(h),this._tmpCtx.moveTo(l-this._config.deviceCellWidth/2,d),this._tmpCtx.bezierCurveTo(l-this._config.deviceCellWidth/2,S0,l,S0,l,d),this._tmpCtx.bezierCurveTo(l,t0,v8,t0,v8,d),this._tmpCtx.bezierCurveTo(v8,S0,$0,S0,$0,d),this._tmpCtx.bezierCurveTo($0,t0,$0+this._config.deviceCellWidth/2,t0,$0+this._config.deviceCellWidth/2,d);break;case 4:let R8=c===0?0:c>=L?L*2-c:L-c;!(c>=L)===!1||R8===0?(this._tmpCtx.setLineDash([Math.round(L),Math.round(L)]),this._tmpCtx.moveTo(l+R8,C),this._tmpCtx.lineTo($0,C)):(this._tmpCtx.setLineDash([Math.round(L),Math.round(L)]),this._tmpCtx.moveTo(l,C),this._tmpCtx.lineTo(l+R8,C),this._tmpCtx.moveTo(l+R8+L,C),this._tmpCtx.lineTo($0,C)),c=EZ($0-l,L,c);break;case 5:let w4=0.6,f4=0.3,M7=$0-l,R1=Math.floor(w4*M7),y1=Math.floor(f4*M7),m4=M7-R1-y1;this._tmpCtx.setLineDash([R1,y1,m4]),this._tmpCtx.moveTo(l,C),this._tmpCtx.lineTo($0,C);break;case 1:default:this._tmpCtx.moveTo(l,C),this._tmpCtx.lineTo($0,C);break}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!c0&&this._config.fontSize>=12&&!this._config.allowTransparency&&X!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let X0=this._tmpCtx.measureText(X);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in X0&&X0.actualBoundingBoxDescent>0){this._tmpCtx.save();let l=new Path2D;l.rect(u,C-Math.ceil(L/2),this._config.deviceCellWidth*x,B0-C+Math.ceil(L/2)),this._tmpCtx.clip(l),this._tmpCtx.lineWidth=this._config.devicePixelRatio*3,this._tmpCtx.strokeStyle=b.css,this._tmpCtx.strokeText(X,f,f+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(B){let L=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),w=L%2===1?0.5:0;this._tmpCtx.lineWidth=L,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(f,f+w),this._tmpCtx.lineTo(f+this._config.deviceCharWidth*x,f+w),this._tmpCtx.stroke()}if(c0||this._tmpCtx.fillText(X,f,f+this._config.deviceCharHeight),X==="_"&&!this._config.allowTransparency){let L=s6(this._tmpCtx.getImageData(f,f,this._config.deviceCellWidth,this._config.deviceCellHeight),b,b0,I);if(L)for(let w=1;w<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=b.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(X,f,f+this._config.deviceCharHeight-w),L=s6(this._tmpCtx.getImageData(f,f,this._config.deviceCellWidth,this._config.deviceCellHeight),b,b0,I),!!L);w++);}if(U){let L=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),w=this._tmpCtx.lineWidth%2===1?0.5:0;this._tmpCtx.lineWidth=L,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(f,f+Math.floor(this._config.deviceCharHeight/2)-w),this._tmpCtx.lineTo(f+this._config.deviceCharWidth*x,f+Math.floor(this._config.deviceCharHeight/2)-w),this._tmpCtx.stroke()}this._tmpCtx.restore();let v=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),q;if(this._config.allowTransparency?q=sZ(v):q=s6(v,b,b0,I),q)return k2;let E=this._findGlyphBoundingBox(v,this._workBoundingBox,N,Q0,c0,f),O,F;for(;;){if(this._activePages.length===0){let L=this._createNewPage();O=L,F=L.currentRow,F.height=E.size.y;break}O=this._activePages[this._activePages.length-1],F=O.currentRow;for(let L of this._activePages)E.size.y<=L.currentRow.height&&(O=L,F=L.currentRow);for(let L=this._activePages.length-1;L>=0;L--)for(let w of this._activePages[L].fixedRows)w.height<=F.height&&E.size.y<=w.height&&(O=this._activePages[L],F=w);if(E.size.x>this._textureSize){this._overflowSizePage||(this._overflowSizePage=new l6(this._document,this._config.deviceMaxTextureSize),this.pages.push(this._overflowSizePage),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(this._overflowSizePage.canvas)),O=this._overflowSizePage,F=this._overflowSizePage.currentRow,F.x+E.size.x>=O.canvas.width&&(F.x=0,F.y+=F.height,F.height=0);break}if(F.y+E.size.y>=O.canvas.height||F.height>E.size.y+2){let L=!1;if(O.currentRow.y+O.currentRow.height+E.size.y>=O.canvas.height){let w;for(let u of this._activePages)if(u.currentRow.y+u.currentRow.height+E.size.y<u.canvas.height){w=u;break}if(w)O=w;else if($.maxAtlasPages&&this._pages.length>=$.maxAtlasPages&&F.y+E.size.y<=O.canvas.height&&F.height>=E.size.y&&F.x+E.size.x<=O.canvas.width)L=!0;else{let u=this._createNewPage();O=u,F=u.currentRow,F.height=E.size.y,L=!0}}L||(O.currentRow.height>0&&O.fixedRows.push(O.currentRow),F={x:0,y:O.currentRow.y+O.currentRow.height,height:E.size.y},O.fixedRows.push(F),O.currentRow={x:0,y:F.y+F.height,height:0})}if(F.x+E.size.x<=O.canvas.width)break;F===O.currentRow?(F.x=0,F.y+=F.height,F.height=0):O.fixedRows.splice(O.fixedRows.indexOf(F),1)}return E.texturePage=this._pages.indexOf(O),E.texturePosition.x=F.x,E.texturePosition.y=F.y,E.texturePositionClipSpace.x=F.x/O.canvas.width,E.texturePositionClipSpace.y=F.y/O.canvas.height,E.sizeClipSpace.x/=O.canvas.width,E.sizeClipSpace.y/=O.canvas.height,F.height=Math.max(F.height,E.size.y),F.x+=E.size.x,O.ctx.putImageData(v,E.texturePosition.x-this._workBoundingBox.left,E.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,E.size.x,E.size.y),O.addGlyph(E),O.version++,E}_findGlyphBoundingBox(Y,J,j,Z,K,Q){J.top=0;let X=Z?this._config.deviceCellHeight:this._tmpCanvas.height,N=Z?this._config.deviceCellWidth:j,z=!1;for(let G=0;G<X;G++){for(let V=0;V<N;V++){let W=G*this._tmpCanvas.width*4+V*4+3;if(Y.data[W]!==0){J.top=G,z=!0;break}}if(z)break}J.left=0,z=!1;for(let G=0;G<Q+N;G++){for(let V=0;V<X;V++){let W=V*this._tmpCanvas.width*4+G*4+3;if(Y.data[W]!==0){J.left=G,z=!0;break}}if(z)break}J.right=N,z=!1;for(let G=Q+N-1;G>=Q;G--){for(let V=0;V<X;V++){let W=V*this._tmpCanvas.width*4+G*4+3;if(Y.data[W]!==0){J.right=G,z=!0;break}}if(z)break}J.bottom=X,z=!1;for(let G=X-1;G>=0;G--){for(let V=0;V<N;V++){let W=G*this._tmpCanvas.width*4+V*4+3;if(Y.data[W]!==0){J.bottom=G,z=!0;break}}if(z)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:J.right-J.left+1,y:J.bottom-J.top+1},sizeClipSpace:{x:J.right-J.left+1,y:J.bottom-J.top+1},offset:{x:-J.left+Q+(Z||K?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-J.top+Q+(Z||K?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}},l6=class{constructor($,Y,J){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],J)for(let j of J)this._glyphs.push(...j.glyphs),this._usedPixels+=j._usedPixels;this.canvas=O4($,Y,Y),this.ctx=G0(this.canvas.getContext("2d",{alpha:!0}))}get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph($){this._glyphs.push($),this._usedPixels+=$.size.x*$.size.y}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}};function s6($,Y,J,j){let Z=Y.rgba>>>24,K=Y.rgba>>>16&255,Q=Y.rgba>>>8&255,X=J.rgba>>>24,N=J.rgba>>>16&255,z=J.rgba>>>8&255,G=Math.floor((Math.abs(Z-X)+Math.abs(K-N)+Math.abs(Q-z))/12),V=!0;for(let W=0;W<$.data.length;W+=4)$.data[W]===Z&&$.data[W+1]===K&&$.data[W+2]===Q||j&&Math.abs($.data[W]-Z)+Math.abs($.data[W+1]-K)+Math.abs($.data[W+2]-Q)<G?$.data[W+3]=0:V=!1;return V}function sZ($){for(let Y=0;Y<$.data.length;Y+=4)if($.data[Y+3]>0)return!1;return!0}function O4($,Y,J){let j=$.createElement("canvas");return j.width=Y,j.height=J,j}function oZ($,Y,J,j,Z,K,Q,X){let N={foreground:K.foreground,background:K.background,cursor:a0,cursorAccent:a0,selectionForeground:a0,selectionBackgroundTransparent:a0,selectionBackgroundOpaque:a0,selectionInactiveBackgroundTransparent:a0,selectionInactiveBackgroundOpaque:a0,overviewRulerBorder:a0,scrollbarSliderBackground:a0,scrollbarSliderHoverBackground:a0,scrollbarSliderActiveBackground:a0,ansi:K.ansi.slice(),contrastCache:K.contrastCache,halfContrastCache:K.halfContrastCache};return{customGlyphs:Z.customGlyphs,devicePixelRatio:Q,deviceMaxTextureSize:X,letterSpacing:Z.letterSpacing,lineHeight:Z.lineHeight,deviceCellWidth:$,deviceCellHeight:Y,deviceCharWidth:J,deviceCharHeight:j,fontFamily:Z.fontFamily,fontSize:Z.fontSize,fontWeight:Z.fontWeight,fontWeightBold:Z.fontWeightBold,allowTransparency:Z.allowTransparency,drawBoldTextInBrightColors:Z.drawBoldTextInBrightColors,minimumContrastRatio:Z.minimumContrastRatio,colors:N}}function w2($,Y){for(let J=0;J<$.colors.ansi.length;J++)if($.colors.ansi[J].rgba!==Y.colors.ansi[J].rgba)return!1;return $.devicePixelRatio===Y.devicePixelRatio&&$.customGlyphs===Y.customGlyphs&&$.lineHeight===Y.lineHeight&&$.letterSpacing===Y.letterSpacing&&$.fontFamily===Y.fontFamily&&$.fontSize===Y.fontSize&&$.fontWeight===Y.fontWeight&&$.fontWeightBold===Y.fontWeightBold&&$.allowTransparency===Y.allowTransparency&&$.deviceCharWidth===Y.deviceCharWidth&&$.deviceCharHeight===Y.deviceCharHeight&&$.drawBoldTextInBrightColors===Y.drawBoldTextInBrightColors&&$.minimumContrastRatio===Y.minimumContrastRatio&&$.colors.foreground.rgba===Y.colors.foreground.rgba&&$.colors.background.rgba===Y.colors.background.rgba}function aZ($){return($&50331648)===16777216||($&50331648)===33554432}var n0=[];function q4($,Y,J,j,Z,K,Q,X,N){let z=oZ(j,Z,K,Q,Y,J,X,N);for(let W=0;W<n0.length;W++){let _=n0[W],H=_.ownedBy.indexOf($);if(H>=0){if(w2(_.config,z))return _.atlas;_.ownedBy.length===1?(_.atlas.dispose(),n0.splice(W,1)):_.ownedBy.splice(H,1);break}}for(let W=0;W<n0.length;W++){let _=n0[W];if(w2(_.config,z))return _.ownedBy.push($),_.atlas}let G=$._core,V={atlas:new P8(document,z,G.unicodeService),config:z,ownedBy:[$]};return n0.push(V),V.atlas}function f2($){for(let Y=0;Y<n0.length;Y++){let J=n0[Y].ownedBy.indexOf($);if(J!==-1){n0[Y].ownedBy.length===1?(n0[Y].atlas.dispose(),n0.splice(Y,1)):n0[Y].ownedBy.splice(J,1);break}}}var H7=600,nZ=class{constructor($,Y){this._renderCallback=$,this._coreBrowserService=Y,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval($=H7){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let Y=H7-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,Y>0){this._restartInterval(Y);return}}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let Y=H7-(Date.now()-this._animationTimeRestarted);this._animationTimeRestarted=void 0,this._restartInterval(Y);return}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},H7)},$)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}};function m2($,Y,J){let j=new Y.ResizeObserver((Z)=>{let K=Z.find((N)=>N.target===$);if(!K)return;if(!("devicePixelContentBoxSize"in K)){j?.disconnect(),j=void 0;return}let Q=K.devicePixelContentBoxSize[0].inlineSize,X=K.devicePixelContentBoxSize[0].blockSize;Q>0&&X>0&&J(Q,X)});try{j.observe($,{box:["device-pixel-content-box"]})}catch{j.disconnect(),j=void 0}return M0(()=>j?.disconnect())}function rZ($){return $>65535?($-=65536,String.fromCharCode(($>>10)+55296)+String.fromCharCode($%1024+56320)):String.fromCharCode($)}var S2=class $ extends r8{constructor(){super(...arguments);this.content=0,this.fg=0,this.bg=0,this.extended=new x4,this.combinedData=""}static fromCharData(Y){let J=new $;return J.setFromCharData(Y),J}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?rZ(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(Y){this.fg=Y[0],this.bg=0;let J=!1;if(Y[1].length>2)J=!0;else if(Y[1].length===2){let j=Y[1].charCodeAt(0);if(55296<=j&&j<=56319){let Z=Y[1].charCodeAt(1);56320<=Z&&Z<=57343?this.content=(j-55296)*1024+Z-56320+65536|Y[2]<<22:J=!0}else J=!0}else this.content=Y[1].charCodeAt(0)|Y[2]<<22;J&&(this.combinedData=Y[1],this.content=2097152|Y[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},E4=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]);function v4($,Y,J){let j=G0($.createProgram());if($.attachShader(j,G0(g2($,$.VERTEX_SHADER,Y))),$.attachShader(j,G0(g2($,$.FRAGMENT_SHADER,J))),$.linkProgram(j),$.getProgramParameter(j,$.LINK_STATUS))return j;console.error($.getProgramInfoLog(j)),$.deleteProgram(j)}function g2($,Y,J){let j=G0($.createShader(Y));if($.shaderSource(j,J),$.compileShader(j),$.getShaderParameter(j,$.COMPILE_STATUS))return j;console.error($.getShaderInfoLog(j)),$.deleteShader(j)}function iZ($,Y){let J=Math.min($.length*2,Y),j=new Float32Array(J);for(let Z=0;Z<$.length;Z++)j[Z]=$[Z];return j}var tZ=class{constructor($){this.texture=$,this.version=-1}},eZ=`#version 300 es
layout (location = 0) in vec2 a_unitquad;
layout (location = 1) in vec2 a_cellpos;
layout (location = 2) in vec2 a_offset;
layout (location = 3) in vec2 a_size;
layout (location = 4) in float a_texpage;
layout (location = 5) in vec2 a_texcoord;
layout (location = 6) in vec2 a_texsize;

uniform mat4 u_projection;
uniform vec2 u_resolution;

out vec2 v_texcoord;
flat out int v_texpage;

void main() {
  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_texpage = int(a_texpage);
  v_texcoord = a_texcoord + a_unitquad * a_texsize;
}`;function $K($){let Y="";for(let J=1;J<$;J++)Y+=` else if (v_texpage == ${J}) { outColor = texture(u_texture[${J}], v_texcoord); }`;return`#version 300 es
precision lowp float;

in vec2 v_texcoord;
flat in int v_texpage;

uniform sampler2D u_texture[${$}];

out vec4 outColor;

void main() {
  if (v_texpage == 0) {
    outColor = texture(u_texture[0], v_texcoord);
  } ${Y}
}`}var k8=11,n8=k8*Float32Array.BYTES_PER_ELEMENT,YK=2,Z0=0,i,o6=0,D9=0,JK=class extends u0{constructor($,Y,J,j){super();this._terminal=$,this._gl=Y,this._dimensions=J,this._optionsService=j,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};let Z=this._gl;P8.maxAtlasPages===void 0&&(P8.maxAtlasPages=Math.min(32,G0(Z.getParameter(Z.MAX_TEXTURE_IMAGE_UNITS))),P8.maxTextureSize=G0(Z.getParameter(Z.MAX_TEXTURE_SIZE))),this._program=G0(v4(Z,eZ,$K(P8.maxAtlasPages))),this._register(M0(()=>Z.deleteProgram(this._program))),this._projectionLocation=G0(Z.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=G0(Z.getUniformLocation(this._program,"u_resolution")),this._textureLocation=G0(Z.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=Z.createVertexArray(),Z.bindVertexArray(this._vertexArrayObject);let K=new Float32Array([0,0,1,0,0,1,1,1]),Q=Z.createBuffer();this._register(M0(()=>Z.deleteBuffer(Q))),Z.bindBuffer(Z.ARRAY_BUFFER,Q),Z.bufferData(Z.ARRAY_BUFFER,K,Z.STATIC_DRAW),Z.enableVertexAttribArray(0),Z.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);let X=new Uint8Array([0,1,2,3]),N=Z.createBuffer();this._register(M0(()=>Z.deleteBuffer(N))),Z.bindBuffer(Z.ELEMENT_ARRAY_BUFFER,N),Z.bufferData(Z.ELEMENT_ARRAY_BUFFER,X,Z.STATIC_DRAW),this._attributesBuffer=G0(Z.createBuffer()),this._register(M0(()=>Z.deleteBuffer(this._attributesBuffer))),Z.bindBuffer(Z.ARRAY_BUFFER,this._attributesBuffer),Z.enableVertexAttribArray(2),Z.vertexAttribPointer(2,2,Z.FLOAT,!1,n8,0),Z.vertexAttribDivisor(2,1),Z.enableVertexAttribArray(3),Z.vertexAttribPointer(3,2,Z.FLOAT,!1,n8,2*Float32Array.BYTES_PER_ELEMENT),Z.vertexAttribDivisor(3,1),Z.enableVertexAttribArray(4),Z.vertexAttribPointer(4,1,Z.FLOAT,!1,n8,4*Float32Array.BYTES_PER_ELEMENT),Z.vertexAttribDivisor(4,1),Z.enableVertexAttribArray(5),Z.vertexAttribPointer(5,2,Z.FLOAT,!1,n8,5*Float32Array.BYTES_PER_ELEMENT),Z.vertexAttribDivisor(5,1),Z.enableVertexAttribArray(6),Z.vertexAttribPointer(6,2,Z.FLOAT,!1,n8,7*Float32Array.BYTES_PER_ELEMENT),Z.vertexAttribDivisor(6,1),Z.enableVertexAttribArray(1),Z.vertexAttribPointer(1,2,Z.FLOAT,!1,n8,9*Float32Array.BYTES_PER_ELEMENT),Z.vertexAttribDivisor(1,1),Z.useProgram(this._program);let z=new Int32Array(P8.maxAtlasPages);for(let G=0;G<P8.maxAtlasPages;G++)z[G]=G;Z.uniform1iv(this._textureLocation,z),Z.uniformMatrix4fv(this._projectionLocation,!1,E4),this._atlasTextures=[];for(let G=0;G<P8.maxAtlasPages;G++){let V=new tZ(G0(Z.createTexture()));this._register(M0(()=>Z.deleteTexture(V.texture))),Z.activeTexture(Z.TEXTURE0+G),Z.bindTexture(Z.TEXTURE_2D,V.texture),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,1,1,0,Z.RGBA,Z.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[G]=V}Z.enable(Z.BLEND),Z.blendFunc(Z.SRC_ALPHA,Z.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return this._atlas?this._atlas.beginFrame():!0}updateCell($,Y,J,j,Z,K,Q,X,N){this._updateCell(this._vertices.attributes,$,Y,J,j,Z,K,Q,X,N)}_updateCell($,Y,J,j,Z,K,Q,X,N,z){if(Z0=(J*this._terminal.cols+Y)*k8,j===0||j===void 0){$.fill(0,Z0,Z0+k8-1-YK);return}this._atlas&&(X&&X.length>1?i=this._atlas.getRasterizedGlyphCombinedChar(X,Z,K,Q,!1,this._terminal.element):i=this._atlas.getRasterizedGlyph(j,Z,K,Q,!1,this._terminal.element),o6=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),Z!==z&&i.offset.x>o6?(D9=i.offset.x-o6,$[Z0]=-(i.offset.x-D9)+this._dimensions.device.char.left,$[Z0+1]=-i.offset.y+this._dimensions.device.char.top,$[Z0+2]=(i.size.x-D9)/this._dimensions.device.canvas.width,$[Z0+3]=i.size.y/this._dimensions.device.canvas.height,$[Z0+4]=i.texturePage,$[Z0+5]=i.texturePositionClipSpace.x+D9/this._atlas.pages[i.texturePage].canvas.width,$[Z0+6]=i.texturePositionClipSpace.y,$[Z0+7]=i.sizeClipSpace.x-D9/this._atlas.pages[i.texturePage].canvas.width,$[Z0+8]=i.sizeClipSpace.y):($[Z0]=-i.offset.x+this._dimensions.device.char.left,$[Z0+1]=-i.offset.y+this._dimensions.device.char.top,$[Z0+2]=i.size.x/this._dimensions.device.canvas.width,$[Z0+3]=i.size.y/this._dimensions.device.canvas.height,$[Z0+4]=i.texturePage,$[Z0+5]=i.texturePositionClipSpace.x,$[Z0+6]=i.texturePositionClipSpace.y,$[Z0+7]=i.sizeClipSpace.x,$[Z0+8]=i.sizeClipSpace.y),this._optionsService.rawOptions.rescaleOverlappingGlyphs&&OZ(j,N,i.size.x,this._dimensions.device.cell.width)&&($[Z0+2]=(this._dimensions.device.cell.width-1)/this._dimensions.device.canvas.width))}clear(){let $=this._terminal,Y=$.cols*$.rows*k8;this._vertices.count!==Y?this._vertices.attributes=new Float32Array(Y):this._vertices.attributes.fill(0);let J=0;for(;J<this._vertices.attributesBuffers.length;J++)this._vertices.count!==Y?this._vertices.attributesBuffers[J]=new Float32Array(Y):this._vertices.attributesBuffers[J].fill(0);this._vertices.count=Y,J=0;for(let j=0;j<$.rows;j++)for(let Z=0;Z<$.cols;Z++)this._vertices.attributes[J+9]=Z/$.cols,this._vertices.attributes[J+10]=j/$.rows,J+=k8}handleResize(){let $=this._gl;$.useProgram(this._program),$.viewport(0,0,$.canvas.width,$.canvas.height),$.uniform2f(this._resolutionLocation,$.canvas.width,$.canvas.height),this.clear()}render($){if(!this._atlas)return;let Y=this._gl;Y.useProgram(this._program),Y.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;let J=this._vertices.attributesBuffers[this._activeBuffer],j=0;for(let Z=0;Z<$.lineLengths.length;Z++){let K=Z*this._terminal.cols*k8,Q=this._vertices.attributes.subarray(K,K+$.lineLengths[Z]*k8);J.set(Q,j),j+=Q.length}Y.bindBuffer(Y.ARRAY_BUFFER,this._attributesBuffer),Y.bufferData(Y.ARRAY_BUFFER,J.subarray(0,j),Y.STREAM_DRAW);for(let Z=0;Z<this._atlas.pages.length;Z++)this._atlas.pages[Z].version!==this._atlasTextures[Z].version&&this._bindAtlasPageTexture(Y,this._atlas,Z);Y.drawElementsInstanced(Y.TRIANGLE_STRIP,4,Y.UNSIGNED_BYTE,0,j/k8)}setAtlas($){this._atlas=$;for(let Y of this._atlasTextures)Y.version=-1}_bindAtlasPageTexture($,Y,J){$.activeTexture($.TEXTURE0+J),$.bindTexture($.TEXTURE_2D,this._atlasTextures[J].texture),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texImage2D($.TEXTURE_2D,0,$.RGBA,$.RGBA,$.UNSIGNED_BYTE,Y.pages[J].canvas),$.generateMipmap($.TEXTURE_2D),this._atlasTextures[J].version=Y.pages[J].version}setDimensions($){this._dimensions=$}},jK=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update($,Y,J,j=!1){if(this.selectionStart=Y,this.selectionEnd=J,!Y||!J||Y[0]===J[0]&&Y[1]===J[1]){this.clear();return}let Z=$.buffers.active.ydisp,K=Y[1]-Z,Q=J[1]-Z,X=Math.max(K,0),N=Math.min(Q,$.rows-1);if(X>=$.rows||N<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=j,this.viewportStartRow=K,this.viewportEndRow=Q,this.viewportCappedStartRow=X,this.viewportCappedEndRow=N,this.startCol=Y[0],this.endCol=J[0]}isCellSelected($,Y,J){return this.hasSelection?(J-=$.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?Y>=this.startCol&&J>=this.viewportCappedStartRow&&Y<this.endCol&&J<=this.viewportCappedEndRow:Y<this.startCol&&J>=this.viewportCappedStartRow&&Y>=this.endCol&&J<=this.viewportCappedEndRow:J>this.viewportStartRow&&J<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&J===this.viewportStartRow&&Y>=this.startCol&&Y<this.endCol||this.viewportStartRow<this.viewportEndRow&&J===this.viewportEndRow&&Y<this.endCol||this.viewportStartRow<this.viewportEndRow&&J===this.viewportStartRow&&Y>=this.startCol):!1}};function ZK(){return new jK}var F7=4,q7=1,E7=2,a6=3,KK=2147483648,QK=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=ZK()}resize($,Y){let J=$*Y*F7;J!==this.cells.length&&(this.cells=new Uint32Array(J),this.lineLengths=new Uint32Array(Y))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}},XK=`#version 300 es
layout (location = 0) in vec2 a_position;
layout (location = 1) in vec2 a_size;
layout (location = 2) in vec4 a_color;
layout (location = 3) in vec2 a_unitquad;

uniform mat4 u_projection;

out vec4 v_color;

void main() {
  vec2 zeroToOne = a_position + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_color = a_color;
}`,zK=`#version 300 es
precision lowp float;

in vec4 v_color;

out vec4 outColor;

void main() {
  outColor = v_color;
}`,U8=8,n6=U8*Float32Array.BYTES_PER_ELEMENT,NK=20*U8,p2=class{constructor(){this.attributes=new Float32Array(NK),this.count=0}},I8=0,C2=0,h2=0,d2=0,u2=0,c2=0,l2=0,VK=class extends u0{constructor($,Y,J,j){super();this._terminal=$,this._gl=Y,this._dimensions=J,this._themeService=j,this._vertices=new p2,this._verticesCursor=new p2;let Z=this._gl;this._program=G0(v4(Z,XK,zK)),this._register(M0(()=>Z.deleteProgram(this._program))),this._projectionLocation=G0(Z.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=Z.createVertexArray(),Z.bindVertexArray(this._vertexArrayObject);let K=new Float32Array([0,0,1,0,0,1,1,1]),Q=Z.createBuffer();this._register(M0(()=>Z.deleteBuffer(Q))),Z.bindBuffer(Z.ARRAY_BUFFER,Q),Z.bufferData(Z.ARRAY_BUFFER,K,Z.STATIC_DRAW),Z.enableVertexAttribArray(3),Z.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);let X=new Uint8Array([0,1,2,3]),N=Z.createBuffer();this._register(M0(()=>Z.deleteBuffer(N))),Z.bindBuffer(Z.ELEMENT_ARRAY_BUFFER,N),Z.bufferData(Z.ELEMENT_ARRAY_BUFFER,X,Z.STATIC_DRAW),this._attributesBuffer=G0(Z.createBuffer()),this._register(M0(()=>Z.deleteBuffer(this._attributesBuffer))),Z.bindBuffer(Z.ARRAY_BUFFER,this._attributesBuffer),Z.enableVertexAttribArray(0),Z.vertexAttribPointer(0,2,Z.FLOAT,!1,n6,0),Z.vertexAttribDivisor(0,1),Z.enableVertexAttribArray(1),Z.vertexAttribPointer(1,2,Z.FLOAT,!1,n6,2*Float32Array.BYTES_PER_ELEMENT),Z.vertexAttribDivisor(1,1),Z.enableVertexAttribArray(2),Z.vertexAttribPointer(2,4,Z.FLOAT,!1,n6,4*Float32Array.BYTES_PER_ELEMENT),Z.vertexAttribDivisor(2,1),this._updateCachedColors(j.colors),this._register(this._themeService.onChangeColors((z)=>{this._updateCachedColors(z),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices($){let Y=this._gl;Y.useProgram(this._program),Y.bindVertexArray(this._vertexArrayObject),Y.uniformMatrix4fv(this._projectionLocation,!1,E4),Y.bindBuffer(Y.ARRAY_BUFFER,this._attributesBuffer),Y.bufferData(Y.ARRAY_BUFFER,$.attributes,Y.DYNAMIC_DRAW),Y.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,Y.UNSIGNED_BYTE,0,$.count)}handleResize(){this._updateViewportRectangle()}setDimensions($){this._dimensions=$}_updateCachedColors($){this._bgFloat=this._colorToFloat32Array($.background),this._cursorFloat=this._colorToFloat32Array($.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds($){let Y=this._terminal,J=this._vertices,j=1,Z,K,Q,X,N,z,G,V,W,_,H;for(Z=0;Z<Y.rows;Z++){for(Q=-1,X=0,N=0,z=!1,K=0;K<Y.cols;K++)G=(Z*Y.cols+K)*F7,V=$.cells[G+q7],W=$.cells[G+E7],_=!!(W&67108864),(V!==X||W!==N&&(z||_))&&((X!==0||z&&N!==0)&&(H=j++*U8,this._updateRectangle(J,H,N,X,Q,K,Z)),Q=K,X=V,N=W,z=_);(X!==0||z&&N!==0)&&(H=j++*U8,this._updateRectangle(J,H,N,X,Q,Y.cols,Z))}J.count=j}updateCursor($){let Y=this._verticesCursor,J=$.cursor;if(!J||J.style==="block"){Y.count=0;return}let j,Z=0;(J.style==="bar"||J.style==="outline")&&(j=Z++*U8,this._addRectangleFloat(Y.attributes,j,J.x*this._dimensions.device.cell.width,J.y*this._dimensions.device.cell.height,J.style==="bar"?J.dpr*J.cursorWidth:J.dpr,this._dimensions.device.cell.height,this._cursorFloat)),(J.style==="underline"||J.style==="outline")&&(j=Z++*U8,this._addRectangleFloat(Y.attributes,j,J.x*this._dimensions.device.cell.width,(J.y+1)*this._dimensions.device.cell.height-J.dpr,J.width*this._dimensions.device.cell.width,J.dpr,this._cursorFloat)),J.style==="outline"&&(j=Z++*U8,this._addRectangleFloat(Y.attributes,j,J.x*this._dimensions.device.cell.width,J.y*this._dimensions.device.cell.height,J.width*this._dimensions.device.cell.width,J.dpr,this._cursorFloat),j=Z++*U8,this._addRectangleFloat(Y.attributes,j,(J.x+J.width)*this._dimensions.device.cell.width-J.dpr,J.y*this._dimensions.device.cell.height,J.dpr,this._dimensions.device.cell.height,this._cursorFloat)),Y.count=Z}_updateRectangle($,Y,J,j,Z,K,Q){if(J&67108864)switch(J&50331648){case 16777216:case 33554432:I8=this._themeService.colors.ansi[J&255].rgba;break;case 50331648:I8=(J&16777215)<<8;break;case 0:default:I8=this._themeService.colors.foreground.rgba}else switch(j&50331648){case 16777216:case 33554432:I8=this._themeService.colors.ansi[j&255].rgba;break;case 50331648:I8=(j&16777215)<<8;break;case 0:default:I8=this._themeService.colors.background.rgba}$.attributes.length<Y+4&&($.attributes=iZ($.attributes,this._terminal.rows*this._terminal.cols*U8)),C2=Z*this._dimensions.device.cell.width,h2=Q*this._dimensions.device.cell.height,d2=(I8>>24&255)/255,u2=(I8>>16&255)/255,c2=(I8>>8&255)/255,l2=1,this._addRectangle($.attributes,Y,C2,h2,(K-Z)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,d2,u2,c2,l2)}_addRectangle($,Y,J,j,Z,K,Q,X,N,z){$[Y]=J/this._dimensions.device.canvas.width,$[Y+1]=j/this._dimensions.device.canvas.height,$[Y+2]=Z/this._dimensions.device.canvas.width,$[Y+3]=K/this._dimensions.device.canvas.height,$[Y+4]=Q,$[Y+5]=X,$[Y+6]=N,$[Y+7]=z}_addRectangleFloat($,Y,J,j,Z,K,Q){$[Y]=J/this._dimensions.device.canvas.width,$[Y+1]=j/this._dimensions.device.canvas.height,$[Y+2]=Z/this._dimensions.device.canvas.width,$[Y+3]=K/this._dimensions.device.canvas.height,$[Y+4]=Q[0],$[Y+5]=Q[1],$[Y+6]=Q[2],$[Y+7]=Q[3]}_colorToFloat32Array($){return new Float32Array([($.rgba>>24&255)/255,($.rgba>>16&255)/255,($.rgba>>8&255)/255,($.rgba&255)/255])}},GK=class extends u0{constructor($,Y,J,j,Z,K,Q,X){super();this._container=Y,this._alpha=Z,this._coreBrowserService=K,this._optionsService=Q,this._themeService=X,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${J}-layer`),this._canvas.style.zIndex=j.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._register(this._themeService.onChangeColors((N)=>{this._refreshCharAtlas($,N),this.reset($)})),this._register(M0(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=G0(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur($){}handleFocus($){}handleCursorMove($){}handleGridChanged($,Y,J){}handleSelectionChanged($,Y,J,j=!1){}_setTransparency($,Y){if(Y===this._alpha)return;let J=this._canvas;this._alpha=Y,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,J),this._refreshCharAtlas($,this._themeService.colors),this.handleGridChanged($,0,$.rows-1)}_refreshCharAtlas($,Y){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=q4($,this._optionsService.rawOptions,Y,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr,2048),this._charAtlas.warmUp())}resize($,Y){this._deviceCellWidth=Y.device.cell.width,this._deviceCellHeight=Y.device.cell.height,this._deviceCharWidth=Y.device.char.width,this._deviceCharHeight=Y.device.char.height,this._deviceCharLeft=Y.device.char.left,this._deviceCharTop=Y.device.char.top,this._canvas.width=Y.device.canvas.width,this._canvas.height=Y.device.canvas.height,this._canvas.style.width=`${Y.css.canvas.width}px`,this._canvas.style.height=`${Y.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas($,this._themeService.colors)}_fillBottomLineAtCells($,Y,J=1){this._ctx.fillRect($*this._deviceCellWidth,(Y+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,J*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells($,Y,J,j){this._alpha?this._ctx.clearRect($*this._deviceCellWidth,Y*this._deviceCellHeight,J*this._deviceCellWidth,j*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect($*this._deviceCellWidth,Y*this._deviceCellHeight,J*this._deviceCellWidth,j*this._deviceCellHeight))}_fillCharTrueColor($,Y,J,j){this._ctx.font=this._getFont($,!1,!1),this._ctx.textBaseline=W4,this._clipCell(J,j,Y.getWidth()),this._ctx.fillText(Y.getChars(),J*this._deviceCellWidth+this._deviceCharLeft,j*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell($,Y,J){this._ctx.beginPath(),this._ctx.rect($*this._deviceCellWidth,Y*this._deviceCellHeight,J*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont($,Y,J){let j=Y?$.options.fontWeightBold:$.options.fontWeight;return`${J?"italic":""} ${j} ${$.options.fontSize*this._coreBrowserService.dpr}px ${$.options.fontFamily}`}},WK=class extends GK{constructor($,Y,J,j,Z,K,Q){super(J,$,"link",Y,!0,Z,K,Q),this._register(j.onShowLinkUnderline((X)=>this._handleShowLinkUnderline(X))),this._register(j.onHideLinkUnderline((X)=>this._handleHideLinkUnderline(X)))}resize($,Y){super.resize($,Y),this._state=void 0}reset($){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let $=this._state.y2-this._state.y1-1;$>0&&this._clearCells(0,this._state.y1+1,this._state.cols,$),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline($){if($.fg===257?this._ctx.fillStyle=this._themeService.colors.background.css:$.fg!==void 0&&aZ($.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[$.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,$.y1===$.y2)this._fillBottomLineAtCells($.x1,$.y1,$.x2-$.x1);else{this._fillBottomLineAtCells($.x1,$.y1,$.cols-$.x1);for(let Y=$.y1+1;Y<$.y2;Y++)this._fillBottomLineAtCells(0,Y,$.cols);this._fillBottomLineAtCells(0,$.y2,$.x2)}this._state=$}_handleHideLinkUnderline($){this._clearCurrentLink()}},i0=typeof window=="object"?window:globalThis,X1=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new a,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new a,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(Y){return this.mapWindowIdToZoomLevel.get(this.getWindowId(Y))??0}setZoomLevel(Y,J){if(this.getZoomLevel(J)===Y)return;let j=this.getWindowId(J);this.mapWindowIdToZoomLevel.set(j,Y),this._onDidChangeZoomLevel.fire(j)}getZoomFactor(Y){return this.mapWindowIdToZoomFactor.get(this.getWindowId(Y))??1}setZoomFactor(Y,J){this.mapWindowIdToZoomFactor.set(this.getWindowId(J),Y)}setFullscreen(Y,J){if(this.isFullscreen(J)===Y)return;let j=this.getWindowId(J);this.mapWindowIdToFullScreen.set(j,Y),this._onDidChangeFullscreen.fire(j)}isFullscreen(Y){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(Y))}getWindowId(Y){return Y.vscodeWindowId}};X1.INSTANCE=new X1;var R4=X1;function _K($,Y,J){typeof Y=="string"&&(Y=$.matchMedia(Y)),Y.addEventListener("change",J)}var lX=R4.INSTANCE.onDidChangeZoomLevel,sX=R4.INSTANCE.onDidChangeFullscreen,$9=typeof navigator=="object"?navigator.userAgent:"",oX=$9.indexOf("Firefox")>=0,r6=$9.indexOf("AppleWebKit")>=0,HK=$9.indexOf("Chrome")>=0,IK=!HK&&$9.indexOf("Safari")>=0,aX=$9.indexOf("Electron/")>=0,nX=$9.indexOf("Android")>=0,v7=!1;if(typeof i0.matchMedia=="function"){let $=i0.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),Y=i0.matchMedia("(display-mode: fullscreen)");v7=$.matches,_K(i0,$,({matches:J})=>{v7&&Y.matches||(v7=J)})}function xK(){return v7}var i8="en",z1=!1,N1=!1,R7=!1,UK=!1,y4=!1,F4=!1,OK=!1,qK=!1,EK=!1,vK=!1,I7,y7=i8,s2=i8,RK,x8,E8=globalThis,d0;typeof E8.vscode<"u"&&typeof E8.vscode.process<"u"?d0=E8.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(d0=process);var B4=typeof d0?.versions?.electron=="string",yK=B4&&d0?.type==="renderer";if(typeof d0=="object"){z1=d0.platform==="win32",N1=d0.platform==="darwin",R7=d0.platform==="linux",UK=R7&&!!d0.env.SNAP&&!!d0.env.SNAP_REVISION,OK=B4,EK=!!d0.env.CI||!!d0.env.BUILD_ARTIFACTSTAGINGDIRECTORY,I7=i8,y7=i8;let $=d0.env.VSCODE_NLS_CONFIG;if($)try{let Y=JSON.parse($);I7=Y.userLocale,s2=Y.osLocale,y7=Y.resolvedLanguage||i8,RK=Y.languagePack?.translationsConfigFile}catch{}y4=!0}else typeof navigator=="object"&&!yK?(x8=navigator.userAgent,z1=x8.indexOf("Windows")>=0,N1=x8.indexOf("Macintosh")>=0,qK=(x8.indexOf("Macintosh")>=0||x8.indexOf("iPad")>=0||x8.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,R7=x8.indexOf("Linux")>=0,vK=x8?.indexOf("Mobi")>=0,F4=!0,y7=globalThis._VSCODE_NLS_LANGUAGE||i8,I7=navigator.language.toLowerCase(),s2=I7):console.error("Unable to resolve platform.");var i6=0;N1?i6=1:z1?i6=3:R7&&(i6=2);var t6=y4,FK=F4&&typeof E8.importScripts=="function",rX=FK?E8.origin:void 0,K8=x8,T8=y7,BK;(($)=>{function Y(){return T8}$.value=Y;function J(){return T8.length===2?T8==="en":T8.length>=3?T8[0]==="e"&&T8[1]==="n"&&T8[2]==="-":!1}$.isDefaultVariant=J;function j(){return T8==="en"}$.isDefault=j})(BK||={});var LK=typeof E8.postMessage=="function"&&!E8.importScripts,DK=(()=>{if(LK){let $=[];E8.addEventListener("message",(J)=>{if(J.data&&J.data.vscodeScheduleAsyncWork)for(let j=0,Z=$.length;j<Z;j++){let K=$[j];if(K.id===J.data.vscodeScheduleAsyncWork){$.splice(j,1),K.callback();return}}});let Y=0;return(J)=>{let j=++Y;$.push({id:j,callback:J}),E8.postMessage({vscodeScheduleAsyncWork:j},"*")}}return($)=>setTimeout($)})(),MK=!!(K8&&K8.indexOf("Chrome")>=0),iX=!!(K8&&K8.indexOf("Firefox")>=0),tX=!!(!MK&&K8&&K8.indexOf("Safari")>=0),eX=!!(K8&&K8.indexOf("Edg/")>=0),$z=!!(K8&&K8.indexOf("Android")>=0),A8=typeof navigator=="object"?navigator:{},Yz={clipboard:{writeText:t6||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(A8&&A8.clipboard&&A8.clipboard.writeText),readText:t6||!!(A8&&A8.clipboard&&A8.clipboard.readText)},keyboard:t6||xK()?0:A8.keyboard||IK?1:2,touch:"ontouchstart"in i0||A8.maxTouchPoints>0,pointerEvents:i0.PointerEvent&&(("ontouchstart"in i0)||navigator.maxTouchPoints>0)},H1=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define($,Y){this._keyCodeToStr[$]=Y,this._strToKeyCode[Y.toLowerCase()]=$}keyCodeToStr($){return this._keyCodeToStr[$]}strToKeyCode($){return this._strToKeyCode[$.toLowerCase()]||0}},e6=new H1,o2=new H1,a2=new H1,Jz=Array(230),bK;(($)=>{function Y(X){return e6.keyCodeToStr(X)}$.toString=Y;function J(X){return e6.strToKeyCode(X)}$.fromString=J;function j(X){return o2.keyCodeToStr(X)}$.toUserSettingsUS=j;function Z(X){return a2.keyCodeToStr(X)}$.toUserSettingsGeneral=Z;function K(X){return o2.strToKeyCode(X)||a2.strToKeyCode(X)}$.fromUserSettings=K;function Q(X){if(X>=98&&X<=113)return null;switch(X){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return e6.keyCodeToStr(X)}$.toElectronAccelerator=Q})(bK||={});var L4=Object.freeze(function($,Y){let J=setTimeout($.bind(Y),0);return{dispose(){clearTimeout(J)}}}),TK;(($)=>{function Y(J){return J===$.None||J===$.Cancelled||J instanceof AK?!0:!J||typeof J!="object"?!1:typeof J.isCancellationRequested=="boolean"&&typeof J.onCancellationRequested=="function"}$.isCancellationToken=Y,$.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:O8.None}),$.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:L4})})(TK||={});var AK=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?L4:(this._emitter||(this._emitter=new a),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},jz=Symbol("MicrotaskDelay"),PK,$1;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?$1=($,Y)=>{DK(()=>{if(J)return;let j=Date.now()+15;Y(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,j-Date.now())}}))});let J=!1;return{dispose(){J||(J=!0)}}}:$1=($,Y,J)=>{let j=$.requestIdleCallback(Y,typeof J=="number"?{timeout:J}:void 0),Z=!1;return{dispose(){Z||(Z=!0,$.cancelIdleCallback(j))}}},PK=($)=>$1(globalThis,$)})();var kK;(($)=>{async function Y(j){let Z,K=await Promise.all(j.map((Q)=>Q.then((X)=>X,(X)=>{Z||(Z=X)})));if(typeof Z<"u")throw Z;return K}$.settled=Y;function J(j){return new Promise(async(Z,K)=>{try{await j(Z,K)}catch(Q){K(Q)}})}$.withAsyncBody=J})(kK||={});var n2=class ${static fromArray(Y){return new $((J)=>{J.emitMany(Y)})}static fromPromise(Y){return new $(async(J)=>{J.emitMany(await Y)})}static fromPromises(Y){return new $(async(J)=>{await Promise.all(Y.map(async(j)=>J.emitOne(await j)))})}static merge(Y){return new $(async(J)=>{await Promise.all(Y.map(async(j)=>{for await(let Z of j)J.emitOne(Z)}))})}constructor(Y,J){this._state=0,this._results=[],this._error=null,this._onReturn=J,this._onStateChanged=new a,queueMicrotask(async()=>{let j={emitOne:(Z)=>this.emitOne(Z),emitMany:(Z)=>this.emitMany(Z),reject:(Z)=>this.reject(Z)};try{await Promise.resolve(Y(j)),this.resolve()}catch(Z){this.reject(Z)}finally{j.emitOne=void 0,j.emitMany=void 0,j.reject=void 0}})}[Symbol.asyncIterator](){let Y=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(Y<this._results.length)return{done:!1,value:this._results[Y++]};if(this._state===1)return{done:!0,value:void 0};await O8.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(Y,J){return new $(async(j)=>{for await(let Z of Y)j.emitOne(J(Z))})}map(Y){return $.map(this,Y)}static filter(Y,J){return new $(async(j)=>{for await(let Z of Y)J(Z)&&j.emitOne(Z)})}filter(Y){return $.filter(this,Y)}static coalesce(Y){return $.filter(Y,(J)=>!!J)}coalesce(){return $.coalesce(this)}static async toPromise(Y){let J=[];for await(let j of Y)J.push(j);return J}toPromise(){return $.toPromise(this)}emitOne(Y){this._state===0&&(this._results.push(Y),this._onStateChanged.fire())}emitMany(Y){this._state===0&&(this._results=this._results.concat(Y),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(Y){this._state===0&&(this._state=2,this._error=Y,this._onStateChanged.fire())}};n2.EMPTY=n2.fromArray([]);function wK($){return 55296<=$&&$<=56319}function r2($){return 56320<=$&&$<=57343}function fK($,Y){return($-55296<<10)+(Y-56320)+65536}function mK($){return I1($,0)}function I1($,Y){switch(typeof $){case"object":return $===null?q8(349,Y):Array.isArray($)?gK($,Y):pK($,Y);case"string":return D4($,Y);case"boolean":return SK($,Y);case"number":return q8($,Y);case"undefined":return q8(937,Y);default:return q8(617,Y)}}function q8($,Y){return(Y<<5)-Y+$|0}function SK($,Y){return q8($?433:863,Y)}function D4($,Y){Y=q8(149417,Y);for(let J=0,j=$.length;J<j;J++)Y=q8($.charCodeAt(J),Y);return Y}function gK($,Y){return Y=q8(104579,Y),$.reduce((J,j)=>I1(j,J),Y)}function pK($,Y){return Y=q8(181387,Y),Object.keys($).sort().reduce((J,j)=>(J=D4(j,J),I1($[j],J)),Y)}function Y1($,Y,J=32){let j=J-Y,Z=~((1<<j)-1);return($<<Y|(Z&$)>>>j)>>>0}function i2($,Y=0,J=$.byteLength,j=0){for(let Z=0;Z<J;Z++)$[Y+Z]=j}function CK($,Y,J="0"){for(;$.length<Y;)$=J+$;return $}function M9($,Y=32){return $ instanceof ArrayBuffer?Array.from(new Uint8Array($)).map((J)=>J.toString(16).padStart(2,"0")).join(""):CK(($>>>0).toString(16),Y/4)}var hK=class ${constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(Y){let J=Y.length;if(J===0)return;let j=this._buff,Z=this._buffLen,K=this._leftoverHighSurrogate,Q,X;for(K!==0?(Q=K,X=-1,K=0):(Q=Y.charCodeAt(0),X=0);;){let N=Q;if(wK(Q))if(X+1<J){let z=Y.charCodeAt(X+1);r2(z)?(X++,N=fK(Q,z)):N=65533}else{K=Q;break}else r2(Q)&&(N=65533);if(Z=this._push(j,Z,N),X++,X<J)Q=Y.charCodeAt(X);else break}this._buffLen=Z,this._leftoverHighSurrogate=K}_push(Y,J,j){return j<128?Y[J++]=j:j<2048?(Y[J++]=192|(j&1984)>>>6,Y[J++]=128|(j&63)>>>0):j<65536?(Y[J++]=224|(j&61440)>>>12,Y[J++]=128|(j&4032)>>>6,Y[J++]=128|(j&63)>>>0):(Y[J++]=240|(j&1835008)>>>18,Y[J++]=128|(j&258048)>>>12,Y[J++]=128|(j&4032)>>>6,Y[J++]=128|(j&63)>>>0),J>=64&&(this._step(),J-=64,this._totalLen+=64,Y[0]=Y[64],Y[1]=Y[65],Y[2]=Y[66]),J}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),M9(this._h0)+M9(this._h1)+M9(this._h2)+M9(this._h3)+M9(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,i2(this._buff,this._buffLen),this._buffLen>56&&(this._step(),i2(this._buff));let Y=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(Y/4294967296),!1),this._buffDV.setUint32(60,Y%4294967296,!1),this._step()}_step(){let Y=$._bigBlock32,J=this._buffDV;for(let V=0;V<64;V+=4)Y.setUint32(V,J.getUint32(V,!1),!1);for(let V=64;V<320;V+=4)Y.setUint32(V,Y1(Y.getUint32(V-12,!1)^Y.getUint32(V-32,!1)^Y.getUint32(V-56,!1)^Y.getUint32(V-64,!1),1),!1);let j=this._h0,Z=this._h1,K=this._h2,Q=this._h3,X=this._h4,N,z,G;for(let V=0;V<80;V++)V<20?(N=Z&K|~Z&Q,z=1518500249):V<40?(N=Z^K^Q,z=1859775393):V<60?(N=Z&K|Z&Q|K&Q,z=2400959708):(N=Z^K^Q,z=3395469782),G=Y1(j,5)+N+X+z+Y.getUint32(V*4,!1)&4294967295,X=Q,Q=K,K=Y1(Z,30),Z=j,j=G;this._h0=this._h0+j&4294967295,this._h1=this._h1+Z&4294967295,this._h2=this._h2+K&4294967295,this._h3=this._h3+Q&4294967295,this._h4=this._h4+X&4294967295}};hK._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:Zz,getWindow:dK,getDocument:Kz,getWindows:Qz,getWindowsCount:Xz,getWindowId:t2,getWindowById:zz,hasWindow:Nz,onDidRegisterWindow:Vz,onWillUnregisterWindow:Gz,onDidUnregisterWindow:Wz}=function(){let $=new Map,Y={window:i0,disposables:new t8};$.set(i0.vscodeWindowId,Y);let J=new a,j=new a,Z=new a;function K(Q,X){return(typeof Q=="number"?$.get(Q):void 0)??(X?Y:void 0)}return{onDidRegisterWindow:J.event,onWillUnregisterWindow:Z.event,onDidUnregisterWindow:j.event,registerWindow(Q){if($.has(Q.vscodeWindowId))return u0.None;let X=new t8,N={window:Q,disposables:X.add(new t8)};return $.set(Q.vscodeWindowId,N),X.add(M0(()=>{$.delete(Q.vscodeWindowId),j.fire(Q)})),X.add(V1(Q,lK.BEFORE_UNLOAD,()=>{Z.fire(Q)})),J.fire(N),X},getWindows(){return $.values()},getWindowsCount(){return $.size},getWindowId(Q){return Q.vscodeWindowId},hasWindow(Q){return $.has(Q)},getWindowById:K,getWindow(Q){let X=Q;if(X?.ownerDocument?.defaultView)return X.ownerDocument.defaultView.window;let N=Q;return N?.view?N.view.window:i0},getDocument(Q){return dK(Q).document}}}(),uK=class{constructor($,Y,J,j){this._node=$,this._type=Y,this._handler=J,this._options=j||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function V1($,Y,J,j){return new uK($,Y,J,j)}var cK,e2,J1=class{constructor($,Y=0){this._runner=$,this.priority=Y,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch($){x7($)}}static sort($,Y){return Y.priority-$.priority}};(function(){let $=new Map,Y=new Map,J=new Map,j=new Map,Z=(K)=>{J.set(K,!1);let Q=$.get(K)??[];for(Y.set(K,Q),$.set(K,[]),j.set(K,!0);Q.length>0;)Q.sort(J1.sort),Q.shift().execute();j.set(K,!1)};e2=(K,Q,X=0)=>{let N=t2(K),z=new J1(Q,X),G=$.get(N);return G||(G=[],$.set(N,G)),G.push(z),J.get(N)||(J.set(N,!0),K.requestAnimationFrame(()=>Z(N))),z},cK=(K,Q,X)=>{let N=t2(K);if(j.get(N)){let z=new J1(Q,X),G=Y.get(N);return G||(G=[],Y.set(N,G)),G.push(z),z}else return e2(K,Q,X)}})();var $4=class ${constructor(Y,J){this.width=Y,this.height=J}with(Y=this.width,J=this.height){return Y!==this.width||J!==this.height?new $(Y,J):this}static is(Y){return typeof Y=="object"&&typeof Y.height=="number"&&typeof Y.width=="number"}static lift(Y){return Y instanceof $?Y:new $(Y.width,Y.height)}static equals(Y,J){return Y===J?!0:!Y||!J?!1:Y.width===J.width&&Y.height===J.height}};$4.None=new $4(0,0);var _z=new class{constructor(){this.mutationObservers=new Map}observe($,Y,J){let j=this.mutationObservers.get($);j||(j=new Map,this.mutationObservers.set($,j));let Z=mK(J),K=j.get(Z);if(K)K.users+=1;else{let Q=new a,X=new MutationObserver((z)=>Q.fire(z));X.observe($,J);let N=K={users:1,observer:X,onDidMutate:Q.event};Y.add(M0(()=>{N.users-=1,N.users===0&&(Q.dispose(),X.disconnect(),j?.delete(Z),j?.size===0&&this.mutationObservers.delete($))})),j.set(Z,K)}return K.onDidMutate}},lK={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:r6?"webkitAnimationStart":"animationstart",ANIMATION_END:r6?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:r6?"webkitAnimationIteration":"animationiteration"},sK=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function M4($,Y,J,...j){let Z=sK.exec(Y);if(!Z)throw Error("Bad use of emmet");let K=Z[1]||"div",Q;return $!=="http://www.w3.org/1999/xhtml"?Q=document.createElementNS($,K):Q=document.createElement(K),Z[3]&&(Q.id=Z[3]),Z[4]&&(Q.className=Z[4].replace(/\./g," ").trim()),J&&Object.entries(J).forEach(([X,N])=>{typeof N>"u"||(/^on\w+$/.test(X)?Q[X]=N:X==="selected"?N&&Q.setAttribute(X,"true"):Q.setAttribute(X,N))}),Q.append(...j),Q}function oK($,Y,...J){return M4("http://www.w3.org/1999/xhtml",$,Y,...J)}oK.SVG=function($,Y,...J){return M4("http://www.w3.org/2000/svg",$,Y,...J)};var aK=class extends u0{constructor($,Y,J,j,Z,K,Q,X,N){super();this._terminal=$,this._characterJoinerService=Y,this._charSizeService=J,this._coreBrowserService=j,this._coreService=Z,this._decorationService=K,this._optionsService=Q,this._themeService=X,this._cursorBlinkStateManager=new F9,this._charAtlasDisposable=this._register(new F9),this._observerDisposable=this._register(new F9),this._model=new QK,this._workCell=new S2,this._workCell2=new S2,this._rectangleRenderer=this._register(new F9),this._glyphRenderer=this._register(new F9),this._onChangeTextureAtlas=this._register(new a),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new a),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new a),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this._register(new a),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this._register(new a),this.onContextLoss=this._onContextLoss.event,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas");let z={antialias:!1,depth:!1,preserveDrawingBuffer:N};if(this._gl=this._canvas.getContext("webgl2",z),!this._gl)throw Error("WebGL2 not supported "+this._gl);this._register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new vZ(this._terminal,this._optionsService,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new WK(this._core.screenElement,2,this._terminal,this._core.linkifier,this._coreBrowserService,Q,this._themeService)],this.dimensions=qZ(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this._register(Q.onOptionChange(()=>this._handleOptionsChanged())),this._deviceMaxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._register(V1(this._canvas,"webglcontextlost",(G)=>{console.log("webglcontextlost event received"),G.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(G)},3000)})),this._register(V1(this._canvas,"webglcontextrestored",(G)=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,f2(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this._observerDisposable.value=m2(this._canvas,this._coreBrowserService.window,(G,V)=>this._setCanvasDevicePixelDimensions(G,V)),this._register(this._coreBrowserService.onWindowChange((G)=>{this._observerDisposable.value=m2(this._canvas,G,(V,W)=>this._setCanvasDevicePixelDimensions(V,W))})),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._core.screenElement.isConnected,this._register(M0(()=>{for(let G of this._renderLayers)G.dispose();this._canvas.parentElement?.removeChild(this._canvas),f2(this._terminal)}))}get textureAtlas(){return this._charAtlas?.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize($,Y){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let J of this._renderLayers)J.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,this._rectangleRenderer.value?.setDimensions(this.dimensions),this._rectangleRenderer.value?.handleResize(),this._glyphRenderer.value?.setDimensions(this.dimensions),this._glyphRenderer.value?.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(let $ of this._renderLayers)$.handleBlur(this._terminal);this._cursorBlinkStateManager.value?.pause(),this._requestRedrawViewport()}handleFocus(){for(let $ of this._renderLayers)$.handleFocus(this._terminal);this._cursorBlinkStateManager.value?.resume(),this._requestRedrawViewport()}handleSelectionChanged($,Y,J){for(let j of this._renderLayers)j.handleSelectionChanged(this._terminal,$,Y,J);this._model.selection.update(this._core,$,Y,J),this._requestRedrawViewport()}handleCursorMove(){for(let $ of this._renderLayers)$.handleCursorMove(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new VK(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new JK(this._terminal,this._gl,this.dimensions,this._optionsService),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0){this._isAttached=!1;return}let $=q4(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr,this._deviceMaxTextureSize);this._charAtlas!==$&&(this._onChangeTextureAtlas.fire($.pages[0].canvas),this._charAtlasDisposable.value=z4(O8.forward($.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),O8.forward($.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas))),this._charAtlas=$,this._charAtlas.warmUp(),this._glyphRenderer.value?.setAtlas(this._charAtlas)}_clearModel($){this._model.clear(),$&&this._glyphRenderer.value?.clear()}clearTextureAtlas(){this._charAtlas?.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){this._clearModel(!0);for(let $ of this._renderLayers)$.reset(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._updateCursorBlink()}renderRows($,Y){if(!this._isAttached)if(this._core.screenElement?.isConnected&&this._charSizeService.width&&this._charSizeService.height)this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0;else return;for(let J of this._renderLayers)J.handleGridChanged(this._terminal,$,Y);!this._glyphRenderer.value||!this._rectangleRenderer.value||(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel($,Y),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible)&&this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._coreService.decPrivateModes.cursorBlink??this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new nZ(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel($,Y){let J=this._core,j=this._workCell,Z,K,Q,X,N,z,G=0,V=!0,W,_,H,U,B,A,k,M,y;$=Y4($,J.rows-1,0),Y=Y4(Y,J.rows-1,0);let b=this._coreService.decPrivateModes.cursorStyle??J.options.cursorStyle??"block",P=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,p=P-J.buffer.ydisp,o=Math.min(this._terminal.buffer.active.cursorX,J.cols-1),Q0=-1,b0=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let f=!1;for(K=$;K<=Y;K++)for(Q=K+J.buffer.ydisp,X=J.buffer.lines.get(Q),this._model.lineLengths[K]=0,H=P===Q,G=0,N=this._characterJoinerService.getJoinedCharacters(Q),M=0;M<J.cols;M++){if(Z=this._cellColorResolver.result.bg,X.loadCell(M,j),M===0&&(Z=this._cellColorResolver.result.bg),z=!1,V=M>=G,W=M,N.length>0&&M===N[0][0]&&V){_=N.shift();let c0=this._model.selection.isCellSelected(this._terminal,_[0],Q);for(k=_[0]+1;k<_[1];k++)V&&=c0===this._model.selection.isCellSelected(this._terminal,k,Q);V&&=!H||o<_[0]||o>=_[1],V?(z=!0,j=new nK(j,X.translateToString(!0,_[0],_[1]),_[1]-_[0]),W=_[1]-1):G=_[1]}if(U=j.getChars(),B=j.getCode(),k=(K*J.cols+M)*F7,this._cellColorResolver.resolve(j,M,Q,this.dimensions.device.cell.width),b0&&Q===P&&(M===o&&(this._model.cursor={x:o,y:p,width:j.getWidth(),style:this._coreBrowserService.isFocused?b:J.options.cursorInactiveStyle,cursorWidth:J.options.cursorWidth,dpr:this._devicePixelRatio},Q0=o+j.getWidth()-1),M>=o&&M<=Q0&&(this._coreBrowserService.isFocused&&b==="block"||this._coreBrowserService.isFocused===!1&&J.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),B!==0&&(this._model.lineLengths[K]=M+1),!(this._model.cells[k]===B&&this._model.cells[k+q7]===this._cellColorResolver.result.bg&&this._model.cells[k+E7]===this._cellColorResolver.result.fg&&this._model.cells[k+a6]===this._cellColorResolver.result.ext)&&(f=!0,U.length>1&&(B|=KK),this._model.cells[k]=B,this._model.cells[k+q7]=this._cellColorResolver.result.bg,this._model.cells[k+E7]=this._cellColorResolver.result.fg,this._model.cells[k+a6]=this._cellColorResolver.result.ext,A=j.getWidth(),this._glyphRenderer.value.updateCell(M,K,B,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,U,A,Z),z)){for(j=this._workCell,M++;M<=W;M++)y=(K*J.cols+M)*F7,this._glyphRenderer.value.updateCell(M,K,0,0,0,0,WZ,0,0),this._model.cells[y]=0,this._model.cells[y+q7]=this._cellColorResolver.result.bg,this._model.cells[y+E7]=this._cellColorResolver.result.fg,this._model.cells[y+a6]=this._cellColorResolver.result.ext;M--}}f&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){!this._charSizeService.width||!this._charSizeService.height||(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions($,Y){this._canvas.width===$&&this._canvas.height===Y||(this._canvas.width=$,this._canvas.height=Y,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){let $=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:$,end:$})}},nK=class extends r8{constructor($,Y,J){super();this.content=0,this.combinedData="",this.fg=$.fg,this.bg=$.bg,this.combinedData=Y,this._width=J}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData($){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};function Y4($,Y,J=0){return Math.max(Math.min($,Y),J)}var J4="di$target",j4="di$dependencies",j1=new Map;function Q8($){if(j1.has($))return j1.get($);let Y=function(J,j,Z){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");rK(Y,J,Z)};return Y._id=$,j1.set($,Y),Y}function rK($,Y,J){Y[J4]===Y?Y[j4].push({id:$,index:J}):(Y[j4]=[{id:$,index:J}],Y[J4]=Y)}var Hz=Q8("BufferService"),Iz=Q8("CoreMouseService"),xz=Q8("CoreService"),Uz=Q8("CharsetService"),Oz=Q8("InstantiationService"),qz=Q8("LogService"),iK=Q8("OptionsService"),Ez=Q8("OscLinkService"),vz=Q8("UnicodeService"),Rz=Q8("DecorationService"),tK={trace:0,debug:1,info:2,warn:3,error:4,off:5},eK="xterm.js: ",Z4=class extends u0{constructor($){super();this._optionsService=$,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),b4=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=tK[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams($){for(let Y=0;Y<$.length;Y++)typeof $[Y]=="function"&&($[Y]=$[Y]())}_log($,Y,J){this._evalLazyOptionalParams(J),$.call(console,(this._optionsService.options.logger?"":eK)+Y,...J)}trace($,...Y){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,$,Y)}debug($,...Y){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,$,Y)}info($,...Y){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,$,Y)}warn($,...Y){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,$,Y)}error($,...Y){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,$,Y)}};Z4=sj([oj(0,iK)],Z4);var b4;function $3($){b4=$}var T4=class extends u0{constructor($){if(V4&&GZ()<16){let Y={antialias:!1,depth:!1,preserveDrawingBuffer:!0};if(!document.createElement("canvas").getContext("webgl2",Y))throw Error("Webgl2 is only supported on Safari 16 and above")}super();this._preserveDrawingBuffer=$,this._onChangeTextureAtlas=this._register(new a),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new a),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new a),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this._register(new a),this.onContextLoss=this._onContextLoss.event}activate($){let Y=$._core;if(!$.element){this._register(Y.onWillOpen(()=>this.activate($)));return}this._terminal=$;let{coreService:J,optionsService:j}=Y,Z=Y,K=Z._renderService,Q=Z._characterJoinerService,X=Z._charSizeService,N=Z._coreBrowserService,z=Z._decorationService,G=Z._logService,V=Z._themeService;$3(G),this._renderer=this._register(new aK($,Q,X,N,J,z,j,V,this._preserveDrawingBuffer)),this._register(O8.forward(this._renderer.onContextLoss,this._onContextLoss)),this._register(O8.forward(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this._register(O8.forward(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this._register(O8.forward(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),K.setRenderer(this._renderer),this._register(M0(()=>{if(this._terminal._core._store._isDisposed)return;let W=this._terminal._core._renderService;W.setRenderer(this._terminal._core._createRenderer()),W.handleResize($.cols,$.rows)}))}get textureAtlas(){return this._renderer?.textureAtlas}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}};class x1{feedIds=[Y0.TERMINAL_OUTPUT];collapsible=!1;terminal=null;fitAddon=null;resizeObserver=null;connection;resizeDebounceId=null;deckManager=null;constructor($){this.connection=$}setDeckManager($){this.deckManager=$}mount($){let Y=getComputedStyle(document.documentElement).getPropertyValue("--background").trim(),J=getComputedStyle(document.documentElement).getPropertyValue("--foreground").trim();this.terminal=new q2({cursorBlink:!0,fontFamily:"'Menlo', 'Monaco', 'Courier New', monospace",fontSize:14,theme:{background:Y,foreground:J}}),this.fitAddon=new E2,this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(new v2),this.terminal.open($);try{let j=new T4;j.onContextLoss(()=>{j.dispose(),console.log("tugdeck: WebGL context lost, falling back to canvas")}),this.terminal.loadAddon(j),console.log("tugdeck: WebGL renderer activated")}catch{console.log("tugdeck: WebGL not available, using canvas renderer")}this.resizeObserver=new ResizeObserver(()=>{if(this.deckManager?.isDragging)return;if(this.resizeDebounceId!==null)cancelAnimationFrame(this.resizeDebounceId);this.resizeDebounceId=requestAnimationFrame(()=>{if(this.fitAddon)this.fitAddon.fit();this.resizeDebounceId=null})}),this.resizeObserver.observe($),this.terminal.onData((j)=>{let Z=new TextEncoder().encode(j);this.connection.send(Y0.TERMINAL_INPUT,Z)}),this.terminal.onResize(({cols:j,rows:Z})=>{let K=b7(j,Z);this.connection.send(K.feedId,K.payload)})}onFrame($,Y){if($===Y0.TERMINAL_OUTPUT&&this.terminal)this.terminal.write(Y)}onResize($,Y){if(this.deckManager?.isDragging)return;if(this.fitAddon&&this.terminal){this.fitAddon.fit();let J=b7(this.terminal.cols,this.terminal.rows);this.connection.send(J.feedId,J.payload)}}destroy(){if(this.resizeDebounceId!==null)cancelAnimationFrame(this.resizeDebounceId),this.resizeDebounceId=null;if(this.resizeObserver)this.resizeObserver.disconnect(),this.resizeObserver=null;if(this.terminal)this.terminal.dispose(),this.terminal=null,this.fitAddon=null}}var Y3=100;class U1{feedIds=[Y0.FILESYSTEM];container=null;header=null;eventList=null;mount($){this.container=$,this.container.classList.add("files-card"),this.header=document.createElement("div"),this.header.className="card-header",this.header.textContent="Files",this.container.appendChild(this.header),this.eventList=document.createElement("div"),this.eventList.className="event-list",this.container.appendChild(this.eventList)}onFrame($,Y){if($!==Y0.FILESYSTEM||!this.eventList)return;if(Y.length===0)return;let J=new TextDecoder().decode(Y),j;try{j=JSON.parse(J)}catch{console.error("files-card: failed to parse FsEvent payload");return}let Z=this.eventList,K=Z.scrollHeight-Z.scrollTop-Z.clientHeight<8;for(let Q of j){let X=document.createElement("div");X.className=`event-entry event-${Q.kind.toLowerCase()}`;let N=document.createElement("span");N.className="event-icon",N.appendChild(this.iconForKind(Q.kind));let z=document.createElement("span");z.className="event-label",z.textContent=this.labelForEvent(Q),X.appendChild(N),X.appendChild(z),Z.appendChild(X)}while(Z.children.length>Y3)Z.removeChild(Z.firstChild);if(K)Z.scrollTop=Z.scrollHeight}onResize($,Y){}destroy(){if(this.container)this.container.innerHTML="",this.container=null,this.header=null,this.eventList=null}iconForKind($){switch($){case"Created":return W0(S7,{width:14,height:14});case"Modified":return W0(m7,{width:14,height:14});case"Removed":return W0(S9,{width:14,height:14});case"Renamed":return W0(g7,{width:14,height:14});default:return W0(S9,{width:14,height:14})}}labelForEvent($){if($.kind==="Renamed")return`${$.from}  ${$.to}`;return $.path??""}}class O1{feedIds=[Y0.GIT];container=null;header=null;content=null;mount($){this.container=$,this.container.classList.add("git-card"),this.header=document.createElement("div"),this.header.className="card-header",this.header.textContent="Git",this.container.appendChild(this.header),this.content=document.createElement("div"),this.content.className="git-content",this.container.appendChild(this.content)}onFrame($,Y){if($!==Y0.GIT||!this.content)return;if(Y.length===0)return;let J=new TextDecoder().decode(Y),j;try{j=JSON.parse(J)}catch{console.error("git-card: failed to parse GitStatus payload");return}this.render(j)}onResize($,Y){}destroy(){if(this.container)this.container.innerHTML="",this.container=null,this.header=null,this.content=null}render($){if(!this.content)return;this.content.innerHTML="";let Y=document.createElement("div");Y.className="branch-section";let J=W0(p7,{width:14,height:14});J.style.color="var(--muted-foreground)",Y.appendChild(J);let j=document.createElement("span");if(j.className="branch-badge",j.textContent=$.branch,Y.appendChild(j),$.ahead>0||$.behind>0){let Z=document.createElement("span");Z.className="ahead-behind";let K=[];if($.ahead>0)K.push(`${$.ahead}`);if($.behind>0)K.push(`${$.behind}`);Z.textContent=K.join(" "),Y.appendChild(Z)}if(this.content.appendChild(Y),$.head_message){let Z=document.createElement("div");Z.className="head-message",Z.textContent=$.head_message,this.content.appendChild(Z)}if($.staged.length>0)this.renderFileSection("Staged","staged",$.staged);if($.unstaged.length>0)this.renderFileSection("Unstaged","unstaged",$.unstaged);if($.untracked.length>0)this.renderUntrackedSection($.untracked);if($.staged.length===0&&$.unstaged.length===0&&$.untracked.length===0){let Z=document.createElement("div");Z.className="clean-status",Z.textContent="Clean working tree",this.content.appendChild(Z)}}renderFileSection($,Y,J){if(!this.content)return;let j=document.createElement("div");j.className=`file-section ${Y}`;let Z=document.createElement("div");Z.className="section-title",Z.textContent=`${$} (${J.length})`,j.appendChild(Z);for(let K of J){let Q=document.createElement("div");Q.className="file-entry";let X=document.createElement("span");X.className="file-status";let N=Y==="staged"?W0(P7,{width:14,height:14}):W0(w7,{width:14,height:14});X.appendChild(N);let z=document.createElement("span");z.className="file-path",z.textContent=K.path,Q.appendChild(X),Q.appendChild(z),j.appendChild(Q)}this.content.appendChild(j)}renderUntrackedSection($){if(!this.content)return;let Y=document.createElement("div");Y.className="file-section untracked";let J=document.createElement("div");J.className="section-title",J.textContent=`Untracked (${$.length})`,Y.appendChild(J);for(let j of $){let Z=document.createElement("div");Z.className="file-entry";let K=document.createElement("span");K.className="file-status",K.appendChild(W0(k7,{width:14,height:14}));let Q=document.createElement("span");Q.className="file-path",Q.textContent=j,Z.appendChild(K),Z.appendChild(Q),Y.appendChild(Z)}this.content.appendChild(Y)}}function q1($){return getComputedStyle(document.documentElement).getPropertyValue($).trim()}class A4{values=[];canvas;ctx;color;bufferSize;constructor($,Y=60,J){this.canvas=$,this.ctx=$.getContext("2d"),this.color=J,this.bufferSize=Y}push($){if(this.values.push($),this.values.length>this.bufferSize)this.values.shift();this.draw()}draw(){let $=this.canvas.width,Y=this.canvas.height;if(this.ctx.clearRect(0,0,$,Y),this.values.length<2)return;let J=Math.min(...this.values),j=Math.max(...this.values);if(j===J)J=j-0.5,j=j+0.5;let Z=j-J;this.ctx.beginPath(),this.ctx.strokeStyle=this.color,this.ctx.lineWidth=1.5;let K=$/(this.bufferSize-1);for(let Q=0;Q<this.values.length;Q++){let X=Q*K,N=Y-(this.values[Q]-J)/Z*Y;if(Q===0)this.ctx.moveTo(X,N);else this.ctx.lineTo(X,N)}this.ctx.stroke()}resize($,Y){this.canvas.width=$,this.canvas.height=Y,this.draw()}}class D7{container;nameSpan;valueSpan;sparkline;canvas;constructor($,Y,J=60,j){this.container=document.createElement("div"),this.container.className="stat-sub-card";let Z=document.createElement("div");Z.className="stat-header";let K=document.createElement("span");if(K.style.display="flex",K.style.alignItems="center",K.style.gap="4px",j)K.appendChild(W0(j,{width:12,height:12}));this.nameSpan=document.createElement("span"),this.nameSpan.className="stat-name",this.nameSpan.textContent=$,K.appendChild(this.nameSpan),this.valueSpan=document.createElement("span"),this.valueSpan.className="stat-value",this.valueSpan.textContent="--",Z.appendChild(K),Z.appendChild(this.valueSpan),this.canvas=document.createElement("canvas"),this.canvas.className="sparkline-canvas",this.canvas.width=300,this.canvas.height=32,this.sparkline=new A4(this.canvas,J,Y),this.container.appendChild(Z),this.container.appendChild(this.canvas)}mount($){$.appendChild(this.container)}updateValue($,Y=!1){if(this.valueSpan.textContent=$,Y)this.valueSpan.classList.add("stat-na");else this.valueSpan.classList.remove("stat-na")}pushSparkline($){this.sparkline.push($)}resize(){let $=this.canvas.clientWidth,Y=32;this.sparkline.resize($,32)}getElement(){return this.container}}class E1{feedIds=[Y0.STATS,Y0.STATS_PROCESS_INFO,Y0.STATS_TOKEN_USAGE,Y0.STATS_BUILD_STATUS];container=null;content=null;processInfo=null;tokenUsage=null;buildStatus=null;mount($){this.container=$,this.container.classList.add("stats-card");let Y=document.createElement("div");Y.className="card-header",Y.textContent="Stats",this.container.appendChild(Y),this.content=document.createElement("div"),this.content.className="stats-content",this.container.appendChild(this.content),this.processInfo=new D7("CPU / Memory",q1("--chart-1"),60,A7),this.processInfo.mount(this.content),this.tokenUsage=new D7("Token Usage",q1("--chart-2"),60,f7),this.tokenUsage.mount(this.content),this.buildStatus=new D7("Build Status",q1("--chart-3"),60,C7),this.buildStatus.mount(this.content)}onFrame($,Y){if(Y.length===0)return;let J=new TextDecoder().decode(Y),j;try{j=JSON.parse(J)}catch(Z){console.error("Stats card: failed to parse JSON payload",Z);return}switch($){case Y0.STATS_PROCESS_INFO:this.handleProcessInfo(j);break;case Y0.STATS_TOKEN_USAGE:this.handleTokenUsage(j);break;case Y0.STATS_BUILD_STATUS:this.handleBuildStatus(j);break;case Y0.STATS:break}}handleProcessInfo($){if(!this.processInfo)return;let Y=$.cpu_percent?.toFixed(1)??"0.0",J=$.memory_mb?.toFixed(0)??"0";this.processInfo.updateValue(`CPU: ${Y}%  Mem: ${J}MB`),this.processInfo.pushSparkline($.cpu_percent??0)}handleTokenUsage($){if(!this.tokenUsage)return;if($===null||$.total_tokens===null){this.tokenUsage.updateValue("N/A",!0),this.tokenUsage.pushSparkline(0);return}let Y=$.total_tokens??0,J=$.context_window_percent?.toFixed(1)??"0.0";this.tokenUsage.updateValue(`${Y} tokens (${J}%)`,!1),this.tokenUsage.pushSparkline(Y)}handleBuildStatus($){if(!this.buildStatus)return;let Y=$.status??"idle";this.buildStatus.updateValue(Y,!1),this.buildStatus.pushSparkline(Y==="building"?1:0)}onResize($,Y){if(this.processInfo)this.processInfo.resize();if(this.tokenUsage)this.tokenUsage.resize();if(this.buildStatus)this.buildStatus.resize()}destroy(){if(this.container)this.container.innerHTML="",this.container=null;this.content=null,this.processInfo=null,this.tokenUsage=null,this.buildStatus=null}}var J3=`ws://${window.location.host}/ws`,v1=new T7(J3),P4=document.getElementById("deck-container");if(!P4)throw Error("deck-container element not found");var k9=new h7(P4,v1),k4=new x1(v1);k4.setDeckManager(k9);k9.addCard(k4,"terminal");k9.addCard(new O1,"git");k9.addCard(new U1,"files");k9.addCard(new E1,"stats");v1.connect();console.log("tugdeck initialized");
