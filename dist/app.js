var G5={TERMINAL_OUTPUT:0,TERMINAL_INPUT:1,TERMINAL_RESIZE:2,FILESYSTEM:16,GIT:32,STATS:48,STATS_PROCESS_INFO:49,STATS_TOKEN_USAGE:50,STATS_BUILD_STATUS:51,HEARTBEAT:255};function z0(q){let G=new ArrayBuffer(5+q.payload.length),J=new DataView(G);return J.setUint8(0,q.feedId),J.setUint32(1,q.payload.length,!1),new Uint8Array(G,5).set(q.payload),G}function B0(q){let G=new DataView(q);if(q.byteLength<5)throw Error(`incomplete frame: need 5 bytes, have ${q.byteLength}`);let J=G.getUint8(0),Z=G.getUint32(1,!1);if(Z>1048576)throw Error(`payload too large: ${Z} bytes`);if(q.byteLength<5+Z)throw Error(`incomplete frame: need ${5+Z} bytes, have ${q.byteLength}`);let $=new Uint8Array(q,5,Z);return{feedId:J,payload:$}}function k8(q,G){let J=JSON.stringify({cols:q,rows:G});return{feedId:G5.TERMINAL_RESIZE,payload:new TextEncoder().encode(J)}}var W2=15000,T7={CONNECTED:"connected",DISCONNECTED:"disconnected",RECONNECTING:"reconnecting"},H0=2000,R2=30000;class L8{ws=null;callbacks=new Map;openCallbacks=[];heartbeatTimer=null;url;state=T7.DISCONNECTED;retryDelay=H0;retryTimer=null;countdownTimer=null;countdownSeconds=0;bannerElement=null;intentionalClose=!1;lastCloseCode=null;lastCloseReason=null;constructor(q){this.url=q}connect(){this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{console.log("tugdeck: WebSocket connected"),this.state=T7.CONNECTED,this.retryDelay=H0,this.hideDisconnectBanner(),this.startHeartbeat();for(let q of this.openCallbacks)q()},this.ws.onmessage=(q)=>{if(q.data instanceof ArrayBuffer)try{let G=B0(q.data);this.dispatch(G.feedId,G.payload)}catch(G){console.error("tugdeck: failed to decode frame:",G)}},this.ws.onclose=(q)=>{if(console.log("tugdeck: WebSocket closed",q.code,q.reason),this.stopHeartbeat(),this.lastCloseCode=q.code,this.lastCloseReason=q.reason||null,this.intentionalClose)return;this.state=T7.DISCONNECTED,this.scheduleReconnect(),this.retryDelay=Math.min(this.retryDelay*2,R2)},this.ws.onerror=(q)=>{console.error("tugdeck: WebSocket error",q)}}scheduleReconnect(){if(this.retryTimer!==null)window.clearTimeout(this.retryTimer),this.retryTimer=null;this.countdownSeconds=Math.ceil(this.retryDelay/1000),this.showDisconnectBanner(),this.countdownTimer=window.setInterval(()=>{this.updateBannerCountdown()},1000),this.retryTimer=window.setTimeout(()=>{this.reconnect()},this.retryDelay)}reconnect(){if(this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null;this.state=T7.RECONNECTING,this.updateBannerText("Reconnecting..."),console.log("tugdeck: attempting reconnection"),this.connect()}showDisconnectBanner(){if(!this.bannerElement)this.bannerElement=document.getElementById("disconnect-banner");if(this.bannerElement)this.bannerElement.style.display="block",this.updateBannerText()}updateBannerText(q){if(!this.bannerElement)return;if(q){this.bannerElement.textContent=q;return}let G="Disconnected";if(this.lastCloseReason&&this.lastCloseReason.trim()!=="")G+=` (${this.lastCloseReason})`;G+=` -- reconnecting in ${this.countdownSeconds}s...`,this.bannerElement.textContent=G}updateBannerCountdown(){if(this.countdownSeconds=Math.max(0,this.countdownSeconds-1),this.updateBannerText(),this.countdownSeconds===0&&this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null}hideDisconnectBanner(){if(this.bannerElement)this.bannerElement.style.display="none";if(this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null}send(q,G){if(this.ws&&this.ws.readyState===WebSocket.OPEN){let J={feedId:q,payload:G};this.ws.send(z0(J))}}onOpen(q){this.openCallbacks.push(q)}onFrame(q,G){if(!this.callbacks.has(q))this.callbacks.set(q,[]);this.callbacks.get(q).push(G)}close(){if(this.intentionalClose=!0,this.stopHeartbeat(),this.retryTimer!==null)window.clearTimeout(this.retryTimer),this.retryTimer=null;if(this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null;if(this.ws)this.ws.close(),this.ws=null}dispatch(q,G){let J=this.callbacks.get(q);if(J)for(let Z of J)Z(G)}startHeartbeat(){this.heartbeatTimer=window.setInterval(()=>{this.send(G5.HEARTBEAT,new Uint8Array(0))},W2)}stopHeartbeat(){if(this.heartbeatTimer!==null)window.clearInterval(this.heartbeatTimer),this.heartbeatTimer=null}}var F0=100,C0="tugdeck-layout",N0=1,O2=500;class x8{cards=new Map;slots=new Map;gridContainer;connection;colSplit=0.667;rowSplits=[0.3333333333333333,0.6666666666666666];collapsedSlots=new Set;saveTimer=null;constructor(q,G){this.connection=G,this.gridContainer=document.createElement("div"),this.gridContainer.className="deck-grid",q.appendChild(this.gridContainer);for(let J of["terminal","git","files","stats"]){let Z=document.createElement("div");Z.className=`card-slot card-slot-${J}`,this.gridContainer.appendChild(Z),this.slots.set(J,Z)}this.createDragHandles(),this.loadLayout(),this.updateGridTracks(),window.addEventListener("resize",()=>this.handleResize()),G.onOpen(()=>this.handleResize())}addCard(q,G){this.cards.set(G,q);for(let Z of q.feedIds)this.connection.onFrame(Z,($)=>{q.onFrame(Z,$)});let J=this.slots.get(G);if(J){if(q.mount(J),q.collapsible!==!1){let Z=J.querySelector(".card-header");if(Z){let $=document.createElement("button");if($.className="collapse-btn",$.textContent=this.collapsedSlots.has(G)?"+":"-",$.addEventListener("click",()=>this.toggleCollapse(G)),Z.appendChild($),this.collapsedSlots.has(G))this.applyCollapse(G)}}}}toggleCollapse(q){if(this.collapsedSlots.has(q))this.expandCard(q);else this.collapseCard(q);this.scheduleSave()}collapseCard(q){this.collapsedSlots.add(q),this.applyCollapse(q)}expandCard(q){this.collapsedSlots.delete(q),this.applyExpand(q)}applyCollapse(q){let G=this.slots.get(q);if(!G)return;G.classList.add("collapsed");let J=G.querySelector(".collapse-btn");if(J)J.textContent="+";this.updateGridTracks()}applyExpand(q){let G=this.slots.get(q);if(!G)return;G.classList.remove("collapsed");let J=G.querySelector(".collapse-btn");if(J)J.textContent="-";this.updateGridTracks(),this.handleResize()}createDragHandles(){let q=document.createElement("div");q.className="drag-handle drag-handle-col",this.gridContainer.appendChild(q),this.setupColDrag(q);let G=document.createElement("div");G.className="drag-handle drag-handle-row",G.dataset.index="0",this.gridContainer.appendChild(G),this.setupRowDrag(G,0);let J=document.createElement("div");J.className="drag-handle drag-handle-row",J.dataset.index="1",this.gridContainer.appendChild(J),this.setupRowDrag(J,1)}setupColDrag(q){let G=0,J=0;q.addEventListener("pointerdown",(Z)=>{Z.preventDefault(),q.setPointerCapture(Z.pointerId),q.classList.add("active"),G=Z.clientX,J=this.colSplit;let $=(K)=>{let X=K.clientX-G,j=this.gridContainer.clientWidth,V=J+X/j,B=F0/j;V=Math.max(B,Math.min(1-B,V)),this.colSplit=V,this.updateGridTracks(),this.handleResize()},Y=(K)=>{q.releasePointerCapture(K.pointerId),q.classList.remove("active"),q.removeEventListener("pointermove",$),q.removeEventListener("pointerup",Y),this.scheduleSave()};q.addEventListener("pointermove",$),q.addEventListener("pointerup",Y)})}setupRowDrag(q,G){let J=0,Z=[];q.addEventListener("pointerdown",($)=>{$.preventDefault(),q.setPointerCapture($.pointerId),q.classList.add("active"),J=$.clientY,Z=[...this.rowSplits];let Y=(X)=>{let j=X.clientY-J,V=this.gridContainer.clientHeight,B=j/V,z=[...Z],H=F0/V;if(G===0)z[0]=Math.max(H,Math.min(z[1]-H,Z[0]+B));else z[1]=Math.max(z[0]+H,Math.min(1-H,Z[1]+B));this.rowSplits=z,this.updateGridTracks(),this.handleResize()},K=(X)=>{q.releasePointerCapture(X.pointerId),q.classList.remove("active"),q.removeEventListener("pointermove",Y),q.removeEventListener("pointerup",K),this.scheduleSave()};q.addEventListener("pointermove",Y),q.addEventListener("pointerup",K)})}updateGridTracks(){let q=(this.colSplit*100).toFixed(2)+"%",G=((1-this.colSplit)*100).toFixed(2)+"%";this.gridContainer.style.gridTemplateColumns=`${q} ${G}`;let J=["git","files","stats"];if(J.some(($)=>this.collapsedSlots.has($))){let $=J.map((Y)=>{return this.collapsedSlots.has(Y)?"28px":"1fr"});this.gridContainer.style.gridTemplateRows=$.join(" ")}else{let $=(this.rowSplits[0]*100).toFixed(2)+"%",Y=((this.rowSplits[1]-this.rowSplits[0])*100).toFixed(2)+"%",K=((1-this.rowSplits[1])*100).toFixed(2)+"%";this.gridContainer.style.gridTemplateRows=`${$} ${Y} ${K}`}this.positionHandles()}positionHandles(){let q=this.gridContainer.querySelectorAll(".drag-handle"),G=q[0],J=q[1],Z=q[2];if(G)G.style.left=`calc(${(this.colSplit*100).toFixed(2)}% - 3px)`;if(J)J.style.top=`calc(${(this.rowSplits[0]*100).toFixed(2)}% - 3px)`,J.style.left=`${(this.colSplit*100).toFixed(2)}%`;if(Z)Z.style.top=`calc(${(this.rowSplits[1]*100).toFixed(2)}% - 3px)`,Z.style.left=`${(this.colSplit*100).toFixed(2)}%`}saveLayout(){try{let q={version:N0,colSplit:this.colSplit,rowSplits:this.rowSplits,collapsed:Array.from(this.collapsedSlots)};localStorage.setItem(C0,JSON.stringify(q))}catch(q){console.warn("tugdeck: failed to save layout to localStorage",q)}}scheduleSave(){if(this.saveTimer!==null)window.clearTimeout(this.saveTimer);this.saveTimer=window.setTimeout(()=>{this.saveLayout(),this.saveTimer=null},O2)}loadLayout(){try{let q=localStorage.getItem(C0);if(!q)return;let G=JSON.parse(q);if(G.version!==N0){console.warn("tugdeck: layout version mismatch, using defaults");return}if(typeof G.colSplit==="number"&&G.colSplit>=0.1&&G.colSplit<=0.9)this.colSplit=G.colSplit;if(Array.isArray(G.rowSplits)&&G.rowSplits.length===2&&G.rowSplits[0]>=0.1&&G.rowSplits[1]>=G.rowSplits[0]+0.1&&G.rowSplits[1]<=0.9)this.rowSplits=G.rowSplits;if(Array.isArray(G.collapsed)){let J=["git","files","stats"],Z=G.collapsed.filter(($)=>J.includes($));this.collapsedSlots=new Set(Z)}}catch(q){console.warn("tugdeck: failed to load layout from localStorage",q)}}handleResize(){for(let[q,G]of this.cards){let J=this.slots.get(q);if(J)G.onResize(J.clientWidth,J.clientHeight)}}destroy(){if(this.saveTimer!==null)window.clearTimeout(this.saveTimer),this.saveTimer=null;for(let q of this.cards.values())q.destroy();this.cards.clear()}}var{defineProperty:Q1,getOwnPropertyDescriptor:A2}=Object,k2=(q,G)=>{for(var J in G)Q1(q,J,{get:G[J],enumerable:!0})},Z5=(q,G,J,Z)=>{for(var $=Z>1?void 0:Z?A2(G,J):G,Y=q.length-1,K;Y>=0;Y--)(K=q[Y])&&($=(Z?K(G,J,$):K($))||$);return Z&&$&&Q1(G,J,$),$},y=(q,G)=>(J,Z)=>G(J,Z,q),U0="Terminal input",c8={get:()=>U0,set:(q)=>U0=q},M0="Too much output to announce, navigate to rows manually to read",a8={get:()=>M0,set:(q)=>M0=q};function L2(q){return q.replace(/\r?\n/g,"\r")}function x2(q,G){return G?"\x1B[200~"+q+"\x1B[201~":q}function S2(q,G){q.clipboardData&&q.clipboardData.setData("text/plain",G.selectionText),q.preventDefault()}function w2(q,G,J,Z){if(q.stopPropagation(),q.clipboardData){let $=q.clipboardData.getData("text/plain");P1($,G,J,Z)}}function P1(q,G,J,Z){q=L2(q),q=x2(q,J.decPrivateModes.bracketedPasteMode&&Z.rawOptions.ignoreBracketedPasteMode!==!0),J.triggerDataEvent(q,!0),G.value=""}function W1(q,G,J){let Z=J.getBoundingClientRect(),$=q.clientX-Z.left-10,Y=q.clientY-Z.top-10;G.style.width="20px",G.style.height="20px",G.style.left=`${$}px`,G.style.top=`${Y}px`,G.style.zIndex="1000",G.focus()}function D0(q,G,J,Z,$){W1(q,G,J),$&&Z.rightClickSelect(q),G.value=Z.selectionText,G.select()}function L6(q){return q>65535?(q-=65536,String.fromCharCode((q>>10)+55296)+String.fromCharCode(q%1024+56320)):String.fromCharCode(q)}function G8(q,G=0,J=q.length){let Z="";for(let $=G;$<J;++$){let Y=q[$];Y>65535?(Y-=65536,Z+=String.fromCharCode((Y>>10)+55296)+String.fromCharCode(Y%1024+56320)):Z+=String.fromCharCode(Y)}return Z}var y2=class{constructor(){this._interim=0}clear(){this._interim=0}decode(q,G){let J=q.length;if(!J)return 0;let Z=0,$=0;if(this._interim){let Y=q.charCodeAt($++);56320<=Y&&Y<=57343?G[Z++]=(this._interim-55296)*1024+Y-56320+65536:(G[Z++]=this._interim,G[Z++]=Y),this._interim=0}for(let Y=$;Y<J;++Y){let K=q.charCodeAt(Y);if(55296<=K&&K<=56319){if(++Y>=J)return this._interim=K,Z;let X=q.charCodeAt(Y);56320<=X&&X<=57343?G[Z++]=(K-55296)*1024+X-56320+65536:(G[Z++]=K,G[Z++]=X);continue}K!==65279&&(G[Z++]=K)}return Z}},I2=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(q,G){let J=q.length;if(!J)return 0;let Z=0,$,Y,K,X,j=0,V=0;if(this.interim[0]){let H=!1,F=this.interim[0];F&=(F&224)===192?31:(F&240)===224?15:7;let C=0,M;for(;(M=this.interim[++C]&63)&&C<4;)F<<=6,F|=M;let k=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,I=k-C;for(;V<I;){if(V>=J)return 0;if(M=q[V++],(M&192)!==128){V--,H=!0;break}else this.interim[C++]=M,F<<=6,F|=M&63}H||(k===2?F<128?V--:G[Z++]=F:k===3?F<2048||F>=55296&&F<=57343||F===65279||(G[Z++]=F):F<65536||F>1114111||(G[Z++]=F)),this.interim.fill(0)}let B=J-4,z=V;for(;z<J;){for(;z<B&&!(($=q[z])&128)&&!((Y=q[z+1])&128)&&!((K=q[z+2])&128)&&!((X=q[z+3])&128);)G[Z++]=$,G[Z++]=Y,G[Z++]=K,G[Z++]=X,z+=4;if($=q[z++],$<128)G[Z++]=$;else if(($&224)===192){if(z>=J)return this.interim[0]=$,Z;if(Y=q[z++],(Y&192)!==128){z--;continue}if(j=($&31)<<6|Y&63,j<128){z--;continue}G[Z++]=j}else if(($&240)===224){if(z>=J)return this.interim[0]=$,Z;if(Y=q[z++],(Y&192)!==128){z--;continue}if(z>=J)return this.interim[0]=$,this.interim[1]=Y,Z;if(K=q[z++],(K&192)!==128){z--;continue}if(j=($&15)<<12|(Y&63)<<6|K&63,j<2048||j>=55296&&j<=57343||j===65279)continue;G[Z++]=j}else if(($&248)===240){if(z>=J)return this.interim[0]=$,Z;if(Y=q[z++],(Y&192)!==128){z--;continue}if(z>=J)return this.interim[0]=$,this.interim[1]=Y,Z;if(K=q[z++],(K&192)!==128){z--;continue}if(z>=J)return this.interim[0]=$,this.interim[1]=Y,this.interim[2]=K,Z;if(X=q[z++],(X&192)!==128){z--;continue}if(j=($&7)<<18|(Y&63)<<12|(K&63)<<6|X&63,j<65536||j>1114111)continue;G[Z++]=j}}return Z}},R1="",x6=" ",Q7=class q{constructor(){this.fg=0,this.bg=0,this.extended=new l7}static toColorRGB(G){return[G>>>16&255,G>>>8&255,G&255]}static fromColorRGB(G){return(G[0]&255)<<16|(G[1]&255)<<8|G[2]&255}clone(){let G=new q;return G.fg=this.fg,G.bg=this.bg,G.extended=this.extended.clone(),G}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},l7=class q{constructor(G=0,J=0){this._ext=0,this._urlId=0,this._ext=G,this._urlId=J}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(G){this._ext=G}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(G){this._ext&=-469762049,this._ext|=G<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(G){this._ext&=-67108864,this._ext|=G&67108863}get urlId(){return this._urlId}set urlId(G){this._urlId=G}get underlineVariantOffset(){let G=(this._ext&3758096384)>>29;return G<0?G^4294967288:G}set underlineVariantOffset(G){this._ext&=536870911,this._ext|=G<<29&3758096384}clone(){return new q(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},l5=class q extends Q7{constructor(){super(...arguments);this.content=0,this.fg=0,this.bg=0,this.extended=new l7,this.combinedData=""}static fromCharData(G){let J=new q;return J.setFromCharData(G),J}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?L6(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(G){this.fg=G[0],this.bg=0;let J=!1;if(G[1].length>2)J=!0;else if(G[1].length===2){let Z=G[1].charCodeAt(0);if(55296<=Z&&Z<=56319){let $=G[1].charCodeAt(1);56320<=$&&$<=57343?this.content=(Z-55296)*1024+$-56320+65536|G[2]<<22:J=!0}else J=!0}else this.content=G[1].charCodeAt(0)|G[2]<<22;J&&(this.combinedData=G[1],this.content=2097152|G[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},Q0="di$target",l8="di$dependencies",S8=new Map;function T2(q){return q[l8]||[]}function Q5(q){if(S8.has(q))return S8.get(q);let G=function(J,Z,$){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");_2(G,J,$)};return G._id=q,S8.set(q,G),G}function _2(q,G,J){G[Q0]===G?G[l8].push({id:q,index:J}):(G[l8]=[{id:q,index:J}],G[Q0]=G)}var y5=Q5("BufferService"),O1=Q5("CoreMouseService"),p6=Q5("CoreService"),v2=Q5("CharsetService"),P9=Q5("InstantiationService"),A1=Q5("LogService"),I5=Q5("OptionsService"),k1=Q5("OscLinkService"),E2=Q5("UnicodeService"),P7=Q5("DecorationService"),o8=class{constructor(q,G,J){this._bufferService=q,this._optionsService=G,this._oscLinkService=J}provideLinks(q,G){let J=this._bufferService.buffer.lines.get(q-1);if(!J){G(void 0);return}let Z=[],$=this._optionsService.rawOptions.linkHandler,Y=new l5,K=J.getTrimmedLength(),X=-1,j=-1,V=!1;for(let B=0;B<K;B++)if(!(j===-1&&!J.hasContent(B))){if(J.loadCell(B,Y),Y.hasExtendedAttrs()&&Y.extended.urlId)if(j===-1){j=B,X=Y.extended.urlId;continue}else V=Y.extended.urlId!==X;else j!==-1&&(V=!0);if(V||j!==-1&&B===K-1){let z=this._oscLinkService.getLinkData(X)?.uri;if(z){let H={start:{x:j+1,y:q},end:{x:B+(!V&&B===K-1?1:0),y:q}},F=!1;if(!$?.allowNonHttpProtocols)try{let C=new URL(z);["http:","https:"].includes(C.protocol)||(F=!0)}catch{F=!0}F||Z.push({text:z,range:H,activate:(C,M)=>$?$.activate(C,M,H):b2(C,M),hover:(C,M)=>$?.hover?.(C,M,H),leave:(C,M)=>$?.leave?.(C,M,H)})}V=!1,Y.hasExtendedAttrs()&&Y.extended.urlId?(j=B,X=Y.extended.urlId):(j=-1,X=-1)}}G(Z)}};o8=Z5([y(0,y5),y(1,I5),y(2,k1)],o8);function b2(q,G){if(confirm(`Do you want to navigate to ${G}?

WARNING: This link could potentially be dangerous`)){let J=window.open();if(J){try{J.opener=null}catch{}J.location.href=G}else console.warn("Opening link blocked as opener could not be cleared")}}var J8=Q5("CharSizeService"),z6=Q5("CoreBrowserService"),W9=Q5("MouseService"),B6=Q5("RenderService"),g2=Q5("SelectionService"),L1=Q5("CharacterJoinerService"),l6=Q5("ThemeService"),x1=Q5("LinkProviderService"),m2=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(q){setTimeout(()=>{throw q.stack?P0.isErrorNoTelemetry(q)?new P0(q.message+`

`+q.stack):Error(q.message+`

`+q.stack):q},0)}}addListener(q){return this.listeners.push(q),()=>{this._removeListener(q)}}emit(q){this.listeners.forEach((G)=>{G(q)})}_removeListener(q){this.listeners.splice(this.listeners.indexOf(q),1)}setUnexpectedErrorHandler(q){this.unexpectedErrorHandler=q}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(q){this.unexpectedErrorHandler(q),this.emit(q)}onUnexpectedExternalError(q){this.unexpectedErrorHandler(q)}},f2=new m2;function m7(q){p2(q)||f2.onUnexpectedError(q)}var s8="Canceled";function p2(q){return q instanceof h2?!0:q instanceof Error&&q.name===s8&&q.message===s8}var h2=class extends Error{constructor(){super(s8),this.name=this.message}};function u2(q){return q?Error(`Illegal argument: ${q}`):Error("Illegal argument")}var P0=class q extends Error{constructor(G){super(G),this.name="CodeExpectedError"}static fromError(G){if(G instanceof q)return G;let J=new q;return J.message=G.message,J.stack=G.stack,J}static isErrorNoTelemetry(G){return G.name==="CodeExpectedError"}},n8=class q extends Error{constructor(G){super(G||"An unexpected bug occurred."),Object.setPrototypeOf(this,q.prototype)}};function d2(q,G,J=0,Z=q.length){let $=J,Y=Z;for(;$<Y;){let K=Math.floor(($+Y)/2);G(q[K])?$=K+1:Y=K}return $-1}var c2=class q{constructor(G){this._array=G,this._findLastMonotonousLastIdx=0}findLastMonotonous(G){if(q.assertInvariants){if(this._prevFindLastPredicate){for(let Z of this._array)if(this._prevFindLastPredicate(Z)&&!G(Z))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=G}let J=d2(this._array,G,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=J+1,J===-1?void 0:this._array[J]}};c2.assertInvariants=!1;function g5(q,G=0){return q[q.length-(1+G)]}var S1;((q)=>{function G(Y){return Y<0}q.isLessThan=G;function J(Y){return Y<=0}q.isLessThanOrEqual=J;function Z(Y){return Y>0}q.isGreaterThan=Z;function $(Y){return Y===0}q.isNeitherLessOrGreaterThan=$,q.greaterThan=1,q.lessThan=-1,q.neitherLessOrGreaterThan=0})(S1||={});function a2(q,G){return(J,Z)=>G(q(J),q(Z))}var l2=(q,G)=>q-G,W0=class q{constructor(G){this.iterate=G}forEach(G){this.iterate((J)=>(G(J),!0))}toArray(){let G=[];return this.iterate((J)=>(G.push(J),!0)),G}filter(G){return new q((J)=>this.iterate((Z)=>G(Z)?J(Z):!0))}map(G){return new q((J)=>this.iterate((Z)=>J(G(Z))))}some(G){let J=!1;return this.iterate((Z)=>(J=G(Z),!J)),J}findFirst(G){let J;return this.iterate((Z)=>G(Z)?(J=Z,!1):!0),J}findLast(G){let J;return this.iterate((Z)=>(G(Z)&&(J=Z),!0)),J}findLastMaxBy(G){let J,Z=!0;return this.iterate(($)=>((Z||S1.isGreaterThan(G($,J)))&&(Z=!1,J=$),!0)),J}};W0.empty=new W0((q)=>{});function o2(q,G){let J=Object.create(null);for(let Z of q){let $=G(Z),Y=J[$];Y||(Y=J[$]=[]),Y.push(Z)}return J}var R0,O0,T$=class{constructor(q,G){this.toKey=G,this._map=new Map,this[R0]="SetWithKey";for(let J of q)this.add(J)}get size(){return this._map.size}add(q){let G=this.toKey(q);return this._map.set(G,q),this}delete(q){return this._map.delete(this.toKey(q))}has(q){return this._map.has(this.toKey(q))}*entries(){for(let q of this._map.values())yield[q,q]}keys(){return this.values()}*values(){for(let q of this._map.values())yield q}clear(){this._map.clear()}forEach(q,G){this._map.forEach((J)=>q.call(G,J,J,this))}[(O0=Symbol.iterator,R0=Symbol.toStringTag,O0)](){return this.values()}},s2=class{constructor(){this.map=new Map}add(q,G){let J=this.map.get(q);J||(J=new Set,this.map.set(q,J)),J.add(G)}delete(q,G){let J=this.map.get(q);J&&(J.delete(G),J.size===0&&this.map.delete(q))}forEach(q,G){let J=this.map.get(q);J&&J.forEach(G)}get(q){return this.map.get(q)||new Set}};function n2(q,G){let J=this,Z=!1,$;return function(){if(Z)return $;if(Z=!0,G)try{$=q.apply(J,arguments)}finally{G()}else $=q.apply(J,arguments);return $}}var w1;((q)=>{function G(O){return O&&typeof O=="object"&&typeof O[Symbol.iterator]=="function"}q.is=G;let J=Object.freeze([]);function Z(){return J}q.empty=Z;function*$(O){yield O}q.single=$;function Y(O){return G(O)?O:$(O)}q.wrap=Y;function K(O){return O||J}q.from=K;function*X(O){for(let w=O.length-1;w>=0;w--)yield O[w]}q.reverse=X;function j(O){return!O||O[Symbol.iterator]().next().done===!0}q.isEmpty=j;function V(O){return O[Symbol.iterator]().next().value}q.first=V;function B(O,w){let T=0;for(let f of O)if(w(f,T++))return!0;return!1}q.some=B;function z(O,w){for(let T of O)if(w(T))return T}q.find=z;function*H(O,w){for(let T of O)w(T)&&(yield T)}q.filter=H;function*F(O,w){let T=0;for(let f of O)yield w(f,T++)}q.map=F;function*C(O,w){let T=0;for(let f of O)yield*w(f,T++)}q.flatMap=C;function*M(...O){for(let w of O)yield*w}q.concat=M;function k(O,w,T){let f=T;for(let o of O)f=w(f,o);return f}q.reduce=k;function*I(O,w,T=O.length){for(w<0&&(w+=O.length),T<0?T+=O.length:T>O.length&&(T=O.length);w<T;w++)yield O[w]}q.slice=I;function _(O,w=Number.POSITIVE_INFINITY){let T=[];if(w===0)return[T,O];let f=O[Symbol.iterator]();for(let o=0;o<w;o++){let K5=f.next();if(K5.done)return[T,q.empty()];T.push(K5.value)}return[T,{[Symbol.iterator](){return f}}]}q.consume=_;async function S(O){let w=[];for await(let T of O)w.push(T);return Promise.resolve(w)}q.asyncToArray=S})(w1||={});var r2=!1,g6=null,i2=class q{constructor(){this.livingDisposables=new Map}getDisposableData(G){let J=this.livingDisposables.get(G);return J||(J={parent:null,source:null,isSingleton:!1,value:G,idx:q.idx++},this.livingDisposables.set(G,J)),J}trackDisposable(G){let J=this.getDisposableData(G);J.source||(J.source=Error().stack)}setParent(G,J){let Z=this.getDisposableData(G);Z.parent=J}markAsDisposed(G){this.livingDisposables.delete(G)}markAsSingleton(G){this.getDisposableData(G).isSingleton=!0}getRootParent(G,J){let Z=J.get(G);if(Z)return Z;let $=G.parent?this.getRootParent(this.getDisposableData(G.parent),J):G;return J.set(G,$),$}getTrackedDisposables(){let G=new Map;return[...this.livingDisposables.entries()].filter(([,J])=>J.source!==null&&!this.getRootParent(J,G).isSingleton).flatMap(([J])=>J)}computeLeakingDisposables(G=10,J){let Z;if(J)Z=J;else{let j=new Map,V=[...this.livingDisposables.values()].filter((z)=>z.source!==null&&!this.getRootParent(z,j).isSingleton);if(V.length===0)return;let B=new Set(V.map((z)=>z.value));if(Z=V.filter((z)=>!(z.parent&&B.has(z.parent))),Z.length===0)throw Error("There are cyclic diposable chains!")}if(!Z)return;function $(j){function V(z,H){for(;z.length>0&&H.some((F)=>typeof F=="string"?F===z[0]:z[0].match(F));)z.shift()}let B=j.source.split(`
`).map((z)=>z.trim().replace("at ","")).filter((z)=>z!=="");return V(B,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),B.reverse()}let Y=new s2;for(let j of Z){let V=$(j);for(let B=0;B<=V.length;B++)Y.add(V.slice(0,B).join(`
`),j)}Z.sort(a2((j)=>j.idx,l2));let K="",X=0;for(let j of Z.slice(0,G)){X++;let V=$(j),B=[];for(let z=0;z<V.length;z++){let H=V[z];H=`(shared with ${Y.get(V.slice(0,z+1).join(`
`)).size}/${Z.length} leaks) at ${H}`;let F=Y.get(V.slice(0,z).join(`
`)),C=o2([...F].map((M)=>$(M)[z]),(M)=>M);delete C[V[z]];for(let[M,k]of Object.entries(C))B.unshift(`    - stacktraces of ${k.length} other leaks continue with ${M}`);B.unshift(H)}K+=`


==================== Leaking disposable ${X}/${Z.length}: ${j.value.constructor.name} ====================
${B.join(`
`)}
============================================================

`}return Z.length>G&&(K+=`


... and ${Z.length-G} more leaking disposables

`),{leaks:Z,details:K}}};i2.idx=0;function t2(q){g6=q}if(r2){let q="__is_disposable_tracked__";t2(new class{trackDisposable(G){let J=Error("Potentially leaked disposable").stack;setTimeout(()=>{G[q]||console.log(J)},3000)}setParent(G,J){if(G&&G!==g.None)try{G[q]=!0}catch{}}markAsDisposed(G){if(G&&G!==g.None)try{G[q]=!0}catch{}}markAsSingleton(G){}})}function Z8(q){return g6?.trackDisposable(q),q}function $8(q){g6?.markAsDisposed(q)}function N7(q,G){g6?.setParent(q,G)}function e2(q,G){if(g6)for(let J of q)g6.setParent(J,G)}function A0(q){return g6?.markAsSingleton(q),q}function m6(q){if(w1.is(q)){let G=[];for(let J of q)if(J)try{J.dispose()}catch(Z){G.push(Z)}if(G.length===1)throw G[0];if(G.length>1)throw AggregateError(G,"Encountered errors while disposing of store");return Array.isArray(q)?[]:q}else if(q)return q.dispose(),q}function q3(...q){let G=r(()=>m6(q));return e2(q,G),G}function r(q){let G=Z8({dispose:n2(()=>{$8(G),q()})});return G}var y1=class q{constructor(){this._toDispose=new Set,this._isDisposed=!1,Z8(this)}dispose(){this._isDisposed||($8(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{m6(this._toDispose)}finally{this._toDispose.clear()}}add(G){if(!G)return G;if(G===this)throw Error("Cannot register a disposable on itself!");return N7(G,this),this._isDisposed?q.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(G),G}delete(G){if(G){if(G===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(G),G.dispose()}}deleteAndLeak(G){G&&this._toDispose.has(G)&&(this._toDispose.delete(G),N7(G,null))}};y1.DISABLE_DISPOSED_WARNING=!1;var S6=y1,g=class{constructor(){this._store=new S6,Z8(this),N7(this._store,this)}dispose(){$8(this),this._store.dispose()}_register(q){if(q===this)throw Error("Cannot register a disposable on itself!");return this._store.add(q)}};g.None=Object.freeze({dispose(){}});var a6=class{constructor(){this._isDisposed=!1,Z8(this)}get value(){return this._isDisposed?void 0:this._value}set value(q){this._isDisposed||q===this._value||(this._value?.dispose(),q&&N7(q,this),this._value=q)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,$8(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let q=this._value;return this._value=void 0,q&&N7(q,null),q}},p5=typeof window=="object"?window:globalThis,r8=class q{constructor(G){this.element=G,this.next=q.Undefined,this.prev=q.Undefined}};r8.Undefined=new r8(void 0);var t=r8,k0=class{constructor(){this._first=t.Undefined,this._last=t.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===t.Undefined}clear(){let q=this._first;for(;q!==t.Undefined;){let G=q.next;q.prev=t.Undefined,q.next=t.Undefined,q=G}this._first=t.Undefined,this._last=t.Undefined,this._size=0}unshift(q){return this._insert(q,!1)}push(q){return this._insert(q,!0)}_insert(q,G){let J=new t(q);if(this._first===t.Undefined)this._first=J,this._last=J;else if(G){let $=this._last;this._last=J,J.prev=$,$.next=J}else{let $=this._first;this._first=J,J.next=$,$.prev=J}this._size+=1;let Z=!1;return()=>{Z||(Z=!0,this._remove(J))}}shift(){if(this._first!==t.Undefined){let q=this._first.element;return this._remove(this._first),q}}pop(){if(this._last!==t.Undefined){let q=this._last.element;return this._remove(this._last),q}}_remove(q){if(q.prev!==t.Undefined&&q.next!==t.Undefined){let G=q.prev;G.next=q.next,q.next.prev=G}else q.prev===t.Undefined&&q.next===t.Undefined?(this._first=t.Undefined,this._last=t.Undefined):q.next===t.Undefined?(this._last=this._last.prev,this._last.next=t.Undefined):q.prev===t.Undefined&&(this._first=this._first.next,this._first.prev=t.Undefined);this._size-=1}*[Symbol.iterator](){let q=this._first;for(;q!==t.Undefined;)yield q.element,q=q.next}},G3=globalThis.performance&&typeof globalThis.performance.now=="function",J3=class q{static create(G){return new q(G)}constructor(G){this._now=G3&&G===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},Z3=!1,L0=!1,$3=!1,k5;((q)=>{q.None=()=>g.None;function G(N){if($3){let{onDidAddListener:U}=N,W=t8.create(),Q=0;N.onDidAddListener=()=>{++Q===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),W.print()),U?.()}}}function J(N,U){return H(N,()=>{},0,void 0,!0,void 0,U)}q.defer=J;function Z(N){return(U,W=null,Q)=>{let P=!1,D;return D=N((A)=>{if(!P)return D?D.dispose():P=!0,U.call(W,A)},null,Q),P&&D.dispose(),D}}q.once=Z;function $(N,U,W){return B((Q,P=null,D)=>N((A)=>Q.call(P,U(A)),null,D),W)}q.map=$;function Y(N,U,W){return B((Q,P=null,D)=>N((A)=>{U(A),Q.call(P,A)},null,D),W)}q.forEach=Y;function K(N,U,W){return B((Q,P=null,D)=>N((A)=>U(A)&&Q.call(P,A),null,D),W)}q.filter=K;function X(N){return N}q.signal=X;function j(...N){return(U,W=null,Q)=>{let P=q3(...N.map((D)=>D((A)=>U.call(W,A))));return z(P,Q)}}q.any=j;function V(N,U,W,Q){let P=W;return $(N,(D)=>(P=U(P,D),P),Q)}q.reduce=V;function B(N,U){let W,Q={onWillAddFirstListener(){W=N(P.fire,P)},onDidRemoveLastListener(){W?.dispose()}};U||G(Q);let P=new x(Q);return U?.add(P),P.event}function z(N,U){return U instanceof Array?U.push(N):U&&U.add(N),N}function H(N,U,W=100,Q=!1,P=!1,D,A){let L,v,d,p=0,u,A5={leakWarningThreshold:D,onWillAddFirstListener(){L=N((X5)=>{p++,v=U(v,X5),Q&&!d&&(c.fire(v),v=void 0),u=()=>{let a=v;v=void 0,d=void 0,(!Q||p>1)&&c.fire(a),p=0},typeof W=="number"?(clearTimeout(d),d=setTimeout(u,W)):d===void 0&&(d=0,queueMicrotask(u))})},onWillRemoveListener(){P&&p>0&&u?.()},onDidRemoveLastListener(){u=void 0,L.dispose()}};A||G(A5);let c=new x(A5);return A?.add(c),c.event}q.debounce=H;function F(N,U=0,W){return q.debounce(N,(Q,P)=>Q?(Q.push(P),Q):[P],U,void 0,!0,void 0,W)}q.accumulate=F;function C(N,U=(Q,P)=>Q===P,W){let Q=!0,P;return K(N,(D)=>{let A=Q||!U(D,P);return Q=!1,P=D,A},W)}q.latch=C;function M(N,U,W){return[q.filter(N,U,W),q.filter(N,(Q)=>!U(Q),W)]}q.split=M;function k(N,U=!1,W=[],Q){let P=W.slice(),D=N((v)=>{P?P.push(v):L.fire(v)});Q&&Q.add(D);let A=()=>{P?.forEach((v)=>L.fire(v)),P=null},L=new x({onWillAddFirstListener(){D||(D=N((v)=>L.fire(v)),Q&&Q.add(D))},onDidAddFirstListener(){P&&(U?setTimeout(A):A())},onDidRemoveLastListener(){D&&D.dispose(),D=null}});return Q&&Q.add(L),L.event}q.buffer=k;function I(N,U){return(W,Q,P)=>{let D=U(new S);return N(function(A){let L=D.evaluate(A);L!==_&&W.call(Q,L)},void 0,P)}}q.chain=I;let _=Symbol("HaltChainable");class S{constructor(){this.steps=[]}map(N){return this.steps.push(N),this}forEach(N){return this.steps.push((U)=>(N(U),U)),this}filter(N){return this.steps.push((U)=>N(U)?U:_),this}reduce(N,U){let W=U;return this.steps.push((Q)=>(W=N(W,Q),W)),this}latch(N=(U,W)=>U===W){let U=!0,W;return this.steps.push((Q)=>{let P=U||!N(Q,W);return U=!1,W=Q,P?Q:_}),this}evaluate(N){for(let U of this.steps)if(N=U(N),N===_)break;return N}}function O(N,U,W=(Q)=>Q){let Q=(...L)=>A.fire(W(...L)),P=()=>N.on(U,Q),D=()=>N.removeListener(U,Q),A=new x({onWillAddFirstListener:P,onDidRemoveLastListener:D});return A.event}q.fromNodeEventEmitter=O;function w(N,U,W=(Q)=>Q){let Q=(...L)=>A.fire(W(...L)),P=()=>N.addEventListener(U,Q),D=()=>N.removeEventListener(U,Q),A=new x({onWillAddFirstListener:P,onDidRemoveLastListener:D});return A.event}q.fromDOMEventEmitter=w;function T(N){return new Promise((U)=>Z(N)(U))}q.toPromise=T;function f(N){let U=new x;return N.then((W)=>{U.fire(W)},()=>{U.fire(void 0)}).finally(()=>{U.dispose()}),U.event}q.fromPromise=f;function o(N,U){return N((W)=>U.fire(W))}q.forward=o;function K5(N,U,W){return U(W),N((Q)=>U(Q))}q.runAndSubscribe=K5;class S5{constructor(N,U){this._observable=N,this._counter=0,this._hasChanged=!1;let W={onWillAddFirstListener:()=>{N.addObserver(this)},onDidRemoveLastListener:()=>{N.removeObserver(this)}};U||G(W),this.emitter=new x(W),U&&U.add(this.emitter)}beginUpdate(N){this._counter++}handlePossibleChange(N){}handleChange(N,U){this._hasChanged=!0}endUpdate(N){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function E(N,U){return new S5(N,U).emitter.event}q.fromObservable=E;function d5(N){return(U,W,Q)=>{let P=0,D=!1,A={beginUpdate(){P++},endUpdate(){P--,P===0&&(N.reportChanges(),D&&(D=!1,U.call(W)))},handlePossibleChange(){},handleChange(){D=!0}};N.addObserver(A),N.reportChanges();let L={dispose(){N.removeObserver(A)}};return Q instanceof S6?Q.add(L):Array.isArray(Q)&&Q.push(L),L}}q.fromObservableLight=d5})(k5||={});var i8=class q{constructor(G){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${G}_${q._idPool++}`,q.all.add(this)}start(G){this._stopWatch=new J3,this.listenerCount=G}stop(){if(this._stopWatch){let G=this._stopWatch.elapsed();this.durations.push(G),this.elapsedOverall+=G,this.invocationCount+=1,this._stopWatch=void 0}}};i8.all=new Set,i8._idPool=0;var Y3=i8,x0=-1,I1=class q{constructor(G,J,Z=(q._idPool++).toString(16).padStart(3,"0")){this._errorHandler=G,this.threshold=J,this.name=Z,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(G,J){let Z=this.threshold;if(Z<=0||J<Z)return;this._stacks||(this._stacks=new Map);let $=this._stacks.get(G.value)||0;if(this._stacks.set(G.value,$+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=Z*0.5;let[Y,K]=this.getMostFrequentStack(),X=`[${this.name}] potential listener LEAK detected, having ${J} listeners already. MOST frequent listener (${K}):`;console.warn(X),console.warn(Y);let j=new X3(X,Y);this._errorHandler(j)}return()=>{let Y=this._stacks.get(G.value)||0;this._stacks.set(G.value,Y-1)}}getMostFrequentStack(){if(!this._stacks)return;let G,J=0;for(let[Z,$]of this._stacks)(!G||J<$)&&(G=[Z,$],J=$);return G}};I1._idPool=1;var K3=I1,t8=class q{constructor(G){this.value=G}static create(){let G=Error();return new q(G.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},X3=class extends Error{constructor(q,G){super(q),this.name="ListenerLeakError",this.stack=G}},V3=class extends Error{constructor(q,G){super(q),this.name="ListenerRefusalError",this.stack=G}},j3=0,f7=class{constructor(q){this.value=q,this.id=j3++}},z3=2,B3=(q,G)=>{if(q instanceof f7)G(q);else for(let J=0;J<q.length;J++){let Z=q[J];Z&&G(Z)}},p7;if(Z3){let q=[];setInterval(()=>{q.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(q.join(`
`)),q.length=0)},3000),p7=new FinalizationRegistry((G)=>{typeof G=="string"&&q.push(G)})}var x=class{constructor(q){this._size=0,this._options=q,this._leakageMon=x0>0||this._options?.leakWarningThreshold?new K3(q?.onListenerError??m7,this._options?.leakWarningThreshold??x0):void 0,this._perfMon=this._options?._profName?new Y3(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(L0){let q=this._listeners;queueMicrotask(()=>{B3(q,(G)=>G.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(q,G,J)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let X=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(X);let j=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],V=new V3(`${X}. HINT: Stack shows most frequent listener (${j[1]}-times)`,j[0]);return(this._options?.onListenerError||m7)(V),g.None}if(this._disposed)return g.None;G&&(q=q.bind(G));let Z=new f7(q),$,Y;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*0.2)&&(Z.stack=t8.create(),$=this._leakageMon.check(Z.stack,this._size+1)),L0&&(Z.stack=Y??t8.create()),this._listeners?this._listeners instanceof f7?(this._deliveryQueue??=new H3,this._listeners=[this._listeners,Z]):this._listeners.push(Z):(this._options?.onWillAddFirstListener?.(this),this._listeners=Z,this._options?.onDidAddFirstListener?.(this)),this._size++;let K=r(()=>{p7?.unregister(K),$?.(),this._removeListener(Z)});if(J instanceof S6?J.add(K):Array.isArray(J)&&J.push(K),p7){let X=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),j=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(X);p7.register(K,j?.[2]??X,K)}return K},this._event}_removeListener(q){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let G=this._listeners,J=G.indexOf(q);if(J===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,G[J]=void 0;let Z=this._deliveryQueue.current===this;if(this._size*z3<=G.length){let $=0;for(let Y=0;Y<G.length;Y++)G[Y]?G[$++]=G[Y]:Z&&(this._deliveryQueue.end--,$<this._deliveryQueue.i&&this._deliveryQueue.i--);G.length=$}}_deliver(q,G){if(!q)return;let J=this._options?.onListenerError||m7;if(!J){q.value(G);return}try{q.value(G)}catch(Z){J(Z)}}_deliverQueue(q){let G=q.current._listeners;for(;q.i<q.end;)this._deliver(G[q.i++],q.value);q.reset()}fire(q){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof f7)this._deliver(this._listeners,q);else{let G=this._deliveryQueue;G.enqueue(this,q,this._listeners.length),this._deliverQueue(G)}this._perfMon?.stop()}hasListeners(){return this._size>0}},H3=class{constructor(){this.i=-1,this.end=0}enqueue(q,G,J){this.i=0,this.end=J,this.current=q,this.value=G}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},e8=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new x,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new x,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(G){return this.mapWindowIdToZoomLevel.get(this.getWindowId(G))??0}setZoomLevel(G,J){if(this.getZoomLevel(J)===G)return;let Z=this.getWindowId(J);this.mapWindowIdToZoomLevel.set(Z,G),this._onDidChangeZoomLevel.fire(Z)}getZoomFactor(G){return this.mapWindowIdToZoomFactor.get(this.getWindowId(G))??1}setZoomFactor(G,J){this.mapWindowIdToZoomFactor.set(this.getWindowId(J),G)}setFullscreen(G,J){if(this.isFullscreen(J)===G)return;let Z=this.getWindowId(J);this.mapWindowIdToFullScreen.set(Z,G),this._onDidChangeFullscreen.fire(Z)}isFullscreen(G){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(G))}getWindowId(G){return G.vscodeWindowId}};e8.INSTANCE=new e8;var R9=e8;function F3(q,G,J){typeof G=="string"&&(G=q.matchMedia(G)),G.addEventListener("change",J)}var _$=R9.INSTANCE.onDidChangeZoomLevel;function C3(q){return R9.INSTANCE.getZoomFactor(q)}var v$=R9.INSTANCE.onDidChangeFullscreen,o6=typeof navigator=="object"?navigator.userAgent:"",q9=o6.indexOf("Firefox")>=0,h7=o6.indexOf("AppleWebKit")>=0,O9=o6.indexOf("Chrome")>=0,T1=!O9&&o6.indexOf("Safari")>=0,E$=o6.indexOf("Electron/")>=0,b$=o6.indexOf("Android")>=0,u7=!1;if(typeof p5.matchMedia=="function"){let q=p5.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),G=p5.matchMedia("(display-mode: fullscreen)");u7=q.matches,F3(p5,q,({matches:J})=>{u7&&G.matches||(u7=J)})}function N3(){return u7}var c6="en",o7=!1,s7=!1,F7=!1,U3=!1,_1=!1,v1=!1,M3=!1,D3=!1,Q3=!1,P3=!1,_7,d7=c6,S0=c6,W3,X6,j6=globalThis,f5;typeof j6.vscode<"u"&&typeof j6.vscode.process<"u"?f5=j6.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(f5=process);var E1=typeof f5?.versions?.electron=="string",R3=E1&&f5?.type==="renderer";if(typeof f5=="object"){o7=f5.platform==="win32",s7=f5.platform==="darwin",F7=f5.platform==="linux",U3=F7&&!!f5.env.SNAP&&!!f5.env.SNAP_REVISION,M3=E1,Q3=!!f5.env.CI||!!f5.env.BUILD_ARTIFACTSTAGINGDIRECTORY,_7=c6,d7=c6;let q=f5.env.VSCODE_NLS_CONFIG;if(q)try{let G=JSON.parse(q);_7=G.userLocale,S0=G.osLocale,d7=G.resolvedLanguage||c6,W3=G.languagePack?.translationsConfigFile}catch{}_1=!0}else typeof navigator=="object"&&!R3?(X6=navigator.userAgent,o7=X6.indexOf("Windows")>=0,s7=X6.indexOf("Macintosh")>=0,D3=(X6.indexOf("Macintosh")>=0||X6.indexOf("iPad")>=0||X6.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,F7=X6.indexOf("Linux")>=0,P3=X6?.indexOf("Mobi")>=0,v1=!0,d7=globalThis._VSCODE_NLS_LANGUAGE||c6,_7=navigator.language.toLowerCase(),S0=_7):console.error("Unable to resolve platform.");var w8=0;s7?w8=1:o7?w8=3:F7&&(w8=2);var b1=o7,G6=s7,O3=F7,y8=_1,A3=v1&&typeof j6.importScripts=="function",g$=A3?j6.origin:void 0,J6=X6,R6=d7,k3;((q)=>{function G(){return R6}q.value=G;function J(){return R6.length===2?R6==="en":R6.length>=3?R6[0]==="e"&&R6[1]==="n"&&R6[2]==="-":!1}q.isDefaultVariant=J;function Z(){return R6==="en"}q.isDefault=Z})(k3||={});var L3=typeof j6.postMessage=="function"&&!j6.importScripts,x3=(()=>{if(L3){let q=[];j6.addEventListener("message",(J)=>{if(J.data&&J.data.vscodeScheduleAsyncWork)for(let Z=0,$=q.length;Z<$;Z++){let Y=q[Z];if(Y.id===J.data.vscodeScheduleAsyncWork){q.splice(Z,1),Y.callback();return}}});let G=0;return(J)=>{let Z=++G;q.push({id:Z,callback:J}),j6.postMessage({vscodeScheduleAsyncWork:Z},"*")}}return(q)=>setTimeout(q)})(),S3=!!(J6&&J6.indexOf("Chrome")>=0),m$=!!(J6&&J6.indexOf("Firefox")>=0),f$=!!(!S3&&J6&&J6.indexOf("Safari")>=0),p$=!!(J6&&J6.indexOf("Edg/")>=0),h$=!!(J6&&J6.indexOf("Android")>=0),O6=typeof navigator=="object"?navigator:{},u$={clipboard:{writeText:y8||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(O6&&O6.clipboard&&O6.clipboard.writeText),readText:y8||!!(O6&&O6.clipboard&&O6.clipboard.readText)},keyboard:y8||N3()?0:O6.keyboard||T1?1:2,touch:"ontouchstart"in p5||O6.maxTouchPoints>0,pointerEvents:p5.PointerEvent&&(("ontouchstart"in p5)||navigator.maxTouchPoints>0)},A9=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(q,G){this._keyCodeToStr[q]=G,this._strToKeyCode[G.toLowerCase()]=q}keyCodeToStr(q){return this._keyCodeToStr[q]}strToKeyCode(q){return this._strToKeyCode[q.toLowerCase()]||0}},I8=new A9,w0=new A9,y0=new A9,w3=Array(230),g1;((q)=>{function G(X){return I8.keyCodeToStr(X)}q.toString=G;function J(X){return I8.strToKeyCode(X)}q.fromString=J;function Z(X){return w0.keyCodeToStr(X)}q.toUserSettingsUS=Z;function $(X){return y0.keyCodeToStr(X)}q.toUserSettingsGeneral=$;function Y(X){return w0.strToKeyCode(X)||y0.strToKeyCode(X)}q.fromUserSettings=Y;function K(X){if(X>=98&&X<=113)return null;switch(X){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return I8.keyCodeToStr(X)}q.toElectronAccelerator=K})(g1||={});var y3=class q{constructor(G,J,Z,$,Y){this.ctrlKey=G,this.shiftKey=J,this.altKey=Z,this.metaKey=$,this.keyCode=Y}equals(G){return G instanceof q&&this.ctrlKey===G.ctrlKey&&this.shiftKey===G.shiftKey&&this.altKey===G.altKey&&this.metaKey===G.metaKey&&this.keyCode===G.keyCode}getHashCode(){let G=this.ctrlKey?"1":"0",J=this.shiftKey?"1":"0",Z=this.altKey?"1":"0",$=this.metaKey?"1":"0";return`K${G}${J}${Z}${$}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new I3([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},I3=class{constructor(q){if(q.length===0)throw u2("chords");this.chords=q}getHashCode(){let q="";for(let G=0,J=this.chords.length;G<J;G++)G!==0&&(q+=";"),q+=this.chords[G].getHashCode();return q}equals(q){if(q===null||this.chords.length!==q.chords.length)return!1;for(let G=0;G<this.chords.length;G++)if(!this.chords[G].equals(q.chords[G]))return!1;return!0}};function T3(q){if(q.charCode){let J=String.fromCharCode(q.charCode).toUpperCase();return g1.fromString(J)}let G=q.keyCode;if(G===3)return 7;if(q9)switch(G){case 59:return 85;case 60:if(O3)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(G6)return 57;break}else if(h7){if(G6&&G===93)return 57;if(!G6&&G===92)return 57}return w3[G]||0}var _3=G6?256:2048,v3=512,E3=1024,b3=G6?2048:256,G9=class{constructor(q){this._standardKeyboardEventBrand=!0;let G=q;this.browserEvent=G,this.target=G.target,this.ctrlKey=G.ctrlKey,this.shiftKey=G.shiftKey,this.altKey=G.altKey,this.metaKey=G.metaKey,this.altGraphKey=G.getModifierState?.("AltGraph"),this.keyCode=T3(G),this.code=G.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals(q){return this._asKeybinding===q}_computeKeybinding(){let q=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(q=this.keyCode);let G=0;return this.ctrlKey&&(G|=_3),this.altKey&&(G|=v3),this.shiftKey&&(G|=E3),this.metaKey&&(G|=b3),G|=q,G}_computeKeyCodeChord(){let q=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&(q=this.keyCode),new y3(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,q)}},I0=new WeakMap;function g3(q){if(!q.parent||q.parent===q)return null;try{let G=q.location,J=q.parent.location;if(G.origin!=="null"&&J.origin!=="null"&&G.origin!==J.origin)return null}catch{return null}return q.parent}var m3=class{static getSameOriginWindowChain(q){let G=I0.get(q);if(!G){G=[],I0.set(q,G);let J=q,Z;do Z=g3(J),Z?G.push({window:new WeakRef(J),iframeElement:J.frameElement||null}):G.push({window:new WeakRef(J),iframeElement:null}),J=Z;while(J)}return G.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow(q,G){if(!G||q===G)return{top:0,left:0};let J=0,Z=0,$=this.getSameOriginWindowChain(q);for(let Y of $){let K=Y.window.deref();if(J+=K?.scrollY??0,Z+=K?.scrollX??0,K===G||!Y.iframeElement)break;let X=Y.iframeElement.getBoundingClientRect();J+=X.top,Z+=X.left}return{top:J,left:Z}}},X7=class{constructor(q,G){this.timestamp=Date.now(),this.browserEvent=G,this.leftButton=G.button===0,this.middleButton=G.button===1,this.rightButton=G.button===2,this.buttons=G.buttons,this.target=G.target,this.detail=G.detail||1,G.type==="dblclick"&&(this.detail=2),this.ctrlKey=G.ctrlKey,this.shiftKey=G.shiftKey,this.altKey=G.altKey,this.metaKey=G.metaKey,typeof G.pageX=="number"?(this.posx=G.pageX,this.posy=G.pageY):(this.posx=G.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=G.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let J=m3.getPositionOfChildWindowRelativeToAncestorWindow(q,G.view);this.posx-=J.left,this.posy-=J.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},T0=class{constructor(q,G=0,J=0){this.browserEvent=q||null,this.target=q?q.target||q.targetNode||q.srcElement:null,this.deltaY=J,this.deltaX=G;let Z=!1;if(O9){let $=navigator.userAgent.match(/Chrome\/(\d+)/);Z=($?parseInt($[1]):123)<=122}if(q){let $=q,Y=q,K=q.view?.devicePixelRatio||1;if(typeof $.wheelDeltaY<"u")Z?this.deltaY=$.wheelDeltaY/(120*K):this.deltaY=$.wheelDeltaY/120;else if(typeof Y.VERTICAL_AXIS<"u"&&Y.axis===Y.VERTICAL_AXIS)this.deltaY=-Y.detail/3;else if(q.type==="wheel"){let X=q;X.deltaMode===X.DOM_DELTA_LINE?q9&&!G6?this.deltaY=-q.deltaY/3:this.deltaY=-q.deltaY:this.deltaY=-q.deltaY/40}if(typeof $.wheelDeltaX<"u")T1&&b1?this.deltaX=-($.wheelDeltaX/120):Z?this.deltaX=$.wheelDeltaX/(120*K):this.deltaX=$.wheelDeltaX/120;else if(typeof Y.HORIZONTAL_AXIS<"u"&&Y.axis===Y.HORIZONTAL_AXIS)this.deltaX=-q.detail/3;else if(q.type==="wheel"){let X=q;X.deltaMode===X.DOM_DELTA_LINE?q9&&!G6?this.deltaX=-q.deltaX/3:this.deltaX=-q.deltaX:this.deltaX=-q.deltaX/40}this.deltaY===0&&this.deltaX===0&&q.wheelDelta&&(Z?this.deltaY=q.wheelDelta/(120*K):this.deltaY=q.wheelDelta/120)}}preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}},m1=Object.freeze(function(q,G){let J=setTimeout(q.bind(G),0);return{dispose(){clearTimeout(J)}}}),f3;((q)=>{function G(J){return J===q.None||J===q.Cancelled||J instanceof p3?!0:!J||typeof J!="object"?!1:typeof J.isCancellationRequested=="boolean"&&typeof J.onCancellationRequested=="function"}q.isCancellationToken=G,q.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:k5.None}),q.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:m1})})(f3||={});var p3=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?m1:(this._emitter||(this._emitter=new x),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},d$=Symbol("MicrotaskDelay"),k9=class{constructor(q,G){this._isDisposed=!1,this._token=-1,typeof q=="function"&&typeof G=="number"&&this.setIfNotSet(q,G)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet(q,G){if(this._isDisposed)throw new n8("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,q()},G)}setIfNotSet(q,G){if(this._isDisposed)throw new n8("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,q()},G))}},h3=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet(q,G,J=globalThis){if(this.isDisposed)throw new n8("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let Z=J.setInterval(()=>{q()},G);this.disposable=r(()=>{J.clearInterval(Z),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},u3,T8;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?T8=(q,G)=>{x3(()=>{if(J)return;let Z=Date.now()+15;G(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,Z-Date.now())}}))});let J=!1;return{dispose(){J||(J=!0)}}}:T8=(q,G,J)=>{let Z=q.requestIdleCallback(G,typeof J=="number"?{timeout:J}:void 0),$=!1;return{dispose(){$||($=!0,q.cancelIdleCallback(Z))}}},u3=(q)=>T8(globalThis,q)})();var d3;((q)=>{async function G(Z){let $,Y=await Promise.all(Z.map((K)=>K.then((X)=>X,(X)=>{$||($=X)})));if(typeof $<"u")throw $;return Y}q.settled=G;function J(Z){return new Promise(async($,Y)=>{try{await Z($,Y)}catch(K){Y(K)}})}q.withAsyncBody=J})(d3||={});var _0=class q{static fromArray(G){return new q((J)=>{J.emitMany(G)})}static fromPromise(G){return new q(async(J)=>{J.emitMany(await G)})}static fromPromises(G){return new q(async(J)=>{await Promise.all(G.map(async(Z)=>J.emitOne(await Z)))})}static merge(G){return new q(async(J)=>{await Promise.all(G.map(async(Z)=>{for await(let $ of Z)J.emitOne($)}))})}constructor(G,J){this._state=0,this._results=[],this._error=null,this._onReturn=J,this._onStateChanged=new x,queueMicrotask(async()=>{let Z={emitOne:($)=>this.emitOne($),emitMany:($)=>this.emitMany($),reject:($)=>this.reject($)};try{await Promise.resolve(G(Z)),this.resolve()}catch($){this.reject($)}finally{Z.emitOne=void 0,Z.emitMany=void 0,Z.reject=void 0}})}[Symbol.asyncIterator](){let G=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(G<this._results.length)return{done:!1,value:this._results[G++]};if(this._state===1)return{done:!0,value:void 0};await k5.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(G,J){return new q(async(Z)=>{for await(let $ of G)Z.emitOne(J($))})}map(G){return q.map(this,G)}static filter(G,J){return new q(async(Z)=>{for await(let $ of G)J($)&&Z.emitOne($)})}filter(G){return q.filter(this,G)}static coalesce(G){return q.filter(G,(J)=>!!J)}coalesce(){return q.coalesce(this)}static async toPromise(G){let J=[];for await(let Z of G)J.push(Z);return J}toPromise(){return q.toPromise(this)}emitOne(G){this._state===0&&(this._results.push(G),this._onStateChanged.fire())}emitMany(G){this._state===0&&(this._results=this._results.concat(G),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(G){this._state===0&&(this._state=2,this._error=G,this._onStateChanged.fire())}};_0.EMPTY=_0.fromArray([]);function c3(q){return 55296<=q&&q<=56319}function v0(q){return 56320<=q&&q<=57343}function a3(q,G){return(q-55296<<10)+(G-56320)+65536}function l3(q){return L9(q,0)}function L9(q,G){switch(typeof q){case"object":return q===null?V6(349,G):Array.isArray(q)?s3(q,G):n3(q,G);case"string":return f1(q,G);case"boolean":return o3(q,G);case"number":return V6(q,G);case"undefined":return V6(937,G);default:return V6(617,G)}}function V6(q,G){return(G<<5)-G+q|0}function o3(q,G){return V6(q?433:863,G)}function f1(q,G){G=V6(149417,G);for(let J=0,Z=q.length;J<Z;J++)G=V6(q.charCodeAt(J),G);return G}function s3(q,G){return G=V6(104579,G),q.reduce((J,Z)=>L9(Z,J),G)}function n3(q,G){return G=V6(181387,G),Object.keys(q).sort().reduce((J,Z)=>(J=f1(Z,J),L9(q[Z],J)),G)}function _8(q,G,J=32){let Z=J-G,$=~((1<<Z)-1);return(q<<G|($&q)>>>Z)>>>0}function E0(q,G=0,J=q.byteLength,Z=0){for(let $=0;$<J;$++)q[G+$]=Z}function r3(q,G,J="0"){for(;q.length<G;)q=J+q;return q}function q7(q,G=32){return q instanceof ArrayBuffer?Array.from(new Uint8Array(q)).map((J)=>J.toString(16).padStart(2,"0")).join(""):r3((q>>>0).toString(16),G/4)}var i3=class q{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(G){let J=G.length;if(J===0)return;let Z=this._buff,$=this._buffLen,Y=this._leftoverHighSurrogate,K,X;for(Y!==0?(K=Y,X=-1,Y=0):(K=G.charCodeAt(0),X=0);;){let j=K;if(c3(K))if(X+1<J){let V=G.charCodeAt(X+1);v0(V)?(X++,j=a3(K,V)):j=65533}else{Y=K;break}else v0(K)&&(j=65533);if($=this._push(Z,$,j),X++,X<J)K=G.charCodeAt(X);else break}this._buffLen=$,this._leftoverHighSurrogate=Y}_push(G,J,Z){return Z<128?G[J++]=Z:Z<2048?(G[J++]=192|(Z&1984)>>>6,G[J++]=128|(Z&63)>>>0):Z<65536?(G[J++]=224|(Z&61440)>>>12,G[J++]=128|(Z&4032)>>>6,G[J++]=128|(Z&63)>>>0):(G[J++]=240|(Z&1835008)>>>18,G[J++]=128|(Z&258048)>>>12,G[J++]=128|(Z&4032)>>>6,G[J++]=128|(Z&63)>>>0),J>=64&&(this._step(),J-=64,this._totalLen+=64,G[0]=G[64],G[1]=G[65],G[2]=G[66]),J}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),q7(this._h0)+q7(this._h1)+q7(this._h2)+q7(this._h3)+q7(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,E0(this._buff,this._buffLen),this._buffLen>56&&(this._step(),E0(this._buff));let G=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(G/4294967296),!1),this._buffDV.setUint32(60,G%4294967296,!1),this._step()}_step(){let G=q._bigBlock32,J=this._buffDV;for(let z=0;z<64;z+=4)G.setUint32(z,J.getUint32(z,!1),!1);for(let z=64;z<320;z+=4)G.setUint32(z,_8(G.getUint32(z-12,!1)^G.getUint32(z-32,!1)^G.getUint32(z-56,!1)^G.getUint32(z-64,!1),1),!1);let Z=this._h0,$=this._h1,Y=this._h2,K=this._h3,X=this._h4,j,V,B;for(let z=0;z<80;z++)z<20?(j=$&Y|~$&K,V=1518500249):z<40?(j=$^Y^K,V=1859775393):z<60?(j=$&Y|$&K|Y&K,V=2400959708):(j=$^Y^K,V=3395469782),B=_8(Z,5)+j+X+V+G.getUint32(z*4,!1)&4294967295,X=K,K=Y,Y=_8($,30),$=Z,Z=B;this._h0=this._h0+Z&4294967295,this._h1=this._h1+$&4294967295,this._h2=this._h2+Y&4294967295,this._h3=this._h3+K&4294967295,this._h4=this._h4+X&4294967295}};i3._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:c$,getWindow:n5,getDocument:a$,getWindows:l$,getWindowsCount:o$,getWindowId:b0,getWindowById:s$,hasWindow:n$,onDidRegisterWindow:t3,onWillUnregisterWindow:r$,onDidUnregisterWindow:i$}=function(){let q=new Map,G={window:p5,disposables:new S6};q.set(p5.vscodeWindowId,G);let J=new x,Z=new x,$=new x;function Y(K,X){return(typeof K=="number"?q.get(K):void 0)??(X?G:void 0)}return{onDidRegisterWindow:J.event,onWillUnregisterWindow:$.event,onDidUnregisterWindow:Z.event,registerWindow(K){if(q.has(K.vscodeWindowId))return g.None;let X=new S6,j={window:K,disposables:X.add(new S6)};return q.set(K.vscodeWindowId,j),X.add(r(()=>{q.delete(K.vscodeWindowId),Z.fire(K)})),X.add(b(K,N5.BEFORE_UNLOAD,()=>{$.fire(K)})),J.fire(j),X},getWindows(){return q.values()},getWindowsCount(){return q.size},getWindowId(K){return K.vscodeWindowId},hasWindow(K){return q.has(K)},getWindowById:Y,getWindow(K){let X=K;if(X?.ownerDocument?.defaultView)return X.ownerDocument.defaultView.window;let j=K;return j?.view?j.view.window:p5},getDocument(K){return n5(K).document}}}(),e3=class{constructor(q,G,J,Z){this._node=q,this._type=G,this._handler=J,this._options=Z||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function b(q,G,J,Z){return new e3(q,G,J,Z)}function qq(q,G){return function(J){return G(new X7(q,J))}}function Gq(q){return function(G){return q(new G9(G))}}var g0=function(q,G,J,Z){let $=J;return G==="click"||G==="mousedown"||G==="contextmenu"?$=qq(n5(q),J):(G==="keydown"||G==="keypress"||G==="keyup")&&($=Gq(J)),b(q,G,$,Z)},Jq,n7,Zq=class extends h3{constructor(q){super(),this.defaultTarget=q&&n5(q)}cancelAndSet(q,G,J){return super.cancelAndSet(q,G,J??this.defaultTarget)}},v8=class{constructor(q,G=0){this._runner=q,this.priority=G,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(q){m7(q)}}static sort(q,G){return G.priority-q.priority}};(function(){let q=new Map,G=new Map,J=new Map,Z=new Map,$=(Y)=>{J.set(Y,!1);let K=q.get(Y)??[];for(G.set(Y,K),q.set(Y,[]),Z.set(Y,!0);K.length>0;)K.sort(v8.sort),K.shift().execute();Z.set(Y,!1)};n7=(Y,K,X=0)=>{let j=b0(Y),V=new v8(K,X),B=q.get(j);return B||(B=[],q.set(j,B)),B.push(V),J.get(j)||(J.set(j,!0),Y.requestAnimationFrame(()=>$(j))),V},Jq=(Y,K,X)=>{let j=b0(Y);if(Z.get(j)){let V=new v8(K,X),B=G.get(j);return B||(B=[],G.set(j,B)),B.push(V),V}else return n7(Y,K,X)}})();var m0=class q{constructor(G,J){this.width=G,this.height=J}with(G=this.width,J=this.height){return G!==this.width||J!==this.height?new q(G,J):this}static is(G){return typeof G=="object"&&typeof G.height=="number"&&typeof G.width=="number"}static lift(G){return G instanceof q?G:new q(G.width,G.height)}static equals(G,J){return G===J?!0:!G||!J?!1:G.width===J.width&&G.height===J.height}};m0.None=new m0(0,0);function $q(q){let G=q.getBoundingClientRect(),J=n5(q);return{left:G.left+J.scrollX,top:G.top+J.scrollY,width:G.width,height:G.height}}var t$=new class{constructor(){this.mutationObservers=new Map}observe(q,G,J){let Z=this.mutationObservers.get(q);Z||(Z=new Map,this.mutationObservers.set(q,Z));let $=l3(J),Y=Z.get($);if(Y)Y.users+=1;else{let K=new x,X=new MutationObserver((V)=>K.fire(V));X.observe(q,J);let j=Y={users:1,observer:X,onDidMutate:K.event};G.add(r(()=>{j.users-=1,j.users===0&&(K.dispose(),X.disconnect(),Z?.delete($),Z?.size===0&&this.mutationObservers.delete(q))})),Z.set($,Y)}return Y.onDidMutate}},N5={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:h7?"webkitAnimationStart":"animationstart",ANIMATION_END:h7?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:h7?"webkitAnimationIteration":"animationiteration"},Yq=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function p1(q,G,J,...Z){let $=Yq.exec(G);if(!$)throw Error("Bad use of emmet");let Y=$[1]||"div",K;return q!=="http://www.w3.org/1999/xhtml"?K=document.createElementNS(q,Y):K=document.createElement(Y),$[3]&&(K.id=$[3]),$[4]&&(K.className=$[4].replace(/\./g," ").trim()),J&&Object.entries(J).forEach(([X,j])=>{typeof j>"u"||(/^on\w+$/.test(X)?K[X]=j:X==="selected"?j&&K.setAttribute(X,"true"):K.setAttribute(X,j))}),K.append(...Z),K}function Kq(q,G,...J){return p1("http://www.w3.org/1999/xhtml",q,G,...J)}Kq.SVG=function(q,G,...J){return p1("http://www.w3.org/2000/svg",q,G,...J)};var Xq=class{constructor(q){this.domNode=q,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth(q){let G=v5(q);this._maxWidth!==G&&(this._maxWidth=G,this.domNode.style.maxWidth=this._maxWidth)}setWidth(q){let G=v5(q);this._width!==G&&(this._width=G,this.domNode.style.width=this._width)}setHeight(q){let G=v5(q);this._height!==G&&(this._height=G,this.domNode.style.height=this._height)}setTop(q){let G=v5(q);this._top!==G&&(this._top=G,this.domNode.style.top=this._top)}setLeft(q){let G=v5(q);this._left!==G&&(this._left=G,this.domNode.style.left=this._left)}setBottom(q){let G=v5(q);this._bottom!==G&&(this._bottom=G,this.domNode.style.bottom=this._bottom)}setRight(q){let G=v5(q);this._right!==G&&(this._right=G,this.domNode.style.right=this._right)}setPaddingTop(q){let G=v5(q);this._paddingTop!==G&&(this._paddingTop=G,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft(q){let G=v5(q);this._paddingLeft!==G&&(this._paddingLeft=G,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom(q){let G=v5(q);this._paddingBottom!==G&&(this._paddingBottom=G,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight(q){let G=v5(q);this._paddingRight!==G&&(this._paddingRight=G,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily(q){this._fontFamily!==q&&(this._fontFamily=q,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight(q){this._fontWeight!==q&&(this._fontWeight=q,this.domNode.style.fontWeight=this._fontWeight)}setFontSize(q){let G=v5(q);this._fontSize!==G&&(this._fontSize=G,this.domNode.style.fontSize=this._fontSize)}setFontStyle(q){this._fontStyle!==q&&(this._fontStyle=q,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings(q){this._fontFeatureSettings!==q&&(this._fontFeatureSettings=q,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings(q){this._fontVariationSettings!==q&&(this._fontVariationSettings=q,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration(q){this._textDecoration!==q&&(this._textDecoration=q,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight(q){let G=v5(q);this._lineHeight!==G&&(this._lineHeight=G,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing(q){let G=v5(q);this._letterSpacing!==G&&(this._letterSpacing=G,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName(q){this._className!==q&&(this._className=q,this.domNode.className=this._className)}toggleClassName(q,G){this.domNode.classList.toggle(q,G),this._className=this.domNode.className}setDisplay(q){this._display!==q&&(this._display=q,this.domNode.style.display=this._display)}setPosition(q){this._position!==q&&(this._position=q,this.domNode.style.position=this._position)}setVisibility(q){this._visibility!==q&&(this._visibility=q,this.domNode.style.visibility=this._visibility)}setColor(q){this._color!==q&&(this._color=q,this.domNode.style.color=this._color)}setBackgroundColor(q){this._backgroundColor!==q&&(this._backgroundColor=q,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting(q){this._layerHint!==q&&(this._layerHint=q,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow(q){this._boxShadow!==q&&(this._boxShadow=q,this.domNode.style.boxShadow=q)}setContain(q){this._contain!==q&&(this._contain=q,this.domNode.style.contain=this._contain)}setAttribute(q,G){this.domNode.setAttribute(q,G)}removeAttribute(q){this.domNode.removeAttribute(q)}appendChild(q){this.domNode.appendChild(q.domNode)}removeChild(q){this.domNode.removeChild(q.domNode)}};function v5(q){return typeof q=="number"?`${q}px`:q}function C7(q){return new Xq(q)}var h1=class{constructor(){this._hooks=new S6,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring(q,G){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let J=this._onStopCallback;this._onStopCallback=null,q&&J&&J(G)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring(q,G,J,Z,$){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=Z,this._onStopCallback=$;let Y=q;try{q.setPointerCapture(G),this._hooks.add(r(()=>{try{q.releasePointerCapture(G)}catch{}}))}catch{Y=n5(q)}this._hooks.add(b(Y,N5.POINTER_MOVE,(K)=>{if(K.buttons!==J){this.stopMonitoring(!0);return}K.preventDefault(),this._pointerMoveCallback(K)})),this._hooks.add(b(Y,N5.POINTER_UP,(K)=>this.stopMonitoring(!0)))}};function Vq(q,G,J){let Z=null,$=null;if(typeof J.value=="function"?(Z="value",$=J.value,$.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof J.get=="function"&&(Z="get",$=J.get),!$)throw Error("not supported");let Y=`$memoize$${G}`;J[Z]=function(...K){return this.hasOwnProperty(Y)||Object.defineProperty(this,Y,{configurable:!1,enumerable:!1,writable:!1,value:$.apply(this,K)}),this[Y]}}var q6;((q)=>(q.Tap="-xterm-gesturetap",q.Change="-xterm-gesturechange",q.Start="-xterm-gesturestart",q.End="-xterm-gesturesend",q.Contextmenu="-xterm-gesturecontextmenu"))(q6||={});var V7=class q extends g{constructor(){super();this.dispatched=!1,this.targets=new k0,this.ignoreTargets=new k0,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(k5.runAndSubscribe(t3,({window:G,disposables:J})=>{J.add(b(G.document,"touchstart",(Z)=>this.onTouchStart(Z),{passive:!1})),J.add(b(G.document,"touchend",(Z)=>this.onTouchEnd(G,Z))),J.add(b(G.document,"touchmove",(Z)=>this.onTouchMove(Z),{passive:!1}))},{window:p5,disposables:this._store}))}static addTarget(G){if(!q.isTouchDevice())return g.None;q.INSTANCE||(q.INSTANCE=A0(new q));let J=q.INSTANCE.targets.push(G);return r(J)}static ignoreTarget(G){if(!q.isTouchDevice())return g.None;q.INSTANCE||(q.INSTANCE=A0(new q));let J=q.INSTANCE.ignoreTargets.push(G);return r(J)}static isTouchDevice(){return"ontouchstart"in p5||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(G){let J=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let Z=0,$=G.targetTouches.length;Z<$;Z++){let Y=G.targetTouches.item(Z);this.activeTouches[Y.identifier]={id:Y.identifier,initialTarget:Y.target,initialTimeStamp:J,initialPageX:Y.pageX,initialPageY:Y.pageY,rollingTimestamps:[J],rollingPageX:[Y.pageX],rollingPageY:[Y.pageY]};let K=this.newGestureEvent(q6.Start,Y.target);K.pageX=Y.pageX,K.pageY=Y.pageY,this.dispatchEvent(K)}this.dispatched&&(G.preventDefault(),G.stopPropagation(),this.dispatched=!1)}onTouchEnd(G,J){let Z=Date.now(),$=Object.keys(this.activeTouches).length;for(let Y=0,K=J.changedTouches.length;Y<K;Y++){let X=J.changedTouches.item(Y);if(!this.activeTouches.hasOwnProperty(String(X.identifier))){console.warn("move of an UNKNOWN touch",X);continue}let j=this.activeTouches[X.identifier],V=Date.now()-j.initialTimeStamp;if(V<q.HOLD_DELAY&&Math.abs(j.initialPageX-g5(j.rollingPageX))<30&&Math.abs(j.initialPageY-g5(j.rollingPageY))<30){let B=this.newGestureEvent(q6.Tap,j.initialTarget);B.pageX=g5(j.rollingPageX),B.pageY=g5(j.rollingPageY),this.dispatchEvent(B)}else if(V>=q.HOLD_DELAY&&Math.abs(j.initialPageX-g5(j.rollingPageX))<30&&Math.abs(j.initialPageY-g5(j.rollingPageY))<30){let B=this.newGestureEvent(q6.Contextmenu,j.initialTarget);B.pageX=g5(j.rollingPageX),B.pageY=g5(j.rollingPageY),this.dispatchEvent(B)}else if($===1){let B=g5(j.rollingPageX),z=g5(j.rollingPageY),H=g5(j.rollingTimestamps)-j.rollingTimestamps[0],F=B-j.rollingPageX[0],C=z-j.rollingPageY[0],M=[...this.targets].filter((k)=>j.initialTarget instanceof Node&&k.contains(j.initialTarget));this.inertia(G,M,Z,Math.abs(F)/H,F>0?1:-1,B,Math.abs(C)/H,C>0?1:-1,z)}this.dispatchEvent(this.newGestureEvent(q6.End,j.initialTarget)),delete this.activeTouches[X.identifier]}this.dispatched&&(J.preventDefault(),J.stopPropagation(),this.dispatched=!1)}newGestureEvent(G,J){let Z=document.createEvent("CustomEvent");return Z.initEvent(G,!1,!0),Z.initialTarget=J,Z.tapCount=0,Z}dispatchEvent(G){if(G.type===q6.Tap){let J=new Date().getTime(),Z=0;J-this._lastSetTapCountTime>q.CLEAR_TAP_COUNT_TIME?Z=1:Z=2,this._lastSetTapCountTime=J,G.tapCount=Z}else(G.type===q6.Change||G.type===q6.Contextmenu)&&(this._lastSetTapCountTime=0);if(G.initialTarget instanceof Node){for(let Z of this.ignoreTargets)if(Z.contains(G.initialTarget))return;let J=[];for(let Z of this.targets)if(Z.contains(G.initialTarget)){let $=0,Y=G.initialTarget;for(;Y&&Y!==Z;)$++,Y=Y.parentElement;J.push([$,Z])}J.sort((Z,$)=>Z[0]-$[0]);for(let[Z,$]of J)$.dispatchEvent(G),this.dispatched=!0}}inertia(G,J,Z,$,Y,K,X,j,V){this.handle=n7(G,()=>{let B=Date.now(),z=B-Z,H=0,F=0,C=!0;$+=q.SCROLL_FRICTION*z,X+=q.SCROLL_FRICTION*z,$>0&&(C=!1,H=Y*$*z),X>0&&(C=!1,F=j*X*z);let M=this.newGestureEvent(q6.Change);M.translationX=H,M.translationY=F,J.forEach((k)=>k.dispatchEvent(M)),C||this.inertia(G,J,B,$,Y,K+H,X,j,V+F)})}onTouchMove(G){let J=Date.now();for(let Z=0,$=G.changedTouches.length;Z<$;Z++){let Y=G.changedTouches.item(Z);if(!this.activeTouches.hasOwnProperty(String(Y.identifier))){console.warn("end of an UNKNOWN touch",Y);continue}let K=this.activeTouches[Y.identifier],X=this.newGestureEvent(q6.Change,K.initialTarget);X.translationX=Y.pageX-g5(K.rollingPageX),X.translationY=Y.pageY-g5(K.rollingPageY),X.pageX=Y.pageX,X.pageY=Y.pageY,this.dispatchEvent(X),K.rollingPageX.length>3&&(K.rollingPageX.shift(),K.rollingPageY.shift(),K.rollingTimestamps.shift()),K.rollingPageX.push(Y.pageX),K.rollingPageY.push(Y.pageY),K.rollingTimestamps.push(J)}this.dispatched&&(G.preventDefault(),G.stopPropagation(),this.dispatched=!1)}};V7.SCROLL_FRICTION=-0.005,V7.HOLD_DELAY=700,V7.CLEAR_TAP_COUNT_TIME=400,Z5([Vq],V7,"isTouchDevice",1);var jq=V7,x9=class extends g{onclick(q,G){this._register(b(q,N5.CLICK,(J)=>G(new X7(n5(q),J))))}onmousedown(q,G){this._register(b(q,N5.MOUSE_DOWN,(J)=>G(new X7(n5(q),J))))}onmouseover(q,G){this._register(b(q,N5.MOUSE_OVER,(J)=>G(new X7(n5(q),J))))}onmouseleave(q,G){this._register(b(q,N5.MOUSE_LEAVE,(J)=>G(new X7(n5(q),J))))}onkeydown(q,G){this._register(b(q,N5.KEY_DOWN,(J)=>G(new G9(J))))}onkeyup(q,G){this._register(b(q,N5.KEY_UP,(J)=>G(new G9(J))))}oninput(q,G){this._register(b(q,N5.INPUT,G))}onblur(q,G){this._register(b(q,N5.BLUR,G))}onfocus(q,G){this._register(b(q,N5.FOCUS,G))}onchange(q,G){this._register(b(q,N5.CHANGE,G))}ignoreGesture(q){return jq.ignoreTarget(q)}},f0=11,zq=class extends x9{constructor(q){super(),this._onActivate=q.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=q.bgWidth+"px",this.bgDomNode.style.height=q.bgHeight+"px",typeof q.top<"u"&&(this.bgDomNode.style.top="0px"),typeof q.left<"u"&&(this.bgDomNode.style.left="0px"),typeof q.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof q.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=q.className,this.domNode.style.position="absolute",this.domNode.style.width=f0+"px",this.domNode.style.height=f0+"px",typeof q.top<"u"&&(this.domNode.style.top=q.top+"px"),typeof q.left<"u"&&(this.domNode.style.left=q.left+"px"),typeof q.bottom<"u"&&(this.domNode.style.bottom=q.bottom+"px"),typeof q.right<"u"&&(this.domNode.style.right=q.right+"px"),this._pointerMoveMonitor=this._register(new h1),this._register(g0(this.bgDomNode,N5.POINTER_DOWN,(G)=>this._arrowPointerDown(G))),this._register(g0(this.domNode,N5.POINTER_DOWN,(G)=>this._arrowPointerDown(G))),this._pointerdownRepeatTimer=this._register(new Zq),this._pointerdownScheduleRepeatTimer=this._register(new k9)}_arrowPointerDown(q){if(!q.target||!(q.target instanceof Element))return;let G=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),41.666666666666664,n5(q))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(G,200),this._pointerMoveMonitor.startMonitoring(q.target,q.pointerId,q.buttons,(J)=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),q.preventDefault()}},Bq=class q{constructor(G,J,Z,$,Y,K,X){this._forceIntegerValues=G,this._scrollStateBrand=void 0,this._forceIntegerValues&&(J=J|0,Z=Z|0,$=$|0,Y=Y|0,K=K|0,X=X|0),this.rawScrollLeft=$,this.rawScrollTop=X,J<0&&(J=0),$+J>Z&&($=Z-J),$<0&&($=0),Y<0&&(Y=0),X+Y>K&&(X=K-Y),X<0&&(X=0),this.width=J,this.scrollWidth=Z,this.scrollLeft=$,this.height=Y,this.scrollHeight=K,this.scrollTop=X}equals(G){return this.rawScrollLeft===G.rawScrollLeft&&this.rawScrollTop===G.rawScrollTop&&this.width===G.width&&this.scrollWidth===G.scrollWidth&&this.scrollLeft===G.scrollLeft&&this.height===G.height&&this.scrollHeight===G.scrollHeight&&this.scrollTop===G.scrollTop}withScrollDimensions(G,J){return new q(this._forceIntegerValues,typeof G.width<"u"?G.width:this.width,typeof G.scrollWidth<"u"?G.scrollWidth:this.scrollWidth,J?this.rawScrollLeft:this.scrollLeft,typeof G.height<"u"?G.height:this.height,typeof G.scrollHeight<"u"?G.scrollHeight:this.scrollHeight,J?this.rawScrollTop:this.scrollTop)}withScrollPosition(G){return new q(this._forceIntegerValues,this.width,this.scrollWidth,typeof G.scrollLeft<"u"?G.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof G.scrollTop<"u"?G.scrollTop:this.rawScrollTop)}createScrollEvent(G,J){let Z=this.width!==G.width,$=this.scrollWidth!==G.scrollWidth,Y=this.scrollLeft!==G.scrollLeft,K=this.height!==G.height,X=this.scrollHeight!==G.scrollHeight,j=this.scrollTop!==G.scrollTop;return{inSmoothScrolling:J,oldWidth:G.width,oldScrollWidth:G.scrollWidth,oldScrollLeft:G.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:G.height,oldScrollHeight:G.scrollHeight,oldScrollTop:G.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:Z,scrollWidthChanged:$,scrollLeftChanged:Y,heightChanged:K,scrollHeightChanged:X,scrollTopChanged:j}}},Hq=class extends g{constructor(q){super();this._scrollableBrand=void 0,this._onScroll=this._register(new x),this.onScroll=this._onScroll.event,this._smoothScrollDuration=q.smoothScrollDuration,this._scheduleAtNextAnimationFrame=q.scheduleAtNextAnimationFrame,this._state=new Bq(q.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(q){this._smoothScrollDuration=q}validateScrollPosition(q){return this._state.withScrollPosition(q)}getScrollDimensions(){return this._state}setScrollDimensions(q,G){let J=this._state.withScrollDimensions(q,G);this._setState(J,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(q){let G=this._state.withScrollPosition(q);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(G,!1)}setScrollPositionSmooth(q,G){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(q);if(this._smoothScrolling){q={scrollLeft:typeof q.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:q.scrollLeft,scrollTop:typeof q.scrollTop>"u"?this._smoothScrolling.to.scrollTop:q.scrollTop};let J=this._state.withScrollPosition(q);if(this._smoothScrolling.to.scrollLeft===J.scrollLeft&&this._smoothScrolling.to.scrollTop===J.scrollTop)return;let Z;G?Z=new h0(this._smoothScrolling.from,J,this._smoothScrolling.startTime,this._smoothScrolling.duration):Z=this._smoothScrolling.combine(this._state,J,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=Z}else{let J=this._state.withScrollPosition(q);this._smoothScrolling=h0.start(this._state,J,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let q=this._smoothScrolling.tick(),G=this._state.withScrollPosition(q);if(this._setState(G,!0),!!this._smoothScrolling){if(q.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(q,G){let J=this._state;J.equals(q)||(this._state=q,this._onScroll.fire(this._state.createScrollEvent(J,G)))}},p0=class{constructor(q,G,J){this.scrollLeft=q,this.scrollTop=G,this.isDone=J}};function E8(q,G){let J=G-q;return function(Z){return q+J*Nq(Z)}}function Fq(q,G,J){return function(Z){return Z<J?q(Z/J):G((Z-J)/(1-J))}}var h0=class q{constructor(G,J,Z,$){this.from=G,this.to=J,this.duration=$,this.startTime=Z,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(G,J,Z){if(Math.abs(G-J)>2.5*Z){let $,Y;return G<J?($=G+0.75*Z,Y=J-0.75*Z):($=G-0.75*Z,Y=J+0.75*Z),Fq(E8(G,$),E8(Y,J),0.33)}return E8(G,J)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(G){this.to=G.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(G){let J=(G-this.startTime)/this.duration;if(J<1){let Z=this.scrollLeft(J),$=this.scrollTop(J);return new p0(Z,$,!1)}return new p0(this.to.scrollLeft,this.to.scrollTop,!0)}combine(G,J,Z){return q.start(G,J,Z)}static start(G,J,Z){Z=Z+10;let $=Date.now()-10;return new q(G,J,$,Z)}};function Cq(q){return Math.pow(q,3)}function Nq(q){return 1-Cq(1-q)}var Uq=class extends g{constructor(q,G,J){super(),this._visibility=q,this._visibleClassName=G,this._invisibleClassName=J,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new k9)}setVisibility(q){this._visibility!==q&&(this._visibility=q,this._updateShouldBeVisible())}setShouldBeVisible(q){this._rawShouldBeVisible=q,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let q=this._applyVisibilitySetting();this._shouldBeVisible!==q&&(this._shouldBeVisible=q,this.ensureVisibility())}setIsNeeded(q){this._isNeeded!==q&&(this._isNeeded=q,this.ensureVisibility())}setDomNode(q){this._domNode=q,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{this._domNode?.setClassName(this._visibleClassName)},0))}_hide(q){this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,this._domNode?.setClassName(this._invisibleClassName+(q?" fade":"")))}},Mq=140,u1=class extends x9{constructor(q){super(),this._lazyRender=q.lazyRender,this._host=q.host,this._scrollable=q.scrollable,this._scrollByPage=q.scrollByPage,this._scrollbarState=q.scrollbarState,this._visibilityController=this._register(new Uq(q.visibility,"visible scrollbar "+q.extraScrollbarClassName,"invisible scrollbar "+q.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new h1),this._shouldRender=!0,this.domNode=C7(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(b(this.domNode.domNode,N5.POINTER_DOWN,(G)=>this._domNodePointerDown(G)))}_createArrow(q){let G=this._register(new zq(q));this.domNode.domNode.appendChild(G.bgDomNode),this.domNode.domNode.appendChild(G.domNode)}_createSlider(q,G,J,Z){this.slider=C7(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop(q),this.slider.setLeft(G),typeof J=="number"&&this.slider.setWidth(J),typeof Z=="number"&&this.slider.setHeight(Z),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(b(this.slider.domNode,N5.POINTER_DOWN,($)=>{$.button===0&&($.preventDefault(),this._sliderPointerDown($))})),this.onclick(this.slider.domNode,($)=>{$.leftButton&&$.stopPropagation()})}_onElementSize(q){return this._scrollbarState.setVisibleSize(q)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize(q){return this._scrollbarState.setScrollSize(q)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition(q){return this._scrollbarState.setScrollPosition(q)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown(q){q.target===this.domNode.domNode&&this._onPointerDown(q)}delegatePointerDown(q){let G=this.domNode.domNode.getClientRects()[0].top,J=G+this._scrollbarState.getSliderPosition(),Z=G+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),$=this._sliderPointerPosition(q);J<=$&&$<=Z?q.button===0&&(q.preventDefault(),this._sliderPointerDown(q)):this._onPointerDown(q)}_onPointerDown(q){let G,J;if(q.target===this.domNode.domNode&&typeof q.offsetX=="number"&&typeof q.offsetY=="number")G=q.offsetX,J=q.offsetY;else{let $=$q(this.domNode.domNode);G=q.pageX-$.left,J=q.pageY-$.top}let Z=this._pointerDownRelativePosition(G,J);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(Z):this._scrollbarState.getDesiredScrollPositionFromOffset(Z)),q.button===0&&(q.preventDefault(),this._sliderPointerDown(q))}_sliderPointerDown(q){if(!q.target||!(q.target instanceof Element))return;let G=this._sliderPointerPosition(q),J=this._sliderOrthogonalPointerPosition(q),Z=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring(q.target,q.pointerId,q.buttons,($)=>{let Y=this._sliderOrthogonalPointerPosition($),K=Math.abs(Y-J);if(b1&&K>Mq){this._setDesiredScrollPositionNow(Z.getScrollPosition());return}let X=this._sliderPointerPosition($)-G;this._setDesiredScrollPositionNow(Z.getDesiredScrollPositionFromDelta(X))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow(q){let G={};this.writeScrollPosition(G,q),this._scrollable.setScrollPositionNow(G)}updateScrollbarSize(q){this._updateScrollbarSize(q),this._scrollbarState.setScrollbarSize(q),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},d1=class q{constructor(G,J,Z,$,Y,K){this._scrollbarSize=Math.round(J),this._oppositeScrollbarSize=Math.round(Z),this._arrowSize=Math.round(G),this._visibleSize=$,this._scrollSize=Y,this._scrollPosition=K,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new q(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(G){let J=Math.round(G);return this._visibleSize!==J?(this._visibleSize=J,this._refreshComputedValues(),!0):!1}setScrollSize(G){let J=Math.round(G);return this._scrollSize!==J?(this._scrollSize=J,this._refreshComputedValues(),!0):!1}setScrollPosition(G){let J=Math.round(G);return this._scrollPosition!==J?(this._scrollPosition=J,this._refreshComputedValues(),!0):!1}setScrollbarSize(G){this._scrollbarSize=Math.round(G)}setOppositeScrollbarSize(G){this._oppositeScrollbarSize=Math.round(G)}static _computeValues(G,J,Z,$,Y){let K=Math.max(0,Z-G),X=Math.max(0,K-2*J),j=$>0&&$>Z;if(!j)return{computedAvailableSize:Math.round(K),computedIsNeeded:j,computedSliderSize:Math.round(X),computedSliderRatio:0,computedSliderPosition:0};let V=Math.round(Math.max(20,Math.floor(Z*X/$))),B=(X-V)/($-Z),z=Y*B;return{computedAvailableSize:Math.round(K),computedIsNeeded:j,computedSliderSize:Math.round(V),computedSliderRatio:B,computedSliderPosition:Math.round(z)}}_refreshComputedValues(){let G=q._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=G.computedAvailableSize,this._computedIsNeeded=G.computedIsNeeded,this._computedSliderSize=G.computedSliderSize,this._computedSliderRatio=G.computedSliderRatio,this._computedSliderPosition=G.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(G){if(!this._computedIsNeeded)return 0;let J=G-this._arrowSize-this._computedSliderSize/2;return Math.round(J/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(G){if(!this._computedIsNeeded)return 0;let J=G-this._arrowSize,Z=this._scrollPosition;return J<this._computedSliderPosition?Z-=this._visibleSize:Z+=this._visibleSize,Z}getDesiredScrollPositionFromDelta(G){if(!this._computedIsNeeded)return 0;let J=this._computedSliderPosition+G;return Math.round(J/this._computedSliderRatio)}},Dq=class extends u1{constructor(q,G,J){let Z=q.getScrollDimensions(),$=q.getCurrentScrollPosition();if(super({lazyRender:G.lazyRender,host:J,scrollbarState:new d1(G.horizontalHasArrows?G.arrowSize:0,G.horizontal===2?0:G.horizontalScrollbarSize,G.vertical===2?0:G.verticalScrollbarSize,Z.width,Z.scrollWidth,$.scrollLeft),visibility:G.horizontal,extraScrollbarClassName:"horizontal",scrollable:q,scrollByPage:G.scrollByPage}),G.horizontalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((G.horizontalScrollbarSize-G.horizontalSliderSize)/2),0,void 0,G.horizontalSliderSize)}_updateSlider(q,G){this.slider.setWidth(q),this.slider.setLeft(G)}_renderDomNode(q,G){this.domNode.setWidth(q),this.domNode.setHeight(G),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll(q){return this._shouldRender=this._onElementScrollSize(q.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(q.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize(q.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(q,G){return q}_sliderPointerPosition(q){return q.pageX}_sliderOrthogonalPointerPosition(q){return q.pageY}_updateScrollbarSize(q){this.slider.setHeight(q)}writeScrollPosition(q,G){q.scrollLeft=G}updateOptions(q){this.updateScrollbarSize(q.horizontal===2?0:q.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(q.vertical===2?0:q.verticalScrollbarSize),this._visibilityController.setVisibility(q.horizontal),this._scrollByPage=q.scrollByPage}},Qq=class extends u1{constructor(q,G,J){let Z=q.getScrollDimensions(),$=q.getCurrentScrollPosition();if(super({lazyRender:G.lazyRender,host:J,scrollbarState:new d1(G.verticalHasArrows?G.arrowSize:0,G.vertical===2?0:G.verticalScrollbarSize,0,Z.height,Z.scrollHeight,$.scrollTop),visibility:G.vertical,extraScrollbarClassName:"vertical",scrollable:q,scrollByPage:G.scrollByPage}),G.verticalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((G.verticalScrollbarSize-G.verticalSliderSize)/2),G.verticalSliderSize,void 0)}_updateSlider(q,G){this.slider.setHeight(q),this.slider.setTop(G)}_renderDomNode(q,G){this.domNode.setWidth(G),this.domNode.setHeight(q),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll(q){return this._shouldRender=this._onElementScrollSize(q.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition(q.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize(q.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition(q,G){return G}_sliderPointerPosition(q){return q.pageY}_sliderOrthogonalPointerPosition(q){return q.pageX}_updateScrollbarSize(q){this.slider.setWidth(q)}writeScrollPosition(q,G){q.scrollTop=G}updateOptions(q){this.updateScrollbarSize(q.vertical===2?0:q.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility(q.vertical),this._scrollByPage=q.scrollByPage}},Pq=500,u0=50,d0=!0,Wq=class{constructor(q,G,J){this.timestamp=q,this.deltaX=G,this.deltaY=J,this.score=0}},J9=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let G=1,J=0,Z=1,$=this._rear;do{let Y=$===this._front?G:Math.pow(2,-Z);if(G-=Y,J+=this._memory[$].score*Y,$===this._front)break;$=(this._capacity+$-1)%this._capacity,Z++}while(!0);return J<=0.5}acceptStandardWheelEvent(G){if(O9){let J=n5(G.browserEvent),Z=C3(J);this.accept(Date.now(),G.deltaX*Z,G.deltaY*Z)}else this.accept(Date.now(),G.deltaX,G.deltaY)}accept(G,J,Z){let $=null,Y=new Wq(G,J,Z);this._front===-1&&this._rear===-1?(this._memory[0]=Y,this._front=0,this._rear=0):($=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=Y),Y.score=this._computeScore(Y,$)}_computeScore(G,J){if(Math.abs(G.deltaX)>0&&Math.abs(G.deltaY)>0)return 1;let Z=0.5;if((!this._isAlmostInt(G.deltaX)||!this._isAlmostInt(G.deltaY))&&(Z+=0.25),J){let $=Math.abs(G.deltaX),Y=Math.abs(G.deltaY),K=Math.abs(J.deltaX),X=Math.abs(J.deltaY),j=Math.max(Math.min($,K),1),V=Math.max(Math.min(Y,X),1),B=Math.max($,K),z=Math.max(Y,X);B%j===0&&z%V===0&&(Z-=0.5)}return Math.min(Math.max(Z,0),1)}_isAlmostInt(G){return Math.abs(Math.round(G)-G)<0.01}};J9.INSTANCE=new J9;var Rq=J9,Oq=class extends x9{constructor(q,G,J){super();this._onScroll=this._register(new x),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new x),this.onWillScroll=this._onWillScroll.event,this._options=kq(G),this._scrollable=J,this._register(this._scrollable.onScroll(($)=>{this._onWillScroll.fire($),this._onDidScroll($),this._onScroll.fire($)}));let Z={onMouseWheel:($)=>this._onMouseWheel($),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new Qq(this._scrollable,this._options,Z)),this._horizontalScrollbar=this._register(new Dq(this._scrollable,this._options,Z)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild(q),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=C7(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=C7(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=C7(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,($)=>this._onMouseOver($)),this.onmouseleave(this._listenOnDomNode,($)=>this._onMouseLeave($)),this._hideTimeout=this._register(new k9),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=m6(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown(q){this._verticalScrollbar.delegatePointerDown(q)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions(q){this._scrollable.setScrollDimensions(q,!1)}updateClassName(q){this._options.className=q,G6&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions(q){typeof q.handleMouseWheel<"u"&&(this._options.handleMouseWheel=q.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof q.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=q.mouseWheelScrollSensitivity),typeof q.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=q.fastScrollSensitivity),typeof q.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=q.scrollPredominantAxis),typeof q.horizontal<"u"&&(this._options.horizontal=q.horizontal),typeof q.vertical<"u"&&(this._options.vertical=q.vertical),typeof q.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=q.horizontalScrollbarSize),typeof q.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=q.verticalScrollbarSize),typeof q.scrollByPage<"u"&&(this._options.scrollByPage=q.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll(q){this._revealOnScroll=q}delegateScrollFromMouseWheelEvent(q){this._onMouseWheel(new T0(q))}_setListeningToMouseWheel(q){if(this._mouseWheelToDispose.length>0!==q&&(this._mouseWheelToDispose=m6(this._mouseWheelToDispose),q)){let G=(J)=>{this._onMouseWheel(new T0(J))};this._mouseWheelToDispose.push(b(this._listenOnDomNode,N5.MOUSE_WHEEL,G,{passive:!1}))}}_onMouseWheel(q){if(q.browserEvent?.defaultPrevented)return;let G=Rq.INSTANCE;d0&&G.acceptStandardWheelEvent(q);let J=!1;if(q.deltaY||q.deltaX){let $=q.deltaY*this._options.mouseWheelScrollSensitivity,Y=q.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&Y+$===0?Y=$=0:Math.abs($)>=Math.abs(Y)?Y=0:$=0),this._options.flipAxes&&([$,Y]=[Y,$]);let K=!G6&&q.browserEvent&&q.browserEvent.shiftKey;(this._options.scrollYToX||K)&&!Y&&(Y=$,$=0),q.browserEvent&&q.browserEvent.altKey&&(Y=Y*this._options.fastScrollSensitivity,$=$*this._options.fastScrollSensitivity);let X=this._scrollable.getFutureScrollPosition(),j={};if($){let V=u0*$,B=X.scrollTop-(V<0?Math.floor(V):Math.ceil(V));this._verticalScrollbar.writeScrollPosition(j,B)}if(Y){let V=u0*Y,B=X.scrollLeft-(V<0?Math.floor(V):Math.ceil(V));this._horizontalScrollbar.writeScrollPosition(j,B)}j=this._scrollable.validateScrollPosition(j),(X.scrollLeft!==j.scrollLeft||X.scrollTop!==j.scrollTop)&&(d0&&this._options.mouseWheelSmoothScroll&&G.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(j):this._scrollable.setScrollPositionNow(j),J=!0)}let Z=J;!Z&&this._options.alwaysConsumeMouseWheel&&(Z=!0),!Z&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(Z=!0),Z&&(q.preventDefault(),q.stopPropagation())}_onDidScroll(q){this._shouldRender=this._horizontalScrollbar.onDidScroll(q)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll(q)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let q=this._scrollable.getCurrentScrollPosition(),G=q.scrollTop>0,J=q.scrollLeft>0,Z=J?" left":"",$=G?" top":"",Y=J||G?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${Z}`),this._topShadowDomNode.setClassName(`shadow${$}`),this._topLeftShadowDomNode.setClassName(`shadow${Y}${$}${Z}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave(q){this._mouseIsOver=!1,this._hide()}_onMouseOver(q){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),Pq)}},Aq=class extends Oq{constructor(q,G,J){super(q,G,J)}setScrollPosition(q){q.reuseAnimation?this._scrollable.setScrollPositionSmooth(q,q.reuseAnimation):this._scrollable.setScrollPositionNow(q)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function kq(q){let G={lazyRender:typeof q.lazyRender<"u"?q.lazyRender:!1,className:typeof q.className<"u"?q.className:"",useShadows:typeof q.useShadows<"u"?q.useShadows:!0,handleMouseWheel:typeof q.handleMouseWheel<"u"?q.handleMouseWheel:!0,flipAxes:typeof q.flipAxes<"u"?q.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof q.consumeMouseWheelIfScrollbarIsNeeded<"u"?q.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof q.alwaysConsumeMouseWheel<"u"?q.alwaysConsumeMouseWheel:!1,scrollYToX:typeof q.scrollYToX<"u"?q.scrollYToX:!1,mouseWheelScrollSensitivity:typeof q.mouseWheelScrollSensitivity<"u"?q.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof q.fastScrollSensitivity<"u"?q.fastScrollSensitivity:5,scrollPredominantAxis:typeof q.scrollPredominantAxis<"u"?q.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof q.mouseWheelSmoothScroll<"u"?q.mouseWheelSmoothScroll:!0,arrowSize:typeof q.arrowSize<"u"?q.arrowSize:11,listenOnDomNode:typeof q.listenOnDomNode<"u"?q.listenOnDomNode:null,horizontal:typeof q.horizontal<"u"?q.horizontal:1,horizontalScrollbarSize:typeof q.horizontalScrollbarSize<"u"?q.horizontalScrollbarSize:10,horizontalSliderSize:typeof q.horizontalSliderSize<"u"?q.horizontalSliderSize:0,horizontalHasArrows:typeof q.horizontalHasArrows<"u"?q.horizontalHasArrows:!1,vertical:typeof q.vertical<"u"?q.vertical:1,verticalScrollbarSize:typeof q.verticalScrollbarSize<"u"?q.verticalScrollbarSize:10,verticalHasArrows:typeof q.verticalHasArrows<"u"?q.verticalHasArrows:!1,verticalSliderSize:typeof q.verticalSliderSize<"u"?q.verticalSliderSize:0,scrollByPage:typeof q.scrollByPage<"u"?q.scrollByPage:!1};return G.horizontalSliderSize=typeof q.horizontalSliderSize<"u"?q.horizontalSliderSize:G.horizontalScrollbarSize,G.verticalSliderSize=typeof q.verticalSliderSize<"u"?q.verticalSliderSize:G.verticalScrollbarSize,G6&&(G.className+=" mac"),G}var Z9=class extends g{constructor(q,G,J,Z,$,Y,K,X){super();this._bufferService=J,this._optionsService=K,this._renderService=X,this._onRequestScrollLines=this._register(new x),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let j=this._register(new Hq({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:(V)=>n7(Z.window,V)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{j.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new Aq(G,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},j)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register($.onProtocolChange((V)=>{this._scrollableElement.updateOptions({handleMouseWheel:!(V&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(k5.runAndSubscribe(Y.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=Y.colors.background.css})),q.appendChild(this._scrollableElement.getDomNode()),this._register(r(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=Z.mainDocument.createElement("style"),G.appendChild(this._styleElement),this._register(r(()=>this._styleElement.remove())),this._register(k5.runAndSubscribe(Y.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${Y.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${Y.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${Y.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll((V)=>this._handleScroll(V)))}scrollLines(q){let G=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:G.scrollTop+q*this._renderService.dimensions.css.cell.height})}scrollToLine(q,G){G&&(this._latestYDisp=q),this._scrollableElement.setScrollPosition({reuseAnimation:!G,scrollTop:q*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:this._optionsService.rawOptions.overviewRuler?.width||14}}queueSync(q){q!==void 0&&(this._latestYDisp=q),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync(q=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,q!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:q*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll(q){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let G=Math.round(q.scrollTop/this._renderService.dimensions.css.cell.height),J=G-this._bufferService.buffer.ydisp;J!==0&&(this._latestYDisp=G,this._onRequestScrollLines.fire(J)),this._isHandlingScroll=!1}};Z9=Z5([y(2,y5),y(3,z6),y(4,O1),y(5,l6),y(6,I5),y(7,B6)],Z9);var $9=class extends g{constructor(q,G,J,Z,$){super();this._screenElement=q,this._bufferService=G,this._coreBrowserService=J,this._decorationService=Z,this._renderService=$,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved((Y)=>this._removeDecoration(Y))),this._register(r(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let q of this._decorationService.decorations)this._renderDecoration(q);this._dimensionsChanged=!1}_renderDecoration(q){this._refreshStyle(q),this._dimensionsChanged&&this._refreshXPosition(q)}_createElement(q){let G=this._coreBrowserService.mainDocument.createElement("div");G.classList.add("xterm-decoration"),G.classList.toggle("xterm-decoration-top-layer",q?.options?.layer==="top"),G.style.width=`${Math.round((q.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,G.style.height=`${(q.options.height||1)*this._renderService.dimensions.css.cell.height}px`,G.style.top=`${(q.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,G.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let J=q.options.x??0;return J&&J>this._bufferService.cols&&(G.style.display="none"),this._refreshXPosition(q,G),G}_refreshStyle(q){let G=q.marker.line-this._bufferService.buffers.active.ydisp;if(G<0||G>=this._bufferService.rows)q.element&&(q.element.style.display="none",q.onRenderEmitter.fire(q.element));else{let J=this._decorationElements.get(q);J||(J=this._createElement(q),q.element=J,this._decorationElements.set(q,J),this._container.appendChild(J),q.onDispose(()=>{this._decorationElements.delete(q),J.remove()})),J.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(J.style.width=`${Math.round((q.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,J.style.height=`${(q.options.height||1)*this._renderService.dimensions.css.cell.height}px`,J.style.top=`${G*this._renderService.dimensions.css.cell.height}px`,J.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),q.onRenderEmitter.fire(J)}}_refreshXPosition(q,G=q.element){if(!G)return;let J=q.options.x??0;(q.options.anchor||"left")==="right"?G.style.right=J?`${J*this._renderService.dimensions.css.cell.width}px`:"":G.style.left=J?`${J*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration(q){this._decorationElements.get(q)?.remove(),this._decorationElements.delete(q),q.dispose()}};$9=Z5([y(1,y5),y(2,z6),y(3,P7),y(4,B6)],$9);var Lq=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(q){if(q.options.overviewRulerOptions){for(let G of this._zones)if(G.color===q.options.overviewRulerOptions.color&&G.position===q.options.overviewRulerOptions.position){if(this._lineIntersectsZone(G,q.marker.line))return;if(this._lineAdjacentToZone(G,q.marker.line,q.options.overviewRulerOptions.position)){this._addLineToZone(G,q.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=q.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=q.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=q.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=q.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:q.options.overviewRulerOptions.color,position:q.options.overviewRulerOptions.position,startBufferLine:q.marker.line,endBufferLine:q.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(q){this._linePadding=q}_lineIntersectsZone(q,G){return G>=q.startBufferLine&&G<=q.endBufferLine}_lineAdjacentToZone(q,G,J){return G>=q.startBufferLine-this._linePadding[J||"full"]&&G<=q.endBufferLine+this._linePadding[J||"full"]}_addLineToZone(q,G){q.startBufferLine=Math.min(q.startBufferLine,G),q.endBufferLine=Math.max(q.endBufferLine,G)}},t5={full:0,left:0,center:0,right:0},A6={full:0,left:0,center:0,right:0},G7={full:0,left:0,center:0,right:0},r7=class extends g{constructor(q,G,J,Z,$,Y,K,X){super();this._viewportElement=q,this._screenElement=G,this._bufferService=J,this._decorationService=Z,this._renderService=$,this._optionsService=Y,this._themeService=K,this._coreBrowserService=X,this._colorZoneStore=new Lq,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement),this._register(r(()=>this._canvas?.remove()));let j=this._canvas.getContext("2d");if(j)this._ctx=j;else throw Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){return this._optionsService.options.overviewRuler?.width||0}_refreshDrawConstants(){let q=Math.floor((this._canvas.width-1)/3),G=Math.ceil((this._canvas.width-1)/3);A6.full=this._canvas.width,A6.left=q,A6.center=G,A6.right=q,this._refreshDrawHeightConstants(),G7.full=1,G7.left=1,G7.center=1+A6.left,G7.right=1+A6.left+A6.center}_refreshDrawHeightConstants(){t5.full=Math.round(2*this._coreBrowserService.dpr);let q=this._canvas.height/this._bufferService.buffer.lines.length,G=Math.round(Math.max(Math.min(q,12),6)*this._coreBrowserService.dpr);t5.left=G,t5.center=G,t5.right=G}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*t5.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*t5.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*t5.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*t5.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let G of this._decorationService.decorations)this._colorZoneStore.addDecoration(G);this._ctx.lineWidth=1,this._renderRulerOutline();let q=this._colorZoneStore.zones;for(let G of q)G.position!=="full"&&this._renderColorZone(G);for(let G of q)G.position==="full"&&this._renderColorZone(G);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone(q){this._ctx.fillStyle=q.color,this._ctx.fillRect(G7[q.position||"full"],Math.round((this._canvas.height-1)*(q.startBufferLine/this._bufferService.buffers.active.lines.length)-t5[q.position||"full"]/2),A6[q.position||"full"],Math.round((this._canvas.height-1)*((q.endBufferLine-q.startBufferLine)/this._bufferService.buffers.active.lines.length)+t5[q.position||"full"]))}_queueRefresh(q,G){this._shouldUpdateDimensions=q||this._shouldUpdateDimensions,this._shouldUpdateAnchor=G||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};r7=Z5([y(2,y5),y(3,P7),y(4,B6),y(5,I5),y(6,l6),y(7,z6)],r7);var R;((q)=>(q.NUL="\x00",q.SOH="\x01",q.STX="\x02",q.ETX="\x03",q.EOT="\x04",q.ENQ="\x05",q.ACK="\x06",q.BEL="\x07",q.BS="\b",q.HT="\t",q.LF=`
`,q.VT="\v",q.FF="\f",q.CR="\r",q.SO="\x0E",q.SI="\x0F",q.DLE="\x10",q.DC1="\x11",q.DC2="\x12",q.DC3="\x13",q.DC4="\x14",q.NAK="\x15",q.SYN="\x16",q.ETB="\x17",q.CAN="\x18",q.EM="\x19",q.SUB="\x1A",q.ESC="\x1B",q.FS="\x1C",q.GS="\x1D",q.RS="\x1E",q.US="\x1F",q.SP=" ",q.DEL=""))(R||={});var c7;((q)=>(q.PAD="",q.HOP="",q.BPH="",q.NBH="",q.IND="",q.NEL="",q.SSA="",q.ESA="",q.HTS="",q.HTJ="",q.VTS="",q.PLD="",q.PLU="",q.RI="",q.SS2="",q.SS3="",q.DCS="",q.PU1="",q.PU2="",q.STS="",q.CCH="",q.MW="",q.SPA="",q.EPA="",q.SOS="",q.SGCI="",q.SCI="",q.CSI="",q.ST="",q.OSC="",q.PM="",q.APC=""))(c7||={});var c1;((q)=>q.ST=`${R.ESC}\\`)(c1||={});var Y9=class{constructor(q,G,J,Z,$,Y){this._textarea=q,this._compositionView=G,this._bufferService=J,this._optionsService=Z,this._coreService=$,this._renderService=Y,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(q){this._compositionView.textContent=q.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(q){if(this._isComposing||this._isSendingComposition){if(q.keyCode===20||q.keyCode===229||q.keyCode===16||q.keyCode===17||q.keyCode===18)return!1;this._finalizeComposition(!1)}return q.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition(q){if(this._compositionView.classList.remove("active"),this._isComposing=!1,q){let G={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let J;G.start+=this._dataAlreadySent.length,this._isComposing?J=this._textarea.value.substring(G.start,this._compositionPosition.start):J=this._textarea.value.substring(G.start),J.length>0&&this._coreService.triggerDataEvent(J,!0)}},0)}else{this._isSendingComposition=!1;let G=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(G,!0)}}_handleAnyTextareaChanges(){let q=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let G=this._textarea.value,J=G.replace(q,"");this._dataAlreadySent=J,G.length>q.length?this._coreService.triggerDataEvent(J,!0):G.length<q.length?this._coreService.triggerDataEvent(`${R.DEL}`,!0):G.length===q.length&&G!==q&&this._coreService.triggerDataEvent(G,!0)}},0)}updateCompositionElements(q){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let G=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),J=this._renderService.dimensions.css.cell.height,Z=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,$=G*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=$+"px",this._compositionView.style.top=Z+"px",this._compositionView.style.height=J+"px",this._compositionView.style.lineHeight=J+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let Y=this._compositionView.getBoundingClientRect();this._textarea.style.left=$+"px",this._textarea.style.top=Z+"px",this._textarea.style.width=Math.max(Y.width,1)+"px",this._textarea.style.height=Math.max(Y.height,1)+"px",this._textarea.style.lineHeight=Y.height+"px"}q||setTimeout(()=>this.updateCompositionElements(!0),0)}}};Y9=Z5([y(2,y5),y(3,I5),y(4,p6),y(5,B6)],Y9);var U5=0,M5=0,D5=0,J5=0,c0={css:"#00000000",rgba:0},z5;((q)=>{function G($,Y,K,X){return X!==void 0?`#${_6($)}${_6(Y)}${_6(K)}${_6(X)}`:`#${_6($)}${_6(Y)}${_6(K)}`}q.toCss=G;function J($,Y,K,X=255){return($<<24|Y<<16|K<<8|X)>>>0}q.toRgba=J;function Z($,Y,K,X){return{css:q.toCss($,Y,K,X),rgba:q.toRgba($,Y,K,X)}}q.toColor=Z})(z5||={});var n;((q)=>{function G(j,V){if(J5=(V.rgba&255)/255,J5===1)return{css:V.css,rgba:V.rgba};let B=V.rgba>>24&255,z=V.rgba>>16&255,H=V.rgba>>8&255,F=j.rgba>>24&255,C=j.rgba>>16&255,M=j.rgba>>8&255;U5=F+Math.round((B-F)*J5),M5=C+Math.round((z-C)*J5),D5=M+Math.round((H-M)*J5);let k=z5.toCss(U5,M5,D5),I=z5.toRgba(U5,M5,D5);return{css:k,rgba:I}}q.blend=G;function J(j){return(j.rgba&255)===255}q.isOpaque=J;function Z(j,V,B){let z=a7.ensureContrastRatio(j.rgba,V.rgba,B);if(z)return z5.toColor(z>>24&255,z>>16&255,z>>8&255)}q.ensureContrastRatio=Z;function $(j){let V=(j.rgba|255)>>>0;return[U5,M5,D5]=a7.toChannels(V),{css:z5.toCss(U5,M5,D5),rgba:V}}q.opaque=$;function Y(j,V){return J5=Math.round(V*255),[U5,M5,D5]=a7.toChannels(j.rgba),{css:z5.toCss(U5,M5,D5,J5),rgba:z5.toRgba(U5,M5,D5,J5)}}q.opacity=Y;function K(j,V){return J5=j.rgba&255,Y(j,J5*V/255)}q.multiplyOpacity=K;function X(j){return[j.rgba>>24&255,j.rgba>>16&255,j.rgba>>8&255]}q.toColorRGB=X})(n||={});var e;((q)=>{let G,J;try{let $=document.createElement("canvas");$.width=1,$.height=1;let Y=$.getContext("2d",{willReadFrequently:!0});Y&&(G=Y,G.globalCompositeOperation="copy",J=G.createLinearGradient(0,0,1,1))}catch{}function Z($){if($.match(/#[\da-f]{3,8}/i))switch($.length){case 4:return U5=parseInt($.slice(1,2).repeat(2),16),M5=parseInt($.slice(2,3).repeat(2),16),D5=parseInt($.slice(3,4).repeat(2),16),z5.toColor(U5,M5,D5);case 5:return U5=parseInt($.slice(1,2).repeat(2),16),M5=parseInt($.slice(2,3).repeat(2),16),D5=parseInt($.slice(3,4).repeat(2),16),J5=parseInt($.slice(4,5).repeat(2),16),z5.toColor(U5,M5,D5,J5);case 7:return{css:$,rgba:(parseInt($.slice(1),16)<<8|255)>>>0};case 9:return{css:$,rgba:parseInt($.slice(1),16)>>>0}}let Y=$.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(Y)return U5=parseInt(Y[1]),M5=parseInt(Y[2]),D5=parseInt(Y[3]),J5=Math.round((Y[5]===void 0?1:parseFloat(Y[5]))*255),z5.toColor(U5,M5,D5,J5);if(!G||!J)throw Error("css.toColor: Unsupported css format");if(G.fillStyle=J,G.fillStyle=$,typeof G.fillStyle!="string")throw Error("css.toColor: Unsupported css format");if(G.fillRect(0,0,1,1),[U5,M5,D5,J5]=G.getImageData(0,0,1,1).data,J5!==255)throw Error("css.toColor: Unsupported css format");return{rgba:z5.toRgba(U5,M5,D5,J5),css:$}}q.toColor=Z})(e||={});var w5;((q)=>{function G(Z){return J(Z>>16&255,Z>>8&255,Z&255)}q.relativeLuminance=G;function J(Z,$,Y){let K=Z/255,X=$/255,j=Y/255,V=K<=0.03928?K/12.92:Math.pow((K+0.055)/1.055,2.4),B=X<=0.03928?X/12.92:Math.pow((X+0.055)/1.055,2.4),z=j<=0.03928?j/12.92:Math.pow((j+0.055)/1.055,2.4);return V*0.2126+B*0.7152+z*0.0722}q.relativeLuminance2=J})(w5||={});var a7;((q)=>{function G(K,X){if(J5=(X&255)/255,J5===1)return X;let j=X>>24&255,V=X>>16&255,B=X>>8&255,z=K>>24&255,H=K>>16&255,F=K>>8&255;return U5=z+Math.round((j-z)*J5),M5=H+Math.round((V-H)*J5),D5=F+Math.round((B-F)*J5),z5.toRgba(U5,M5,D5)}q.blend=G;function J(K,X,j){let V=w5.relativeLuminance(K>>8),B=w5.relativeLuminance(X>>8);if(K6(V,B)<j){if(B<V){let F=Z(K,X,j),C=K6(V,w5.relativeLuminance(F>>8));if(C<j){let M=$(K,X,j),k=K6(V,w5.relativeLuminance(M>>8));return C>k?F:M}return F}let z=$(K,X,j),H=K6(V,w5.relativeLuminance(z>>8));if(H<j){let F=Z(K,X,j),C=K6(V,w5.relativeLuminance(F>>8));return H>C?z:F}return z}}q.ensureContrastRatio=J;function Z(K,X,j){let V=K>>24&255,B=K>>16&255,z=K>>8&255,H=X>>24&255,F=X>>16&255,C=X>>8&255,M=K6(w5.relativeLuminance2(H,F,C),w5.relativeLuminance2(V,B,z));for(;M<j&&(H>0||F>0||C>0);)H-=Math.max(0,Math.ceil(H*0.1)),F-=Math.max(0,Math.ceil(F*0.1)),C-=Math.max(0,Math.ceil(C*0.1)),M=K6(w5.relativeLuminance2(H,F,C),w5.relativeLuminance2(V,B,z));return(H<<24|F<<16|C<<8|255)>>>0}q.reduceLuminance=Z;function $(K,X,j){let V=K>>24&255,B=K>>16&255,z=K>>8&255,H=X>>24&255,F=X>>16&255,C=X>>8&255,M=K6(w5.relativeLuminance2(H,F,C),w5.relativeLuminance2(V,B,z));for(;M<j&&(H<255||F<255||C<255);)H=Math.min(255,H+Math.ceil((255-H)*0.1)),F=Math.min(255,F+Math.ceil((255-F)*0.1)),C=Math.min(255,C+Math.ceil((255-C)*0.1)),M=K6(w5.relativeLuminance2(H,F,C),w5.relativeLuminance2(V,B,z));return(H<<24|F<<16|C<<8|255)>>>0}q.increaseLuminance=$;function Y(K){return[K>>24&255,K>>16&255,K>>8&255,K&255]}q.toChannels=Y})(a7||={});function _6(q){let G=q.toString(16);return G.length<2?"0"+G:G}function K6(q,G){return q<G?(G+0.05)/(q+0.05):(q+0.05)/(G+0.05)}var xq=class extends Q7{constructor(q,G,J){super();this.content=0,this.combinedData="",this.fg=q.fg,this.bg=q.bg,this.combinedData=G,this._width=J}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(q){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},i7=class{constructor(q){this._bufferService=q,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new l5}register(q){let G={id:this._nextCharacterJoinerId++,handler:q};return this._characterJoiners.push(G),G.id}deregister(q){for(let G=0;G<this._characterJoiners.length;G++)if(this._characterJoiners[G].id===q)return this._characterJoiners.splice(G,1),!0;return!1}getJoinedCharacters(q){if(this._characterJoiners.length===0)return[];let G=this._bufferService.buffer.lines.get(q);if(!G||G.length===0)return[];let J=[],Z=G.translateToString(!0),$=0,Y=0,K=0,X=G.getFg(0),j=G.getBg(0);for(let V=0;V<G.getTrimmedLength();V++)if(G.loadCell(V,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==X||this._workCell.bg!==j){if(V-$>1){let B=this._getJoinedRanges(Z,K,Y,G,$);for(let z=0;z<B.length;z++)J.push(B[z])}$=V,K=Y,X=this._workCell.fg,j=this._workCell.bg}Y+=this._workCell.getChars().length||x6.length}if(this._bufferService.cols-$>1){let V=this._getJoinedRanges(Z,K,Y,G,$);for(let B=0;B<V.length;B++)J.push(V[B])}return J}_getJoinedRanges(q,G,J,Z,$){let Y=q.substring(G,J),K=[];try{K=this._characterJoiners[0].handler(Y)}catch(X){console.error(X)}for(let X=1;X<this._characterJoiners.length;X++)try{let j=this._characterJoiners[X].handler(Y);for(let V=0;V<j.length;V++)i7._mergeRanges(K,j[V])}catch(j){console.error(j)}return this._stringRangesToCellRanges(K,Z,$),K}_stringRangesToCellRanges(q,G,J){let Z=0,$=!1,Y=0,K=q[Z];if(K){for(let X=J;X<this._bufferService.cols;X++){let j=G.getWidth(X),V=G.getString(X).length||x6.length;if(j!==0){if(!$&&K[0]<=Y&&(K[0]=X,$=!0),K[1]<=Y){if(K[1]=X,K=q[++Z],!K)break;K[0]<=Y?(K[0]=X,$=!0):$=!1}Y+=V}}K&&(K[1]=this._bufferService.cols)}}static _mergeRanges(q,G){let J=!1;for(let Z=0;Z<q.length;Z++){let $=q[Z];if(J){if(G[1]<=$[0])return q[Z-1][1]=G[1],q;if(G[1]<=$[1])return q[Z-1][1]=Math.max(G[1],$[1]),q.splice(Z,1),q;q.splice(Z,1),Z--}else{if(G[1]<=$[0])return q.splice(Z,0,G),q;if(G[1]<=$[1])return $[0]=Math.min(G[0],$[0]),q;G[0]<$[1]&&($[0]=Math.min(G[0],$[0]),J=!0);continue}}return J?q[q.length-1][1]=G[1]:q.push(G),q}};i7=Z5([y(0,y5)],i7);function Sq(q){return 57508<=q&&q<=57558}function wq(q){return 9472<=q&&q<=9631}function yq(q){return Sq(q)||wq(q)}function Iq(){return{css:{canvas:v7(),cell:v7()},device:{canvas:v7(),cell:v7(),char:{width:0,height:0,left:0,top:0}}}}function v7(){return{width:0,height:0}}var K9=class{constructor(q,G,J,Z,$,Y,K){this._document=q,this._characterJoinerService=G,this._optionsService=J,this._coreBrowserService=Z,this._coreService=$,this._decorationService=Y,this._themeService=K,this._workCell=new l5,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(q,G,J){this._selectionStart=q,this._selectionEnd=G,this._columnSelectMode=J}createRow(q,G,J,Z,$,Y,K,X,j,V,B){let z=[],H=this._characterJoinerService.getJoinedCharacters(G),F=this._themeService.colors,C=q.getNoBgTrimmedLength();J&&C<Y+1&&(C=Y+1);let M,k=0,I="",_=0,S=0,O=0,w=0,T=!1,f=0,o=!1,K5=0,S5=0,E=[],d5=V!==-1&&B!==-1;for(let N=0;N<C;N++){q.loadCell(N,this._workCell);let U=this._workCell.getWidth();if(U===0)continue;let W=!1,Q=N>=S5,P=N,D=this._workCell;if(H.length>0&&N===H[0][0]&&Q){let h=H.shift(),W6=this._isCellInSelection(h[0],G);for(_=h[0]+1;_<h[1];_++)Q&&=W6===this._isCellInSelection(_,G);Q&&=!J||Y<h[0]||Y>=h[1],Q?(W=!0,D=new xq(this._workCell,q.translateToString(!0,h[0],h[1]),h[1]-h[0]),P=h[1]-1,U=D.getWidth()):S5=h[1]}let A=this._isCellInSelection(N,G),L=J&&N===Y,v=d5&&N>=V&&N<=B,d=!1;this._decorationService.forEachDecorationAtCell(N,G,void 0,(h)=>{d=!0});let p=D.getChars()||x6;if(p===" "&&(D.isUnderline()||D.isOverline())&&(p=""),K5=U*X-j.get(p,D.isBold(),D.isItalic()),!M)M=this._document.createElement("span");else if(k&&(A&&o||!A&&!o&&D.bg===S)&&(A&&o&&F.selectionForeground||D.fg===O)&&D.extended.ext===w&&v===T&&K5===f&&!L&&!W&&!d&&Q){D.isInvisible()?I+=x6:I+=p,k++;continue}else k&&(M.textContent=I),M=this._document.createElement("span"),k=0,I="";if(S=D.bg,O=D.fg,w=D.extended.ext,T=v,f=K5,o=A,W&&Y>=N&&Y<=P&&(Y=N),!this._coreService.isCursorHidden&&L&&this._coreService.isCursorInitialized){if(E.push("xterm-cursor"),this._coreBrowserService.isFocused)K&&E.push("xterm-cursor-blink"),E.push(Z==="bar"?"xterm-cursor-bar":Z==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if($)switch($){case"outline":E.push("xterm-cursor-outline");break;case"block":E.push("xterm-cursor-block");break;case"bar":E.push("xterm-cursor-bar");break;case"underline":E.push("xterm-cursor-underline");break;default:break}}if(D.isBold()&&E.push("xterm-bold"),D.isItalic()&&E.push("xterm-italic"),D.isDim()&&E.push("xterm-dim"),D.isInvisible()?I=x6:I=D.getChars()||x6,D.isUnderline()&&(E.push(`xterm-underline-${D.extended.underlineStyle}`),I===" "&&(I=""),!D.isUnderlineColorDefault()))if(D.isUnderlineColorRGB())M.style.textDecorationColor=`rgb(${Q7.toColorRGB(D.getUnderlineColor()).join(",")})`;else{let h=D.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&D.isBold()&&h<8&&(h+=8),M.style.textDecorationColor=F.ansi[h].css}D.isOverline()&&(E.push("xterm-overline"),I===" "&&(I="")),D.isStrikethrough()&&E.push("xterm-strikethrough"),v&&(M.style.textDecoration="underline");let u=D.getFgColor(),A5=D.getFgColorMode(),c=D.getBgColor(),X5=D.getBgColorMode(),a=!!D.isInverse();if(a){let h=u;u=c,c=h;let W6=A5;A5=X5,X5=W6}let q5,P6,i5=!1;this._decorationService.forEachDecorationAtCell(N,G,void 0,(h)=>{h.options.layer!=="top"&&i5||(h.backgroundColorRGB&&(X5=50331648,c=h.backgroundColorRGB.rgba>>8&16777215,q5=h.backgroundColorRGB),h.foregroundColorRGB&&(A5=50331648,u=h.foregroundColorRGB.rgba>>8&16777215,P6=h.foregroundColorRGB),i5=h.options.layer==="top")}),!i5&&A&&(q5=this._coreBrowserService.isFocused?F.selectionBackgroundOpaque:F.selectionInactiveBackgroundOpaque,c=q5.rgba>>8&16777215,X5=50331648,i5=!0,F.selectionForeground&&(A5=50331648,u=F.selectionForeground.rgba>>8&16777215,P6=F.selectionForeground)),i5&&E.push("xterm-decoration-top");let b5;switch(X5){case 16777216:case 33554432:b5=F.ansi[c],E.push(`xterm-bg-${c}`);break;case 50331648:b5=z5.toColor(c>>16,c>>8&255,c&255),this._addStyle(M,`background-color:#${a0((c>>>0).toString(16),"0",6)}`);break;case 0:default:a?(b5=F.foreground,E.push("xterm-bg-257")):b5=F.background}switch(q5||D.isDim()&&(q5=n.multiplyOpacity(b5,0.5)),A5){case 16777216:case 33554432:D.isBold()&&u<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(u+=8),this._applyMinimumContrast(M,b5,F.ansi[u],D,q5,void 0)||E.push(`xterm-fg-${u}`);break;case 50331648:let h=z5.toColor(u>>16&255,u>>8&255,u&255);this._applyMinimumContrast(M,b5,h,D,q5,P6)||this._addStyle(M,`color:#${a0(u.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(M,b5,F.foreground,D,q5,P6)||a&&E.push("xterm-fg-257")}E.length&&(M.className=E.join(" "),E.length=0),!L&&!W&&!d&&Q?k++:M.textContent=I,K5!==this.defaultSpacing&&(M.style.letterSpacing=`${K5}px`),z.push(M),N=P}return M&&k&&(M.textContent=I),z}_applyMinimumContrast(q,G,J,Z,$,Y){if(this._optionsService.rawOptions.minimumContrastRatio===1||yq(Z.getCode()))return!1;let K=this._getContrastCache(Z),X;if(!$&&!Y&&(X=K.getColor(G.rgba,J.rgba)),X===void 0){let j=this._optionsService.rawOptions.minimumContrastRatio/(Z.isDim()?2:1);X=n.ensureContrastRatio($||G,Y||J,j),K.setColor(($||G).rgba,(Y||J).rgba,X??null)}return X?(this._addStyle(q,`color:${X.css}`),!0):!1}_getContrastCache(q){return q.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(q,G){q.setAttribute("style",`${q.getAttribute("style")||""}${G};`)}_isCellInSelection(q,G){let J=this._selectionStart,Z=this._selectionEnd;return!J||!Z?!1:this._columnSelectMode?J[0]<=Z[0]?q>=J[0]&&G>=J[1]&&q<Z[0]&&G<=Z[1]:q<J[0]&&G>=J[1]&&q>=Z[0]&&G<=Z[1]:G>J[1]&&G<Z[1]||J[1]===Z[1]&&G===J[1]&&q>=J[0]&&q<Z[0]||J[1]<Z[1]&&G===Z[1]&&q<Z[0]||J[1]<Z[1]&&G===J[1]&&q>=J[0]}};K9=Z5([y(1,L1),y(2,I5),y(3,z6),y(4,p6),y(5,P7),y(6,l6)],K9);function a0(q,G,J){for(;q.length<J;)q=G+q;return q}var Tq=class{constructor(q,G){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=q.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let J=q.createElement("span");J.classList.add("xterm-char-measure-element");let Z=q.createElement("span");Z.classList.add("xterm-char-measure-element"),Z.style.fontWeight="bold";let $=q.createElement("span");$.classList.add("xterm-char-measure-element"),$.style.fontStyle="italic";let Y=q.createElement("span");Y.classList.add("xterm-char-measure-element"),Y.style.fontWeight="bold",Y.style.fontStyle="italic",this._measureElements=[J,Z,$,Y],this._container.appendChild(J),this._container.appendChild(Z),this._container.appendChild($),this._container.appendChild(Y),G.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(q,G,J,Z){q===this._font&&G===this._fontSize&&J===this._weight&&Z===this._weightBold||(this._font=q,this._fontSize=G,this._weight=J,this._weightBold=Z,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${J}`,this._measureElements[1].style.fontWeight=`${Z}`,this._measureElements[2].style.fontWeight=`${J}`,this._measureElements[3].style.fontWeight=`${Z}`,this.clear())}get(q,G,J){let Z=0;if(!G&&!J&&q.length===1&&(Z=q.charCodeAt(0))<256){if(this._flat[Z]!==-9999)return this._flat[Z];let K=this._measure(q,0);return K>0&&(this._flat[Z]=K),K}let $=q;G&&($+="B"),J&&($+="I");let Y=this._holey.get($);if(Y===void 0){let K=0;G&&(K|=1),J&&(K|=2),Y=this._measure(q,K),Y>0&&this._holey.set($,Y)}return Y}_measure(q,G){let J=this._measureElements[G];return J.textContent=q.repeat(32),J.offsetWidth/32}},_q=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(q,G,J,Z=!1){if(this.selectionStart=G,this.selectionEnd=J,!G||!J||G[0]===J[0]&&G[1]===J[1]){this.clear();return}let $=q.buffers.active.ydisp,Y=G[1]-$,K=J[1]-$,X=Math.max(Y,0),j=Math.min(K,q.rows-1);if(X>=q.rows||j<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=Z,this.viewportStartRow=Y,this.viewportEndRow=K,this.viewportCappedStartRow=X,this.viewportCappedEndRow=j,this.startCol=G[0],this.endCol=J[0]}isCellSelected(q,G,J){return this.hasSelection?(J-=q.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?G>=this.startCol&&J>=this.viewportCappedStartRow&&G<this.endCol&&J<=this.viewportCappedEndRow:G<this.startCol&&J>=this.viewportCappedStartRow&&G>=this.endCol&&J<=this.viewportCappedEndRow:J>this.viewportStartRow&&J<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&J===this.viewportStartRow&&G>=this.startCol&&G<this.endCol||this.viewportStartRow<this.viewportEndRow&&J===this.viewportEndRow&&G<this.endCol||this.viewportStartRow<this.viewportEndRow&&J===this.viewportStartRow&&G>=this.startCol):!1}};function vq(){return new _q}var b8="xterm-dom-renderer-owner-",c5="xterm-rows",E7="xterm-fg-",l0="xterm-bg-",J7="xterm-focus",b7="xterm-selection",Eq=1,X9=class extends g{constructor(q,G,J,Z,$,Y,K,X,j,V,B,z,H,F){super();this._terminal=q,this._document=G,this._element=J,this._screenElement=Z,this._viewportElement=$,this._helperContainer=Y,this._linkifier2=K,this._charSizeService=j,this._optionsService=V,this._bufferService=B,this._coreService=z,this._coreBrowserService=H,this._themeService=F,this._terminalClass=Eq++,this._rowElements=[],this._selectionRenderModel=vq(),this.onRequestRedraw=this._register(new x).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(c5),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(b7),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=Iq(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors((C)=>this._injectCss(C))),this._injectCss(this._themeService.colors),this._rowFactory=X.createInstance(K9,document),this._element.classList.add(b8+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline((C)=>this._handleLinkHover(C))),this._register(this._linkifier2.onHideLinkUnderline((C)=>this._handleLinkLeave(C))),this._register(r(()=>{this._element.classList.remove(b8+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new Tq(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let q=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*q,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*q),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/q),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/q),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let J of this._rowElements)J.style.width=`${this.dimensions.css.canvas.width}px`,J.style.height=`${this.dimensions.css.cell.height}px`,J.style.lineHeight=`${this.dimensions.css.cell.height}px`,J.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let G=`${this._terminalSelector} .${c5} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=G,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(q){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let G=`${this._terminalSelector} .${c5} { pointer-events: none; color: ${q.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;G+=`${this._terminalSelector} .${c5} .xterm-dim { color: ${n.multiplyOpacity(q.foreground,0.5).css};}`,G+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let J=`blink_underline_${this._terminalClass}`,Z=`blink_bar_${this._terminalClass}`,$=`blink_block_${this._terminalClass}`;G+=`@keyframes ${J} { 50% {  border-bottom-style: hidden; }}`,G+=`@keyframes ${Z} { 50% {  box-shadow: none; }}`,G+=`@keyframes ${$} { 0% {  background-color: ${q.cursor.css};  color: ${q.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${q.cursor.css}; }}`,G+=`${this._terminalSelector} .${c5}.${J7} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${J} 1s step-end infinite;}${this._terminalSelector} .${c5}.${J7} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${Z} 1s step-end infinite;}${this._terminalSelector} .${c5}.${J7} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${$} 1s step-end infinite;}${this._terminalSelector} .${c5} .xterm-cursor.xterm-cursor-block { background-color: ${q.cursor.css}; color: ${q.cursorAccent.css};}${this._terminalSelector} .${c5} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${q.cursor.css} !important; color: ${q.cursorAccent.css} !important;}${this._terminalSelector} .${c5} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${q.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${c5} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${q.cursor.css} inset;}${this._terminalSelector} .${c5} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${q.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,G+=`${this._terminalSelector} .${b7} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${b7} div { position: absolute; background-color: ${q.selectionBackgroundOpaque.css};}${this._terminalSelector} .${b7} div { position: absolute; background-color: ${q.selectionInactiveBackgroundOpaque.css};}`;for(let[Y,K]of q.ansi.entries())G+=`${this._terminalSelector} .${E7}${Y} { color: ${K.css}; }${this._terminalSelector} .${E7}${Y}.xterm-dim { color: ${n.multiplyOpacity(K,0.5).css}; }${this._terminalSelector} .${l0}${Y} { background-color: ${K.css}; }`;G+=`${this._terminalSelector} .${E7}257 { color: ${n.opaque(q.background).css}; }${this._terminalSelector} .${E7}257.xterm-dim { color: ${n.multiplyOpacity(n.opaque(q.background),0.5).css}; }${this._terminalSelector} .${l0}257 { background-color: ${q.foreground.css}; }`,this._themeStyleElement.textContent=G}_setDefaultSpacing(){let q=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${q}px`,this._rowFactory.defaultSpacing=q}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(q,G){for(let J=this._rowElements.length;J<=G;J++){let Z=this._document.createElement("div");this._rowContainer.appendChild(Z),this._rowElements.push(Z)}for(;this._rowElements.length>G;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(q,G){this._refreshRowElements(q,G),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(J7),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(J7),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(q,G,J){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(q,G,J),this.renderRows(0,this._bufferService.rows-1),!q||!G||(this._selectionRenderModel.update(this._terminal,q,G,J),!this._selectionRenderModel.hasSelection))return;let Z=this._selectionRenderModel.viewportStartRow,$=this._selectionRenderModel.viewportEndRow,Y=this._selectionRenderModel.viewportCappedStartRow,K=this._selectionRenderModel.viewportCappedEndRow,X=this._document.createDocumentFragment();if(J){let j=q[0]>G[0];X.appendChild(this._createSelectionElement(Y,j?G[0]:q[0],j?q[0]:G[0],K-Y+1))}else{let j=Z===Y?q[0]:0,V=Y===$?G[0]:this._bufferService.cols;X.appendChild(this._createSelectionElement(Y,j,V));let B=K-Y-1;if(X.appendChild(this._createSelectionElement(Y+1,0,this._bufferService.cols,B)),Y!==K){let z=$===K?G[0]:this._bufferService.cols;X.appendChild(this._createSelectionElement(K,0,z))}}this._selectionContainer.appendChild(X)}_createSelectionElement(q,G,J,Z=1){let $=this._document.createElement("div"),Y=G*this.dimensions.css.cell.width,K=this.dimensions.css.cell.width*(J-G);return Y+K>this.dimensions.css.canvas.width&&(K=this.dimensions.css.canvas.width-Y),$.style.height=`${Z*this.dimensions.css.cell.height}px`,$.style.top=`${q*this.dimensions.css.cell.height}px`,$.style.left=`${Y}px`,$.style.width=`${K}px`,$}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let q of this._rowElements)q.replaceChildren()}renderRows(q,G){let J=this._bufferService.buffer,Z=J.ybase+J.y,$=Math.min(J.x,this._bufferService.cols-1),Y=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,K=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,X=this._optionsService.rawOptions.cursorInactiveStyle;for(let j=q;j<=G;j++){let V=j+J.ydisp,B=this._rowElements[j],z=J.lines.get(V);if(!B||!z)break;B.replaceChildren(...this._rowFactory.createRow(z,V,V===Z,K,X,$,Y,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${b8}${this._terminalClass}`}_handleLinkHover(q){this._setCellUnderline(q.x1,q.x2,q.y1,q.y2,q.cols,!0)}_handleLinkLeave(q){this._setCellUnderline(q.x1,q.x2,q.y1,q.y2,q.cols,!1)}_setCellUnderline(q,G,J,Z,$,Y){J<0&&(q=0),Z<0&&(G=0);let K=this._bufferService.rows-1;J=Math.max(Math.min(J,K),0),Z=Math.max(Math.min(Z,K),0),$=Math.min($,this._bufferService.cols);let X=this._bufferService.buffer,j=X.ybase+X.y,V=Math.min(X.x,$-1),B=this._optionsService.rawOptions.cursorBlink,z=this._optionsService.rawOptions.cursorStyle,H=this._optionsService.rawOptions.cursorInactiveStyle;for(let F=J;F<=Z;++F){let C=F+X.ydisp,M=this._rowElements[F],k=X.lines.get(C);if(!M||!k)break;M.replaceChildren(...this._rowFactory.createRow(k,C,C===j,z,H,V,B,this.dimensions.css.cell.width,this._widthCache,Y?F===J?q:0:-1,Y?(F===Z?G:$)-1:-1))}}};X9=Z5([y(7,P9),y(8,J8),y(9,I5),y(10,y5),y(11,p6),y(12,z6),y(13,l6)],X9);var V9=class extends g{constructor(q,G,J){super();this._optionsService=J,this.width=0,this.height=0,this._onCharSizeChange=this._register(new x),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new gq(this._optionsService))}catch{this._measureStrategy=this._register(new bq(q,G,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let q=this._measureStrategy.measure();(q.width!==this.width||q.height!==this.height)&&(this.width=q.width,this.height=q.height,this._onCharSizeChange.fire())}};V9=Z5([y(2,I5)],V9);var a1=class extends g{constructor(){super(...arguments);this._result={width:0,height:0}}_validateAndSet(q,G){q!==void 0&&q>0&&G!==void 0&&G>0&&(this._result.width=q,this._result.height=G)}},bq=class extends a1{constructor(q,G,J){super();this._document=q,this._parentElement=G,this._optionsService=J,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},gq=class extends a1{constructor(q){super();this._optionsService=q,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let G=this._ctx.measureText("W");if(!(("width"in G)&&("fontBoundingBoxAscent"in G)&&("fontBoundingBoxDescent"in G)))throw Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let q=this._ctx.measureText("W");return this._validateAndSet(q.width,q.fontBoundingBoxAscent+q.fontBoundingBoxDescent),this._result}},mq=class extends g{constructor(q,G,J){super();this._textarea=q,this._window=G,this.mainDocument=J,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new fq(this._window)),this._onDprChange=this._register(new x),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new x),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange((Z)=>this._screenDprMonitor.setWindow(Z))),this._register(k5.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(b(this._textarea,"focus",()=>this._isFocused=!0)),this._register(b(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window(q){this._window!==q&&(this._window=q,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},fq=class extends g{constructor(q){super();this._parentWindow=q,this._windowResizeListener=this._register(new a6),this._onDprChange=this._register(new x),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(r(()=>this.clearListener()))}setWindow(q){this._parentWindow=q,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=b(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},pq=class extends g{constructor(){super();this.linkProviders=[],this._register(r(()=>this.linkProviders.length=0))}registerLinkProvider(q){return this.linkProviders.push(q),{dispose:()=>{let G=this.linkProviders.indexOf(q);G!==-1&&this.linkProviders.splice(G,1)}}}};function S9(q,G,J){let Z=J.getBoundingClientRect(),$=q.getComputedStyle(J),Y=parseInt($.getPropertyValue("padding-left")),K=parseInt($.getPropertyValue("padding-top"));return[G.clientX-Z.left-Y,G.clientY-Z.top-K]}function hq(q,G,J,Z,$,Y,K,X,j){if(!Y)return;let V=S9(q,G,J);if(V)return V[0]=Math.ceil((V[0]+(j?K/2:0))/K),V[1]=Math.ceil(V[1]/X),V[0]=Math.min(Math.max(V[0],1),Z+(j?1:0)),V[1]=Math.min(Math.max(V[1],1),$),V}var j9=class{constructor(q,G){this._renderService=q,this._charSizeService=G}getCoords(q,G,J,Z,$){return hq(window,q,G,J,Z,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,$)}getMouseReportCoords(q,G){let J=S9(window,q,G);if(this._charSizeService.hasValidSize)return J[0]=Math.min(Math.max(J[0],0),this._renderService.dimensions.css.canvas.width-1),J[1]=Math.min(Math.max(J[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(J[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(J[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(J[0]),y:Math.floor(J[1])}}};j9=Z5([y(0,B6),y(1,J8)],j9);var uq=class{constructor(q,G){this._renderCallback=q,this._coreBrowserService=G,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(q){return this._refreshCallbacks.push(q),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(q,G,J){this._rowCount=J,q=q!==void 0?q:0,G=G!==void 0?G:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,q):q,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,G):G,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let q=Math.max(this._rowStart,0),G=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(q,G),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let q of this._refreshCallbacks)q(0);this._refreshCallbacks=[]}},l1={};k2(l1,{getSafariVersion:()=>cq,isChromeOS:()=>r1,isFirefox:()=>o1,isIpad:()=>aq,isIphone:()=>lq,isLegacyEdge:()=>dq,isLinux:()=>w9,isMac:()=>t7,isNode:()=>Y8,isSafari:()=>s1,isWindows:()=>n1});var Y8=typeof process<"u"&&"title"in process,W7=Y8?"node":navigator.userAgent,R7=Y8?"node":navigator.platform,o1=W7.includes("Firefox"),dq=W7.includes("Edge"),s1=/^((?!chrome|android).)*safari/i.test(W7);function cq(){if(!s1)return 0;let q=W7.match(/Version\/(\d+)/);return q===null||q.length<2?0:parseInt(q[1])}var t7=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(R7),aq=R7==="iPad",lq=R7==="iPhone",n1=["Windows","Win16","Win32","WinCE"].includes(R7),w9=R7.indexOf("Linux")>=0,r1=/\bCrOS\b/.test(W7),i1=class{constructor(){this._tasks=[],this._i=0}enqueue(q){this._tasks.push(q),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(q){this._idleCallback=void 0;let G=0,J=0,Z=q.timeRemaining(),$=0;for(;this._i<this._tasks.length;){if(G=performance.now(),this._tasks[this._i]()||this._i++,G=Math.max(1,performance.now()-G),J=Math.max(G,J),$=q.timeRemaining(),J*1.5>$){Z-G<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(Z-G))}ms`),this._start();return}Z=$}this.clear()}},oq=class extends i1{_requestCallback(q){return setTimeout(()=>q(this._createDeadline(16)))}_cancelCallback(q){clearTimeout(q)}_createDeadline(q){let G=performance.now()+q;return{timeRemaining:()=>Math.max(0,G-performance.now())}}},sq=class extends i1{_requestCallback(q){return requestIdleCallback(q)}_cancelCallback(q){cancelIdleCallback(q)}},e7=!Y8&&"requestIdleCallback"in window?sq:oq,nq=class{constructor(){this._queue=new e7}set(q){this._queue.clear(),this._queue.enqueue(q)}flush(){this._queue.flush()}},z9=class extends g{constructor(q,G,J,Z,$,Y,K,X,j){super();this._rowCount=q,this._optionsService=J,this._charSizeService=Z,this._coreService=$,this._coreBrowserService=X,this._renderer=this._register(new a6),this._pausedResizeTask=new nq,this._observerDisposable=this._register(new a6),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new x),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new x),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new x),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new x),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new uq((V,B)=>this._renderRows(V,B),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new rq(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(r(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(K.onResize(()=>this._fullRefresh())),this._register(K.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(Y.onDecorationRegistered(()=>this._fullRefresh())),this._register(Y.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(K.cols,K.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(K.buffer.y,K.buffer.y,!0))),this._register(j.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,G),this._register(this._coreBrowserService.onWindowChange((V)=>this._registerIntersectionObserver(V,G)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver(q,G){if("IntersectionObserver"in q){let J=new q.IntersectionObserver((Z)=>this._handleIntersectionChange(Z[Z.length-1]),{threshold:0});J.observe(G),this._observerDisposable.value=r(()=>J.disconnect())}}_handleIntersectionChange(q){this._isPaused=q.isIntersecting===void 0?q.intersectionRatio===0:!q.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(q,G,J=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(q,G);return}let Z=this._syncOutputHandler.flush();Z&&(q=Math.min(q,Z.start),G=Math.max(G,Z.end)),J||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(q,G,this._rowCount)}_renderRows(q,G){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows(q,G);return}q=Math.min(q,this._rowCount-1),G=Math.min(G,this._rowCount-1),this._renderer.value.renderRows(q,G),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:q,end:G}),this._onRender.fire({start:q,end:G}),this._isNextRenderRedrawOnly=!0}}resize(q,G){this._rowCount=G,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(q){this._renderer.value=q,this._renderer.value&&(this._renderer.value.onRequestRedraw((G)=>this.refreshRows(G.start,G.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(q){return this._renderDebouncer.addRefreshCallback(q)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(q,G){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize(q,G)):this._renderer.value.handleResize(q,G),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged(q,G,J){this._selectionState.start=q,this._selectionState.end=G,this._selectionState.columnSelectMode=J,this._renderer.value?.handleSelectionChanged(q,G,J)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};z9=Z5([y(2,I5),y(3,J8),y(4,p6),y(5,P7),y(6,y5),y(7,z6),y(8,l6)],z9);var rq=class{constructor(q,G,J){this._coreBrowserService=q,this._coreService=G,this._onTimeout=J,this._start=0,this._end=0,this._isBuffering=!1}bufferRows(q,G){this._isBuffering?(this._start=Math.min(this._start,q),this._end=Math.max(this._end,G)):(this._start=q,this._end=G,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1000))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let q={start:this._start,end:this._end};return this._isBuffering=!1,q}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function iq(q,G,J,Z){let $=J.buffer.x,Y=J.buffer.y;if(!J.buffer.hasScrollback)return qG($,Y,q,G,J,Z)+K8(Y,G,J,Z)+GG($,Y,q,G,J,Z);let K;if(Y===G)return K=$>q?"D":"C",M7(Math.abs($-q),U7(K,Z));K=Y>G?"D":"C";let X=Math.abs(Y-G),j=eq(Y>G?q:$,J)+(X-1)*J.cols+1+tq(Y>G?$:q,J);return M7(j,U7(K,Z))}function tq(q,G){return q-1}function eq(q,G){return G.cols-q}function qG(q,G,J,Z,$,Y){return K8(G,Z,$,Y).length===0?"":M7(e1(q,G,q,G-f6(G,$),!1,$).length,U7("D",Y))}function K8(q,G,J,Z){let $=q-f6(q,J),Y=G-f6(G,J),K=Math.abs($-Y)-JG(q,G,J);return M7(K,U7(t1(q,G),Z))}function GG(q,G,J,Z,$,Y){let K;K8(G,Z,$,Y).length>0?K=Z-f6(Z,$):K=G;let X=Z,j=ZG(q,G,J,Z,$,Y);return M7(e1(q,K,J,X,j==="C",$).length,U7(j,Y))}function JG(q,G,J){let Z=0,$=q-f6(q,J),Y=G-f6(G,J);for(let K=0;K<Math.abs($-Y);K++){let X=t1(q,G)==="A"?-1:1;J.buffer.lines.get($+X*K)?.isWrapped&&Z++}return Z}function f6(q,G){let J=0,Z=G.buffer.lines.get(q),$=Z?.isWrapped;for(;$&&q>=0&&q<G.rows;)J++,Z=G.buffer.lines.get(--q),$=Z?.isWrapped;return J}function ZG(q,G,J,Z,$,Y){let K;return K8(J,Z,$,Y).length>0?K=Z-f6(Z,$):K=G,q<J&&K<=Z||q>=J&&K<Z?"C":"D"}function t1(q,G){return q>G?"A":"B"}function e1(q,G,J,Z,$,Y){let K=q,X=G,j="";for(;(K!==J||X!==Z)&&X>=0&&X<Y.buffer.lines.length;)K+=$?1:-1,$&&K>Y.cols-1?(j+=Y.buffer.translateBufferLineToString(X,!1,q,K),K=0,q=0,X++):!$&&K<0&&(j+=Y.buffer.translateBufferLineToString(X,!1,0,q+1),K=Y.cols-1,q=K,X--);return j+Y.buffer.translateBufferLineToString(X,!1,q,K)}function U7(q,G){let J=G?"O":"[";return R.ESC+J+q}function M7(q,G){q=Math.floor(q);let J="";for(let Z=0;Z<q;Z++)J+=G;return J}var $G=class{constructor(q){this._bufferService=q,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let q=this.selectionStart[0]+this.selectionStartLength;return q>this._bufferService.cols?q%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(q/this._bufferService.cols)-1]:[q%this._bufferService.cols,this.selectionStart[1]+Math.floor(q/this._bufferService.cols)]:[q,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let q=this.selectionStart[0]+this.selectionStartLength;return q>this._bufferService.cols?[q%this._bufferService.cols,this.selectionStart[1]+Math.floor(q/this._bufferService.cols)]:[Math.max(q,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let q=this.selectionStart,G=this.selectionEnd;return!q||!G?!1:q[1]>G[1]||q[1]===G[1]&&q[0]>G[0]}handleTrim(q){return this.selectionStart&&(this.selectionStart[1]-=q),this.selectionEnd&&(this.selectionEnd[1]-=q),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function o0(q,G){if(q.start.y>q.end.y)throw Error(`Buffer range end (${q.end.x}, ${q.end.y}) cannot be before start (${q.start.x}, ${q.start.y})`);return G*(q.end.y-q.start.y)+(q.end.x-q.start.x+1)}var g8=50,YG=15,KG=50,XG=500,VG="",jG=new RegExp(VG,"g"),B9=class extends g{constructor(q,G,J,Z,$,Y,K,X,j){super();this._element=q,this._screenElement=G,this._linkifier=J,this._bufferService=Z,this._coreService=$,this._mouseService=Y,this._optionsService=K,this._renderService=X,this._coreBrowserService=j,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new l5,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new x),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new x),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new x),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new x),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=(V)=>this._handleMouseMove(V),this._mouseUpListener=(V)=>this._handleMouseUp(V),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim((V)=>this._handleTrim(V)),this._register(this._bufferService.buffers.onBufferActivate((V)=>this._handleBufferActivate(V))),this.enable(),this._model=new $G(this._bufferService),this._activeSelectionMode=0,this._register(r(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize((V)=>{V.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let q=this._model.finalSelectionStart,G=this._model.finalSelectionEnd;return!q||!G?!1:q[0]!==G[0]||q[1]!==G[1]}get selectionText(){let q=this._model.finalSelectionStart,G=this._model.finalSelectionEnd;if(!q||!G)return"";let J=this._bufferService.buffer,Z=[];if(this._activeSelectionMode===3){if(q[0]===G[0])return"";let $=q[0]<G[0]?q[0]:G[0],Y=q[0]<G[0]?G[0]:q[0];for(let K=q[1];K<=G[1];K++){let X=J.translateBufferLineToString(K,!0,$,Y);Z.push(X)}}else{let $=q[1]===G[1]?G[0]:void 0;Z.push(J.translateBufferLineToString(q[1],!0,q[0],$));for(let Y=q[1]+1;Y<=G[1]-1;Y++){let K=J.lines.get(Y),X=J.translateBufferLineToString(Y,!0);K?.isWrapped?Z[Z.length-1]+=X:Z.push(X)}if(q[1]!==G[1]){let Y=J.lines.get(G[1]),K=J.translateBufferLineToString(G[1],!0,0,G[0]);Y&&Y.isWrapped?Z[Z.length-1]+=K:Z.push(K)}}return Z.map(($)=>$.replace(jG," ")).join(n1?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(q){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),w9&&q&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(q){let G=this._getMouseBufferCoords(q),J=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd;return!J||!Z||!G?!1:this._areCoordsInSelection(G,J,Z)}isCellInSelection(q,G){let J=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd;return!J||!Z?!1:this._areCoordsInSelection([q,G],J,Z)}_areCoordsInSelection(q,G,J){return q[1]>G[1]&&q[1]<J[1]||G[1]===J[1]&&q[1]===G[1]&&q[0]>=G[0]&&q[0]<J[0]||G[1]<J[1]&&q[1]===J[1]&&q[0]<J[0]||G[1]<J[1]&&q[1]===G[1]&&q[0]>=G[0]}_selectWordAtCursor(q,G){let J=this._linkifier.currentLink?.link?.range;if(J)return this._model.selectionStart=[J.start.x-1,J.start.y-1],this._model.selectionStartLength=o0(J,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let Z=this._getMouseBufferCoords(q);return Z?(this._selectWordAt(Z,G),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(q,G){this._model.clearSelection(),q=Math.max(q,0),G=Math.min(G,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,q],this._model.selectionEnd=[this._bufferService.cols,G],this.refresh(),this._onSelectionChange.fire()}_handleTrim(q){this._model.handleTrim(q)&&this.refresh()}_getMouseBufferCoords(q){let G=this._mouseService.getCoords(q,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(G)return G[0]--,G[1]--,G[1]+=this._bufferService.buffer.ydisp,G}_getMouseEventScrollAmount(q){let G=S9(this._coreBrowserService.window,q,this._screenElement)[1],J=this._renderService.dimensions.css.canvas.height;return G>=0&&G<=J?0:(G>J&&(G-=J),G=Math.min(Math.max(G,-g8),g8),G/=g8,G/Math.abs(G)+Math.round(G*(YG-1)))}shouldForceSelection(q){return t7?q.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:q.shiftKey}handleMouseDown(q){if(this._mouseDownTimeStamp=q.timeStamp,!(q.button===2&&this.hasSelection)&&q.button===0){if(!this._enabled){if(!this.shouldForceSelection(q))return;q.stopPropagation()}q.preventDefault(),this._dragScrollAmount=0,this._enabled&&q.shiftKey?this._handleIncrementalClick(q):q.detail===1?this._handleSingleClick(q):q.detail===2?this._handleDoubleClick(q):q.detail===3&&this._handleTripleClick(q),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),KG)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(q){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(q))}_handleSingleClick(q){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(q)?3:0,this._model.selectionStart=this._getMouseBufferCoords(q),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let G=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);G&&G.length!==this._model.selectionStart[0]&&G.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(q){this._selectWordAtCursor(q,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(q){let G=this._getMouseBufferCoords(q);G&&(this._activeSelectionMode=2,this._selectLineAt(G[1]))}shouldColumnSelect(q){return q.altKey&&!(t7&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(q){if(q.stopImmediatePropagation(),!this._model.selectionStart)return;let G=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(q),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(q),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let J=this._bufferService.buffer;if(this._model.selectionEnd[1]<J.lines.length){let Z=J.lines.get(this._model.selectionEnd[1]);Z&&Z.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!G||G[0]!==this._model.selectionEnd[0]||G[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let q=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(q.ydisp+this._bufferService.rows,q.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=q.ydisp),this.refresh()}}_handleMouseUp(q){let G=q.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&G<XG&&q.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let J=this._mouseService.getCoords(q,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(J&&J[0]!==void 0&&J[1]!==void 0){let Z=iq(J[0]-1,J[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(Z,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let q=this._model.finalSelectionStart,G=this._model.finalSelectionEnd,J=!!q&&!!G&&(q[0]!==G[0]||q[1]!==G[1]);if(!J){this._oldHasSelection&&this._fireOnSelectionChange(q,G,J);return}!q||!G||(!this._oldSelectionStart||!this._oldSelectionEnd||q[0]!==this._oldSelectionStart[0]||q[1]!==this._oldSelectionStart[1]||G[0]!==this._oldSelectionEnd[0]||G[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange(q,G,J)}_fireOnSelectionChange(q,G,J){this._oldSelectionStart=q,this._oldSelectionEnd=G,this._oldHasSelection=J,this._onSelectionChange.fire()}_handleBufferActivate(q){this.clearSelection(),this._trimListener.dispose(),this._trimListener=q.activeBuffer.lines.onTrim((G)=>this._handleTrim(G))}_convertViewportColToCharacterIndex(q,G){let J=G;for(let Z=0;G>=Z;Z++){let $=q.loadCell(Z,this._workCell).getChars().length;this._workCell.getWidth()===0?J--:$>1&&G!==Z&&(J+=$-1)}return J}setSelection(q,G,J){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[q,G],this._model.selectionStartLength=J,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(q){this._isClickInSelection(q)||(this._selectWordAtCursor(q,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(q,G,J=!0,Z=!0){if(q[0]>=this._bufferService.cols)return;let $=this._bufferService.buffer,Y=$.lines.get(q[1]);if(!Y)return;let K=$.translateBufferLineToString(q[1],!1),X=this._convertViewportColToCharacterIndex(Y,q[0]),j=X,V=q[0]-X,B=0,z=0,H=0,F=0;if(K.charAt(X)===" "){for(;X>0&&K.charAt(X-1)===" ";)X--;for(;j<K.length&&K.charAt(j+1)===" ";)j++}else{let k=q[0],I=q[0];Y.getWidth(k)===0&&(B++,k--),Y.getWidth(I)===2&&(z++,I++);let _=Y.getString(I).length;for(_>1&&(F+=_-1,j+=_-1);k>0&&X>0&&!this._isCharWordSeparator(Y.loadCell(k-1,this._workCell));){Y.loadCell(k-1,this._workCell);let S=this._workCell.getChars().length;this._workCell.getWidth()===0?(B++,k--):S>1&&(H+=S-1,X-=S-1),X--,k--}for(;I<Y.length&&j+1<K.length&&!this._isCharWordSeparator(Y.loadCell(I+1,this._workCell));){Y.loadCell(I+1,this._workCell);let S=this._workCell.getChars().length;this._workCell.getWidth()===2?(z++,I++):S>1&&(F+=S-1,j+=S-1),j++,I++}}j++;let C=X+V-B+H,M=Math.min(this._bufferService.cols,j-X+B+z-H-F);if(!(!G&&K.slice(X,j).trim()==="")){if(J&&C===0&&Y.getCodePoint(0)!==32){let k=$.lines.get(q[1]-1);if(k&&Y.isWrapped&&k.getCodePoint(this._bufferService.cols-1)!==32){let I=this._getWordAt([this._bufferService.cols-1,q[1]-1],!1,!0,!1);if(I){let _=this._bufferService.cols-I.start;C-=_,M+=_}}}if(Z&&C+M===this._bufferService.cols&&Y.getCodePoint(this._bufferService.cols-1)!==32){let k=$.lines.get(q[1]+1);if(k?.isWrapped&&k.getCodePoint(0)!==32){let I=this._getWordAt([0,q[1]+1],!1,!1,!0);I&&(M+=I.length)}}return{start:C,length:M}}}_selectWordAt(q,G){let J=this._getWordAt(q,G);if(J){for(;J.start<0;)J.start+=this._bufferService.cols,q[1]--;this._model.selectionStart=[J.start,q[1]],this._model.selectionStartLength=J.length}}_selectToWordAt(q){let G=this._getWordAt(q,!0);if(G){let J=q[1];for(;G.start<0;)G.start+=this._bufferService.cols,J--;if(!this._model.areSelectionValuesReversed())for(;G.start+G.length>this._bufferService.cols;)G.length-=this._bufferService.cols,J++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?G.start:G.start+G.length,J]}}_isCharWordSeparator(q){return q.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf(q.getChars())>=0}_selectLineAt(q){let G=this._bufferService.buffer.getWrappedRangeForLine(q),J={start:{x:0,y:G.first},end:{x:this._bufferService.cols-1,y:G.last}};this._model.selectionStart=[0,G.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=o0(J,this._bufferService.cols)}};B9=Z5([y(3,y5),y(4,p6),y(5,W9),y(6,I5),y(7,B6),y(8,z6)],B9);var s0=class{constructor(){this._data={}}set(q,G,J){this._data[q]||(this._data[q]={}),this._data[q][G]=J}get(q,G){return this._data[q]?this._data[q][G]:void 0}clear(){this._data={}}},n0=class{constructor(){this._color=new s0,this._css=new s0}setCss(q,G,J){this._css.set(q,G,J)}getCss(q,G){return this._css.get(q,G)}setColor(q,G,J){this._color.set(q,G,J)}getColor(q,G){return this._color.get(q,G)}clear(){this._color.clear(),this._css.clear()}},H5=Object.freeze((()=>{let q=[e.toColor("#2e3436"),e.toColor("#cc0000"),e.toColor("#4e9a06"),e.toColor("#c4a000"),e.toColor("#3465a4"),e.toColor("#75507b"),e.toColor("#06989a"),e.toColor("#d3d7cf"),e.toColor("#555753"),e.toColor("#ef2929"),e.toColor("#8ae234"),e.toColor("#fce94f"),e.toColor("#729fcf"),e.toColor("#ad7fa8"),e.toColor("#34e2e2"),e.toColor("#eeeeec")],G=[0,95,135,175,215,255];for(let J=0;J<216;J++){let Z=G[J/36%6|0],$=G[J/6%6|0],Y=G[J%6];q.push({css:z5.toCss(Z,$,Y),rgba:z5.toRgba(Z,$,Y)})}for(let J=0;J<24;J++){let Z=8+J*10;q.push({css:z5.toCss(Z,Z,Z),rgba:z5.toRgba(Z,Z,Z)})}return q})()),v6=e.toColor("#ffffff"),j7=e.toColor("#000000"),r0=e.toColor("#ffffff"),i0=j7,Z7={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},zG=v6,H9=class extends g{constructor(q){super();this._optionsService=q,this._contrastCache=new n0,this._halfContrastCache=new n0,this._onChangeColors=this._register(new x),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:v6,background:j7,cursor:r0,cursorAccent:i0,selectionForeground:void 0,selectionBackgroundTransparent:Z7,selectionBackgroundOpaque:n.blend(j7,Z7),selectionInactiveBackgroundTransparent:Z7,selectionInactiveBackgroundOpaque:n.blend(j7,Z7),scrollbarSliderBackground:n.opacity(v6,0.2),scrollbarSliderHoverBackground:n.opacity(v6,0.4),scrollbarSliderActiveBackground:n.opacity(v6,0.5),overviewRulerBorder:v6,ansi:H5.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme(q={}){let G=this._colors;if(G.foreground=l(q.foreground,v6),G.background=l(q.background,j7),G.cursor=n.blend(G.background,l(q.cursor,r0)),G.cursorAccent=n.blend(G.background,l(q.cursorAccent,i0)),G.selectionBackgroundTransparent=l(q.selectionBackground,Z7),G.selectionBackgroundOpaque=n.blend(G.background,G.selectionBackgroundTransparent),G.selectionInactiveBackgroundTransparent=l(q.selectionInactiveBackground,G.selectionBackgroundTransparent),G.selectionInactiveBackgroundOpaque=n.blend(G.background,G.selectionInactiveBackgroundTransparent),G.selectionForeground=q.selectionForeground?l(q.selectionForeground,c0):void 0,G.selectionForeground===c0&&(G.selectionForeground=void 0),n.isOpaque(G.selectionBackgroundTransparent)&&(G.selectionBackgroundTransparent=n.opacity(G.selectionBackgroundTransparent,0.3)),n.isOpaque(G.selectionInactiveBackgroundTransparent)&&(G.selectionInactiveBackgroundTransparent=n.opacity(G.selectionInactiveBackgroundTransparent,0.3)),G.scrollbarSliderBackground=l(q.scrollbarSliderBackground,n.opacity(G.foreground,0.2)),G.scrollbarSliderHoverBackground=l(q.scrollbarSliderHoverBackground,n.opacity(G.foreground,0.4)),G.scrollbarSliderActiveBackground=l(q.scrollbarSliderActiveBackground,n.opacity(G.foreground,0.5)),G.overviewRulerBorder=l(q.overviewRulerBorder,zG),G.ansi=H5.slice(),G.ansi[0]=l(q.black,H5[0]),G.ansi[1]=l(q.red,H5[1]),G.ansi[2]=l(q.green,H5[2]),G.ansi[3]=l(q.yellow,H5[3]),G.ansi[4]=l(q.blue,H5[4]),G.ansi[5]=l(q.magenta,H5[5]),G.ansi[6]=l(q.cyan,H5[6]),G.ansi[7]=l(q.white,H5[7]),G.ansi[8]=l(q.brightBlack,H5[8]),G.ansi[9]=l(q.brightRed,H5[9]),G.ansi[10]=l(q.brightGreen,H5[10]),G.ansi[11]=l(q.brightYellow,H5[11]),G.ansi[12]=l(q.brightBlue,H5[12]),G.ansi[13]=l(q.brightMagenta,H5[13]),G.ansi[14]=l(q.brightCyan,H5[14]),G.ansi[15]=l(q.brightWhite,H5[15]),q.extendedAnsi){let J=Math.min(G.ansi.length-16,q.extendedAnsi.length);for(let Z=0;Z<J;Z++)G.ansi[Z+16]=l(q.extendedAnsi[Z],H5[Z+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(q){this._restoreColor(q),this._onChangeColors.fire(this.colors)}_restoreColor(q){if(q===void 0){for(let G=0;G<this._restoreColors.ansi.length;++G)this._colors.ansi[G]=this._restoreColors.ansi[G];return}switch(q){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[q]=this._restoreColors.ansi[q]}}modifyColors(q){q(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};H9=Z5([y(0,I5)],H9);function l(q,G){if(q!==void 0)try{return e.toColor(q)}catch{}return G}var BG=class{constructor(...q){this._entries=new Map;for(let[G,J]of q)this.set(G,J)}set(q,G){let J=this._entries.get(q);return this._entries.set(q,G),J}forEach(q){for(let[G,J]of this._entries.entries())q(G,J)}has(q){return this._entries.has(q)}get(q){return this._entries.get(q)}},HG=class{constructor(){this._services=new BG,this._services.set(P9,this)}setService(q,G){this._services.set(q,G)}getService(q){return this._services.get(q)}createInstance(q,...G){let J=T2(q).sort((Y,K)=>Y.index-K.index),Z=[];for(let Y of J){let K=this._services.get(Y.id);if(!K)throw Error(`[createInstance] ${q.name} depends on UNKNOWN service ${Y.id._id}.`);Z.push(K)}let $=J.length>0?J[0].index:G.length;if(G.length!==$)throw Error(`[createInstance] First service dependency of ${q.name} at position ${$+1} conflicts with ${G.length} static arguments`);return new q(...G,...Z)}},FG={trace:0,debug:1,info:2,warn:3,error:4,off:5},CG="xterm.js: ",F9=class extends g{constructor(q){super();this._optionsService=q,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),NG=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=FG[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(q){for(let G=0;G<q.length;G++)typeof q[G]=="function"&&(q[G]=q[G]())}_log(q,G,J){this._evalLazyOptionalParams(J),q.call(console,(this._optionsService.options.logger?"":CG)+G,...J)}trace(q,...G){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,q,G)}debug(q,...G){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,q,G)}info(q,...G){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,q,G)}warn(q,...G){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,q,G)}error(q,...G){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,q,G)}};F9=Z5([y(0,I5)],F9);var NG,t0=class extends g{constructor(q){super();this._maxLength=q,this.onDeleteEmitter=this._register(new x),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new x),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new x),this.onTrim=this.onTrimEmitter.event,this._array=Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(q){if(this._maxLength===q)return;let G=Array(q);for(let J=0;J<Math.min(q,this.length);J++)G[J]=this._array[this._getCyclicIndex(J)];this._array=G,this._maxLength=q,this._startIndex=0}get length(){return this._length}set length(q){if(q>this._length)for(let G=this._length;G<q;G++)this._array[G]=void 0;this._length=q}get(q){return this._array[this._getCyclicIndex(q)]}set(q,G){this._array[this._getCyclicIndex(q)]=G}push(q){this._array[this._getCyclicIndex(this._length)]=q,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(q,G,...J){if(G){for(let Z=q;Z<this._length-G;Z++)this._array[this._getCyclicIndex(Z)]=this._array[this._getCyclicIndex(Z+G)];this._length-=G,this.onDeleteEmitter.fire({index:q,amount:G})}for(let Z=this._length-1;Z>=q;Z--)this._array[this._getCyclicIndex(Z+J.length)]=this._array[this._getCyclicIndex(Z)];for(let Z=0;Z<J.length;Z++)this._array[this._getCyclicIndex(q+Z)]=J[Z];if(J.length&&this.onInsertEmitter.fire({index:q,amount:J.length}),this._length+J.length>this._maxLength){let Z=this._length+J.length-this._maxLength;this._startIndex+=Z,this._length=this._maxLength,this.onTrimEmitter.fire(Z)}else this._length+=J.length}trimStart(q){q>this._length&&(q=this._length),this._startIndex+=q,this._length-=q,this.onTrimEmitter.fire(q)}shiftElements(q,G,J){if(!(G<=0)){if(q<0||q>=this._length)throw Error("start argument out of range");if(q+J<0)throw Error("Cannot shift elements in list beyond index 0");if(J>0){for(let $=G-1;$>=0;$--)this.set(q+$+J,this.get(q+$));let Z=q+G+J-this._length;if(Z>0)for(this._length+=Z;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let Z=0;Z<G;Z++)this.set(q+Z+J,this.get(q+Z))}}_getCyclicIndex(q){return(this._startIndex+q)%this._maxLength}},m=3,j5=Object.freeze(new Q7),g7=0,m8=2,z7=class q{constructor(G,J,Z=!1){this.isWrapped=Z,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(G*m);let $=J||l5.fromCharData([0,R1,1,0]);for(let Y=0;Y<G;++Y)this.setCell(Y,$);this.length=G}get(G){let J=this._data[G*m+0],Z=J&2097151;return[this._data[G*m+1],J&2097152?this._combined[G]:Z?L6(Z):"",J>>22,J&2097152?this._combined[G].charCodeAt(this._combined[G].length-1):Z]}set(G,J){this._data[G*m+1]=J[0],J[1].length>1?(this._combined[G]=J[1],this._data[G*m+0]=G|2097152|J[2]<<22):this._data[G*m+0]=J[1].charCodeAt(0)|J[2]<<22}getWidth(G){return this._data[G*m+0]>>22}hasWidth(G){return this._data[G*m+0]&12582912}getFg(G){return this._data[G*m+1]}getBg(G){return this._data[G*m+2]}hasContent(G){return this._data[G*m+0]&4194303}getCodePoint(G){let J=this._data[G*m+0];return J&2097152?this._combined[G].charCodeAt(this._combined[G].length-1):J&2097151}isCombined(G){return this._data[G*m+0]&2097152}getString(G){let J=this._data[G*m+0];return J&2097152?this._combined[G]:J&2097151?L6(J&2097151):""}isProtected(G){return this._data[G*m+2]&536870912}loadCell(G,J){return g7=G*m,J.content=this._data[g7+0],J.fg=this._data[g7+1],J.bg=this._data[g7+2],J.content&2097152&&(J.combinedData=this._combined[G]),J.bg&268435456&&(J.extended=this._extendedAttrs[G]),J}setCell(G,J){J.content&2097152&&(this._combined[G]=J.combinedData),J.bg&268435456&&(this._extendedAttrs[G]=J.extended),this._data[G*m+0]=J.content,this._data[G*m+1]=J.fg,this._data[G*m+2]=J.bg}setCellFromCodepoint(G,J,Z,$){$.bg&268435456&&(this._extendedAttrs[G]=$.extended),this._data[G*m+0]=J|Z<<22,this._data[G*m+1]=$.fg,this._data[G*m+2]=$.bg}addCodepointToCell(G,J,Z){let $=this._data[G*m+0];$&2097152?this._combined[G]+=L6(J):$&2097151?(this._combined[G]=L6($&2097151)+L6(J),$&=-2097152,$|=2097152):$=J|4194304,Z&&($&=-12582913,$|=Z<<22),this._data[G*m+0]=$}insertCells(G,J,Z){if(G%=this.length,G&&this.getWidth(G-1)===2&&this.setCellFromCodepoint(G-1,0,1,Z),J<this.length-G){let $=new l5;for(let Y=this.length-G-J-1;Y>=0;--Y)this.setCell(G+J+Y,this.loadCell(G+Y,$));for(let Y=0;Y<J;++Y)this.setCell(G+Y,Z)}else for(let $=G;$<this.length;++$)this.setCell($,Z);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,Z)}deleteCells(G,J,Z){if(G%=this.length,J<this.length-G){let $=new l5;for(let Y=0;Y<this.length-G-J;++Y)this.setCell(G+Y,this.loadCell(G+J+Y,$));for(let Y=this.length-J;Y<this.length;++Y)this.setCell(Y,Z)}else for(let $=G;$<this.length;++$)this.setCell($,Z);G&&this.getWidth(G-1)===2&&this.setCellFromCodepoint(G-1,0,1,Z),this.getWidth(G)===0&&!this.hasContent(G)&&this.setCellFromCodepoint(G,0,1,Z)}replaceCells(G,J,Z,$=!1){if($){for(G&&this.getWidth(G-1)===2&&!this.isProtected(G-1)&&this.setCellFromCodepoint(G-1,0,1,Z),J<this.length&&this.getWidth(J-1)===2&&!this.isProtected(J)&&this.setCellFromCodepoint(J,0,1,Z);G<J&&G<this.length;)this.isProtected(G)||this.setCell(G,Z),G++;return}for(G&&this.getWidth(G-1)===2&&this.setCellFromCodepoint(G-1,0,1,Z),J<this.length&&this.getWidth(J-1)===2&&this.setCellFromCodepoint(J,0,1,Z);G<J&&G<this.length;)this.setCell(G++,Z)}resize(G,J){if(G===this.length)return this._data.length*4*m8<this._data.buffer.byteLength;let Z=G*m;if(G>this.length){if(this._data.buffer.byteLength>=Z*4)this._data=new Uint32Array(this._data.buffer,0,Z);else{let $=new Uint32Array(Z);$.set(this._data),this._data=$}for(let $=this.length;$<G;++$)this.setCell($,J)}else{this._data=this._data.subarray(0,Z);let $=Object.keys(this._combined);for(let K=0;K<$.length;K++){let X=parseInt($[K],10);X>=G&&delete this._combined[X]}let Y=Object.keys(this._extendedAttrs);for(let K=0;K<Y.length;K++){let X=parseInt(Y[K],10);X>=G&&delete this._extendedAttrs[X]}}return this.length=G,Z*4*m8<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*m8<this._data.buffer.byteLength){let G=new Uint32Array(this._data.length);return G.set(this._data),this._data=G,1}return 0}fill(G,J=!1){if(J){for(let Z=0;Z<this.length;++Z)this.isProtected(Z)||this.setCell(Z,G);return}this._combined={},this._extendedAttrs={};for(let Z=0;Z<this.length;++Z)this.setCell(Z,G)}copyFrom(G){this.length!==G.length?this._data=new Uint32Array(G._data):this._data.set(G._data),this.length=G.length,this._combined={};for(let J in G._combined)this._combined[J]=G._combined[J];this._extendedAttrs={};for(let J in G._extendedAttrs)this._extendedAttrs[J]=G._extendedAttrs[J];this.isWrapped=G.isWrapped}clone(){let G=new q(0);G._data=new Uint32Array(this._data),G.length=this.length;for(let J in this._combined)G._combined[J]=this._combined[J];for(let J in this._extendedAttrs)G._extendedAttrs[J]=this._extendedAttrs[J];return G.isWrapped=this.isWrapped,G}getTrimmedLength(){for(let G=this.length-1;G>=0;--G)if(this._data[G*m+0]&4194303)return G+(this._data[G*m+0]>>22);return 0}getNoBgTrimmedLength(){for(let G=this.length-1;G>=0;--G)if(this._data[G*m+0]&4194303||this._data[G*m+2]&50331648)return G+(this._data[G*m+0]>>22);return 0}copyCellsFrom(G,J,Z,$,Y){let K=G._data;if(Y)for(let j=$-1;j>=0;j--){for(let V=0;V<m;V++)this._data[(Z+j)*m+V]=K[(J+j)*m+V];K[(J+j)*m+2]&268435456&&(this._extendedAttrs[Z+j]=G._extendedAttrs[J+j])}else for(let j=0;j<$;j++){for(let V=0;V<m;V++)this._data[(Z+j)*m+V]=K[(J+j)*m+V];K[(J+j)*m+2]&268435456&&(this._extendedAttrs[Z+j]=G._extendedAttrs[J+j])}let X=Object.keys(G._combined);for(let j=0;j<X.length;j++){let V=parseInt(X[j],10);V>=J&&(this._combined[V-J+Z]=G._combined[V])}}translateToString(G,J,Z,$){J=J??0,Z=Z??this.length,G&&(Z=Math.min(Z,this.getTrimmedLength())),$&&($.length=0);let Y="";for(;J<Z;){let K=this._data[J*m+0],X=K&2097151,j=K&2097152?this._combined[J]:X?L6(X):x6;if(Y+=j,$)for(let V=0;V<j.length;++V)$.push(J);J+=K>>22||1}return $&&$.push(J),Y}};function UG(q,G,J,Z,$,Y){let K=[];for(let X=0;X<q.length-1;X++){let j=X,V=q.get(++j);if(!V.isWrapped)continue;let B=[q.get(X)];for(;j<q.length&&V.isWrapped;)B.push(V),V=q.get(++j);if(!Y&&Z>=X&&Z<j){X+=B.length-1;continue}let z=0,H=D7(B,z,G),F=1,C=0;for(;F<B.length;){let k=D7(B,F,G),I=k-C,_=J-H,S=Math.min(I,_);B[z].copyCellsFrom(B[F],C,H,S,!1),H+=S,H===J&&(z++,H=0),C+=S,C===k&&(F++,C=0),H===0&&z!==0&&B[z-1].getWidth(J-1)===2&&(B[z].copyCellsFrom(B[z-1],J-1,H++,1,!1),B[z-1].setCell(J-1,$))}B[z].replaceCells(H,J,$);let M=0;for(let k=B.length-1;k>0&&(k>z||B[k].getTrimmedLength()===0);k--)M++;M>0&&(K.push(X+B.length-M),K.push(M)),X+=B.length-1}return K}function MG(q,G){let J=[],Z=0,$=G[Z],Y=0;for(let K=0;K<q.length;K++)if($===K){let X=G[++Z];q.onDeleteEmitter.fire({index:K-Y,amount:X}),K+=X-1,Y+=X,$=G[++Z]}else J.push(K);return{layout:J,countRemoved:Y}}function DG(q,G){let J=[];for(let Z=0;Z<G.length;Z++)J.push(q.get(G[Z]));for(let Z=0;Z<J.length;Z++)q.set(Z,J[Z]);q.length=G.length}function QG(q,G,J){let Z=[],$=q.map((j,V)=>D7(q,V,G)).reduce((j,V)=>j+V),Y=0,K=0,X=0;for(;X<$;){if($-X<J){Z.push($-X);break}Y+=J;let j=D7(q,K,G);Y>j&&(Y-=j,K++);let V=q[K].getWidth(Y-1)===2;V&&Y--;let B=V?J-1:J;Z.push(B),X+=B}return Z}function D7(q,G,J){if(G===q.length-1)return q[G].getTrimmedLength();let Z=!q[G].hasContent(J-1)&&q[G].getWidth(J-1)===1,$=q[G+1].getWidth(0)===2;return Z&&$?J-1:J}var q4=class q{constructor(G){this.line=G,this.isDisposed=!1,this._disposables=[],this._id=q._nextId++,this._onDispose=this.register(new x),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),m6(this._disposables),this._disposables.length=0)}register(G){return this._disposables.push(G),G}};q4._nextId=1;var PG=q4,C5={},E6=C5.B;C5[0]={"`":"",a:"",b:"",c:"",d:"",e:"",f:"",g:"",h:"",i:"",j:"",k:"",l:"",m:"",n:"",o:"",p:"",q:"",r:"",s:"",t:"",u:"",v:"",w:"",x:"",y:"",z:"","{":"","|":"","}":"","~":""};C5.A={"#":""};C5.B=void 0;C5[4]={"#":"","@":"","[":"ij","\\":"","]":"|","{":"","|":"f","}":"","~":""};C5.C=C5[5]={"[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};C5.R={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};C5.Q={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};C5.K={"@":"","[":"","\\":"","]":"","{":"","|":"","}":"","~":""};C5.Y={"#":"","@":"","[":"","\\":"","]":"","`":"","{":"","|":"","}":"","~":""};C5.E=C5[6]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};C5.Z={"#":"","@":"","[":"","\\":"","]":"","{":"","|":"","}":""};C5.H=C5[7]={"@":"","[":"","\\":"","]":"","^":"","`":"","{":"","|":"","}":"","~":""};C5["="]={"#":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":""};var e0=4294967295,q1=class{constructor(q,G,J){this._hasScrollback=q,this._optionsService=G,this._bufferService=J,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=j5.clone(),this.savedCharset=E6,this.markers=[],this._nullCell=l5.fromCharData([0,R1,1,0]),this._whitespaceCell=l5.fromCharData([0,x6,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new e7,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new t0(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(q){return q?(this._nullCell.fg=q.fg,this._nullCell.bg=q.bg,this._nullCell.extended=q.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new l7),this._nullCell}getWhitespaceCell(q){return q?(this._whitespaceCell.fg=q.fg,this._whitespaceCell.bg=q.bg,this._whitespaceCell.extended=q.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new l7),this._whitespaceCell}getBlankLine(q,G){return new z7(this._bufferService.cols,this.getNullCell(q),G)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let q=this.ybase+this.y-this.ydisp;return q>=0&&q<this._rows}_getCorrectBufferLength(q){if(!this._hasScrollback)return q;let G=q+this._optionsService.rawOptions.scrollback;return G>e0?e0:G}fillViewportRows(q){if(this.lines.length===0){q===void 0&&(q=j5);let G=this._rows;for(;G--;)this.lines.push(this.getBlankLine(q))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new t0(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(q,G){let J=this.getNullCell(j5),Z=0,$=this._getCorrectBufferLength(G);if($>this.lines.maxLength&&(this.lines.maxLength=$),this.lines.length>0){if(this._cols<q)for(let K=0;K<this.lines.length;K++)Z+=+this.lines.get(K).resize(q,J);let Y=0;if(this._rows<G)for(let K=this._rows;K<G;K++)this.lines.length<G+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new z7(q,J)):this.ybase>0&&this.lines.length<=this.ybase+this.y+Y+1?(this.ybase--,Y++,this.ydisp>0&&this.ydisp--):this.lines.push(new z7(q,J)));else for(let K=this._rows;K>G;K--)this.lines.length>G+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if($<this.lines.maxLength){let K=this.lines.length-$;K>0&&(this.lines.trimStart(K),this.ybase=Math.max(this.ybase-K,0),this.ydisp=Math.max(this.ydisp-K,0),this.savedY=Math.max(this.savedY-K,0)),this.lines.maxLength=$}this.x=Math.min(this.x,q-1),this.y=Math.min(this.y,G-1),Y&&(this.y+=Y),this.savedX=Math.min(this.savedX,q-1),this.scrollTop=0}if(this.scrollBottom=G-1,this._isReflowEnabled&&(this._reflow(q,G),this._cols>q))for(let Y=0;Y<this.lines.length;Y++)Z+=+this.lines.get(Y).resize(q,J);this._cols=q,this._rows=G,this._memoryCleanupQueue.clear(),Z>0.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let q=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,q=!1);let G=0;for(;this._memoryCleanupPosition<this.lines.length;)if(G+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),G>100)return!0;return q}get _isReflowEnabled(){let q=this._optionsService.rawOptions.windowsPty;return q&&q.buildNumber?this._hasScrollback&&q.backend==="conpty"&&q.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(q,G){this._cols!==q&&(q>this._cols?this._reflowLarger(q,G):this._reflowSmaller(q,G))}_reflowLarger(q,G){let J=this._optionsService.rawOptions.reflowCursorLine,Z=UG(this.lines,this._cols,q,this.ybase+this.y,this.getNullCell(j5),J);if(Z.length>0){let $=MG(this.lines,Z);DG(this.lines,$.layout),this._reflowLargerAdjustViewport(q,G,$.countRemoved)}}_reflowLargerAdjustViewport(q,G,J){let Z=this.getNullCell(j5),$=J;for(;$-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<G&&this.lines.push(new z7(q,Z))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-J,0)}_reflowSmaller(q,G){let J=this._optionsService.rawOptions.reflowCursorLine,Z=this.getNullCell(j5),$=[],Y=0;for(let K=this.lines.length-1;K>=0;K--){let X=this.lines.get(K);if(!X||!X.isWrapped&&X.getTrimmedLength()<=q)continue;let j=[X];for(;X.isWrapped&&K>0;)X=this.lines.get(--K),j.unshift(X);if(!J){let S=this.ybase+this.y;if(S>=K&&S<K+j.length)continue}let V=j[j.length-1].getTrimmedLength(),B=QG(j,this._cols,q),z=B.length-j.length,H;this.ybase===0&&this.y!==this.lines.length-1?H=Math.max(0,this.y-this.lines.maxLength+z):H=Math.max(0,this.lines.length-this.lines.maxLength+z);let F=[];for(let S=0;S<z;S++){let O=this.getBlankLine(j5,!0);F.push(O)}F.length>0&&($.push({start:K+j.length+Y,newLines:F}),Y+=F.length),j.push(...F);let C=B.length-1,M=B[C];M===0&&(C--,M=B[C]);let k=j.length-z-1,I=V;for(;k>=0;){let S=Math.min(I,M);if(j[C]===void 0)break;if(j[C].copyCellsFrom(j[k],I-S,M-S,S,!0),M-=S,M===0&&(C--,M=B[C]),I-=S,I===0){k--;let O=Math.max(k,0);I=D7(j,O,this._cols)}}for(let S=0;S<j.length;S++)B[S]<q&&j[S].setCell(B[S],Z);let _=z-H;for(;_-- >0;)this.ybase===0?this.y<G-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+Y)-G&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+z,this.ybase+G-1)}if($.length>0){let K=[],X=[];for(let M=0;M<this.lines.length;M++)X.push(this.lines.get(M));let j=this.lines.length,V=j-1,B=0,z=$[B];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+Y);let H=0;for(let M=Math.min(this.lines.maxLength-1,j+Y-1);M>=0;M--)if(z&&z.start>V+H){for(let k=z.newLines.length-1;k>=0;k--)this.lines.set(M--,z.newLines[k]);M++,K.push({index:V+1,amount:z.newLines.length}),H+=z.newLines.length,z=$[++B]}else this.lines.set(M,X[V--]);let F=0;for(let M=K.length-1;M>=0;M--)K[M].index+=F,this.lines.onInsertEmitter.fire(K[M]),F+=K[M].amount;let C=Math.max(0,j+Y-this.lines.maxLength);C>0&&this.lines.onTrimEmitter.fire(C)}}translateBufferLineToString(q,G,J=0,Z){let $=this.lines.get(q);return $?$.translateToString(G,J,Z):""}getWrappedRangeForLine(q){let G=q,J=q;for(;G>0&&this.lines.get(G).isWrapped;)G--;for(;J+1<this.lines.length&&this.lines.get(J+1).isWrapped;)J++;return{first:G,last:J}}setupTabStops(q){for(q!=null?this.tabs[q]||(q=this.prevStop(q)):(this.tabs={},q=0);q<this._cols;q+=this._optionsService.rawOptions.tabStopWidth)this.tabs[q]=!0}prevStop(q){for(q==null&&(q=this.x);!this.tabs[--q]&&q>0;);return q>=this._cols?this._cols-1:q<0?0:q}nextStop(q){for(q==null&&(q=this.x);!this.tabs[++q]&&q<this._cols;);return q>=this._cols?this._cols-1:q<0?0:q}clearMarkers(q){this._isClearing=!0;for(let G=0;G<this.markers.length;G++)this.markers[G].line===q&&(this.markers[G].dispose(),this.markers.splice(G--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let q=0;q<this.markers.length;q++)this.markers[q].dispose();this.markers.length=0,this._isClearing=!1}addMarker(q){let G=new PG(q);return this.markers.push(G),G.register(this.lines.onTrim((J)=>{G.line-=J,G.line<0&&G.dispose()})),G.register(this.lines.onInsert((J)=>{G.line>=J.index&&(G.line+=J.amount)})),G.register(this.lines.onDelete((J)=>{G.line>=J.index&&G.line<J.index+J.amount&&G.dispose(),G.line>J.index&&(G.line-=J.amount)})),G.register(G.onDispose(()=>this._removeMarker(G))),G}_removeMarker(q){this._isClearing||this.markers.splice(this.markers.indexOf(q),1)}},WG=class extends g{constructor(q,G){super();this._optionsService=q,this._bufferService=G,this._onBufferActivate=this._register(new x),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new q1(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new q1(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(q){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(q),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(q,G){this._normal.resize(q,G),this._alt.resize(q,G),this.setupTabStops(q)}setupTabStops(q){this._normal.setupTabStops(q),this._alt.setupTabStops(q)}},G4=2,J4=1,C9=class extends g{constructor(q){super();this.isUserScrolling=!1,this._onResize=this._register(new x),this.onResize=this._onResize.event,this._onScroll=this._register(new x),this.onScroll=this._onScroll.event,this.cols=Math.max(q.rawOptions.cols||0,G4),this.rows=Math.max(q.rawOptions.rows||0,J4),this.buffers=this._register(new WG(q,this)),this._register(this.buffers.onBufferActivate((G)=>{this._onScroll.fire(G.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize(q,G){let J=this.cols!==q,Z=this.rows!==G;this.cols=q,this.rows=G,this.buffers.resize(q,G),this._onResize.fire({cols:q,rows:G,colsChanged:J,rowsChanged:Z})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(q,G=!1){let J=this.buffer,Z;Z=this._cachedBlankLine,(!Z||Z.length!==this.cols||Z.getFg(0)!==q.fg||Z.getBg(0)!==q.bg)&&(Z=J.getBlankLine(q,G),this._cachedBlankLine=Z),Z.isWrapped=G;let $=J.ybase+J.scrollTop,Y=J.ybase+J.scrollBottom;if(J.scrollTop===0){let K=J.lines.isFull;Y===J.lines.length-1?K?J.lines.recycle().copyFrom(Z):J.lines.push(Z.clone()):J.lines.splice(Y+1,0,Z.clone()),K?this.isUserScrolling&&(J.ydisp=Math.max(J.ydisp-1,0)):(J.ybase++,this.isUserScrolling||J.ydisp++)}else{let K=Y-$+1;J.lines.shiftElements($+1,K-1,-1),J.lines.set(Y,Z.clone())}this.isUserScrolling||(J.ydisp=J.ybase),this._onScroll.fire(J.ydisp)}scrollLines(q,G){let J=this.buffer;if(q<0){if(J.ydisp===0)return;this.isUserScrolling=!0}else q+J.ydisp>=J.ybase&&(this.isUserScrolling=!1);let Z=J.ydisp;J.ydisp=Math.max(Math.min(J.ydisp+q,J.ybase),0),Z!==J.ydisp&&(G||this._onScroll.fire(J.ydisp))}};C9=Z5([y(0,I5)],C9);var d6={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1000,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:t7,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},RG=["normal","bold","100","200","300","400","500","600","700","800","900"],OG=class extends g{constructor(q){super();this._onOptionChange=this._register(new x),this.onOptionChange=this._onOptionChange.event;let G={...d6};for(let J in q)if(J in G)try{let Z=q[J];G[J]=this._sanitizeAndValidateOption(J,Z)}catch(Z){console.error(Z)}this.rawOptions=G,this.options={...G},this._setupOptions(),this._register(r(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(q,G){return this.onOptionChange((J)=>{J===q&&G(this.rawOptions[q])})}onMultipleOptionChange(q,G){return this.onOptionChange((J)=>{q.indexOf(J)!==-1&&G()})}_setupOptions(){let q=(J)=>{if(!(J in d6))throw Error(`No option with key "${J}"`);return this.rawOptions[J]},G=(J,Z)=>{if(!(J in d6))throw Error(`No option with key "${J}"`);Z=this._sanitizeAndValidateOption(J,Z),this.rawOptions[J]!==Z&&(this.rawOptions[J]=Z,this._onOptionChange.fire(J))};for(let J in this.rawOptions){let Z={get:q.bind(this,J),set:G.bind(this,J)};Object.defineProperty(this.options,J,Z)}}_sanitizeAndValidateOption(q,G){switch(q){case"cursorStyle":if(G||(G=d6[q]),!AG(G))throw Error(`"${G}" is not a valid value for ${q}`);break;case"wordSeparator":G||(G=d6[q]);break;case"fontWeight":case"fontWeightBold":if(typeof G=="number"&&1<=G&&G<=1000)break;G=RG.includes(G)?G:d6[q];break;case"cursorWidth":G=Math.floor(G);case"lineHeight":case"tabStopWidth":if(G<1)throw Error(`${q} cannot be less than 1, value: ${G}`);break;case"minimumContrastRatio":G=Math.max(1,Math.min(21,Math.round(G*10)/10));break;case"scrollback":if(G=Math.min(G,4294967295),G<0)throw Error(`${q} cannot be less than 0, value: ${G}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(G<=0)throw Error(`${q} cannot be less than or equal to 0, value: ${G}`);break;case"rows":case"cols":if(!G&&G!==0)throw Error(`${q} must be numeric, value: ${G}`);break;case"windowsPty":G=G??{};break}return G}};function AG(q){return q==="block"||q==="underline"||q==="bar"}function B7(q,G=5){if(typeof q!="object")return q;let J=Array.isArray(q)?[]:{};for(let Z in q)J[Z]=G<=1?q[Z]:q[Z]&&B7(q[Z],G-1);return J}var G1=Object.freeze({insertMode:!1}),J1=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),N9=class extends g{constructor(q,G,J){super();this._bufferService=q,this._logService=G,this._optionsService=J,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new x),this.onData=this._onData.event,this._onUserInput=this._register(new x),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new x),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new x),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=B7(G1),this.decPrivateModes=B7(J1)}reset(){this.modes=B7(G1),this.decPrivateModes=B7(J1)}triggerDataEvent(q,G=!1){if(this._optionsService.rawOptions.disableStdin)return;let J=this._bufferService.buffer;G&&this._optionsService.rawOptions.scrollOnUserInput&&J.ybase!==J.ydisp&&this._onRequestScrollToBottom.fire(),G&&this._onUserInput.fire(),this._logService.debug(`sending data "${q}"`),this._logService.trace("sending data (codes)",()=>q.split("").map((Z)=>Z.charCodeAt(0))),this._onData.fire(q)}triggerBinaryEvent(q){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${q}"`),this._logService.trace("sending binary (codes)",()=>q.split("").map((G)=>G.charCodeAt(0))),this._onBinary.fire(q))}};N9=Z5([y(0,y5),y(1,A1),y(2,I5)],N9);var Z1={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:(q)=>q.button===4||q.action!==1?!1:(q.ctrl=!1,q.alt=!1,q.shift=!1,!0)},VT200:{events:19,restrict:(q)=>q.action!==32},DRAG:{events:23,restrict:(q)=>!(q.action===32&&q.button===3)},ANY:{events:31,restrict:(q)=>!0}};function f8(q,G){let J=(q.ctrl?16:0)|(q.shift?4:0)|(q.alt?8:0);return q.button===4?(J|=64,J|=q.action):(J|=q.button&3,q.button&4&&(J|=64),q.button&8&&(J|=128),q.action===32?J|=32:q.action===0&&!G&&(J|=3)),J}var p8=String.fromCharCode,$1={DEFAULT:(q)=>{let G=[f8(q,!1)+32,q.col+32,q.row+32];return G[0]>255||G[1]>255||G[2]>255?"":`\x1B[M${p8(G[0])}${p8(G[1])}${p8(G[2])}`},SGR:(q)=>{let G=q.action===0&&q.button!==4?"m":"M";return`\x1B[<${f8(q,!0)};${q.col};${q.row}${G}`},SGR_PIXELS:(q)=>{let G=q.action===0&&q.button!==4?"m":"M";return`\x1B[<${f8(q,!0)};${q.x};${q.y}${G}`}},U9=class extends g{constructor(q,G,J){super();this._bufferService=q,this._coreService=G,this._optionsService=J,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new x),this.onProtocolChange=this._onProtocolChange.event;for(let Z of Object.keys(Z1))this.addProtocol(Z,Z1[Z]);for(let Z of Object.keys($1))this.addEncoding(Z,$1[Z]);this.reset()}addProtocol(q,G){this._protocols[q]=G}addEncoding(q,G){this._encodings[q]=G}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(q){if(!this._protocols[q])throw Error(`unknown protocol "${q}"`);this._activeProtocol=q,this._onProtocolChange.fire(this._protocols[q].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(q){if(!this._encodings[q])throw Error(`unknown encoding "${q}"`);this._activeEncoding=q}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent(q,G,J){if(q.deltaY===0||q.shiftKey||G===void 0||J===void 0)return 0;let Z=G/J,$=this._applyScrollModifier(q.deltaY,q);return q.deltaMode===WheelEvent.DOM_DELTA_PIXEL?($/=Z+0,Math.abs(q.deltaY)<50&&($*=0.3),this._wheelPartialScroll+=$,$=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):q.deltaMode===WheelEvent.DOM_DELTA_PAGE&&($*=this._bufferService.rows),$}_applyScrollModifier(q,G){return G.altKey||G.ctrlKey||G.shiftKey?q*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:q*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent(q){if(q.col<0||q.col>=this._bufferService.cols||q.row<0||q.row>=this._bufferService.rows||q.button===4&&q.action===32||q.button===3&&q.action!==32||q.button!==4&&(q.action===2||q.action===3)||(q.col++,q.row++,q.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,q,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(q))return!1;let G=this._encodings[this._activeEncoding](q);return G&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(G):this._coreService.triggerDataEvent(G,!0)),this._lastEvent=q,!0}explainEvents(q){return{down:!!(q&1),up:!!(q&2),drag:!!(q&4),move:!!(q&8),wheel:!!(q&16)}}_equalEvents(q,G,J){if(J){if(q.x!==G.x||q.y!==G.y)return!1}else if(q.col!==G.col||q.row!==G.row)return!1;return!(q.button!==G.button||q.action!==G.action||q.ctrl!==G.ctrl||q.alt!==G.alt||q.shift!==G.shift)}};U9=Z5([y(0,y5),y(1,p6),y(2,I5)],U9);var h8=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],kG=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],F5;function LG(q,G){let J=0,Z=G.length-1,$;if(q<G[0][0]||q>G[Z][1])return!1;for(;Z>=J;)if($=J+Z>>1,q>G[$][1])J=$+1;else if(q<G[$][0])Z=$-1;else return!0;return!1}var xG=class{constructor(){if(this.version="6",!F5){F5=new Uint8Array(65536),F5.fill(1),F5[0]=0,F5.fill(0,1,32),F5.fill(0,127,160),F5.fill(2,4352,4448),F5[9001]=2,F5[9002]=2,F5.fill(2,11904,42192),F5[12351]=1,F5.fill(2,44032,55204),F5.fill(2,63744,64256),F5.fill(2,65040,65050),F5.fill(2,65072,65136),F5.fill(2,65280,65377),F5.fill(2,65504,65511);for(let q=0;q<h8.length;++q)F5.fill(0,h8[q][0],h8[q][1]+1)}}wcwidth(q){return q<32?0:q<127?1:q<65536?F5[q]:LG(q,kG)?0:q>=131072&&q<=196605||q>=196608&&q<=262141?2:1}charProperties(q,G){let J=this.wcwidth(q),Z=J===0&&G!==0;if(Z){let $=b6.extractWidth(G);$===0?Z=!1:$>J&&(J=$)}return b6.createPropertyValue(0,J,Z)}},b6=class q{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new x,this.onChange=this._onChange.event;let G=new xG;this.register(G),this._active=G.version,this._activeProvider=G}static extractShouldJoin(G){return(G&1)!==0}static extractWidth(G){return G>>1&3}static extractCharKind(G){return G>>3}static createPropertyValue(G,J,Z=!1){return(G&16777215)<<3|(J&3)<<1|(Z?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(G){if(!this._providers[G])throw Error(`unknown Unicode version "${G}"`);this._active=G,this._activeProvider=this._providers[G],this._onChange.fire(G)}register(G){this._providers[G.version]=G}wcwidth(G){return this._activeProvider.wcwidth(G)}getStringCellWidth(G){let J=0,Z=0,$=G.length;for(let Y=0;Y<$;++Y){let K=G.charCodeAt(Y);if(55296<=K&&K<=56319){if(++Y>=$)return J+this.wcwidth(K);let V=G.charCodeAt(Y);56320<=V&&V<=57343?K=(K-55296)*1024+V-56320+65536:J+=this.wcwidth(V)}let X=this.charProperties(K,Z),j=q.extractWidth(X);q.extractShouldJoin(X)&&(j-=q.extractWidth(Z)),J+=j,Z=X}return J}charProperties(G,J){return this._activeProvider.charProperties(G,J)}},SG=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(q){this.glevel=q,this.charset=this._charsets[q]}setgCharset(q,G){this._charsets[q]=G,this.glevel===q&&(this.charset=G)}};function Y1(q){let G=q.buffer.lines.get(q.buffer.ybase+q.buffer.y-1)?.get(q.cols-1),J=q.buffer.lines.get(q.buffer.ybase+q.buffer.y);J&&G&&(J.isWrapped=G[3]!==0&&G[3]!==32)}var $7=2147483647,wG=256,Z4=class q{constructor(G=32,J=32){if(this.maxLength=G,this.maxSubParamsLength=J,J>wG)throw Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(G),this.length=0,this._subParams=new Int32Array(J),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(G),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(G){let J=new q;if(!G.length)return J;for(let Z=Array.isArray(G[0])?1:0;Z<G.length;++Z){let $=G[Z];if(Array.isArray($))for(let Y=0;Y<$.length;++Y)J.addSubParam($[Y]);else J.addParam($)}return J}clone(){let G=new q(this.maxLength,this.maxSubParamsLength);return G.params.set(this.params),G.length=this.length,G._subParams.set(this._subParams),G._subParamsLength=this._subParamsLength,G._subParamsIdx.set(this._subParamsIdx),G._rejectDigits=this._rejectDigits,G._rejectSubDigits=this._rejectSubDigits,G._digitIsSub=this._digitIsSub,G}toArray(){let G=[];for(let J=0;J<this.length;++J){G.push(this.params[J]);let Z=this._subParamsIdx[J]>>8,$=this._subParamsIdx[J]&255;$-Z>0&&G.push(Array.prototype.slice.call(this._subParams,Z,$))}return G}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(G){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(G<-1)throw Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=G>$7?$7:G}addSubParam(G){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(G<-1)throw Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=G>$7?$7:G,this._subParamsIdx[this.length-1]++}}hasSubParams(G){return(this._subParamsIdx[G]&255)-(this._subParamsIdx[G]>>8)>0}getSubParams(G){let J=this._subParamsIdx[G]>>8,Z=this._subParamsIdx[G]&255;return Z-J>0?this._subParams.subarray(J,Z):null}getSubParamsAll(){let G={};for(let J=0;J<this.length;++J){let Z=this._subParamsIdx[J]>>8,$=this._subParamsIdx[J]&255;$-Z>0&&(G[J]=this._subParams.slice(Z,$))}return G}addDigit(G){let J;if(this._rejectDigits||!(J=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let Z=this._digitIsSub?this._subParams:this.params,$=Z[J-1];Z[J-1]=~$?Math.min($*10+G,$7):G}},Y7=[],yG=class{constructor(){this._state=0,this._active=Y7,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(q,G){this._handlers[q]===void 0&&(this._handlers[q]=[]);let J=this._handlers[q];return J.push(G),{dispose:()=>{let Z=J.indexOf(G);Z!==-1&&J.splice(Z,1)}}}clearHandler(q){this._handlers[q]&&delete this._handlers[q]}setHandlerFallback(q){this._handlerFb=q}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=Y7}reset(){if(this._state===2)for(let q=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;q>=0;--q)this._active[q].end(!1);this._stack.paused=!1,this._active=Y7,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||Y7,!this._active.length)this._handlerFb(this._id,"START");else for(let q=this._active.length-1;q>=0;q--)this._active[q].start()}_put(q,G,J){if(!this._active.length)this._handlerFb(this._id,"PUT",G8(q,G,J));else for(let Z=this._active.length-1;Z>=0;Z--)this._active[Z].put(q,G,J)}start(){this.reset(),this._state=1}put(q,G,J){if(this._state!==3){if(this._state===1)for(;G<J;){let Z=q[G++];if(Z===59){this._state=2,this._start();break}if(Z<48||57<Z){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+Z-48}this._state===2&&J-G>0&&this._put(q,G,J)}}end(q,G=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",q);else{let J=!1,Z=this._active.length-1,$=!1;if(this._stack.paused&&(Z=this._stack.loopPosition-1,J=G,$=this._stack.fallThrough,this._stack.paused=!1),!$&&J===!1){for(;Z>=0&&(J=this._active[Z].end(q),J!==!0);Z--)if(J instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Z,this._stack.fallThrough=!1,J;Z--}for(;Z>=0;Z--)if(J=this._active[Z].end(!1),J instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Z,this._stack.fallThrough=!0,J}this._active=Y7,this._id=-1,this._state=0}}},m5=class{constructor(q){this._handler=q,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(q,G,J){this._hitLimit||(this._data+=G8(q,G,J),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end(q){let G=!1;if(this._hitLimit)G=!1;else if(q&&(G=this._handler(this._data),G instanceof Promise))return G.then((J)=>(this._data="",this._hitLimit=!1,J));return this._data="",this._hitLimit=!1,G}},K7=[],IG=class{constructor(){this._handlers=Object.create(null),this._active=K7,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=K7}registerHandler(q,G){this._handlers[q]===void 0&&(this._handlers[q]=[]);let J=this._handlers[q];return J.push(G),{dispose:()=>{let Z=J.indexOf(G);Z!==-1&&J.splice(Z,1)}}}clearHandler(q){this._handlers[q]&&delete this._handlers[q]}setHandlerFallback(q){this._handlerFb=q}reset(){if(this._active.length)for(let q=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;q>=0;--q)this._active[q].unhook(!1);this._stack.paused=!1,this._active=K7,this._ident=0}hook(q,G){if(this.reset(),this._ident=q,this._active=this._handlers[q]||K7,!this._active.length)this._handlerFb(this._ident,"HOOK",G);else for(let J=this._active.length-1;J>=0;J--)this._active[J].hook(G)}put(q,G,J){if(!this._active.length)this._handlerFb(this._ident,"PUT",G8(q,G,J));else for(let Z=this._active.length-1;Z>=0;Z--)this._active[Z].put(q,G,J)}unhook(q,G=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",q);else{let J=!1,Z=this._active.length-1,$=!1;if(this._stack.paused&&(Z=this._stack.loopPosition-1,J=G,$=this._stack.fallThrough,this._stack.paused=!1),!$&&J===!1){for(;Z>=0&&(J=this._active[Z].unhook(q),J!==!0);Z--)if(J instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Z,this._stack.fallThrough=!1,J;Z--}for(;Z>=0;Z--)if(J=this._active[Z].unhook(!1),J instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Z,this._stack.fallThrough=!0,J}this._active=K7,this._ident=0}},H7=new Z4;H7.addParam(0);var K1=class{constructor(q){this._handler=q,this._data="",this._params=H7,this._hitLimit=!1}hook(q){this._params=q.length>1||q.params[0]?q.clone():H7,this._data="",this._hitLimit=!1}put(q,G,J){this._hitLimit||(this._data+=G8(q,G,J),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook(q){let G=!1;if(this._hitLimit)G=!1;else if(q&&(G=this._handler(this._data,this._params),G instanceof Promise))return G.then((J)=>(this._params=H7,this._data="",this._hitLimit=!1,J));return this._params=H7,this._data="",this._hitLimit=!1,G}},TG=class{constructor(q){this.table=new Uint8Array(q)}setDefault(q,G){this.table.fill(q<<4|G)}add(q,G,J,Z){this.table[G<<8|q]=J<<4|Z}addMany(q,G,J,Z){for(let $=0;$<q.length;$++)this.table[G<<8|q[$]]=J<<4|Z}},a5=160,_G=function(){let q=new TG(4095),G=Array.apply(null,Array(256)).map((X,j)=>j),J=(X,j)=>G.slice(X,j),Z=J(32,127),$=J(0,24);$.push(25),$.push.apply($,J(28,32));let Y=J(0,14),K;q.setDefault(1,0),q.addMany(Z,0,2,0);for(K in Y)q.addMany([24,26,153,154],K,3,0),q.addMany(J(128,144),K,3,0),q.addMany(J(144,152),K,3,0),q.add(156,K,0,0),q.add(27,K,11,1),q.add(157,K,4,8),q.addMany([152,158,159],K,0,7),q.add(155,K,11,3),q.add(144,K,11,9);return q.addMany($,0,3,0),q.addMany($,1,3,1),q.add(127,1,0,1),q.addMany($,8,0,8),q.addMany($,3,3,3),q.add(127,3,0,3),q.addMany($,4,3,4),q.add(127,4,0,4),q.addMany($,6,3,6),q.addMany($,5,3,5),q.add(127,5,0,5),q.addMany($,2,3,2),q.add(127,2,0,2),q.add(93,1,4,8),q.addMany(Z,8,5,8),q.add(127,8,5,8),q.addMany([156,27,24,26,7],8,6,0),q.addMany(J(28,32),8,0,8),q.addMany([88,94,95],1,0,7),q.addMany(Z,7,0,7),q.addMany($,7,0,7),q.add(156,7,0,0),q.add(127,7,0,7),q.add(91,1,11,3),q.addMany(J(64,127),3,7,0),q.addMany(J(48,60),3,8,4),q.addMany([60,61,62,63],3,9,4),q.addMany(J(48,60),4,8,4),q.addMany(J(64,127),4,7,0),q.addMany([60,61,62,63],4,0,6),q.addMany(J(32,64),6,0,6),q.add(127,6,0,6),q.addMany(J(64,127),6,0,0),q.addMany(J(32,48),3,9,5),q.addMany(J(32,48),5,9,5),q.addMany(J(48,64),5,0,6),q.addMany(J(64,127),5,7,0),q.addMany(J(32,48),4,9,5),q.addMany(J(32,48),1,9,2),q.addMany(J(32,48),2,9,2),q.addMany(J(48,127),2,10,0),q.addMany(J(48,80),1,10,0),q.addMany(J(81,88),1,10,0),q.addMany([89,90,92],1,10,0),q.addMany(J(96,127),1,10,0),q.add(80,1,11,9),q.addMany($,9,0,9),q.add(127,9,0,9),q.addMany(J(28,32),9,0,9),q.addMany(J(32,48),9,9,12),q.addMany(J(48,60),9,8,10),q.addMany([60,61,62,63],9,9,10),q.addMany($,11,0,11),q.addMany(J(32,128),11,0,11),q.addMany(J(28,32),11,0,11),q.addMany($,10,0,10),q.add(127,10,0,10),q.addMany(J(28,32),10,0,10),q.addMany(J(48,60),10,8,10),q.addMany([60,61,62,63],10,0,11),q.addMany(J(32,48),10,9,12),q.addMany($,12,0,12),q.add(127,12,0,12),q.addMany(J(28,32),12,0,12),q.addMany(J(32,48),12,9,12),q.addMany(J(48,64),12,0,11),q.addMany(J(64,127),12,12,13),q.addMany(J(64,127),10,12,13),q.addMany(J(64,127),9,12,13),q.addMany($,13,13,13),q.addMany(Z,13,13,13),q.add(127,13,0,13),q.addMany([27,156,24,26],13,14,0),q.add(a5,0,2,0),q.add(a5,8,5,8),q.add(a5,6,0,6),q.add(a5,11,0,11),q.add(a5,13,13,13),q}(),vG=class extends g{constructor(q=_G){super();this._transitions=q,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new Z4,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(G,J,Z)=>{},this._executeHandlerFb=(G)=>{},this._csiHandlerFb=(G,J)=>{},this._escHandlerFb=(G)=>{},this._errorHandlerFb=(G)=>G,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(r(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new yG),this._dcsParser=this._register(new IG),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(q,G=[64,126]){let J=0;if(q.prefix){if(q.prefix.length>1)throw Error("only one byte as prefix supported");if(J=q.prefix.charCodeAt(0),J&&60>J||J>63)throw Error("prefix must be in range 0x3c .. 0x3f")}if(q.intermediates){if(q.intermediates.length>2)throw Error("only two bytes as intermediates are supported");for(let $=0;$<q.intermediates.length;++$){let Y=q.intermediates.charCodeAt($);if(32>Y||Y>47)throw Error("intermediate must be in range 0x20 .. 0x2f");J<<=8,J|=Y}}if(q.final.length!==1)throw Error("final must be a single byte");let Z=q.final.charCodeAt(0);if(G[0]>Z||Z>G[1])throw Error(`final must be in range ${G[0]} .. ${G[1]}`);return J<<=8,J|=Z,J}identToString(q){let G=[];for(;q;)G.push(String.fromCharCode(q&255)),q>>=8;return G.reverse().join("")}setPrintHandler(q){this._printHandler=q}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(q,G){let J=this._identifier(q,[48,126]);this._escHandlers[J]===void 0&&(this._escHandlers[J]=[]);let Z=this._escHandlers[J];return Z.push(G),{dispose:()=>{let $=Z.indexOf(G);$!==-1&&Z.splice($,1)}}}clearEscHandler(q){this._escHandlers[this._identifier(q,[48,126])]&&delete this._escHandlers[this._identifier(q,[48,126])]}setEscHandlerFallback(q){this._escHandlerFb=q}setExecuteHandler(q,G){this._executeHandlers[q.charCodeAt(0)]=G}clearExecuteHandler(q){this._executeHandlers[q.charCodeAt(0)]&&delete this._executeHandlers[q.charCodeAt(0)]}setExecuteHandlerFallback(q){this._executeHandlerFb=q}registerCsiHandler(q,G){let J=this._identifier(q);this._csiHandlers[J]===void 0&&(this._csiHandlers[J]=[]);let Z=this._csiHandlers[J];return Z.push(G),{dispose:()=>{let $=Z.indexOf(G);$!==-1&&Z.splice($,1)}}}clearCsiHandler(q){this._csiHandlers[this._identifier(q)]&&delete this._csiHandlers[this._identifier(q)]}setCsiHandlerFallback(q){this._csiHandlerFb=q}registerDcsHandler(q,G){return this._dcsParser.registerHandler(this._identifier(q),G)}clearDcsHandler(q){this._dcsParser.clearHandler(this._identifier(q))}setDcsHandlerFallback(q){this._dcsParser.setHandlerFallback(q)}registerOscHandler(q,G){return this._oscParser.registerHandler(q,G)}clearOscHandler(q){this._oscParser.clearHandler(q)}setOscHandlerFallback(q){this._oscParser.setHandlerFallback(q)}setErrorHandler(q){this._errorHandler=q}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(q,G,J,Z,$){this._parseStack.state=q,this._parseStack.handlers=G,this._parseStack.handlerPos=J,this._parseStack.transition=Z,this._parseStack.chunkPos=$}parse(q,G,J){let Z=0,$=0,Y=0,K;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,Y=this._parseStack.chunkPos+1;else{if(J===void 0||this._parseStack.state===1)throw this._parseStack.state=1,Error("improper continuation due to previous async handler, giving up parsing");let X=this._parseStack.handlers,j=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(J===!1&&j>-1){for(;j>=0&&(K=X[j](this._params),K!==!0);j--)if(K instanceof Promise)return this._parseStack.handlerPos=j,K}this._parseStack.handlers=[];break;case 4:if(J===!1&&j>-1){for(;j>=0&&(K=X[j](),K!==!0);j--)if(K instanceof Promise)return this._parseStack.handlerPos=j,K}this._parseStack.handlers=[];break;case 6:if(Z=q[this._parseStack.chunkPos],K=this._dcsParser.unhook(Z!==24&&Z!==26,J),K)return K;Z===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(Z=q[this._parseStack.chunkPos],K=this._oscParser.end(Z!==24&&Z!==26,J),K)return K;Z===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,Y=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let X=Y;X<G;++X){switch(Z=q[X],$=this._transitions.table[this.currentState<<8|(Z<160?Z:a5)],$>>4){case 2:for(let H=X+1;;++H){if(H>=G||(Z=q[H])<32||Z>126&&Z<a5){this._printHandler(q,X,H),X=H-1;break}if(++H>=G||(Z=q[H])<32||Z>126&&Z<a5){this._printHandler(q,X,H),X=H-1;break}if(++H>=G||(Z=q[H])<32||Z>126&&Z<a5){this._printHandler(q,X,H),X=H-1;break}if(++H>=G||(Z=q[H])<32||Z>126&&Z<a5){this._printHandler(q,X,H),X=H-1;break}}break;case 3:this._executeHandlers[Z]?this._executeHandlers[Z]():this._executeHandlerFb(Z),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:X,code:Z,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let j=this._csiHandlers[this._collect<<8|Z],V=j?j.length-1:-1;for(;V>=0&&(K=j[V](this._params),K!==!0);V--)if(K instanceof Promise)return this._preserveStack(3,j,V,$,X),K;V<0&&this._csiHandlerFb(this._collect<<8|Z,this._params),this.precedingJoinState=0;break;case 8:do switch(Z){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(Z-48)}while(++X<G&&(Z=q[X])>47&&Z<60);X--;break;case 9:this._collect<<=8,this._collect|=Z;break;case 10:let B=this._escHandlers[this._collect<<8|Z],z=B?B.length-1:-1;for(;z>=0&&(K=B[z](),K!==!0);z--)if(K instanceof Promise)return this._preserveStack(4,B,z,$,X),K;z<0&&this._escHandlerFb(this._collect<<8|Z),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|Z,this._params);break;case 13:for(let H=X+1;;++H)if(H>=G||(Z=q[H])===24||Z===26||Z===27||Z>127&&Z<a5){this._dcsParser.put(q,X,H),X=H-1;break}break;case 14:if(K=this._dcsParser.unhook(Z!==24&&Z!==26),K)return this._preserveStack(6,[],0,$,X),K;Z===27&&($|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let H=X+1;;H++)if(H>=G||(Z=q[H])<32||Z>127&&Z<a5){this._oscParser.put(q,X,H),X=H-1;break}break;case 6:if(K=this._oscParser.end(Z!==24&&Z!==26),K)return this._preserveStack(5,[],0,$,X),K;Z===27&&($|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=$&15}}},EG=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,bG=/^[\da-f]+$/;function X1(q){if(!q)return;let G=q.toLowerCase();if(G.indexOf("rgb:")===0){G=G.slice(4);let J=EG.exec(G);if(J){let Z=J[1]?15:J[4]?255:J[7]?4095:65535;return[Math.round(parseInt(J[1]||J[4]||J[7]||J[10],16)/Z*255),Math.round(parseInt(J[2]||J[5]||J[8]||J[11],16)/Z*255),Math.round(parseInt(J[3]||J[6]||J[9]||J[12],16)/Z*255)]}}else if(G.indexOf("#")===0&&(G=G.slice(1),bG.exec(G)&&[3,6,9,12].includes(G.length))){let J=G.length/3,Z=[0,0,0];for(let $=0;$<3;++$){let Y=parseInt(G.slice(J*$,J*$+J),16);Z[$]=J===1?Y<<4:J===2?Y:J===3?Y>>4:Y>>8}return Z}}function u8(q,G){let J=q.toString(16),Z=J.length<2?"0"+J:J;switch(G){case 4:return J[0];case 8:return Z;case 12:return(Z+Z).slice(0,3);default:return Z+Z}}function gG(q,G=16){let[J,Z,$]=q;return`rgb:${u8(J,G)}/${u8(Z,G)}/${u8($,G)}`}var mG={"(":0,")":1,"*":2,"+":3,"-":1,".":2},k6=131072,V1=10;function j1(q,G){if(q>24)return G.setWinLines||!1;switch(q){case 1:return!!G.restoreWin;case 2:return!!G.minimizeWin;case 3:return!!G.setWinPosition;case 4:return!!G.setWinSizePixels;case 5:return!!G.raiseWin;case 6:return!!G.lowerWin;case 7:return!!G.refreshWin;case 8:return!!G.setWinSizeChars;case 9:return!!G.maximizeWin;case 10:return!!G.fullscreenWin;case 11:return!!G.getWinState;case 13:return!!G.getWinPosition;case 14:return!!G.getWinSizePixels;case 15:return!!G.getScreenSizePixels;case 16:return!!G.getCellSizePixels;case 18:return!!G.getWinSizeChars;case 19:return!!G.getScreenSizeChars;case 20:return!!G.getIconTitle;case 21:return!!G.getWinTitle;case 22:return!!G.pushTitle;case 23:return!!G.popTitle;case 24:return!!G.setWinLines}return!1}var z1=5000,B1=0,fG=class extends g{constructor(q,G,J,Z,$,Y,K,X,j=new vG){super();this._bufferService=q,this._charsetService=G,this._coreService=J,this._logService=Z,this._optionsService=$,this._oscLinkService=Y,this._coreMouseService=K,this._unicodeService=X,this._parser=j,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new y2,this._utf8Decoder=new I2,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=j5.clone(),this._eraseAttrDataInternal=j5.clone(),this._onRequestBell=this._register(new x),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new x),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new x),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new x),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new x),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new x),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new x),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new x),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new x),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new x),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new x),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new x),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new x),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new M9(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate((V)=>this._activeBuffer=V.activeBuffer)),this._parser.setCsiHandlerFallback((V,B)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(V),params:B.toArray()})}),this._parser.setEscHandlerFallback((V)=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(V)})}),this._parser.setExecuteHandlerFallback((V)=>{this._logService.debug("Unknown EXECUTE code: ",{code:V})}),this._parser.setOscHandlerFallback((V,B,z)=>{this._logService.debug("Unknown OSC code: ",{identifier:V,action:B,data:z})}),this._parser.setDcsHandlerFallback((V,B,z)=>{B==="HOOK"&&(z=z.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(V),action:B,payload:z})}),this._parser.setPrintHandler((V,B,z)=>this.print(V,B,z)),this._parser.registerCsiHandler({final:"@"},(V)=>this.insertChars(V)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(V)=>this.scrollLeft(V)),this._parser.registerCsiHandler({final:"A"},(V)=>this.cursorUp(V)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(V)=>this.scrollRight(V)),this._parser.registerCsiHandler({final:"B"},(V)=>this.cursorDown(V)),this._parser.registerCsiHandler({final:"C"},(V)=>this.cursorForward(V)),this._parser.registerCsiHandler({final:"D"},(V)=>this.cursorBackward(V)),this._parser.registerCsiHandler({final:"E"},(V)=>this.cursorNextLine(V)),this._parser.registerCsiHandler({final:"F"},(V)=>this.cursorPrecedingLine(V)),this._parser.registerCsiHandler({final:"G"},(V)=>this.cursorCharAbsolute(V)),this._parser.registerCsiHandler({final:"H"},(V)=>this.cursorPosition(V)),this._parser.registerCsiHandler({final:"I"},(V)=>this.cursorForwardTab(V)),this._parser.registerCsiHandler({final:"J"},(V)=>this.eraseInDisplay(V,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},(V)=>this.eraseInDisplay(V,!0)),this._parser.registerCsiHandler({final:"K"},(V)=>this.eraseInLine(V,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},(V)=>this.eraseInLine(V,!0)),this._parser.registerCsiHandler({final:"L"},(V)=>this.insertLines(V)),this._parser.registerCsiHandler({final:"M"},(V)=>this.deleteLines(V)),this._parser.registerCsiHandler({final:"P"},(V)=>this.deleteChars(V)),this._parser.registerCsiHandler({final:"S"},(V)=>this.scrollUp(V)),this._parser.registerCsiHandler({final:"T"},(V)=>this.scrollDown(V)),this._parser.registerCsiHandler({final:"X"},(V)=>this.eraseChars(V)),this._parser.registerCsiHandler({final:"Z"},(V)=>this.cursorBackwardTab(V)),this._parser.registerCsiHandler({final:"`"},(V)=>this.charPosAbsolute(V)),this._parser.registerCsiHandler({final:"a"},(V)=>this.hPositionRelative(V)),this._parser.registerCsiHandler({final:"b"},(V)=>this.repeatPrecedingCharacter(V)),this._parser.registerCsiHandler({final:"c"},(V)=>this.sendDeviceAttributesPrimary(V)),this._parser.registerCsiHandler({prefix:">",final:"c"},(V)=>this.sendDeviceAttributesSecondary(V)),this._parser.registerCsiHandler({final:"d"},(V)=>this.linePosAbsolute(V)),this._parser.registerCsiHandler({final:"e"},(V)=>this.vPositionRelative(V)),this._parser.registerCsiHandler({final:"f"},(V)=>this.hVPosition(V)),this._parser.registerCsiHandler({final:"g"},(V)=>this.tabClear(V)),this._parser.registerCsiHandler({final:"h"},(V)=>this.setMode(V)),this._parser.registerCsiHandler({prefix:"?",final:"h"},(V)=>this.setModePrivate(V)),this._parser.registerCsiHandler({final:"l"},(V)=>this.resetMode(V)),this._parser.registerCsiHandler({prefix:"?",final:"l"},(V)=>this.resetModePrivate(V)),this._parser.registerCsiHandler({final:"m"},(V)=>this.charAttributes(V)),this._parser.registerCsiHandler({final:"n"},(V)=>this.deviceStatus(V)),this._parser.registerCsiHandler({prefix:"?",final:"n"},(V)=>this.deviceStatusPrivate(V)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(V)=>this.softReset(V)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(V)=>this.setCursorStyle(V)),this._parser.registerCsiHandler({final:"r"},(V)=>this.setScrollRegion(V)),this._parser.registerCsiHandler({final:"s"},(V)=>this.saveCursor(V)),this._parser.registerCsiHandler({final:"t"},(V)=>this.windowOptions(V)),this._parser.registerCsiHandler({final:"u"},(V)=>this.restoreCursor(V)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(V)=>this.insertColumns(V)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(V)=>this.deleteColumns(V)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(V)=>this.selectProtected(V)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(V)=>this.requestMode(V,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(V)=>this.requestMode(V,!1)),this._parser.setExecuteHandler(R.BEL,()=>this.bell()),this._parser.setExecuteHandler(R.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(R.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(R.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(R.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(R.BS,()=>this.backspace()),this._parser.setExecuteHandler(R.HT,()=>this.tab()),this._parser.setExecuteHandler(R.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(R.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(c7.IND,()=>this.index()),this._parser.setExecuteHandler(c7.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(c7.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new m5((V)=>(this.setTitle(V),this.setIconName(V),!0))),this._parser.registerOscHandler(1,new m5((V)=>this.setIconName(V))),this._parser.registerOscHandler(2,new m5((V)=>this.setTitle(V))),this._parser.registerOscHandler(4,new m5((V)=>this.setOrReportIndexedColor(V))),this._parser.registerOscHandler(8,new m5((V)=>this.setHyperlink(V))),this._parser.registerOscHandler(10,new m5((V)=>this.setOrReportFgColor(V))),this._parser.registerOscHandler(11,new m5((V)=>this.setOrReportBgColor(V))),this._parser.registerOscHandler(12,new m5((V)=>this.setOrReportCursorColor(V))),this._parser.registerOscHandler(104,new m5((V)=>this.restoreIndexedColor(V))),this._parser.registerOscHandler(110,new m5((V)=>this.restoreFgColor(V))),this._parser.registerOscHandler(111,new m5((V)=>this.restoreBgColor(V))),this._parser.registerOscHandler(112,new m5((V)=>this.restoreCursorColor(V))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let V in C5)this._parser.registerEscHandler({intermediates:"(",final:V},()=>this.selectCharset("("+V)),this._parser.registerEscHandler({intermediates:")",final:V},()=>this.selectCharset(")"+V)),this._parser.registerEscHandler({intermediates:"*",final:V},()=>this.selectCharset("*"+V)),this._parser.registerEscHandler({intermediates:"+",final:V},()=>this.selectCharset("+"+V)),this._parser.registerEscHandler({intermediates:"-",final:V},()=>this.selectCharset("-"+V)),this._parser.registerEscHandler({intermediates:".",final:V},()=>this.selectCharset("."+V)),this._parser.registerEscHandler({intermediates:"/",final:V},()=>this.selectCharset("/"+V));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler((V)=>(this._logService.error("Parsing error: ",V),V)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new K1((V,B)=>this.requestStatusString(V,B)))}getAttrData(){return this._curAttrData}_preserveStack(q,G,J,Z){this._parseStack.paused=!0,this._parseStack.cursorStartX=q,this._parseStack.cursorStartY=G,this._parseStack.decodedLength=J,this._parseStack.position=Z}_logSlowResolvingAsync(q){this._logService.logLevel<=3&&Promise.race([q,new Promise((G,J)=>setTimeout(()=>J("#SLOW_TIMEOUT"),z1))]).catch((G)=>{if(G!=="#SLOW_TIMEOUT")throw G;console.warn(`async parser handler taking longer than ${z1} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(q,G){let J,Z=this._activeBuffer.x,$=this._activeBuffer.y,Y=0,K=this._parseStack.paused;if(K){if(J=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,G))return this._logSlowResolvingAsync(J),J;Z=this._parseStack.cursorStartX,$=this._parseStack.cursorStartY,this._parseStack.paused=!1,q.length>k6&&(Y=this._parseStack.position+k6)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof q=="string"?` "${q}"`:` "${Array.prototype.map.call(q,(V)=>String.fromCharCode(V)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof q=="string"?q.split("").map((V)=>V.charCodeAt(0)):q),this._parseBuffer.length<q.length&&this._parseBuffer.length<k6&&(this._parseBuffer=new Uint32Array(Math.min(q.length,k6))),K||this._dirtyRowTracker.clearRange(),q.length>k6)for(let V=Y;V<q.length;V+=k6){let B=V+k6<q.length?V+k6:q.length,z=typeof q=="string"?this._stringDecoder.decode(q.substring(V,B),this._parseBuffer):this._utf8Decoder.decode(q.subarray(V,B),this._parseBuffer);if(J=this._parser.parse(this._parseBuffer,z))return this._preserveStack(Z,$,z,V),this._logSlowResolvingAsync(J),J}else if(!K){let V=typeof q=="string"?this._stringDecoder.decode(q,this._parseBuffer):this._utf8Decoder.decode(q,this._parseBuffer);if(J=this._parser.parse(this._parseBuffer,V))return this._preserveStack(Z,$,V,0),this._logSlowResolvingAsync(J),J}(this._activeBuffer.x!==Z||this._activeBuffer.y!==$)&&this._onCursorMove.fire();let X=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),j=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);j<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(j,this._bufferService.rows-1),end:Math.min(X,this._bufferService.rows-1)})}print(q,G,J){let Z,$,Y=this._charsetService.charset,K=this._optionsService.rawOptions.screenReaderMode,X=this._bufferService.cols,j=this._coreService.decPrivateModes.wraparound,V=this._coreService.modes.insertMode,B=this._curAttrData,z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&J-G>0&&z.getWidth(this._activeBuffer.x-1)===2&&z.setCellFromCodepoint(this._activeBuffer.x-1,0,1,B);let H=this._parser.precedingJoinState;for(let F=G;F<J;++F){if(Z=q[F],Z<127&&Y){let I=Y[String.fromCharCode(Z)];I&&(Z=I.charCodeAt(0))}let C=this._unicodeService.charProperties(Z,H);$=b6.extractWidth(C);let M=b6.extractShouldJoin(C),k=M?b6.extractWidth(H):0;if(H=C,K&&this._onA11yChar.fire(L6(Z)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+$-k>X){if(j){let I=z,_=this._activeBuffer.x-k;for(this._activeBuffer.x=k,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),k>0&&z instanceof z7&&z.copyCellsFrom(I,_,0,k,!1);_<X;)I.setCellFromCodepoint(_++,0,1,B)}else if(this._activeBuffer.x=X-1,$===2)continue}if(M&&this._activeBuffer.x){let I=z.getWidth(this._activeBuffer.x-1)?1:2;z.addCodepointToCell(this._activeBuffer.x-I,Z,$);for(let _=$-k;--_>=0;)z.setCellFromCodepoint(this._activeBuffer.x++,0,0,B);continue}if(V&&(z.insertCells(this._activeBuffer.x,$-k,this._activeBuffer.getNullCell(B)),z.getWidth(X-1)===2&&z.setCellFromCodepoint(X-1,0,1,B)),z.setCellFromCodepoint(this._activeBuffer.x++,Z,$,B),$>0)for(;--$;)z.setCellFromCodepoint(this._activeBuffer.x++,0,0,B)}this._parser.precedingJoinState=H,this._activeBuffer.x<X&&J-G>0&&z.getWidth(this._activeBuffer.x)===0&&!z.hasContent(this._activeBuffer.x)&&z.setCellFromCodepoint(this._activeBuffer.x,0,1,B),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(q,G){return q.final==="t"&&!q.prefix&&!q.intermediates?this._parser.registerCsiHandler(q,(J)=>j1(J.params[0],this._optionsService.rawOptions.windowOptions)?G(J):!0):this._parser.registerCsiHandler(q,G)}registerDcsHandler(q,G){return this._parser.registerDcsHandler(q,new K1(G))}registerEscHandler(q,G){return this._parser.registerEscHandler(q,G)}registerOscHandler(q,G){return this._parser.registerOscHandler(q,new m5(G))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let q=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);q.hasWidth(this._activeBuffer.x)&&!q.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let q=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-q),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(q=this._bufferService.cols-1){this._activeBuffer.x=Math.min(q,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(q,G){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=q,this._activeBuffer.y=this._activeBuffer.scrollTop+G):(this._activeBuffer.x=q,this._activeBuffer.y=G),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(q,G){this._restrictCursor(),this._setCursor(this._activeBuffer.x+q,this._activeBuffer.y+G)}cursorUp(q){let G=this._activeBuffer.y-this._activeBuffer.scrollTop;return G>=0?this._moveCursor(0,-Math.min(G,q.params[0]||1)):this._moveCursor(0,-(q.params[0]||1)),!0}cursorDown(q){let G=this._activeBuffer.scrollBottom-this._activeBuffer.y;return G>=0?this._moveCursor(0,Math.min(G,q.params[0]||1)):this._moveCursor(0,q.params[0]||1),!0}cursorForward(q){return this._moveCursor(q.params[0]||1,0),!0}cursorBackward(q){return this._moveCursor(-(q.params[0]||1),0),!0}cursorNextLine(q){return this.cursorDown(q),this._activeBuffer.x=0,!0}cursorPrecedingLine(q){return this.cursorUp(q),this._activeBuffer.x=0,!0}cursorCharAbsolute(q){return this._setCursor((q.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(q){return this._setCursor(q.length>=2?(q.params[1]||1)-1:0,(q.params[0]||1)-1),!0}charPosAbsolute(q){return this._setCursor((q.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(q){return this._moveCursor(q.params[0]||1,0),!0}linePosAbsolute(q){return this._setCursor(this._activeBuffer.x,(q.params[0]||1)-1),!0}vPositionRelative(q){return this._moveCursor(0,q.params[0]||1),!0}hVPosition(q){return this.cursorPosition(q),!0}tabClear(q){let G=q.params[0];return G===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:G===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(q){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let G=q.params[0]||1;for(;G--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(q){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let G=q.params[0]||1;for(;G--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(q){let G=q.params[0];return G===1&&(this._curAttrData.bg|=536870912),(G===2||G===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(q,G,J,Z=!1,$=!1){let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+q);Y.replaceCells(G,J,this._activeBuffer.getNullCell(this._eraseAttrData()),$),Z&&(Y.isWrapped=!1)}_resetBufferLine(q,G=!1){let J=this._activeBuffer.lines.get(this._activeBuffer.ybase+q);J&&(J.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),G),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+q),J.isWrapped=!1)}eraseInDisplay(q,G=!1){this._restrictCursor(this._bufferService.cols);let J;switch(q.params[0]){case 0:for(J=this._activeBuffer.y,this._dirtyRowTracker.markDirty(J),this._eraseInBufferLine(J++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,G);J<this._bufferService.rows;J++)this._resetBufferLine(J,G);this._dirtyRowTracker.markDirty(J);break;case 1:for(J=this._activeBuffer.y,this._dirtyRowTracker.markDirty(J),this._eraseInBufferLine(J,0,this._activeBuffer.x+1,!0,G),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(J+1).isWrapped=!1);J--;)this._resetBufferLine(J,G);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(J=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,J-1);J--&&!this._activeBuffer.lines.get(this._activeBuffer.ybase+J)?.getTrimmedLength(););for(;J>=0;J--)this._bufferService.scroll(this._eraseAttrData())}else{for(J=this._bufferService.rows,this._dirtyRowTracker.markDirty(J-1);J--;)this._resetBufferLine(J,G);this._dirtyRowTracker.markDirty(0)}break;case 3:let Z=this._activeBuffer.lines.length-this._bufferService.rows;Z>0&&(this._activeBuffer.lines.trimStart(Z),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-Z,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-Z,0),this._onScroll.fire(0));break}return!0}eraseInLine(q,G=!1){switch(this._restrictCursor(this._bufferService.cols),q.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,G);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,G);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,G);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(q){this._restrictCursor();let G=q.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let J=this._activeBuffer.ybase+this._activeBuffer.y,Z=this._bufferService.rows-1-this._activeBuffer.scrollBottom,$=this._bufferService.rows-1+this._activeBuffer.ybase-Z+1;for(;G--;)this._activeBuffer.lines.splice($-1,1),this._activeBuffer.lines.splice(J,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(q){this._restrictCursor();let G=q.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let J=this._activeBuffer.ybase+this._activeBuffer.y,Z;for(Z=this._bufferService.rows-1-this._activeBuffer.scrollBottom,Z=this._bufferService.rows-1+this._activeBuffer.ybase-Z;G--;)this._activeBuffer.lines.splice(J,1),this._activeBuffer.lines.splice(Z,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(q){this._restrictCursor();let G=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return G&&(G.insertCells(this._activeBuffer.x,q.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(q){this._restrictCursor();let G=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return G&&(G.deleteCells(this._activeBuffer.x,q.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(q){let G=q.params[0]||1;for(;G--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(q){let G=q.params[0]||1;for(;G--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(j5));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let G=q.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){let Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);Z.deleteCells(0,G,this._activeBuffer.getNullCell(this._eraseAttrData())),Z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let G=q.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){let Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);Z.insertCells(0,G,this._activeBuffer.getNullCell(this._eraseAttrData())),Z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let G=q.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){let Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);Z.insertCells(this._activeBuffer.x,G,this._activeBuffer.getNullCell(this._eraseAttrData())),Z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(q){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let G=q.params[0]||1;for(let J=this._activeBuffer.scrollTop;J<=this._activeBuffer.scrollBottom;++J){let Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+J);Z.deleteCells(this._activeBuffer.x,G,this._activeBuffer.getNullCell(this._eraseAttrData())),Z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(q){this._restrictCursor();let G=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return G&&(G.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(q.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(q){let G=this._parser.precedingJoinState;if(!G)return!0;let J=q.params[0]||1,Z=b6.extractWidth(G),$=this._activeBuffer.x-Z,Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString($),K=new Uint32Array(Y.length*J),X=0;for(let V=0;V<Y.length;){let B=Y.codePointAt(V)||0;K[X++]=B,V+=B>65535?2:1}let j=X;for(let V=1;V<J;++V)K.copyWithin(j,0,X),j+=X;return this.print(K,0,j),!0}sendDeviceAttributesPrimary(q){return q.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(R.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(R.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(q){return q.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(R.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(R.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(q.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(R.ESC+"[>83;40003;0c")),!0}_is(q){return(this._optionsService.rawOptions.termName+"").indexOf(q)===0}setMode(q){for(let G=0;G<q.length;G++)switch(q.params[G]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate(q){for(let G=0;G<q.length;G++)switch(q.params[G]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,E6),this._charsetService.setgCharset(1,E6),this._charsetService.setgCharset(2,E6),this._charsetService.setgCharset(3,E6);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1000:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode(q){for(let G=0;G<q.length;G++)switch(q.params[G]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate(q){for(let G=0;G<q.length;G++)switch(q.params[G]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1000:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),q.params[G]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode(q,G){let J;((M)=>(M[M.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",M[M.SET=1]="SET",M[M.RESET=2]="RESET",M[M.PERMANENTLY_SET=3]="PERMANENTLY_SET",M[M.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(J||={});let Z=this._coreService.decPrivateModes,{activeProtocol:$,activeEncoding:Y}=this._coreMouseService,K=this._coreService,{buffers:X,cols:j}=this._bufferService,{active:V,alt:B}=X,z=this._optionsService.rawOptions,H=(M,k)=>(K.triggerDataEvent(`${R.ESC}[${G?"":"?"}${M};${k}$y`),!0),F=(M)=>M?1:2,C=q.params[0];return G?C===2?H(C,4):C===4?H(C,F(K.modes.insertMode)):C===12?H(C,3):C===20?H(C,F(z.convertEol)):H(C,0):C===1?H(C,F(Z.applicationCursorKeys)):C===3?H(C,z.windowOptions.setWinLines?j===80?2:j===132?1:0:0):C===6?H(C,F(Z.origin)):C===7?H(C,F(Z.wraparound)):C===8?H(C,3):C===9?H(C,F($==="X10")):C===12?H(C,F(z.cursorBlink)):C===25?H(C,F(!K.isCursorHidden)):C===45?H(C,F(Z.reverseWraparound)):C===66?H(C,F(Z.applicationKeypad)):C===67?H(C,4):C===1000?H(C,F($==="VT200")):C===1002?H(C,F($==="DRAG")):C===1003?H(C,F($==="ANY")):C===1004?H(C,F(Z.sendFocus)):C===1005?H(C,4):C===1006?H(C,F(Y==="SGR")):C===1015?H(C,4):C===1016?H(C,F(Y==="SGR_PIXELS")):C===1048?H(C,1):C===47||C===1047||C===1049?H(C,F(V===B)):C===2004?H(C,F(Z.bracketedPasteMode)):C===2026?H(C,F(Z.synchronizedOutput)):H(C,0)}_updateAttrColor(q,G,J,Z,$){return G===2?(q|=50331648,q&=-16777216,q|=Q7.fromColorRGB([J,Z,$])):G===5&&(q&=-50331904,q|=33554432|J&255),q}_extractColor(q,G,J){let Z=[0,0,-1,0,0,0],$=0,Y=0;do{if(Z[Y+$]=q.params[G+Y],q.hasSubParams(G+Y)){let K=q.getSubParams(G+Y),X=0;do Z[1]===5&&($=1),Z[Y+X+1+$]=K[X];while(++X<K.length&&X+Y+1+$<Z.length);break}if(Z[1]===5&&Y+$>=2||Z[1]===2&&Y+$>=5)break;Z[1]&&($=1)}while(++Y+G<q.length&&Y+$<Z.length);for(let K=2;K<Z.length;++K)Z[K]===-1&&(Z[K]=0);switch(Z[0]){case 38:J.fg=this._updateAttrColor(J.fg,Z[1],Z[3],Z[4],Z[5]);break;case 48:J.bg=this._updateAttrColor(J.bg,Z[1],Z[3],Z[4],Z[5]);break;case 58:J.extended=J.extended.clone(),J.extended.underlineColor=this._updateAttrColor(J.extended.underlineColor,Z[1],Z[3],Z[4],Z[5])}return Y}_processUnderline(q,G){G.extended=G.extended.clone(),(!~q||q>5)&&(q=1),G.extended.underlineStyle=q,G.fg|=268435456,q===0&&(G.fg&=-268435457),G.updateExtended()}_processSGR0(q){q.fg=j5.fg,q.bg=j5.bg,q.extended=q.extended.clone(),q.extended.underlineStyle=0,q.extended.underlineColor&=-67108864,q.updateExtended()}charAttributes(q){if(q.length===1&&q.params[0]===0)return this._processSGR0(this._curAttrData),!0;let G=q.length,J,Z=this._curAttrData;for(let $=0;$<G;$++)J=q.params[$],J>=30&&J<=37?(Z.fg&=-50331904,Z.fg|=16777216|J-30):J>=40&&J<=47?(Z.bg&=-50331904,Z.bg|=16777216|J-40):J>=90&&J<=97?(Z.fg&=-50331904,Z.fg|=16777216|J-90|8):J>=100&&J<=107?(Z.bg&=-50331904,Z.bg|=16777216|J-100|8):J===0?this._processSGR0(Z):J===1?Z.fg|=134217728:J===3?Z.bg|=67108864:J===4?(Z.fg|=268435456,this._processUnderline(q.hasSubParams($)?q.getSubParams($)[0]:1,Z)):J===5?Z.fg|=536870912:J===7?Z.fg|=67108864:J===8?Z.fg|=1073741824:J===9?Z.fg|=2147483648:J===2?Z.bg|=134217728:J===21?this._processUnderline(2,Z):J===22?(Z.fg&=-134217729,Z.bg&=-134217729):J===23?Z.bg&=-67108865:J===24?(Z.fg&=-268435457,this._processUnderline(0,Z)):J===25?Z.fg&=-536870913:J===27?Z.fg&=-67108865:J===28?Z.fg&=-1073741825:J===29?Z.fg&=2147483647:J===39?(Z.fg&=-67108864,Z.fg|=j5.fg&16777215):J===49?(Z.bg&=-67108864,Z.bg|=j5.bg&16777215):J===38||J===48||J===58?$+=this._extractColor(q,$,Z):J===53?Z.bg|=1073741824:J===55?Z.bg&=-1073741825:J===59?(Z.extended=Z.extended.clone(),Z.extended.underlineColor=-1,Z.updateExtended()):J===100?(Z.fg&=-67108864,Z.fg|=j5.fg&16777215,Z.bg&=-67108864,Z.bg|=j5.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",J);return!0}deviceStatus(q){switch(q.params[0]){case 5:this._coreService.triggerDataEvent(`${R.ESC}[0n`);break;case 6:let G=this._activeBuffer.y+1,J=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${R.ESC}[${G};${J}R`);break}return!0}deviceStatusPrivate(q){switch(q.params[0]){case 6:let G=this._activeBuffer.y+1,J=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${R.ESC}[?${G};${J}R`);break;case 15:break;case 25:break;case 26:break;case 53:break}return!0}softReset(q){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=j5.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(q){let G=q.length===0?1:q.params[0];if(G===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(G){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let J=G%2===1;this._coreService.decPrivateModes.cursorBlink=J}return!0}setScrollRegion(q){let G=q.params[0]||1,J;return(q.length<2||(J=q.params[1])>this._bufferService.rows||J===0)&&(J=this._bufferService.rows),J>G&&(this._activeBuffer.scrollTop=G-1,this._activeBuffer.scrollBottom=J-1,this._setCursor(0,0)),!0}windowOptions(q){if(!j1(q.params[0],this._optionsService.rawOptions.windowOptions))return!0;let G=q.length>1?q.params[1]:0;switch(q.params[0]){case 14:G!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${R.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(G===0||G===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>V1&&this._windowTitleStack.shift()),(G===0||G===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>V1&&this._iconNameStack.shift());break;case 23:(G===0||G===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(G===0||G===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor(q){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(q){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(q){return this._windowTitle=q,this._onTitleChange.fire(q),!0}setIconName(q){return this._iconName=q,!0}setOrReportIndexedColor(q){let G=[],J=q.split(";");for(;J.length>1;){let Z=J.shift(),$=J.shift();if(/^\d+$/.exec(Z)){let Y=parseInt(Z);if(H1(Y))if($==="?")G.push({type:0,index:Y});else{let K=X1($);K&&G.push({type:1,index:Y,color:K})}}}return G.length&&this._onColor.fire(G),!0}setHyperlink(q){let G=q.indexOf(";");if(G===-1)return!0;let J=q.slice(0,G).trim(),Z=q.slice(G+1);return Z?this._createHyperlink(J,Z):J.trim()?!1:this._finishHyperlink()}_createHyperlink(q,G){this._getCurrentLinkId()&&this._finishHyperlink();let J=q.split(":"),Z,$=J.findIndex((Y)=>Y.startsWith("id="));return $!==-1&&(Z=J[$].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:Z,uri:G}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(q,G){let J=q.split(";");for(let Z=0;Z<J.length&&!(G>=this._specialColors.length);++Z,++G)if(J[Z]==="?")this._onColor.fire([{type:0,index:this._specialColors[G]}]);else{let $=X1(J[Z]);$&&this._onColor.fire([{type:1,index:this._specialColors[G],color:$}])}return!0}setOrReportFgColor(q){return this._setOrReportSpecialColor(q,0)}setOrReportBgColor(q){return this._setOrReportSpecialColor(q,1)}setOrReportCursorColor(q){return this._setOrReportSpecialColor(q,2)}restoreIndexedColor(q){if(!q)return this._onColor.fire([{type:2}]),!0;let G=[],J=q.split(";");for(let Z=0;Z<J.length;++Z)if(/^\d+$/.exec(J[Z])){let $=parseInt(J[Z]);H1($)&&G.push({type:2,index:$})}return G.length&&this._onColor.fire(G),!0}restoreFgColor(q){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(q){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(q){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,E6),!0}selectCharset(q){return q.length!==2?(this.selectDefaultCharset(),!0):(q[0]==="/"||this._charsetService.setgCharset(mG[q[0]],C5[q[1]]||E6),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let q=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,q,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=j5.clone(),this._eraseAttrDataInternal=j5.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel(q){return this._charsetService.setgLevel(q),!0}screenAlignmentPattern(){let q=new l5;q.content=4194373,q.fg=this._curAttrData.fg,q.bg=this._curAttrData.bg,this._setCursor(0,0);for(let G=0;G<this._bufferService.rows;++G){let J=this._activeBuffer.ybase+this._activeBuffer.y+G,Z=this._activeBuffer.lines.get(J);Z&&(Z.fill(q),Z.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(q,G){let J=(K)=>(this._coreService.triggerDataEvent(`${R.ESC}${K}${R.ESC}\\`),!0),Z=this._bufferService.buffer,$=this._optionsService.rawOptions;return J(q==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:q==='"p'?'P1$r61;1"p':q==="r"?`P1$r${Z.scrollTop+1};${Z.scrollBottom+1}r`:q==="m"?"P1$r0m":q===" q"?`P1$r${{block:2,underline:4,bar:6}[$.cursorStyle]-($.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(q,G){this._dirtyRowTracker.markRangeDirty(q,G)}},M9=class{constructor(q){this._bufferService=q,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(q){q<this.start?this.start=q:q>this.end&&(this.end=q)}markRangeDirty(q,G){q>G&&(B1=q,q=G,G=B1),q<this.start&&(this.start=q),G>this.end&&(this.end=G)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};M9=Z5([y(0,y5)],M9);function H1(q){return 0<=q&&q<256}var pG=50000000,F1=12,hG=50,uG=class extends g{constructor(q){super();this._action=q,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new x),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(q,G){if(G!==void 0&&this._syncCalls>G){this._syncCalls=0;return}if(this._pendingData+=q.length,this._writeBuffer.push(q),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let J;for(;J=this._writeBuffer.shift();){this._action(J);let Z=this._callbacks.shift();Z&&Z()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(q,G){if(this._pendingData>pG)throw Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=q.length,this._writeBuffer.push(q),this._callbacks.push(G),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=q.length,this._writeBuffer.push(q),this._callbacks.push(G)}_innerWrite(q=0,G=!0){let J=q||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let Z=this._writeBuffer[this._bufferOffset],$=this._action(Z,G);if($){let K=(X)=>performance.now()-J>=F1?setTimeout(()=>this._innerWrite(0,X)):this._innerWrite(J,X);$.catch((X)=>(queueMicrotask(()=>{throw X}),Promise.resolve(!1))).then(K);return}let Y=this._callbacks[this._bufferOffset];if(Y&&Y(),this._bufferOffset++,this._pendingData-=Z.length,performance.now()-J>=F1)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>hG&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},D9=class{constructor(q){this._bufferService=q,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(q){let G=this._bufferService.buffer;if(q.id===void 0){let X=G.addMarker(G.ybase+G.y),j={data:q,id:this._nextId++,lines:[X]};return X.onDispose(()=>this._removeMarkerFromLink(j,X)),this._dataByLinkId.set(j.id,j),j.id}let J=q,Z=this._getEntryIdKey(J),$=this._entriesWithId.get(Z);if($)return this.addLineToLink($.id,G.ybase+G.y),$.id;let Y=G.addMarker(G.ybase+G.y),K={id:this._nextId++,key:this._getEntryIdKey(J),data:J,lines:[Y]};return Y.onDispose(()=>this._removeMarkerFromLink(K,Y)),this._entriesWithId.set(K.key,K),this._dataByLinkId.set(K.id,K),K.id}addLineToLink(q,G){let J=this._dataByLinkId.get(q);if(J&&J.lines.every((Z)=>Z.line!==G)){let Z=this._bufferService.buffer.addMarker(G);J.lines.push(Z),Z.onDispose(()=>this._removeMarkerFromLink(J,Z))}}getLinkData(q){return this._dataByLinkId.get(q)?.data}_getEntryIdKey(q){return`${q.id};;${q.uri}`}_removeMarkerFromLink(q,G){let J=q.lines.indexOf(G);J!==-1&&(q.lines.splice(J,1),q.lines.length===0&&(q.data.id!==void 0&&this._entriesWithId.delete(q.key),this._dataByLinkId.delete(q.id)))}};D9=Z5([y(0,y5)],D9);var C1=!1,dG=class extends g{constructor(q){super();this._windowsWrappingHeuristics=this._register(new a6),this._onBinary=this._register(new x),this.onBinary=this._onBinary.event,this._onData=this._register(new x),this.onData=this._onData.event,this._onLineFeed=this._register(new x),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new x),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new x),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new x),this._instantiationService=new HG,this.optionsService=this._register(new OG(q)),this._instantiationService.setService(I5,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(C9)),this._instantiationService.setService(y5,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(F9)),this._instantiationService.setService(A1,this._logService),this.coreService=this._register(this._instantiationService.createInstance(N9)),this._instantiationService.setService(p6,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(U9)),this._instantiationService.setService(O1,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(b6)),this._instantiationService.setService(E2,this.unicodeService),this._charsetService=this._instantiationService.createInstance(SG),this._instantiationService.setService(v2,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(D9),this._instantiationService.setService(k1,this._oscLinkService),this._inputHandler=this._register(new fG(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(k5.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(k5.forward(this._bufferService.onResize,this._onResize)),this._register(k5.forward(this.coreService.onData,this._onData)),this._register(k5.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new uG((G,J)=>this._inputHandler.parse(G,J))),this._register(k5.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new x),this._onScroll.event((q)=>{this._onScrollApi?.fire(q.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(q){for(let G in q)this.optionsService.options[G]=q[G]}write(q,G){this._writeBuffer.write(q,G)}writeSync(q,G){this._logService.logLevel<=3&&!C1&&(this._logService.warn("writeSync is unreliable and will be removed soon."),C1=!0),this._writeBuffer.writeSync(q,G)}input(q,G=!0){this.coreService.triggerDataEvent(q,G)}resize(q,G){isNaN(q)||isNaN(G)||(q=Math.max(q,G4),G=Math.max(G,J4),this._bufferService.resize(q,G))}scroll(q,G=!1){this._bufferService.scroll(q,G)}scrollLines(q,G){this._bufferService.scrollLines(q,G)}scrollPages(q){this.scrollLines(q*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(q){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(q){let G=q-this._bufferService.buffer.ydisp;G!==0&&this.scrollLines(G)}registerEscHandler(q,G){return this._inputHandler.registerEscHandler(q,G)}registerDcsHandler(q,G){return this._inputHandler.registerDcsHandler(q,G)}registerCsiHandler(q,G){return this._inputHandler.registerCsiHandler(q,G)}registerOscHandler(q,G){return this._inputHandler.registerOscHandler(q,G)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let q=!1,G=this.optionsService.rawOptions.windowsPty;G&&G.buildNumber!==void 0&&G.buildNumber!==void 0?q=G.backend==="conpty"&&G.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(q=!0),q?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let q=[];q.push(this.onLineFeed(Y1.bind(null,this._bufferService))),q.push(this.registerCsiHandler({final:"H"},()=>(Y1(this._bufferService),!1))),this._windowsWrappingHeuristics.value=r(()=>{for(let G of q)G.dispose()})}}},cG={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function aG(q,G,J,Z){let $={type:0,cancel:!1,key:void 0},Y=(q.shiftKey?1:0)|(q.altKey?2:0)|(q.ctrlKey?4:0)|(q.metaKey?8:0);switch(q.keyCode){case 0:q.key==="UIKeyInputUpArrow"?G?$.key=R.ESC+"OA":$.key=R.ESC+"[A":q.key==="UIKeyInputLeftArrow"?G?$.key=R.ESC+"OD":$.key=R.ESC+"[D":q.key==="UIKeyInputRightArrow"?G?$.key=R.ESC+"OC":$.key=R.ESC+"[C":q.key==="UIKeyInputDownArrow"&&(G?$.key=R.ESC+"OB":$.key=R.ESC+"[B");break;case 8:$.key=q.ctrlKey?"\b":R.DEL,q.altKey&&($.key=R.ESC+$.key);break;case 9:if(q.shiftKey){$.key=R.ESC+"[Z";break}$.key=R.HT,$.cancel=!0;break;case 13:$.key=q.altKey?R.ESC+R.CR:R.CR,$.cancel=!0;break;case 27:$.key=R.ESC,q.altKey&&($.key=R.ESC+R.ESC),$.cancel=!0;break;case 37:if(q.metaKey)break;Y?$.key=R.ESC+"[1;"+(Y+1)+"D":G?$.key=R.ESC+"OD":$.key=R.ESC+"[D";break;case 39:if(q.metaKey)break;Y?$.key=R.ESC+"[1;"+(Y+1)+"C":G?$.key=R.ESC+"OC":$.key=R.ESC+"[C";break;case 38:if(q.metaKey)break;Y?$.key=R.ESC+"[1;"+(Y+1)+"A":G?$.key=R.ESC+"OA":$.key=R.ESC+"[A";break;case 40:if(q.metaKey)break;Y?$.key=R.ESC+"[1;"+(Y+1)+"B":G?$.key=R.ESC+"OB":$.key=R.ESC+"[B";break;case 45:!q.shiftKey&&!q.ctrlKey&&($.key=R.ESC+"[2~");break;case 46:Y?$.key=R.ESC+"[3;"+(Y+1)+"~":$.key=R.ESC+"[3~";break;case 36:Y?$.key=R.ESC+"[1;"+(Y+1)+"H":G?$.key=R.ESC+"OH":$.key=R.ESC+"[H";break;case 35:Y?$.key=R.ESC+"[1;"+(Y+1)+"F":G?$.key=R.ESC+"OF":$.key=R.ESC+"[F";break;case 33:q.shiftKey?$.type=2:q.ctrlKey?$.key=R.ESC+"[5;"+(Y+1)+"~":$.key=R.ESC+"[5~";break;case 34:q.shiftKey?$.type=3:q.ctrlKey?$.key=R.ESC+"[6;"+(Y+1)+"~":$.key=R.ESC+"[6~";break;case 112:Y?$.key=R.ESC+"[1;"+(Y+1)+"P":$.key=R.ESC+"OP";break;case 113:Y?$.key=R.ESC+"[1;"+(Y+1)+"Q":$.key=R.ESC+"OQ";break;case 114:Y?$.key=R.ESC+"[1;"+(Y+1)+"R":$.key=R.ESC+"OR";break;case 115:Y?$.key=R.ESC+"[1;"+(Y+1)+"S":$.key=R.ESC+"OS";break;case 116:Y?$.key=R.ESC+"[15;"+(Y+1)+"~":$.key=R.ESC+"[15~";break;case 117:Y?$.key=R.ESC+"[17;"+(Y+1)+"~":$.key=R.ESC+"[17~";break;case 118:Y?$.key=R.ESC+"[18;"+(Y+1)+"~":$.key=R.ESC+"[18~";break;case 119:Y?$.key=R.ESC+"[19;"+(Y+1)+"~":$.key=R.ESC+"[19~";break;case 120:Y?$.key=R.ESC+"[20;"+(Y+1)+"~":$.key=R.ESC+"[20~";break;case 121:Y?$.key=R.ESC+"[21;"+(Y+1)+"~":$.key=R.ESC+"[21~";break;case 122:Y?$.key=R.ESC+"[23;"+(Y+1)+"~":$.key=R.ESC+"[23~";break;case 123:Y?$.key=R.ESC+"[24;"+(Y+1)+"~":$.key=R.ESC+"[24~";break;default:if(q.ctrlKey&&!q.shiftKey&&!q.altKey&&!q.metaKey)q.keyCode>=65&&q.keyCode<=90?$.key=String.fromCharCode(q.keyCode-64):q.keyCode===32?$.key=R.NUL:q.keyCode>=51&&q.keyCode<=55?$.key=String.fromCharCode(q.keyCode-51+27):q.keyCode===56?$.key=R.DEL:q.keyCode===219?$.key=R.ESC:q.keyCode===220?$.key=R.FS:q.keyCode===221&&($.key=R.GS);else if((!J||Z)&&q.altKey&&!q.metaKey){let K=cG[q.keyCode]?.[q.shiftKey?1:0];if(K)$.key=R.ESC+K;else if(q.keyCode>=65&&q.keyCode<=90){let X=q.ctrlKey?q.keyCode-64:q.keyCode+32,j=String.fromCharCode(X);q.shiftKey&&(j=j.toUpperCase()),$.key=R.ESC+j}else if(q.keyCode===32)$.key=R.ESC+(q.ctrlKey?R.NUL:" ");else if(q.key==="Dead"&&q.code.startsWith("Key")){let X=q.code.slice(3,4);q.shiftKey||(X=X.toLowerCase()),$.key=R.ESC+X,$.cancel=!0}}else J&&!q.altKey&&!q.ctrlKey&&!q.shiftKey&&q.metaKey?q.keyCode===65&&($.type=1):q.key&&!q.ctrlKey&&!q.altKey&&!q.metaKey&&q.keyCode>=48&&q.key.length===1?$.key=q.key:q.key&&q.ctrlKey&&(q.key==="_"&&($.key=R.US),q.key==="@"&&($.key=R.NUL));break}return $}var V5=0,lG=class{constructor(q){this._getKey=q,this._array=[],this._insertedValues=[],this._flushInsertedTask=new e7,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new e7,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert(q){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push(q)}_flushInserted(){let q=this._insertedValues.sort(($,Y)=>this._getKey($)-this._getKey(Y)),G=0,J=0,Z=Array(this._array.length+this._insertedValues.length);for(let $=0;$<Z.length;$++)J>=this._array.length||this._getKey(q[G])<=this._getKey(this._array[J])?(Z[$]=q[G],G++):Z[$]=this._array[J++];this._array=Z,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete(q){if(this._flushCleanupInserted(),this._array.length===0)return!1;let G=this._getKey(q);if(G===void 0||(V5=this._search(G),V5===-1)||this._getKey(this._array[V5])!==G)return!1;do if(this._array[V5]===q)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(V5),!0;while(++V5<this._array.length&&this._getKey(this._array[V5])===G);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let q=this._deletedIndices.sort(($,Y)=>$-Y),G=0,J=Array(this._array.length-q.length),Z=0;for(let $=0;$<this._array.length;$++)q[G]===$?G++:J[Z++]=this._array[$];this._array=J,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator(q){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(V5=this._search(q),!(V5<0||V5>=this._array.length)&&this._getKey(this._array[V5])===q))do yield this._array[V5];while(++V5<this._array.length&&this._getKey(this._array[V5])===q)}forEachByKey(q,G){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(V5=this._search(q),!(V5<0||V5>=this._array.length)&&this._getKey(this._array[V5])===q))do G(this._array[V5]);while(++V5<this._array.length&&this._getKey(this._array[V5])===q)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search(q){let G=0,J=this._array.length-1;for(;J>=G;){let Z=G+J>>1,$=this._getKey(this._array[Z]);if($>q)J=Z-1;else if($<q)G=Z+1;else{for(;Z>0&&this._getKey(this._array[Z-1])===q;)Z--;return Z}}return G}},d8=0,N1=0,oG=class extends g{constructor(){super();this._decorations=new lG((q)=>q?.marker.line),this._onDecorationRegistered=this._register(new x),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new x),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(r(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration(q){if(q.marker.isDisposed)return;let G=new sG(q);if(G){let J=G.marker.onDispose(()=>G.dispose()),Z=G.onDispose(()=>{Z.dispose(),G&&(this._decorations.delete(G)&&this._onDecorationRemoved.fire(G),J.dispose())});this._decorations.insert(G),this._onDecorationRegistered.fire(G)}return G}reset(){for(let q of this._decorations.values())q.dispose();this._decorations.clear()}*getDecorationsAtCell(q,G,J){let Z=0,$=0;for(let Y of this._decorations.getKeyIterator(G))Z=Y.options.x??0,$=Z+(Y.options.width??1),q>=Z&&q<$&&(!J||(Y.options.layer??"bottom")===J)&&(yield Y)}forEachDecorationAtCell(q,G,J,Z){this._decorations.forEachByKey(G,($)=>{d8=$.options.x??0,N1=d8+($.options.width??1),q>=d8&&q<N1&&(!J||($.options.layer??"bottom")===J)&&Z($)})}},sG=class extends S6{constructor(q){super();this.options=q,this.onRenderEmitter=this.add(new x),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new x),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=q.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=e.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=e.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},nG=1000,rG=class{constructor(q,G=nG){this._renderCallback=q,this._debounceThresholdMS=G,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(q,G,J){this._rowCount=J,q=q!==void 0?q:0,G=G!==void 0?G:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,q):q,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,G):G;let Z=performance.now();if(Z-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=Z,this._innerRefresh();else if(!this._additionalRefreshRequested){let $=Z-this._lastRefreshMs,Y=this._debounceThresholdMS-$;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},Y)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let q=Math.max(this._rowStart,0),G=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(q,G)}},U1=20,M1=!1,q8=class extends g{constructor(q,G,J,Z){super();this._terminal=q,this._coreBrowserService=J,this._renderService=Z,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let $=this._coreBrowserService.mainDocument;this._accessibilityContainer=$.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=$.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let Y=0;Y<this._terminal.rows;Y++)this._rowElements[Y]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[Y]);if(this._topBoundaryFocusListener=(Y)=>this._handleBoundaryFocus(Y,0),this._bottomBoundaryFocusListener=(Y)=>this._handleBoundaryFocus(Y,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=$.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new rG(this._renderRows.bind(this))),!this._terminal.element)throw Error("Cannot enable accessibility before Terminal.open");M1?(this._accessibilityContainer.classList.add("debug"),this._rowContainer.classList.add("debug"),this._debugRootContainer=$.createElement("div"),this._debugRootContainer.classList.add("xterm"),this._debugRootContainer.appendChild($.createTextNode("------start a11y------")),this._debugRootContainer.appendChild(this._accessibilityContainer),this._debugRootContainer.appendChild($.createTextNode("------end a11y------")),this._terminal.element.insertAdjacentElement("afterend",this._debugRootContainer)):this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize((Y)=>this._handleResize(Y.rows))),this._register(this._terminal.onRender((Y)=>this._refreshRows(Y.start,Y.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar((Y)=>this._handleChar(Y))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab((Y)=>this._handleTab(Y))),this._register(this._terminal.onKey((Y)=>this._handleKey(Y.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(b($,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(r(()=>{M1?this._debugRootContainer.remove():this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(q){for(let G=0;G<q;G++)this._handleChar(" ")}_handleChar(q){this._liveRegionLineCount<U1+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==q&&(this._charsToAnnounce+=q):this._charsToAnnounce+=q,q===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===U1+1&&(this._liveRegion.textContent+=a8.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(q){this._clearLiveRegion(),/\p{Control}/u.test(q)||this._charsToConsume.push(q)}_refreshRows(q,G){this._liveRegionDebouncer.refresh(q,G,this._terminal.rows)}_renderRows(q,G){let J=this._terminal.buffer,Z=J.lines.length.toString();for(let $=q;$<=G;$++){let Y=J.lines.get(J.ydisp+$),K=[],X=Y?.translateToString(!0,void 0,void 0,K)||"",j=(J.ydisp+$+1).toString(),V=this._rowElements[$];V&&(X.length===0?(V.textContent="",this._rowColumns.set(V,[0,1])):(V.textContent=X,this._rowColumns.set(V,K)),V.setAttribute("aria-posinset",j),V.setAttribute("aria-setsize",Z),this._alignRowWidth(V))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(q,G){let J=q.target,Z=this._rowElements[G===0?1:this._rowElements.length-2],$=J.getAttribute("aria-posinset"),Y=G===0?"1":`${this._terminal.buffer.lines.length}`;if($===Y||q.relatedTarget!==Z)return;let K,X;if(G===0?(K=J,X=this._rowElements.pop(),this._rowContainer.removeChild(X)):(K=this._rowElements.shift(),X=J,this._rowContainer.removeChild(K)),K.removeEventListener("focus",this._topBoundaryFocusListener),X.removeEventListener("focus",this._bottomBoundaryFocusListener),G===0){let j=this._createAccessibilityTreeNode();this._rowElements.unshift(j),this._rowContainer.insertAdjacentElement("afterbegin",j)}else{let j=this._createAccessibilityTreeNode();this._rowElements.push(j),this._rowContainer.appendChild(j)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(G===0?-1:1),this._rowElements[G===0?1:this._rowElements.length-2].focus(),q.preventDefault(),q.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;let q=this._coreBrowserService.mainDocument.getSelection();if(!q)return;if(q.isCollapsed){this._rowContainer.contains(q.anchorNode)&&this._terminal.clearSelection();return}if(!q.anchorNode||!q.focusNode){console.error("anchorNode and/or focusNode are null");return}let G={node:q.anchorNode,offset:q.anchorOffset},J={node:q.focusNode,offset:q.focusOffset};if((G.node.compareDocumentPosition(J.node)&Node.DOCUMENT_POSITION_PRECEDING||G.node===J.node&&G.offset>J.offset)&&([G,J]=[J,G]),G.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(G={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(G.node))return;let Z=this._rowElements.slice(-1)[0];if(J.node.compareDocumentPosition(Z)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(J={node:Z,offset:Z.textContent?.length??0}),!this._rowContainer.contains(J.node))return;let $=({node:X,offset:j})=>{let V=X instanceof Text?X.parentNode:X,B=parseInt(V?.getAttribute("aria-posinset"),10)-1;if(isNaN(B))return console.warn("row is invalid. Race condition?"),null;let z=this._rowColumns.get(V);if(!z)return console.warn("columns is null. Race condition?"),null;let H=j<z.length?z[j]:z.slice(-1)[0]+1;return H>=this._terminal.cols&&(++B,H=0),{row:B,column:H}},Y=$(G),K=$(J);if(!(!Y||!K)){if(Y.row>K.row||Y.row===K.row&&Y.column>=K.column)throw Error("invalid range");this._terminal.select(Y.column,Y.row,(K.row-Y.row)*this._terminal.cols-Y.column+K.column)}}_handleResize(q){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let G=this._rowContainer.children.length;G<this._terminal.rows;G++)this._rowElements[G]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[G]);for(;this._rowElements.length>q;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let q=this._coreBrowserService.mainDocument.createElement("div");return q.setAttribute("role","listitem"),q.tabIndex=-1,this._refreshRowDimensions(q),q}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let q=0;q<this._terminal.rows;q++)this._refreshRowDimensions(this._rowElements[q]),this._alignRowWidth(this._rowElements[q])}}_refreshRowDimensions(q){q.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth(q){q.style.transform="";let G=q.getBoundingClientRect().width,J=this._rowColumns.get(q)?.slice(-1)?.[0];if(!J)return;let Z=J*this._renderService.dimensions.css.cell.width;q.style.transform=`scaleX(${Z/G})`}};q8=Z5([y(1,P9),y(2,z6),y(3,B6)],q8);var Q9=class extends g{constructor(q,G,J,Z,$){super();this._element=q,this._mouseService=G,this._renderService=J,this._bufferService=Z,this._linkProviderService=$,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new x),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new x),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(r(()=>{m6(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(b(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(b(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(b(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(b(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove(q){this._lastMouseEvent=q;let G=this._positionFromMouseEvent(q,this._element,this._mouseService);if(!G)return;this._isMouseOut=!1;let J=q.composedPath();for(let Z=0;Z<J.length;Z++){let $=J[Z];if($.classList.contains("xterm"))break;if($.classList.contains("xterm-hover"))return}(!this._lastBufferCell||G.x!==this._lastBufferCell.x||G.y!==this._lastBufferCell.y)&&(this._handleHover(G),this._lastBufferCell=G)}_handleHover(q){if(this._activeLine!==q.y||this._wasResized){this._clearCurrentLink(),this._askForLink(q,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,q)||(this._clearCurrentLink(),this._askForLink(q,!0))}_askForLink(q,G){(!this._activeProviderReplies||!G)&&(this._activeProviderReplies?.forEach((Z)=>{Z?.forEach(($)=>{$.link.dispose&&$.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=q.y);let J=!1;for(let[Z,$]of this._linkProviderService.linkProviders.entries())G?this._activeProviderReplies?.get(Z)&&(J=this._checkLinkProviderResult(Z,q,J)):$.provideLinks(q.y,(Y)=>{if(this._isMouseOut)return;let K=Y?.map((X)=>({link:X}));this._activeProviderReplies?.set(Z,K),J=this._checkLinkProviderResult(Z,q,J),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(q.y,this._activeProviderReplies)})}_removeIntersectingLinks(q,G){let J=new Set;for(let Z=0;Z<G.size;Z++){let $=G.get(Z);if($)for(let Y=0;Y<$.length;Y++){let K=$[Y],X=K.link.range.start.y<q?0:K.link.range.start.x,j=K.link.range.end.y>q?this._bufferService.cols:K.link.range.end.x;for(let V=X;V<=j;V++){if(J.has(V)){$.splice(Y--,1);break}J.add(V)}}}}_checkLinkProviderResult(q,G,J){if(!this._activeProviderReplies)return J;let Z=this._activeProviderReplies.get(q),$=!1;for(let Y=0;Y<q;Y++)(!this._activeProviderReplies.has(Y)||this._activeProviderReplies.get(Y))&&($=!0);if(!$&&Z){let Y=Z.find((K)=>this._linkAtPosition(K.link,G));Y&&(J=!0,this._handleNewLink(Y))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!J)for(let Y=0;Y<this._activeProviderReplies.size;Y++){let K=this._activeProviderReplies.get(Y)?.find((X)=>this._linkAtPosition(X.link,G));if(K){J=!0,this._handleNewLink(K);break}}return J}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(q){if(!this._currentLink)return;let G=this._positionFromMouseEvent(q,this._element,this._mouseService);G&&this._mouseDownLink&&iG(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,G)&&this._currentLink.link.activate(q,this._currentLink.link.text)}_clearCurrentLink(q,G){!this._currentLink||!this._lastMouseEvent||(!q||!G||this._currentLink.link.range.start.y>=q&&this._currentLink.link.range.end.y<=G)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,m6(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink(q){if(!this._lastMouseEvent)return;let G=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);G&&this._linkAtPosition(q.link,G)&&(this._currentLink=q,this._currentLink.state={decorations:{underline:q.link.decorations===void 0?!0:q.link.decorations.underline,pointerCursor:q.link.decorations===void 0?!0:q.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,q.link,this._lastMouseEvent),q.link.decorations={},Object.defineProperties(q.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:(J)=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==J&&(this._currentLink.state.decorations.pointerCursor=J,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",J))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:(J)=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==J&&(this._currentLink.state.decorations.underline=J,this._currentLink.state.isHovered&&this._fireUnderlineEvent(q.link,J))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((J)=>{if(!this._currentLink)return;let Z=J.start===0?0:J.start+1+this._bufferService.buffer.ydisp,$=this._bufferService.buffer.ydisp+1+J.end;if(this._currentLink.link.range.start.y>=Z&&this._currentLink.link.range.end.y<=$&&(this._clearCurrentLink(Z,$),this._lastMouseEvent)){let Y=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);Y&&this._askForLink(Y,!1)}})))}_linkHover(q,G,J){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(G,!0),this._currentLink.state.decorations.pointerCursor&&q.classList.add("xterm-cursor-pointer")),G.hover&&G.hover(J,G.text)}_fireUnderlineEvent(q,G){let J=q.range,Z=this._bufferService.buffer.ydisp,$=this._createLinkUnderlineEvent(J.start.x-1,J.start.y-Z-1,J.end.x,J.end.y-Z-1,void 0);(G?this._onShowLinkUnderline:this._onHideLinkUnderline).fire($)}_linkLeave(q,G,J){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(G,!1),this._currentLink.state.decorations.pointerCursor&&q.classList.remove("xterm-cursor-pointer")),G.leave&&G.leave(J,G.text)}_linkAtPosition(q,G){let J=q.range.start.y*this._bufferService.cols+q.range.start.x,Z=q.range.end.y*this._bufferService.cols+q.range.end.x,$=G.y*this._bufferService.cols+G.x;return J<=$&&$<=Z}_positionFromMouseEvent(q,G,J){let Z=J.getCoords(q,G,this._bufferService.cols,this._bufferService.rows);if(Z)return{x:Z[0],y:Z[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(q,G,J,Z,$){return{x1:q,y1:G,x2:J,y2:Z,cols:this._bufferService.cols,fg:$}}};Q9=Z5([y(1,W9),y(2,B6),y(3,y5),y(4,x1)],Q9);function iG(q,G){return q.text===G.text&&q.range.start.x===G.range.start.x&&q.range.start.y===G.range.start.y&&q.range.end.x===G.range.end.x&&q.range.end.y===G.range.end.y}var tG=class extends dG{constructor(q={}){super(q);this._linkifier=this._register(new a6),this.browser=l1,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new a6),this._onCursorMove=this._register(new x),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new x),this.onKey=this._onKey.event,this._onRender=this._register(new x),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new x),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new x),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new x),this.onBell=this._onBell.event,this._onFocus=this._register(new x),this._onBlur=this._register(new x),this._onA11yCharEmitter=this._register(new x),this._onA11yTabEmitter=this._register(new x),this._onWillOpen=this._register(new x),this._setup(),this._decorationService=this._instantiationService.createInstance(oG),this._instantiationService.setService(P7,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(pq),this._instantiationService.setService(x1,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(o8)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows((G)=>this.refresh(G?.start??0,G?.end??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport((G)=>this._reportWindowsOptions(G))),this._register(this._inputHandler.onColor((G)=>this._handleColorEvent(G))),this._register(k5.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(k5.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(k5.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(k5.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize((G)=>this._afterResize(G.cols,G.rows))),this._register(r(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent(q){if(this._themeService)for(let G of q){let J,Z="";switch(G.index){case 256:J="foreground",Z="10";break;case 257:J="background",Z="11";break;case 258:J="cursor",Z="12";break;default:J="ansi",Z="4;"+G.index}switch(G.type){case 0:let $=n.toColorRGB(J==="ansi"?this._themeService.colors.ansi[G.index]:this._themeService.colors[J]);this.coreService.triggerDataEvent(`${R.ESC}]${Z};${gG($)}${c1.ST}`);break;case 1:if(J==="ansi")this._themeService.modifyColors((Y)=>Y.ansi[G.index]=z5.toColor(...G.color));else{let Y=J;this._themeService.modifyColors((K)=>K[Y]=z5.toColor(...G.color))}break;case 2:this._themeService.restoreColor(G.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(q){q?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(q8,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(q){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(R.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(R.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let q=this.buffer.ybase+this.buffer.y,G=this.buffer.lines.get(q);if(!G)return;let J=Math.min(this.buffer.x,this.cols-1),Z=this._renderService.dimensions.css.cell.height,$=G.getWidth(J),Y=this._renderService.dimensions.css.cell.width*$,K=this.buffer.y*this._renderService.dimensions.css.cell.height,X=J*this._renderService.dimensions.css.cell.width;this.textarea.style.left=X+"px",this.textarea.style.top=K+"px",this.textarea.style.width=Y+"px",this.textarea.style.height=Z+"px",this.textarea.style.lineHeight=Z+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(b(this.element,"copy",(G)=>{this.hasSelection()&&S2(G,this._selectionService)}));let q=(G)=>w2(G,this.textarea,this.coreService,this.optionsService);this._register(b(this.textarea,"paste",q)),this._register(b(this.element,"paste",q)),o1?this._register(b(this.element,"mousedown",(G)=>{G.button===2&&D0(G,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(b(this.element,"contextmenu",(G)=>{D0(G,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),w9&&this._register(b(this.element,"auxclick",(G)=>{G.button===1&&W1(G,this.textarea,this.screenElement)}))}_bindKeys(){this._register(b(this.textarea,"keyup",(q)=>this._keyUp(q),!0)),this._register(b(this.textarea,"keydown",(q)=>this._keyDown(q),!0)),this._register(b(this.textarea,"keypress",(q)=>this._keyPress(q),!0)),this._register(b(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(b(this.textarea,"compositionupdate",(q)=>this._compositionHelper.compositionupdate(q))),this._register(b(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(b(this.textarea,"input",(q)=>this._inputEvent(q),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(q){if(!q)throw Error("Terminal requires a parent element.");if(q.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=q.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),q.appendChild(this.element);let G=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),G.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(b(this.screenElement,"mousemove",($)=>this.updateCursorStyle($))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),G.appendChild(this.screenElement);let J=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",c8.get()),r1||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>J.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(mq,this.textarea,q.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(z6,this._coreBrowserService),this._register(b(this.textarea,"focus",($)=>this._handleTextAreaFocus($))),this._register(b(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(V9,this._document,this._helperContainer),this._instantiationService.setService(J8,this._charSizeService),this._themeService=this._instantiationService.createInstance(H9),this._instantiationService.setService(l6,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(i7),this._instantiationService.setService(L1,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(z9,this.rows,this.screenElement)),this._instantiationService.setService(B6,this._renderService),this._register(this._renderService.onRenderedViewportChange(($)=>this._onRender.fire($))),this.onResize(($)=>this._renderService.resize($.cols,$.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(Y9,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(j9),this._instantiationService.setService(W9,this._mouseService);let Z=this._linkifier.value=this._register(this._instantiationService.createInstance(Q9,this.screenElement));this.element.appendChild(G);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(Z9,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines(($)=>{super.scrollLines($,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(B9,this.element,this.screenElement,Z)),this._instantiationService.setService(g2,this._selectionService),this._register(this._selectionService.onRequestScrollLines(($)=>this.scrollLines($.amount,$.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw(($)=>this._renderService.handleSelectionChanged($.start,$.end,$.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection(($)=>{this.textarea.value=$,this.textarea.focus(),this.textarea.select()})),this._register(k5.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{this._selectionService.refresh(),this._viewport?.queueSync()})),this._register(this._instantiationService.createInstance($9,this.screenElement)),this._register(b(this.element,"mousedown",($)=>this._selectionService.handleMouseDown($))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(q8,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",($)=>this._handleScreenReaderModeOptionChange($))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(r7,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",($)=>{!this._overviewRulerRenderer&&$&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(r7,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(X9,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let q=this,G=this.element;function J(Y){let K=q._mouseService.getMouseReportCoords(Y,q.screenElement);if(!K)return!1;let X,j;switch(Y.overrideType||Y.type){case"mousemove":j=32,Y.buttons===void 0?(X=3,Y.button!==void 0&&(X=Y.button<3?Y.button:3)):X=Y.buttons&1?0:Y.buttons&4?1:Y.buttons&2?2:3;break;case"mouseup":j=0,X=Y.button<3?Y.button:3;break;case"mousedown":j=1,X=Y.button<3?Y.button:3;break;case"wheel":if(q._customWheelEventHandler&&q._customWheelEventHandler(Y)===!1)return!1;let V=Y.deltaY;if(V===0||q.coreMouseService.consumeWheelEvent(Y,q._renderService?.dimensions?.device?.cell?.height,q._coreBrowserService?.dpr)===0)return!1;j=V<0?0:1,X=4;break;default:return!1}return j===void 0||X===void 0||X>4?!1:q.coreMouseService.triggerMouseEvent({col:K.col,row:K.row,x:K.x,y:K.y,button:X,action:j,ctrl:Y.ctrlKey,alt:Y.altKey,shift:Y.shiftKey})}let Z={mouseup:null,wheel:null,mousedrag:null,mousemove:null},$={mouseup:(Y)=>(J(Y),Y.buttons||(this._document.removeEventListener("mouseup",Z.mouseup),Z.mousedrag&&this._document.removeEventListener("mousemove",Z.mousedrag)),this.cancel(Y)),wheel:(Y)=>(J(Y),this.cancel(Y,!0)),mousedrag:(Y)=>{Y.buttons&&J(Y)},mousemove:(Y)=>{Y.buttons||J(Y)}};this._register(this.coreMouseService.onProtocolChange((Y)=>{Y?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(Y)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),Y&8?Z.mousemove||(G.addEventListener("mousemove",$.mousemove),Z.mousemove=$.mousemove):(G.removeEventListener("mousemove",Z.mousemove),Z.mousemove=null),Y&16?Z.wheel||(G.addEventListener("wheel",$.wheel,{passive:!1}),Z.wheel=$.wheel):(G.removeEventListener("wheel",Z.wheel),Z.wheel=null),Y&2?Z.mouseup||(Z.mouseup=$.mouseup):(this._document.removeEventListener("mouseup",Z.mouseup),Z.mouseup=null),Y&4?Z.mousedrag||(Z.mousedrag=$.mousedrag):(this._document.removeEventListener("mousemove",Z.mousedrag),Z.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(b(G,"mousedown",(Y)=>{if(Y.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(Y)))return J(Y),Z.mouseup&&this._document.addEventListener("mouseup",Z.mouseup),Z.mousedrag&&this._document.addEventListener("mousemove",Z.mousedrag),this.cancel(Y)})),this._register(b(G,"wheel",(Y)=>{if(!Z.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(Y)===!1)return!1;if(!this.buffer.hasScrollback){if(Y.deltaY===0)return!1;if(q.coreMouseService.consumeWheelEvent(Y,q._renderService?.dimensions?.device?.cell?.height,q._coreBrowserService?.dpr)===0)return this.cancel(Y,!0);let K=R.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(Y.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(K,!0),this.cancel(Y,!0)}}},{passive:!1}))}refresh(q,G){this._renderService?.refreshRows(q,G)}updateCursorStyle(q){this._selectionService?.shouldColumnSelect(q)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(q,G){this._viewport?this._viewport.scrollLines(q):super.scrollLines(q,G),this.refresh(0,this.rows-1)}scrollPages(q){this.scrollLines(q*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(q){q&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(q){let G=q-this._bufferService.buffer.ydisp;G!==0&&this.scrollLines(G)}paste(q){P1(q,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(q){this._customKeyEventHandler=q}attachCustomWheelEventHandler(q){this._customWheelEventHandler=q}registerLinkProvider(q){return this._linkProviderService.registerLinkProvider(q)}registerCharacterJoiner(q){if(!this._characterJoinerService)throw Error("Terminal must be opened first");let G=this._characterJoinerService.register(q);return this.refresh(0,this.rows-1),G}deregisterCharacterJoiner(q){if(!this._characterJoinerService)throw Error("Terminal must be opened first");this._characterJoinerService.deregister(q)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(q){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+q)}registerDecoration(q){return this._decorationService.registerDecoration(q)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select(q,G,J){this._selectionService.setSelection(q,G,J)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines(q,G){this._selectionService?.selectLines(q,G)}_keyDown(q){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(q)===!1)return!1;let G=this.browser.isMac&&this.options.macOptionIsMeta&&q.altKey;if(!G&&!this._compositionHelper.keydown(q))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!G&&(q.key==="Dead"||q.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let J=aG(q,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(q),J.type===3||J.type===2){let Z=this.rows-1;return this.scrollLines(J.type===2?-Z:Z),this.cancel(q,!0)}if(J.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,q)||(J.cancel&&this.cancel(q,!0),!J.key)||q.key&&!q.ctrlKey&&!q.altKey&&!q.metaKey&&q.key.length===1&&q.key.charCodeAt(0)>=65&&q.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((J.key===R.ETX||J.key===R.CR)&&(this.textarea.value=""),this._onKey.fire({key:J.key,domEvent:q}),this._showCursor(),this.coreService.triggerDataEvent(J.key,!0),!this.optionsService.rawOptions.screenReaderMode||q.altKey||q.ctrlKey)return this.cancel(q,!0);this._keyDownHandled=!0}_isThirdLevelShift(q,G){let J=q.isMac&&!this.options.macOptionIsMeta&&G.altKey&&!G.ctrlKey&&!G.metaKey||q.isWindows&&G.altKey&&G.ctrlKey&&!G.metaKey||q.isWindows&&G.getModifierState("AltGraph");return G.type==="keypress"?J:J&&(!G.keyCode||G.keyCode>47)}_keyUp(q){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler(q)===!1)&&(eG(q)||this.focus(),this.updateCursorStyle(q),this._keyPressHandled=!1)}_keyPress(q){let G;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(q)===!1)return!1;if(this.cancel(q),q.charCode)G=q.charCode;else if(q.which===null||q.which===void 0)G=q.keyCode;else if(q.which!==0&&q.charCode!==0)G=q.which;else return!1;return!G||(q.altKey||q.ctrlKey||q.metaKey)&&!this._isThirdLevelShift(this.browser,q)?!1:(G=String.fromCharCode(G),this._onKey.fire({key:G,domEvent:q}),this._showCursor(),this.coreService.triggerDataEvent(G,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent(q){if(q.data&&q.inputType==="insertText"&&(!q.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let G=q.data;return this.coreService.triggerDataEvent(G,!0),this.cancel(q),!0}return!1}resize(q,G){if(q===this.cols&&G===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize(q,G)}_afterResize(q,G){this._charSizeService?.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let q=1;q<this.rows;q++)this.buffer.lines.push(this.buffer.getBlankLine(j5));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let q=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this._customKeyEventHandler=q,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(R.ESC+"[I"):this.coreService.triggerDataEvent(R.ESC+"[O")}_reportWindowsOptions(q){if(this._renderService)switch(q){case 0:let G=this._renderService.dimensions.css.canvas.width.toFixed(0),J=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${R.ESC}[4;${J};${G}t`);break;case 1:let Z=this._renderService.dimensions.css.cell.width.toFixed(0),$=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${R.ESC}[6;${$};${Z}t`);break}}cancel(q,G){if(!(!this.options.cancelEvents&&!G))return q.preventDefault(),q.stopPropagation(),!1}};function eG(q){return q.keyCode===16||q.keyCode===17||q.keyCode===18}var qJ=class{constructor(){this._addons=[]}dispose(){for(let q=this._addons.length-1;q>=0;q--)this._addons[q].instance.dispose()}loadAddon(q,G){let J={instance:G,dispose:G.dispose,isDisposed:!1};this._addons.push(J),G.dispose=()=>this._wrappedAddonDispose(J),G.activate(q)}_wrappedAddonDispose(q){if(q.isDisposed)return;let G=-1;for(let J=0;J<this._addons.length;J++)if(this._addons[J]===q){G=J;break}if(G===-1)throw Error("Could not dispose an addon that has not been loaded");q.isDisposed=!0,q.dispose.apply(q.instance),this._addons.splice(G,1)}},GJ=class{constructor(q){this._line=q}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(q,G){if(!(q<0||q>=this._line.length))return G?(this._line.loadCell(q,G),G):this._line.loadCell(q,new l5)}translateToString(q,G,J){return this._line.translateToString(q,G,J)}},D1=class{constructor(q,G){this._buffer=q,this.type=G}init(q){return this._buffer=q,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(q){let G=this._buffer.lines.get(q);if(G)return new GJ(G)}getNullCell(){return new l5}},JJ=class extends g{constructor(q){super();this._core=q,this._onBufferChange=this._register(new x),this.onBufferChange=this._onBufferChange.event,this._normal=new D1(this._core.buffers.normal,"normal"),this._alternate=new D1(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},ZJ=class{constructor(q){this._core=q}registerCsiHandler(q,G){return this._core.registerCsiHandler(q,(J)=>G(J.toArray()))}addCsiHandler(q,G){return this.registerCsiHandler(q,G)}registerDcsHandler(q,G){return this._core.registerDcsHandler(q,(J,Z)=>G(J,Z.toArray()))}addDcsHandler(q,G){return this.registerDcsHandler(q,G)}registerEscHandler(q,G){return this._core.registerEscHandler(q,G)}addEscHandler(q,G){return this.registerEscHandler(q,G)}registerOscHandler(q,G){return this._core.registerOscHandler(q,G)}addOscHandler(q,G){return this.registerOscHandler(q,G)}},$J=class{constructor(q){this._core=q}register(q){this._core.unicodeService.register(q)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(q){this._core.unicodeService.activeVersion=q}},YJ=["cols","rows"],e5=0,$4=class extends g{constructor(q){super(),this._core=this._register(new tG(q)),this._addonManager=this._register(new qJ),this._publicOptions={...this._core.options};let G=(Z)=>this._core.options[Z],J=(Z,$)=>{this._checkReadonlyOptions(Z),this._core.options[Z]=$};for(let Z in this._core.options){let $={get:G.bind(this,Z),set:J.bind(this,Z)};Object.defineProperty(this._publicOptions,Z,$)}}_checkReadonlyOptions(q){if(YJ.includes(q))throw Error(`Option "${q}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new ZJ(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new $J(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new JJ(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let q=this._core.coreService.decPrivateModes,G="none";switch(this._core.coreMouseService.activeProtocol){case"X10":G="x10";break;case"VT200":G="vt200";break;case"DRAG":G="drag";break;case"ANY":G="any";break}return{applicationCursorKeysMode:q.applicationCursorKeys,applicationKeypadMode:q.applicationKeypad,bracketedPasteMode:q.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:G,originMode:q.origin,reverseWraparoundMode:q.reverseWraparound,sendFocusMode:q.sendFocus,synchronizedOutputMode:q.synchronizedOutput,wraparoundMode:q.wraparound}}get options(){return this._publicOptions}set options(q){for(let G in q)this._publicOptions[G]=q[G]}blur(){this._core.blur()}focus(){this._core.focus()}input(q,G=!0){this._core.input(q,G)}resize(q,G){this._verifyIntegers(q,G),this._core.resize(q,G)}open(q){this._core.open(q)}attachCustomKeyEventHandler(q){this._core.attachCustomKeyEventHandler(q)}attachCustomWheelEventHandler(q){this._core.attachCustomWheelEventHandler(q)}registerLinkProvider(q){return this._core.registerLinkProvider(q)}registerCharacterJoiner(q){return this._checkProposedApi(),this._core.registerCharacterJoiner(q)}deregisterCharacterJoiner(q){this._checkProposedApi(),this._core.deregisterCharacterJoiner(q)}registerMarker(q=0){return this._verifyIntegers(q),this._core.registerMarker(q)}registerDecoration(q){return this._checkProposedApi(),this._verifyPositiveIntegers(q.x??0,q.width??0,q.height??0),this._core.registerDecoration(q)}hasSelection(){return this._core.hasSelection()}select(q,G,J){this._verifyIntegers(q,G,J),this._core.select(q,G,J)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(q,G){this._verifyIntegers(q,G),this._core.selectLines(q,G)}dispose(){super.dispose()}scrollLines(q){this._verifyIntegers(q),this._core.scrollLines(q)}scrollPages(q){this._verifyIntegers(q),this._core.scrollPages(q)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(q){this._verifyIntegers(q),this._core.scrollToLine(q)}clear(){this._core.clear()}write(q,G){this._core.write(q,G)}writeln(q,G){this._core.write(q),this._core.write(`\r
`,G)}paste(q){this._core.paste(q)}refresh(q,G){this._verifyIntegers(q,G),this._core.refresh(q,G)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(q){this._addonManager.loadAddon(this,q)}static get strings(){return{get promptLabel(){return c8.get()},set promptLabel(q){c8.set(q)},get tooMuchOutput(){return a8.get()},set tooMuchOutput(q){a8.set(q)}}}_verifyIntegers(...q){for(e5 of q)if(e5===1/0||isNaN(e5)||e5%1!==0)throw Error("This API only accepts integers")}_verifyPositiveIntegers(...q){for(e5 of q)if(e5&&(e5===1/0||isNaN(e5)||e5%1!==0||e5<0))throw Error("This API only accepts positive integers")}};var KJ=2,XJ=1,Y4=class{activate(q){this._terminal=q}dispose(){}fit(){let q=this.proposeDimensions();if(!q||!this._terminal||isNaN(q.cols)||isNaN(q.rows))return;let G=this._terminal._core;(this._terminal.rows!==q.rows||this._terminal.cols!==q.cols)&&(G._renderService.clear(),this._terminal.resize(q.cols,q.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let q=this._terminal._core._renderService.dimensions;if(q.css.cell.width===0||q.css.cell.height===0)return;let G=this._terminal.options.scrollback===0?0:this._terminal.options.overviewRuler?.width||14,J=window.getComputedStyle(this._terminal.element.parentElement),Z=parseInt(J.getPropertyValue("height")),$=Math.max(0,parseInt(J.getPropertyValue("width"))),Y=window.getComputedStyle(this._terminal.element),K={top:parseInt(Y.getPropertyValue("padding-top")),bottom:parseInt(Y.getPropertyValue("padding-bottom")),right:parseInt(Y.getPropertyValue("padding-right")),left:parseInt(Y.getPropertyValue("padding-left"))},X=K.top+K.bottom,j=K.right+K.left,V=Z-X,B=$-j-G;return{cols:Math.max(KJ,Math.floor(B/q.css.cell.width)),rows:Math.max(XJ,Math.floor(V/q.css.cell.height))}}};var VJ=class{constructor(q,G,J,Z={}){this._terminal=q,this._regex=G,this._handler=J,this._options=Z}provideLinks(q,G){let J=zJ.computeLink(q,this._regex,this._terminal,this._handler);G(this._addCallbacks(J))}_addCallbacks(q){return q.map((G)=>(G.leave=this._options.leave,G.hover=(J,Z)=>{if(this._options.hover){let{range:$}=G;this._options.hover(J,Z,$)}},G))}};function jJ(q){try{let G=new URL(q),J=G.password&&G.username?`${G.protocol}//${G.username}:${G.password}@${G.host}`:G.username?`${G.protocol}//${G.username}@${G.host}`:`${G.protocol}//${G.host}`;return q.toLocaleLowerCase().startsWith(J.toLocaleLowerCase())}catch{return!1}}var zJ=class q{static computeLink(G,J,Z,$){let Y=new RegExp(J.source,(J.flags||"")+"g"),[K,X]=q._getWindowedLineStrings(G-1,Z),j=K.join(""),V,B=[];for(;V=Y.exec(j);){let z=V[0];if(!jJ(z))continue;let[H,F]=q._mapStrIdx(Z,X,0,V.index),[C,M]=q._mapStrIdx(Z,H,F,z.length);if(H===-1||F===-1||C===-1||M===-1)continue;let k={start:{x:F+1,y:H+1},end:{x:M,y:C+1}};B.push({range:k,text:z,activate:$})}return B}static _getWindowedLineStrings(G,J){let Z,$=G,Y=G,K=0,X="",j=[];if(Z=J.buffer.active.getLine(G)){let V=Z.translateToString(!0);if(Z.isWrapped&&V[0]!==" "){for(K=0;(Z=J.buffer.active.getLine(--$))&&K<2048&&(X=Z.translateToString(!0),K+=X.length,j.push(X),!(!Z.isWrapped||X.indexOf(" ")!==-1)););j.reverse()}for(j.push(V),K=0;(Z=J.buffer.active.getLine(++Y))&&Z.isWrapped&&K<2048&&(X=Z.translateToString(!0),K+=X.length,j.push(X),X.indexOf(" ")===-1););}return[j,$]}static _mapStrIdx(G,J,Z,$){let Y=G.buffer.active,K=Y.getNullCell(),X=Z;for(;$;){let j=Y.getLine(J);if(!j)return[-1,-1];for(let V=X;V<j.length;++V){j.getCell(V,K);let B=K.getChars();if(K.getWidth()&&($-=B.length||1,V===j.length-1&&B==="")){let z=Y.getLine(J+1);z&&z.isWrapped&&(z.getCell(0,K),K.getWidth()===2&&($+=1))}if($<0)return[J,V]}J++,X=0}return[J,X]}},BJ=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function HJ(q,G){let J=window.open();if(J){try{J.opener=null}catch{}J.location.href=G}else console.warn("Opening link blocked as opener could not be cleared")}var K4=class{constructor(q=HJ,G={}){this._handler=q,this._options=G}activate(q){this._terminal=q;let G=this._options,J=G.urlRegex||BJ;this._linkProvider=this._terminal.registerLinkProvider(new VJ(this._terminal,J,this._handler,G))}dispose(){this._linkProvider?.dispose()}};var{defineProperty:FJ,getOwnPropertyDescriptor:CJ}=Object,NJ=(q,G,J,Z)=>{for(var $=Z>1?void 0:Z?CJ(G,J):G,Y=q.length-1,K;Y>=0;Y--)(K=q[Y])&&($=(Z?K(G,J,$):K($))||$);return Z&&$&&FJ(G,J,$),$},UJ=(q,G)=>(J,Z)=>G(J,Z,q),MJ=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(q){setTimeout(()=>{throw q.stack?X4.isErrorNoTelemetry(q)?new X4(q.message+`

`+q.stack):Error(q.message+`

`+q.stack):q},0)}}addListener(q){return this.listeners.push(q),()=>{this._removeListener(q)}}emit(q){this.listeners.forEach((G)=>{G(q)})}_removeListener(q){this.listeners.splice(this.listeners.indexOf(q),1)}setUnexpectedErrorHandler(q){this.unexpectedErrorHandler=q}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(q){this.unexpectedErrorHandler(q),this.emit(q)}onUnexpectedExternalError(q){this.unexpectedErrorHandler(q)}},DJ=new MJ;function B8(q){QJ(q)||DJ.onUnexpectedError(q)}var c9="Canceled";function QJ(q){return q instanceof PJ?!0:q instanceof Error&&q.name===c9&&q.message===c9}var PJ=class extends Error{constructor(){super(c9),this.name=this.message}},X4=class q extends Error{constructor(G){super(G),this.name="CodeExpectedError"}static fromError(G){if(G instanceof q)return G;let J=new q;return J.message=G.message,J.stack=G.stack,J}static isErrorNoTelemetry(G){return G.name==="CodeExpectedError"}};function WJ(q,G,J=0,Z=q.length){let $=J,Y=Z;for(;$<Y;){let K=Math.floor(($+Y)/2);G(q[K])?$=K+1:Y=K}return $-1}var RJ=class q{constructor(G){this._array=G,this._findLastMonotonousLastIdx=0}findLastMonotonous(G){if(q.assertInvariants){if(this._prevFindLastPredicate){for(let Z of this._array)if(this._prevFindLastPredicate(Z)&&!G(Z))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=G}let J=WJ(this._array,G,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=J+1,J===-1?void 0:this._array[J]}};RJ.assertInvariants=!1;var c4;((q)=>{function G(Y){return Y<0}q.isLessThan=G;function J(Y){return Y<=0}q.isLessThanOrEqual=J;function Z(Y){return Y>0}q.isGreaterThan=Z;function $(Y){return Y===0}q.isNeitherLessOrGreaterThan=$,q.greaterThan=1,q.lessThan=-1,q.neitherLessOrGreaterThan=0})(c4||={});function OJ(q,G){return(J,Z)=>G(q(J),q(Z))}var AJ=(q,G)=>q-G,V4=class q{constructor(G){this.iterate=G}forEach(G){this.iterate((J)=>(G(J),!0))}toArray(){let G=[];return this.iterate((J)=>(G.push(J),!0)),G}filter(G){return new q((J)=>this.iterate((Z)=>G(Z)?J(Z):!0))}map(G){return new q((J)=>this.iterate((Z)=>J(G(Z))))}some(G){let J=!1;return this.iterate((Z)=>(J=G(Z),!J)),J}findFirst(G){let J;return this.iterate((Z)=>G(Z)?(J=Z,!1):!0),J}findLast(G){let J;return this.iterate((Z)=>(G(Z)&&(J=Z),!0)),J}findLastMaxBy(G){let J,Z=!0;return this.iterate(($)=>((Z||c4.isGreaterThan(G($,J)))&&(Z=!1,J=$),!0)),J}};V4.empty=new V4((q)=>{});function kJ(q,G){let J=Object.create(null);for(let Z of q){let $=G(Z),Y=J[$];Y||(Y=J[$]=[]),Y.push(Z)}return J}var j4,z4,XX=class{constructor(q,G){this.toKey=G,this._map=new Map,this[j4]="SetWithKey";for(let J of q)this.add(J)}get size(){return this._map.size}add(q){let G=this.toKey(q);return this._map.set(G,q),this}delete(q){return this._map.delete(this.toKey(q))}has(q){return this._map.has(this.toKey(q))}*entries(){for(let q of this._map.values())yield[q,q]}keys(){return this.values()}*values(){for(let q of this._map.values())yield q}clear(){this._map.clear()}forEach(q,G){this._map.forEach((J)=>q.call(G,J,J,this))}[(z4=Symbol.iterator,j4=Symbol.toStringTag,z4)](){return this.values()}},LJ=class{constructor(){this.map=new Map}add(q,G){let J=this.map.get(q);J||(J=new Set,this.map.set(q,J)),J.add(G)}delete(q,G){let J=this.map.get(q);J&&(J.delete(G),J.size===0&&this.map.delete(q))}forEach(q,G){let J=this.map.get(q);J&&J.forEach(G)}get(q){return this.map.get(q)||new Set}};function xJ(q,G){let J=this,Z=!1,$;return function(){if(Z)return $;if(Z=!0,G)try{$=q.apply(J,arguments)}finally{G()}else $=q.apply(J,arguments);return $}}var a4;((q)=>{function G(O){return O&&typeof O=="object"&&typeof O[Symbol.iterator]=="function"}q.is=G;let J=Object.freeze([]);function Z(){return J}q.empty=Z;function*$(O){yield O}q.single=$;function Y(O){return G(O)?O:$(O)}q.wrap=Y;function K(O){return O||J}q.from=K;function*X(O){for(let w=O.length-1;w>=0;w--)yield O[w]}q.reverse=X;function j(O){return!O||O[Symbol.iterator]().next().done===!0}q.isEmpty=j;function V(O){return O[Symbol.iterator]().next().value}q.first=V;function B(O,w){let T=0;for(let f of O)if(w(f,T++))return!0;return!1}q.some=B;function z(O,w){for(let T of O)if(w(T))return T}q.find=z;function*H(O,w){for(let T of O)w(T)&&(yield T)}q.filter=H;function*F(O,w){let T=0;for(let f of O)yield w(f,T++)}q.map=F;function*C(O,w){let T=0;for(let f of O)yield*w(f,T++)}q.flatMap=C;function*M(...O){for(let w of O)yield*w}q.concat=M;function k(O,w,T){let f=T;for(let o of O)f=w(f,o);return f}q.reduce=k;function*I(O,w,T=O.length){for(w<0&&(w+=O.length),T<0?T+=O.length:T>O.length&&(T=O.length);w<T;w++)yield O[w]}q.slice=I;function _(O,w=Number.POSITIVE_INFINITY){let T=[];if(w===0)return[T,O];let f=O[Symbol.iterator]();for(let o=0;o<w;o++){let K5=f.next();if(K5.done)return[T,q.empty()];T.push(K5.value)}return[T,{[Symbol.iterator](){return f}}]}q.consume=_;async function S(O){let w=[];for await(let T of O)w.push(T);return Promise.resolve(w)}q.asyncToArray=S})(a4||={});var SJ=!1,t6=null,wJ=class q{constructor(){this.livingDisposables=new Map}getDisposableData(G){let J=this.livingDisposables.get(G);return J||(J={parent:null,source:null,isSingleton:!1,value:G,idx:q.idx++},this.livingDisposables.set(G,J)),J}trackDisposable(G){let J=this.getDisposableData(G);J.source||(J.source=Error().stack)}setParent(G,J){let Z=this.getDisposableData(G);Z.parent=J}markAsDisposed(G){this.livingDisposables.delete(G)}markAsSingleton(G){this.getDisposableData(G).isSingleton=!0}getRootParent(G,J){let Z=J.get(G);if(Z)return Z;let $=G.parent?this.getRootParent(this.getDisposableData(G.parent),J):G;return J.set(G,$),$}getTrackedDisposables(){let G=new Map;return[...this.livingDisposables.entries()].filter(([,J])=>J.source!==null&&!this.getRootParent(J,G).isSingleton).flatMap(([J])=>J)}computeLeakingDisposables(G=10,J){let Z;if(J)Z=J;else{let j=new Map,V=[...this.livingDisposables.values()].filter((z)=>z.source!==null&&!this.getRootParent(z,j).isSingleton);if(V.length===0)return;let B=new Set(V.map((z)=>z.value));if(Z=V.filter((z)=>!(z.parent&&B.has(z.parent))),Z.length===0)throw Error("There are cyclic diposable chains!")}if(!Z)return;function $(j){function V(z,H){for(;z.length>0&&H.some((F)=>typeof F=="string"?F===z[0]:z[0].match(F));)z.shift()}let B=j.source.split(`
`).map((z)=>z.trim().replace("at ","")).filter((z)=>z!=="");return V(B,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),B.reverse()}let Y=new LJ;for(let j of Z){let V=$(j);for(let B=0;B<=V.length;B++)Y.add(V.slice(0,B).join(`
`),j)}Z.sort(OJ((j)=>j.idx,AJ));let K="",X=0;for(let j of Z.slice(0,G)){X++;let V=$(j),B=[];for(let z=0;z<V.length;z++){let H=V[z];H=`(shared with ${Y.get(V.slice(0,z+1).join(`
`)).size}/${Z.length} leaks) at ${H}`;let F=Y.get(V.slice(0,z).join(`
`)),C=kJ([...F].map((M)=>$(M)[z]),(M)=>M);delete C[V[z]];for(let[M,k]of Object.entries(C))B.unshift(`    - stacktraces of ${k.length} other leaks continue with ${M}`);B.unshift(H)}K+=`


==================== Leaking disposable ${X}/${Z.length}: ${j.value.constructor.name} ====================
${B.join(`
`)}
============================================================

`}return Z.length>G&&(K+=`


... and ${Z.length-G} more leaking disposables

`),{leaks:Z,details:K}}};wJ.idx=0;function yJ(q){t6=q}if(SJ){let q="__is_disposable_tracked__";yJ(new class{trackDisposable(G){let J=Error("Potentially leaked disposable").stack;setTimeout(()=>{G[q]||console.log(J)},3000)}setParent(G,J){if(G&&G!==u5.None)try{G[q]=!0}catch{}}markAsDisposed(G){if(G&&G!==u5.None)try{G[q]=!0}catch{}}markAsSingleton(G){}})}function P8(q){return t6?.trackDisposable(q),q}function W8(q){t6?.markAsDisposed(q)}function w7(q,G){t6?.setParent(q,G)}function IJ(q,G){if(t6)for(let J of q)t6.setParent(J,G)}function l4(q){if(a4.is(q)){let G=[];for(let J of q)if(J)try{J.dispose()}catch(Z){G.push(Z)}if(G.length===1)throw G[0];if(G.length>1)throw AggregateError(G,"Encountered errors while disposing of store");return Array.isArray(q)?[]:q}else if(q)return q.dispose(),q}function o4(...q){let G=x5(()=>l4(q));return IJ(q,G),G}function x5(q){let G=P8({dispose:xJ(()=>{W8(G),q()})});return G}var s4=class q{constructor(){this._toDispose=new Set,this._isDisposed=!1,P8(this)}dispose(){this._isDisposed||(W8(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{l4(this._toDispose)}finally{this._toDispose.clear()}}add(G){if(!G)return G;if(G===this)throw Error("Cannot register a disposable on itself!");return w7(G,this),this._isDisposed?q.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(G),G}delete(G){if(G){if(G===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(G),G.dispose()}}deleteAndLeak(G){G&&this._toDispose.has(G)&&(this._toDispose.delete(G),w7(G,null))}};s4.DISABLE_DISPOSED_WARNING=!1;var i6=s4,u5=class{constructor(){this._store=new i6,P8(this),w7(this._store,this)}dispose(){W8(this),this._store.dispose()}_register(q){if(q===this)throw Error("Cannot register a disposable on itself!");return this._store.add(q)}};u5.None=Object.freeze({dispose(){}});var O7=class{constructor(){this._isDisposed=!1,P8(this)}get value(){return this._isDisposed?void 0:this._value}set value(q){this._isDisposed||q===this._value||(this._value?.dispose(),q&&w7(q,this),this._value=q)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,W8(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let q=this._value;return this._value=void 0,q&&w7(q,null),q}},i9=typeof process<"u"&&"title"in process,I7=i9?"node":navigator.userAgent,t9=i9?"node":navigator.platform,TJ=I7.includes("Firefox"),_J=I7.includes("Edge"),n4=/^((?!chrome|android).)*safari/i.test(I7);function vJ(){if(!n4)return 0;let q=I7.match(/Version\/(\d+)/);return q===null||q.length<2?0:parseInt(q[1])}var VX=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(t9),jX=["Windows","Win16","Win32","WinCE"].includes(t9),zX=t9.indexOf("Linux")>=0,BX=/\bCrOS\b/.test(I7),EJ="",W5=0,R5=0,O5=0,Y5=0,o5={css:"#00000000",rgba:0},_5;((q)=>{function G($,Y,K,X){return X!==void 0?`#${h6($)}${h6(Y)}${h6(K)}${h6(X)}`:`#${h6($)}${h6(Y)}${h6(K)}`}q.toCss=G;function J($,Y,K,X=255){return($<<24|Y<<16|K<<8|X)>>>0}q.toRgba=J;function Z($,Y,K,X){return{css:q.toCss($,Y,K,X),rgba:q.toRgba($,Y,K,X)}}q.toColor=Z})(_5||={});var S7;((q)=>{function G(j,V){if(Y5=(V.rgba&255)/255,Y5===1)return{css:V.css,rgba:V.rgba};let B=V.rgba>>24&255,z=V.rgba>>16&255,H=V.rgba>>8&255,F=j.rgba>>24&255,C=j.rgba>>16&255,M=j.rgba>>8&255;W5=F+Math.round((B-F)*Y5),R5=C+Math.round((z-C)*Y5),O5=M+Math.round((H-M)*Y5);let k=_5.toCss(W5,R5,O5),I=_5.toRgba(W5,R5,O5);return{css:k,rgba:I}}q.blend=G;function J(j){return(j.rgba&255)===255}q.isOpaque=J;function Z(j,V,B){let z=u6.ensureContrastRatio(j.rgba,V.rgba,B);if(z)return _5.toColor(z>>24&255,z>>16&255,z>>8&255)}q.ensureContrastRatio=Z;function $(j){let V=(j.rgba|255)>>>0;return[W5,R5,O5]=u6.toChannels(V),{css:_5.toCss(W5,R5,O5),rgba:V}}q.opaque=$;function Y(j,V){return Y5=Math.round(V*255),[W5,R5,O5]=u6.toChannels(j.rgba),{css:_5.toCss(W5,R5,O5,Y5),rgba:_5.toRgba(W5,R5,O5,Y5)}}q.opacity=Y;function K(j,V){return Y5=j.rgba&255,Y(j,Y5*V/255)}q.multiplyOpacity=K;function X(j){return[j.rgba>>24&255,j.rgba>>16&255,j.rgba>>8&255]}q.toColorRGB=X})(S7||={});var bJ;((q)=>{let G,J;try{let $=document.createElement("canvas");$.width=1,$.height=1;let Y=$.getContext("2d",{willReadFrequently:!0});Y&&(G=Y,G.globalCompositeOperation="copy",J=G.createLinearGradient(0,0,1,1))}catch{}function Z($){if($.match(/#[\da-f]{3,8}/i))switch($.length){case 4:return W5=parseInt($.slice(1,2).repeat(2),16),R5=parseInt($.slice(2,3).repeat(2),16),O5=parseInt($.slice(3,4).repeat(2),16),_5.toColor(W5,R5,O5);case 5:return W5=parseInt($.slice(1,2).repeat(2),16),R5=parseInt($.slice(2,3).repeat(2),16),O5=parseInt($.slice(3,4).repeat(2),16),Y5=parseInt($.slice(4,5).repeat(2),16),_5.toColor(W5,R5,O5,Y5);case 7:return{css:$,rgba:(parseInt($.slice(1),16)<<8|255)>>>0};case 9:return{css:$,rgba:parseInt($.slice(1),16)>>>0}}let Y=$.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(Y)return W5=parseInt(Y[1]),R5=parseInt(Y[2]),O5=parseInt(Y[3]),Y5=Math.round((Y[5]===void 0?1:parseFloat(Y[5]))*255),_5.toColor(W5,R5,O5,Y5);if(!G||!J)throw Error("css.toColor: Unsupported css format");if(G.fillStyle=J,G.fillStyle=$,typeof G.fillStyle!="string")throw Error("css.toColor: Unsupported css format");if(G.fillRect(0,0,1,1),[W5,R5,O5,Y5]=G.getImageData(0,0,1,1).data,Y5!==255)throw Error("css.toColor: Unsupported css format");return{rgba:_5.toRgba(W5,R5,O5,Y5),css:$}}q.toColor=Z})(bJ||={});var T5;((q)=>{function G(Z){return J(Z>>16&255,Z>>8&255,Z&255)}q.relativeLuminance=G;function J(Z,$,Y){let K=Z/255,X=$/255,j=Y/255,V=K<=0.03928?K/12.92:Math.pow((K+0.055)/1.055,2.4),B=X<=0.03928?X/12.92:Math.pow((X+0.055)/1.055,2.4),z=j<=0.03928?j/12.92:Math.pow((j+0.055)/1.055,2.4);return V*0.2126+B*0.7152+z*0.0722}q.relativeLuminance2=J})(T5||={});var u6;((q)=>{function G(K,X){if(Y5=(X&255)/255,Y5===1)return X;let j=X>>24&255,V=X>>16&255,B=X>>8&255,z=K>>24&255,H=K>>16&255,F=K>>8&255;return W5=z+Math.round((j-z)*Y5),R5=H+Math.round((V-H)*Y5),O5=F+Math.round((B-F)*Y5),_5.toRgba(W5,R5,O5)}q.blend=G;function J(K,X,j){let V=T5.relativeLuminance(K>>8),B=T5.relativeLuminance(X>>8);if(H6(V,B)<j){if(B<V){let F=Z(K,X,j),C=H6(V,T5.relativeLuminance(F>>8));if(C<j){let M=$(K,X,j),k=H6(V,T5.relativeLuminance(M>>8));return C>k?F:M}return F}let z=$(K,X,j),H=H6(V,T5.relativeLuminance(z>>8));if(H<j){let F=Z(K,X,j),C=H6(V,T5.relativeLuminance(F>>8));return H>C?z:F}return z}}q.ensureContrastRatio=J;function Z(K,X,j){let V=K>>24&255,B=K>>16&255,z=K>>8&255,H=X>>24&255,F=X>>16&255,C=X>>8&255,M=H6(T5.relativeLuminance2(H,F,C),T5.relativeLuminance2(V,B,z));for(;M<j&&(H>0||F>0||C>0);)H-=Math.max(0,Math.ceil(H*0.1)),F-=Math.max(0,Math.ceil(F*0.1)),C-=Math.max(0,Math.ceil(C*0.1)),M=H6(T5.relativeLuminance2(H,F,C),T5.relativeLuminance2(V,B,z));return(H<<24|F<<16|C<<8|255)>>>0}q.reduceLuminance=Z;function $(K,X,j){let V=K>>24&255,B=K>>16&255,z=K>>8&255,H=X>>24&255,F=X>>16&255,C=X>>8&255,M=H6(T5.relativeLuminance2(H,F,C),T5.relativeLuminance2(V,B,z));for(;M<j&&(H<255||F<255||C<255);)H=Math.min(255,H+Math.ceil((255-H)*0.1)),F=Math.min(255,F+Math.ceil((255-F)*0.1)),C=Math.min(255,C+Math.ceil((255-C)*0.1)),M=H6(T5.relativeLuminance2(H,F,C),T5.relativeLuminance2(V,B,z));return(H<<24|F<<16|C<<8|255)>>>0}q.increaseLuminance=$;function Y(K){return[K>>24&255,K>>16&255,K>>8&255,K&255]}q.toChannels=Y})(u6||={});function h6(q){let G=q.toString(16);return G.length<2?"0"+G:G}function H6(q,G){return q<G?(G+0.05)/(q+0.05):(q+0.05)/(G+0.05)}function B5(q){if(!q)throw Error("value must not be falsy");return q}function e9(q){return 57508<=q&&q<=57558}function gJ(q){return 57520<=q&&q<=57527}function mJ(q){return 57344<=q&&q<=63743}function fJ(q){return 9472<=q&&q<=9631}function pJ(q){return q>=128512&&q<=128591||q>=127744&&q<=128511||q>=128640&&q<=128767||q>=9728&&q<=9983||q>=9984&&q<=10175||q>=65024&&q<=65039||q>=129280&&q<=129535||q>=127462&&q<=127487}function hJ(q,G,J,Z){return G===1&&J>Math.ceil(Z*1.5)&&q!==void 0&&q>255&&!pJ(q)&&!e9(q)&&!mJ(q)}function r4(q){return e9(q)||fJ(q)}function uJ(){return{css:{canvas:X8(),cell:X8()},device:{canvas:X8(),cell:X8(),char:{width:0,height:0,left:0,top:0}}}}function X8(){return{width:0,height:0}}function dJ(q,G,J=0){return(q-(Math.round(G)*2-J))%(Math.round(G)*2)}var L5=0,P5=0,Z6=!1,F6=!1,V8=!1,E5,y9=0,cJ=class{constructor(q,G,J,Z,$,Y){this._terminal=q,this._optionService=G,this._selectionRenderModel=J,this._decorationService=Z,this._coreBrowserService=$,this._themeService=Y,this.result={fg:0,bg:0,ext:0}}resolve(q,G,J,Z){if(this.result.bg=q.bg,this.result.fg=q.fg,this.result.ext=q.bg&268435456?q.extended.ext:0,P5=0,L5=0,F6=!1,Z6=!1,V8=!1,E5=this._themeService.colors,y9=0,q.getCode()!==0&&q.extended.underlineStyle===4){let $=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));y9=G*Z%(Math.round($)*2)}if(this._decorationService.forEachDecorationAtCell(G,J,"bottom",($)=>{$.backgroundColorRGB&&(P5=$.backgroundColorRGB.rgba>>8&16777215,F6=!0),$.foregroundColorRGB&&(L5=$.foregroundColorRGB.rgba>>8&16777215,Z6=!0)}),V8=this._selectionRenderModel.isCellSelected(this._terminal,G,J),V8){if(this.result.fg&67108864||(this.result.bg&50331648)!==0){if(this.result.fg&67108864)switch(this.result.fg&50331648){case 16777216:case 33554432:P5=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:P5=(this.result.fg&16777215)<<8|255;break;case 0:default:P5=this._themeService.colors.foreground.rgba}else switch(this.result.bg&50331648){case 16777216:case 33554432:P5=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:P5=(this.result.bg&16777215)<<8|255;break}P5=u6.blend(P5,(this._coreBrowserService.isFocused?E5.selectionBackgroundOpaque:E5.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}else P5=(this._coreBrowserService.isFocused?E5.selectionBackgroundOpaque:E5.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(F6=!0,E5.selectionForeground&&(L5=E5.selectionForeground.rgba>>8&16777215,Z6=!0),r4(q.getCode())){if(this.result.fg&67108864&&(this.result.bg&50331648)===0)L5=(this._coreBrowserService.isFocused?E5.selectionBackgroundOpaque:E5.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(this.result.fg&67108864)switch(this.result.bg&50331648){case 16777216:case 33554432:L5=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:L5=(this.result.bg&16777215)<<8|255;break}else switch(this.result.fg&50331648){case 16777216:case 33554432:L5=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:L5=(this.result.fg&16777215)<<8|255;break;case 0:default:L5=this._themeService.colors.foreground.rgba}L5=u6.blend(L5,(this._coreBrowserService.isFocused?E5.selectionBackgroundOpaque:E5.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}Z6=!0}}this._decorationService.forEachDecorationAtCell(G,J,"top",($)=>{$.backgroundColorRGB&&(P5=$.backgroundColorRGB.rgba>>8&16777215,F6=!0),$.foregroundColorRGB&&(L5=$.foregroundColorRGB.rgba>>8&16777215,Z6=!0)}),F6&&(V8?P5=q.bg&-16777216&-134217729|P5|50331648:P5=q.bg&-16777216|P5|50331648),Z6&&(L5=q.fg&-16777216&-67108865|L5|50331648),this.result.fg&67108864&&(F6&&!Z6&&((this.result.bg&50331648)===0?L5=this.result.fg&-134217728|E5.background.rgba>>8&16777215&16777215|50331648:L5=this.result.fg&-134217728|this.result.bg&67108863,Z6=!0),!F6&&Z6&&((this.result.fg&50331648)===0?P5=this.result.bg&-67108864|E5.foreground.rgba>>8&16777215&16777215|50331648:P5=this.result.bg&-67108864|this.result.fg&67108863,F6=!0)),E5=void 0,this.result.bg=F6?P5:this.result.bg,this.result.fg=Z6?L5:this.result.fg,this.result.ext&=536870911,this.result.ext|=y9<<29&3758096384}},aJ=0.5,i4=TJ||_J?"bottom":"ideographic",lJ={"":[{x:0,y:0,w:8,h:4}],"":[{x:0,y:7,w:8,h:1}],"":[{x:0,y:6,w:8,h:2}],"":[{x:0,y:5,w:8,h:3}],"":[{x:0,y:4,w:8,h:4}],"":[{x:0,y:3,w:8,h:5}],"":[{x:0,y:2,w:8,h:6}],"":[{x:0,y:1,w:8,h:7}],"":[{x:0,y:0,w:8,h:8}],"":[{x:0,y:0,w:7,h:8}],"":[{x:0,y:0,w:6,h:8}],"":[{x:0,y:0,w:5,h:8}],"":[{x:0,y:0,w:4,h:8}],"":[{x:0,y:0,w:3,h:8}],"":[{x:0,y:0,w:2,h:8}],"":[{x:0,y:0,w:1,h:8}],"":[{x:4,y:0,w:4,h:8}],"":[{x:0,y:0,w:8,h:1}],"":[{x:7,y:0,w:1,h:8}],"":[{x:0,y:4,w:4,h:4}],"":[{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"":[{x:4,y:0,w:4,h:4}],"":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\uD83E\uDF70":[{x:1,y:0,w:1,h:8}],"\uD83E\uDF71":[{x:2,y:0,w:1,h:8}],"\uD83E\uDF72":[{x:3,y:0,w:1,h:8}],"\uD83E\uDF73":[{x:4,y:0,w:1,h:8}],"\uD83E\uDF74":[{x:5,y:0,w:1,h:8}],"\uD83E\uDF75":[{x:6,y:0,w:1,h:8}],"\uD83E\uDF76":[{x:0,y:1,w:8,h:1}],"\uD83E\uDF77":[{x:0,y:2,w:8,h:1}],"\uD83E\uDF78":[{x:0,y:3,w:8,h:1}],"\uD83E\uDF79":[{x:0,y:4,w:8,h:1}],"\uD83E\uDF7A":[{x:0,y:5,w:8,h:1}],"\uD83E\uDF7B":[{x:0,y:6,w:8,h:1}],"\uD83E\uDF7C":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF7D":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7E":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7F":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF80":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF81":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF82":[{x:0,y:0,w:8,h:2}],"\uD83E\uDF83":[{x:0,y:0,w:8,h:3}],"\uD83E\uDF84":[{x:0,y:0,w:8,h:5}],"\uD83E\uDF85":[{x:0,y:0,w:8,h:6}],"\uD83E\uDF86":[{x:0,y:0,w:8,h:7}],"\uD83E\uDF87":[{x:6,y:0,w:2,h:8}],"\uD83E\uDF88":[{x:5,y:0,w:3,h:8}],"\uD83E\uDF89":[{x:3,y:0,w:5,h:8}],"\uD83E\uDF8A":[{x:2,y:0,w:6,h:8}],"\uD83E\uDF8B":[{x:1,y:0,w:7,h:8}],"\uD83E\uDF95":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\uD83E\uDF96":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\uD83E\uDF97":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]},oJ={"":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"":[[1,0],[0,0],[0,1],[0,0]],"":[[0,1],[1,1],[1,0],[1,1]]},sJ={"":{1:"M0,.5 L1,.5"},"":{3:"M0,.5 L1,.5"},"":{1:"M.5,0 L.5,1"},"":{3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5"},"":{3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M0,.5 L.5,.5 L.5,1"},"":{3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L1,.5"},"":{3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L0,.5"},"":{3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"":{1:"M.5,.5 L0,.5"},"":{3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0"},"":{3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5"},"":{3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1"},"":{3:"M.5,.5 L.5,1"},"":{1:(q,G)=>`M0,${0.5-G} L1,${0.5-G} M0,${0.5+G} L1,${0.5+G}`},"":{1:(q,G)=>`M${0.5-q},0 L${0.5-q},1 M${0.5+q},0 L${0.5+q},1`},"":{1:(q,G)=>`M.5,1 L.5,${0.5-G} L1,${0.5-G} M.5,${0.5+G} L1,${0.5+G}`},"":{1:(q,G)=>`M${0.5-q},1 L${0.5-q},.5 L1,.5 M${0.5+q},.5 L${0.5+q},1`},"":{1:(q,G)=>`M1,${0.5-G} L${0.5-q},${0.5-G} L${0.5-q},1 M1,${0.5+G} L${0.5+q},${0.5+G} L${0.5+q},1`},"":{1:(q,G)=>`M0,${0.5-G} L.5,${0.5-G} L.5,1 M0,${0.5+G} L.5,${0.5+G}`},"":{1:(q,G)=>`M${0.5+q},1 L${0.5+q},.5 L0,.5 M${0.5-q},.5 L${0.5-q},1`},"":{1:(q,G)=>`M0,${0.5+G} L${0.5-q},${0.5+G} L${0.5-q},1 M0,${0.5-G} L${0.5+q},${0.5-G} L${0.5+q},1`},"":{1:(q,G)=>`M.5,0 L.5,${0.5+G} L1,${0.5+G} M.5,${0.5-G} L1,${0.5-G}`},"":{1:(q,G)=>`M1,.5 L${0.5-q},.5 L${0.5-q},0 M${0.5+q},.5 L${0.5+q},0`},"":{1:(q,G)=>`M1,${0.5-G} L${0.5+q},${0.5-G} L${0.5+q},0 M1,${0.5+G} L${0.5-q},${0.5+G} L${0.5-q},0`},"":{1:(q,G)=>`M0,${0.5+G} L.5,${0.5+G} L.5,0 M0,${0.5-G} L.5,${0.5-G}`},"":{1:(q,G)=>`M0,.5 L${0.5+q},.5 L${0.5+q},0 M${0.5-q},.5 L${0.5-q},0`},"":{1:(q,G)=>`M0,${0.5-G} L${0.5-q},${0.5-G} L${0.5-q},0 M0,${0.5+G} L${0.5+q},${0.5+G} L${0.5+q},0`},"":{1:(q,G)=>`M.5,0 L.5,1 M.5,${0.5-G} L1,${0.5-G} M.5,${0.5+G} L1,${0.5+G}`},"":{1:(q,G)=>`M${0.5-q},0 L${0.5-q},1 M${0.5+q},0 L${0.5+q},1 M${0.5+q},.5 L1,.5`},"":{1:(q,G)=>`M${0.5-q},0 L${0.5-q},1 M1,${0.5+G} L${0.5+q},${0.5+G} L${0.5+q},1 M1,${0.5-G} L${0.5+q},${0.5-G} L${0.5+q},0`},"":{1:(q,G)=>`M.5,0 L.5,1 M0,${0.5-G} L.5,${0.5-G} M0,${0.5+G} L.5,${0.5+G}`},"":{1:(q,G)=>`M0,.5 L${0.5-q},.5 M${0.5-q},0 L${0.5-q},1 M${0.5+q},0 L${0.5+q},1`},"":{1:(q,G)=>`M${0.5+q},0 L${0.5+q},1 M0,${0.5+G} L${0.5-q},${0.5+G} L${0.5-q},1 M0,${0.5-G} L${0.5-q},${0.5-G} L${0.5-q},0`},"":{1:(q,G)=>`M0,${0.5-G} L1,${0.5-G} M0,${0.5+G} L1,${0.5+G} M.5,${0.5+G} L.5,1`},"":{1:(q,G)=>`M0,.5 L1,.5 M${0.5-q},.5 L${0.5-q},1 M${0.5+q},.5 L${0.5+q},1`},"":{1:(q,G)=>`M0,${0.5-G} L1,${0.5-G} M0,${0.5+G} L${0.5-q},${0.5+G} L${0.5-q},1 M1,${0.5+G} L${0.5+q},${0.5+G} L${0.5+q},1`},"":{1:(q,G)=>`M.5,0 L.5,${0.5-G} M0,${0.5-G} L1,${0.5-G} M0,${0.5+G} L1,${0.5+G}`},"":{1:(q,G)=>`M0,.5 L1,.5 M${0.5-q},.5 L${0.5-q},0 M${0.5+q},.5 L${0.5+q},0`},"":{1:(q,G)=>`M0,${0.5+G} L1,${0.5+G} M0,${0.5-G} L${0.5-q},${0.5-G} L${0.5-q},0 M1,${0.5-G} L${0.5+q},${0.5-G} L${0.5+q},0`},"":{1:(q,G)=>`M.5,0 L.5,1 M0,${0.5-G} L1,${0.5-G} M0,${0.5+G} L1,${0.5+G}`},"":{1:(q,G)=>`M0,.5 L1,.5 M${0.5-q},0 L${0.5-q},1 M${0.5+q},0 L${0.5+q},1`},"":{1:(q,G)=>`M0,${0.5+G} L${0.5-q},${0.5+G} L${0.5-q},1 M1,${0.5+G} L${0.5+q},${0.5+G} L${0.5+q},1 M0,${0.5-G} L${0.5-q},${0.5-G} L${0.5-q},0 M1,${0.5-G} L${0.5+q},${0.5-G} L${0.5+q},0`},"":{1:"M1,0 L0,1"},"":{1:"M0,0 L1,1"},"":{1:"M1,0 L0,1 M0,0 L1,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"":{1:(q,G)=>`M.5,1 L.5,${0.5+G/0.15*0.5} C.5,${0.5+G/0.15*0.5},.5,.5,1,.5`},"":{1:(q,G)=>`M.5,1 L.5,${0.5+G/0.15*0.5} C.5,${0.5+G/0.15*0.5},.5,.5,0,.5`},"":{1:(q,G)=>`M.5,0 L.5,${0.5-G/0.15*0.5} C.5,${0.5-G/0.15*0.5},.5,.5,0,.5`},"":{1:(q,G)=>`M.5,0 L.5,${0.5-G/0.15*0.5} C.5,${0.5-G/0.15*0.5},.5,.5,1,.5`}},y7={"":{d:"M.3,1 L.03,1 L.03,.88 C.03,.82,.06,.78,.11,.73 C.15,.7,.2,.68,.28,.65 L.43,.6 C.49,.58,.53,.56,.56,.53 C.59,.5,.6,.47,.6,.43 L.6,.27 L.4,.27 L.69,.1 L.98,.27 L.78,.27 L.78,.46 C.78,.52,.76,.56,.72,.61 C.68,.66,.63,.67,.56,.7 L.48,.72 C.42,.74,.38,.76,.35,.78 C.32,.8,.31,.84,.31,.88 L.31,1 M.3,.5 L.03,.59 L.03,.09 L.3,.09 L.3,.655",type:0},"":{d:"M.7,.4 L.7,.47 L.2,.47 L.2,.03 L.355,.03 L.355,.4 L.705,.4 M.7,.5 L.86,.5 L.86,.95 L.69,.95 L.44,.66 L.46,.86 L.46,.95 L.3,.95 L.3,.49 L.46,.49 L.71,.78 L.69,.565 L.69,.5",type:0},"":{d:"M.25,.94 C.16,.94,.11,.92,.11,.87 L.11,.53 C.11,.48,.15,.455,.23,.45 L.23,.3 C.23,.25,.26,.22,.31,.19 C.36,.16,.43,.15,.51,.15 C.59,.15,.66,.16,.71,.19 C.77,.22,.79,.26,.79,.3 L.79,.45 C.87,.45,.91,.48,.91,.53 L.91,.87 C.91,.92,.86,.94,.77,.94 L.24,.94 M.53,.2 C.49,.2,.45,.21,.42,.23 C.39,.25,.38,.27,.38,.3 L.38,.45 L.68,.45 L.68,.3 C.68,.27,.67,.25,.64,.23 C.61,.21,.58,.2,.53,.2 M.58,.82 L.58,.66 C.63,.65,.65,.63,.65,.6 C.65,.58,.64,.57,.61,.56 C.58,.55,.56,.54,.52,.54 C.48,.54,.46,.55,.43,.56 C.4,.57,.39,.59,.39,.6 C.39,.63,.41,.64,.46,.66 L.46,.82 L.57,.82",type:0},"":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}};y7[""]=y7[""];y7[""]=y7[""];function nJ(q,G,J,Z,$,Y,K,X){let j=lJ[G];if(j)return rJ(q,j,J,Z,$,Y),!0;let V=oJ[G];if(V)return iJ(q,V,J,Z,$,Y),!0;let B=sJ[G];if(B)return tJ(q,B,J,Z,$,Y,X),!0;let z=y7[G];return z?(eJ(q,z,J,Z,$,Y,K,X),!0):!1}function rJ(q,G,J,Z,$,Y){for(let K=0;K<G.length;K++){let X=G[K],j=$/8,V=Y/8;q.fillRect(J+X.x*j,Z+X.y*V,X.w*j,X.h*V)}}var B4=new Map;function iJ(q,G,J,Z,$,Y){let K=B4.get(G);K||(K=new Map,B4.set(G,K));let X=q.fillStyle;if(typeof X!="string")throw Error(`Unexpected fillStyle type "${X}"`);let j=K.get(X);if(!j){let V=G[0].length,B=G.length,z=q.canvas.ownerDocument.createElement("canvas");z.width=V,z.height=B;let H=B5(z.getContext("2d")),F=new ImageData(V,B),C,M,k,I;if(X.startsWith("#"))C=parseInt(X.slice(1,3),16),M=parseInt(X.slice(3,5),16),k=parseInt(X.slice(5,7),16),I=X.length>7&&parseInt(X.slice(7,9),16)||1;else if(X.startsWith("rgba"))[C,M,k,I]=X.substring(5,X.length-1).split(",").map((_)=>parseFloat(_));else throw Error(`Unexpected fillStyle color format "${X}" when drawing pattern glyph`);for(let _=0;_<B;_++)for(let S=0;S<V;S++)F.data[(_*V+S)*4]=C,F.data[(_*V+S)*4+1]=M,F.data[(_*V+S)*4+2]=k,F.data[(_*V+S)*4+3]=G[_][S]*(I*255);H.putImageData(F,0,0),j=B5(q.createPattern(z,null)),K.set(X,j)}q.fillStyle=j,q.fillRect(J,Z,$,Y)}function tJ(q,G,J,Z,$,Y,K){q.strokeStyle=q.fillStyle;for(let[X,j]of Object.entries(G)){q.beginPath(),q.lineWidth=K*Number.parseInt(X);let V;if(typeof j=="function"){let B=0.15/Y*$;V=j(0.15,B)}else V=j;for(let B of V.split(" ")){let z=B[0],H=t4[z];if(!H){console.error(`Could not find drawing instructions for "${z}"`);continue}let F=B.substring(1).split(",");!F[0]||!F[1]||H(q,e4(F,$,Y,J,Z,!0,K))}q.stroke(),q.closePath()}}function eJ(q,G,J,Z,$,Y,K,X){let j=new Path2D;j.rect(J,Z,$,Y),q.clip(j),q.beginPath();let V=K/12;q.lineWidth=X*V;for(let B of G.d.split(" ")){let z=B[0],H=t4[z];if(!H){console.error(`Could not find drawing instructions for "${z}"`);continue}let F=B.substring(1).split(",");!F[0]||!F[1]||H(q,e4(F,$,Y,J,Z,!1,X,(G.leftPadding??0)*(V/2),(G.rightPadding??0)*(V/2)))}G.type===1?(q.strokeStyle=q.fillStyle,q.stroke()):q.fill(),q.closePath()}function H4(q,G,J=0){return Math.max(Math.min(q,G),J)}var t4={C:(q,G)=>q.bezierCurveTo(G[0],G[1],G[2],G[3],G[4],G[5]),L:(q,G)=>q.lineTo(G[0],G[1]),M:(q,G)=>q.moveTo(G[0],G[1])};function e4(q,G,J,Z,$,Y,K,X=0,j=0){let V=q.map((B)=>parseFloat(B)||parseInt(B));if(V.length<2)throw Error("Too few arguments for instruction");for(let B=0;B<V.length;B+=2)V[B]*=G-X*K-j*K,Y&&V[B]!==0&&(V[B]=H4(Math.round(V[B]+0.5)-0.5,G,0)),V[B]+=Z+X*K;for(let B=1;B<V.length;B+=2)V[B]*=J,Y&&V[B]!==0&&(V[B]=H4(Math.round(V[B]+0.5)-0.5,J,0)),V[B]+=$;return V}var F4=class{constructor(){this._data={}}set(q,G,J){this._data[q]||(this._data[q]={}),this._data[q][G]=J}get(q,G){return this._data[q]?this._data[q][G]:void 0}clear(){this._data={}}},C4=class{constructor(){this._data=new F4}set(q,G,J,Z,$){this._data.get(q,G)||this._data.set(q,G,new F4),this._data.get(q,G).set(J,Z,$)}get(q,G,J,Z){return this._data.get(q,G)?.get(J,Z)}clear(){this._data.clear()}},q2=class{constructor(){this._tasks=[],this._i=0}enqueue(q){this._tasks.push(q),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(q){this._idleCallback=void 0;let G=0,J=0,Z=q.timeRemaining(),$=0;for(;this._i<this._tasks.length;){if(G=performance.now(),this._tasks[this._i]()||this._i++,G=Math.max(1,performance.now()-G),J=Math.max(G,J),$=q.timeRemaining(),J*1.5>$){Z-G<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(Z-G))}ms`),this._start();return}Z=$}this.clear()}},qZ=class extends q2{_requestCallback(q){return setTimeout(()=>q(this._createDeadline(16)))}_cancelCallback(q){clearTimeout(q)}_createDeadline(q){let G=performance.now()+q;return{timeRemaining:()=>Math.max(0,G-performance.now())}}},GZ=class extends q2{_requestCallback(q){return requestIdleCallback(q)}_cancelCallback(q){cancelIdleCallback(q)}},JZ=!i9&&"requestIdleCallback"in window?GZ:qZ,n6=class q{constructor(){this.fg=0,this.bg=0,this.extended=new G2}static toColorRGB(G){return[G>>>16&255,G>>>8&255,G&255]}static fromColorRGB(G){return(G[0]&255)<<16|(G[1]&255)<<8|G[2]&255}clone(){let G=new q;return G.fg=this.fg,G.bg=this.bg,G.extended=this.extended.clone(),G}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},G2=class q{constructor(G=0,J=0){this._ext=0,this._urlId=0,this._ext=G,this._urlId=J}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(G){this._ext=G}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(G){this._ext&=-469762049,this._ext|=G<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(G){this._ext&=-67108864,this._ext|=G&67108863}get urlId(){return this._urlId}set urlId(G){this._urlId=G}get underlineVariantOffset(){let G=(this._ext&3758096384)>>29;return G<0?G^4294967288:G}set underlineVariantOffset(G){this._ext&=536870911,this._ext|=G<<29&3758096384}clone(){return new q(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},N4=class q{constructor(G){this.element=G,this.next=q.Undefined,this.prev=q.Undefined}};N4.Undefined=new N4(void 0);var ZZ=globalThis.performance&&typeof globalThis.performance.now=="function",$Z=class q{static create(G){return new q(G)}constructor(G){this._now=ZZ&&G===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},YZ=!1,U4=!1,KZ=!1,M6;((q)=>{q.None=()=>u5.None;function G(N){if(KZ){let{onDidAddListener:U}=N,W=l9.create(),Q=0;N.onDidAddListener=()=>{++Q===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),W.print()),U?.()}}}function J(N,U){return H(N,()=>{},0,void 0,!0,void 0,U)}q.defer=J;function Z(N){return(U,W=null,Q)=>{let P=!1,D;return D=N((A)=>{if(!P)return D?D.dispose():P=!0,U.call(W,A)},null,Q),P&&D.dispose(),D}}q.once=Z;function $(N,U,W){return B((Q,P=null,D)=>N((A)=>Q.call(P,U(A)),null,D),W)}q.map=$;function Y(N,U,W){return B((Q,P=null,D)=>N((A)=>{U(A),Q.call(P,A)},null,D),W)}q.forEach=Y;function K(N,U,W){return B((Q,P=null,D)=>N((A)=>U(A)&&Q.call(P,A),null,D),W)}q.filter=K;function X(N){return N}q.signal=X;function j(...N){return(U,W=null,Q)=>{let P=o4(...N.map((D)=>D((A)=>U.call(W,A))));return z(P,Q)}}q.any=j;function V(N,U,W,Q){let P=W;return $(N,(D)=>(P=U(P,D),P),Q)}q.reduce=V;function B(N,U){let W,Q={onWillAddFirstListener(){W=N(P.fire,P)},onDidRemoveLastListener(){W?.dispose()}};U||G(Q);let P=new s(Q);return U?.add(P),P.event}function z(N,U){return U instanceof Array?U.push(N):U&&U.add(N),N}function H(N,U,W=100,Q=!1,P=!1,D,A){let L,v,d,p=0,u,A5={leakWarningThreshold:D,onWillAddFirstListener(){L=N((X5)=>{p++,v=U(v,X5),Q&&!d&&(c.fire(v),v=void 0),u=()=>{let a=v;v=void 0,d=void 0,(!Q||p>1)&&c.fire(a),p=0},typeof W=="number"?(clearTimeout(d),d=setTimeout(u,W)):d===void 0&&(d=0,queueMicrotask(u))})},onWillRemoveListener(){P&&p>0&&u?.()},onDidRemoveLastListener(){u=void 0,L.dispose()}};A||G(A5);let c=new s(A5);return A?.add(c),c.event}q.debounce=H;function F(N,U=0,W){return q.debounce(N,(Q,P)=>Q?(Q.push(P),Q):[P],U,void 0,!0,void 0,W)}q.accumulate=F;function C(N,U=(Q,P)=>Q===P,W){let Q=!0,P;return K(N,(D)=>{let A=Q||!U(D,P);return Q=!1,P=D,A},W)}q.latch=C;function M(N,U,W){return[q.filter(N,U,W),q.filter(N,(Q)=>!U(Q),W)]}q.split=M;function k(N,U=!1,W=[],Q){let P=W.slice(),D=N((v)=>{P?P.push(v):L.fire(v)});Q&&Q.add(D);let A=()=>{P?.forEach((v)=>L.fire(v)),P=null},L=new s({onWillAddFirstListener(){D||(D=N((v)=>L.fire(v)),Q&&Q.add(D))},onDidAddFirstListener(){P&&(U?setTimeout(A):A())},onDidRemoveLastListener(){D&&D.dispose(),D=null}});return Q&&Q.add(L),L.event}q.buffer=k;function I(N,U){return(W,Q,P)=>{let D=U(new S);return N(function(A){let L=D.evaluate(A);L!==_&&W.call(Q,L)},void 0,P)}}q.chain=I;let _=Symbol("HaltChainable");class S{constructor(){this.steps=[]}map(N){return this.steps.push(N),this}forEach(N){return this.steps.push((U)=>(N(U),U)),this}filter(N){return this.steps.push((U)=>N(U)?U:_),this}reduce(N,U){let W=U;return this.steps.push((Q)=>(W=N(W,Q),W)),this}latch(N=(U,W)=>U===W){let U=!0,W;return this.steps.push((Q)=>{let P=U||!N(Q,W);return U=!1,W=Q,P?Q:_}),this}evaluate(N){for(let U of this.steps)if(N=U(N),N===_)break;return N}}function O(N,U,W=(Q)=>Q){let Q=(...L)=>A.fire(W(...L)),P=()=>N.on(U,Q),D=()=>N.removeListener(U,Q),A=new s({onWillAddFirstListener:P,onDidRemoveLastListener:D});return A.event}q.fromNodeEventEmitter=O;function w(N,U,W=(Q)=>Q){let Q=(...L)=>A.fire(W(...L)),P=()=>N.addEventListener(U,Q),D=()=>N.removeEventListener(U,Q),A=new s({onWillAddFirstListener:P,onDidRemoveLastListener:D});return A.event}q.fromDOMEventEmitter=w;function T(N){return new Promise((U)=>Z(N)(U))}q.toPromise=T;function f(N){let U=new s;return N.then((W)=>{U.fire(W)},()=>{U.fire(void 0)}).finally(()=>{U.dispose()}),U.event}q.fromPromise=f;function o(N,U){return N((W)=>U.fire(W))}q.forward=o;function K5(N,U,W){return U(W),N((Q)=>U(Q))}q.runAndSubscribe=K5;class S5{constructor(N,U){this._observable=N,this._counter=0,this._hasChanged=!1;let W={onWillAddFirstListener:()=>{N.addObserver(this)},onDidRemoveLastListener:()=>{N.removeObserver(this)}};U||G(W),this.emitter=new s(W),U&&U.add(this.emitter)}beginUpdate(N){this._counter++}handlePossibleChange(N){}handleChange(N,U){this._hasChanged=!0}endUpdate(N){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function E(N,U){return new S5(N,U).emitter.event}q.fromObservable=E;function d5(N){return(U,W,Q)=>{let P=0,D=!1,A={beginUpdate(){P++},endUpdate(){P--,P===0&&(N.reportChanges(),D&&(D=!1,U.call(W)))},handlePossibleChange(){},handleChange(){D=!0}};N.addObserver(A),N.reportChanges();let L={dispose(){N.removeObserver(A)}};return Q instanceof i6?Q.add(L):Array.isArray(Q)&&Q.push(L),L}}q.fromObservableLight=d5})(M6||={});var a9=class q{constructor(G){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${G}_${q._idPool++}`,q.all.add(this)}start(G){this._stopWatch=new $Z,this.listenerCount=G}stop(){if(this._stopWatch){let G=this._stopWatch.elapsed();this.durations.push(G),this.elapsedOverall+=G,this.invocationCount+=1,this._stopWatch=void 0}}};a9.all=new Set,a9._idPool=0;var XZ=a9,M4=-1,J2=class q{constructor(G,J,Z=(q._idPool++).toString(16).padStart(3,"0")){this._errorHandler=G,this.threshold=J,this.name=Z,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(G,J){let Z=this.threshold;if(Z<=0||J<Z)return;this._stacks||(this._stacks=new Map);let $=this._stacks.get(G.value)||0;if(this._stacks.set(G.value,$+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=Z*0.5;let[Y,K]=this.getMostFrequentStack(),X=`[${this.name}] potential listener LEAK detected, having ${J} listeners already. MOST frequent listener (${K}):`;console.warn(X),console.warn(Y);let j=new jZ(X,Y);this._errorHandler(j)}return()=>{let Y=this._stacks.get(G.value)||0;this._stacks.set(G.value,Y-1)}}getMostFrequentStack(){if(!this._stacks)return;let G,J=0;for(let[Z,$]of this._stacks)(!G||J<$)&&(G=[Z,$],J=$);return G}};J2._idPool=1;var VZ=J2,l9=class q{constructor(G){this.value=G}static create(){let G=Error();return new q(G.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},jZ=class extends Error{constructor(q,G){super(q),this.name="ListenerLeakError",this.stack=G}},zZ=class extends Error{constructor(q,G){super(q),this.name="ListenerRefusalError",this.stack=G}},BZ=0,H8=class{constructor(q){this.value=q,this.id=BZ++}},HZ=2,FZ=(q,G)=>{if(q instanceof H8)G(q);else for(let J=0;J<q.length;J++){let Z=q[J];Z&&G(Z)}},F8;if(YZ){let q=[];setInterval(()=>{q.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(q.join(`
`)),q.length=0)},3000),F8=new FinalizationRegistry((G)=>{typeof G=="string"&&q.push(G)})}var s=class{constructor(q){this._size=0,this._options=q,this._leakageMon=M4>0||this._options?.leakWarningThreshold?new VZ(q?.onListenerError??B8,this._options?.leakWarningThreshold??M4):void 0,this._perfMon=this._options?._profName?new XZ(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(U4){let q=this._listeners;queueMicrotask(()=>{FZ(q,(G)=>G.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(q,G,J)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let X=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(X);let j=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],V=new zZ(`${X}. HINT: Stack shows most frequent listener (${j[1]}-times)`,j[0]);return(this._options?.onListenerError||B8)(V),u5.None}if(this._disposed)return u5.None;G&&(q=q.bind(G));let Z=new H8(q),$,Y;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*0.2)&&(Z.stack=l9.create(),$=this._leakageMon.check(Z.stack,this._size+1)),U4&&(Z.stack=Y??l9.create()),this._listeners?this._listeners instanceof H8?(this._deliveryQueue??=new CZ,this._listeners=[this._listeners,Z]):this._listeners.push(Z):(this._options?.onWillAddFirstListener?.(this),this._listeners=Z,this._options?.onDidAddFirstListener?.(this)),this._size++;let K=x5(()=>{F8?.unregister(K),$?.(),this._removeListener(Z)});if(J instanceof i6?J.add(K):Array.isArray(J)&&J.push(K),F8){let X=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),j=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(X);F8.register(K,j?.[2]??X,K)}return K},this._event}_removeListener(q){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let G=this._listeners,J=G.indexOf(q);if(J===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,G[J]=void 0;let Z=this._deliveryQueue.current===this;if(this._size*HZ<=G.length){let $=0;for(let Y=0;Y<G.length;Y++)G[Y]?G[$++]=G[Y]:Z&&(this._deliveryQueue.end--,$<this._deliveryQueue.i&&this._deliveryQueue.i--);G.length=$}}_deliver(q,G){if(!q)return;let J=this._options?.onListenerError||B8;if(!J){q.value(G);return}try{q.value(G)}catch(Z){J(Z)}}_deliverQueue(q){let G=q.current._listeners;for(;q.i<q.end;)this._deliver(G[q.i++],q.value);q.reset()}fire(q){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof H8)this._deliver(this._listeners,q);else{let G=this._deliveryQueue;G.enqueue(this,q,this._listeners.length),this._deliverQueue(G)}this._perfMon?.stop()}hasListeners(){return this._size>0}},CZ=class{constructor(){this.i=-1,this.end=0}enqueue(q,G,J){this.i=0,this.end=J,this.current=q,this.value=G}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},D4={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},A7=2,k7,I6=class q{constructor(G,J,Z){this._document=G,this._config=J,this._unicodeService=Z,this._didWarmUp=!1,this._cacheMap=new C4,this._cacheMapCombined=new C4,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new n6,this._textureSize=512,this._onAddTextureAtlasCanvas=new s,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new s,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=Z2(G,this._config.deviceCellWidth*4+A7*2,this._config.deviceCellHeight+A7*2),this._tmpCtx=B5(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}get pages(){return this._pages}dispose(){this._tmpCanvas.remove();for(let G of this.pages)G.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){let G=new JZ;for(let J=33;J<126;J++)G.enqueue(()=>{if(!this._cacheMap.get(J,0,0,0)){let Z=this._drawToCache(J,0,0,0,!1,void 0);this._cacheMap.set(J,0,0,0,Z)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(!(this._pages[0].currentRow.x===0&&this._pages[0].currentRow.y===0)){for(let G of this._pages)G.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(q.maxAtlasPages&&this._pages.length>=Math.max(4,q.maxAtlasPages)){let J=this._pages.filter((V)=>V.canvas.width*2<=(q.maxTextureSize||4096)).sort((V,B)=>B.canvas.width!==V.canvas.width?B.canvas.width-V.canvas.width:B.percentageUsed-V.percentageUsed),Z=-1,$=0;for(let V=0;V<J.length;V++)if(J[V].canvas.width!==$)Z=V,$=J[V].canvas.width;else if(V-Z===3)break;let Y=J.slice(Z,Z+4),K=Y.map((V)=>V.glyphs[0].texturePage).sort((V,B)=>V>B?1:-1),X=this.pages.length-Y.length,j=this._mergePages(Y,X);j.version++;for(let V=K.length-1;V>=0;V--)this._deletePage(K[V]);this.pages.push(j),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(j.canvas)}let G=new I9(this._document,this._textureSize);return this._pages.push(G),this._activePages.push(G),this._onAddTextureAtlasCanvas.fire(G.canvas),G}_mergePages(G,J){let Z=G[0].canvas.width*2,$=new I9(this._document,Z,G);for(let[Y,K]of G.entries()){let X=Y*K.canvas.width%Z,j=Math.floor(Y/2)*K.canvas.height;$.ctx.drawImage(K.canvas,X,j);for(let B of K.glyphs)B.texturePage=J,B.sizeClipSpace.x=B.size.x/Z,B.sizeClipSpace.y=B.size.y/Z,B.texturePosition.x+=X,B.texturePosition.y+=j,B.texturePositionClipSpace.x=B.texturePosition.x/Z,B.texturePositionClipSpace.y=B.texturePosition.y/Z;this._onRemoveTextureAtlasCanvas.fire(K.canvas);let V=this._activePages.indexOf(K);V!==-1&&this._activePages.splice(V,1)}return $}_deletePage(G){this._pages.splice(G,1);for(let J=G;J<this._pages.length;J++){let Z=this._pages[J];for(let $ of Z.glyphs)$.texturePage--;Z.version++}}getRasterizedGlyphCombinedChar(G,J,Z,$,Y,K){return this._getFromCacheMap(this._cacheMapCombined,G,J,Z,$,Y,K)}getRasterizedGlyph(G,J,Z,$,Y,K){return this._getFromCacheMap(this._cacheMap,G,J,Z,$,Y,K)}_getFromCacheMap(G,J,Z,$,Y,K,X){return k7=G.get(J,Z,$,Y),k7||(k7=this._drawToCache(J,Z,$,Y,K,X),G.set(J,Z,$,Y,k7)),k7}_getColorFromAnsiIndex(G){if(G>=this._config.colors.ansi.length)throw Error("No color found for idx "+G);return this._config.colors.ansi[G]}_getBackgroundColor(G,J,Z,$){if(this._config.allowTransparency)return o5;let Y;switch(G){case 16777216:case 33554432:Y=this._getColorFromAnsiIndex(J);break;case 50331648:let K=n6.toColorRGB(J);Y=_5.toColor(K[0],K[1],K[2]);break;case 0:default:Z?Y=S7.opaque(this._config.colors.foreground):Y=this._config.colors.background;break}return this._config.allowTransparency||(Y=S7.opaque(Y)),Y}_getForegroundColor(G,J,Z,$,Y,K,X,j,V,B){let z=this._getMinimumContrastColor(G,J,Z,$,Y,K,X,V,j,B);if(z)return z;let H;switch(Y){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&V&&K<8&&(K+=8),H=this._getColorFromAnsiIndex(K);break;case 50331648:let F=n6.toColorRGB(K);H=_5.toColor(F[0],F[1],F[2]);break;case 0:default:X?H=this._config.colors.background:H=this._config.colors.foreground}return this._config.allowTransparency&&(H=S7.opaque(H)),j&&(H=S7.multiplyOpacity(H,aJ)),H}_resolveBackgroundRgba(G,J,Z){switch(G){case 16777216:case 33554432:return this._getColorFromAnsiIndex(J).rgba;case 50331648:return J<<8;case 0:default:return Z?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(G,J,Z,$){switch(G){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&$&&J<8&&(J+=8),this._getColorFromAnsiIndex(J).rgba;case 50331648:return J<<8;case 0:default:return Z?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(G,J,Z,$,Y,K,X,j,V,B){if(this._config.minimumContrastRatio===1||B)return;let z=this._getContrastCache(V),H=z.getColor(G,$);if(H!==void 0)return H||void 0;let F=this._resolveBackgroundRgba(J,Z,X),C=this._resolveForegroundRgba(Y,K,X,j),M=u6.ensureContrastRatio(F,C,this._config.minimumContrastRatio/(V?2:1));if(!M){z.setColor(G,$,null);return}let k=_5.toColor(M>>24&255,M>>16&255,M>>8&255);return z.setColor(G,$,k),k}_getContrastCache(G){return G?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(G,J,Z,$,Y,K){let X=typeof G=="number"?String.fromCharCode(G):G;K&&this._tmpCanvas.parentElement!==K&&(this._tmpCanvas.style.display="none",K.append(this._tmpCanvas));let j=Math.min(this._config.deviceCellWidth*Math.max(X.length,2)+A7*2,this._config.deviceMaxTextureSize);this._tmpCanvas.width<j&&(this._tmpCanvas.width=j);let V=Math.min(this._config.deviceCellHeight+A7*4,this._textureSize);if(this._tmpCanvas.height<V&&(this._tmpCanvas.height=V),this._tmpCtx.save(),this._workAttributeData.fg=Z,this._workAttributeData.bg=J,this._workAttributeData.extended.ext=$,!!this._workAttributeData.isInvisible())return D4;let B=!!this._workAttributeData.isBold(),z=!!this._workAttributeData.isInverse(),H=!!this._workAttributeData.isDim(),F=!!this._workAttributeData.isItalic(),C=!!this._workAttributeData.isUnderline(),M=!!this._workAttributeData.isStrikethrough(),k=!!this._workAttributeData.isOverline(),I=this._workAttributeData.getFgColor(),_=this._workAttributeData.getFgColorMode(),S=this._workAttributeData.getBgColor(),O=this._workAttributeData.getBgColorMode();if(z){let L=I;I=S,S=L;let v=_;_=O,O=v}let w=this._getBackgroundColor(O,S,z,H);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=w.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let T=B?this._config.fontWeightBold:this._config.fontWeight,f=F?"italic":"";this._tmpCtx.font=`${f} ${T} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=i4;let o=X.length===1&&e9(X.charCodeAt(0)),K5=X.length===1&&gJ(X.charCodeAt(0)),S5=this._getForegroundColor(J,O,S,Z,_,I,z,H,B,r4(X.charCodeAt(0)));this._tmpCtx.fillStyle=S5.css;let E=K5?0:A7*2,d5=!1;this._config.customGlyphs!==!1&&(d5=nJ(this._tmpCtx,X,E,E,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let N=!o,U;if(typeof G=="number"?U=this._unicodeService.wcwidth(G):U=this._unicodeService.getStringCellWidth(G),C){this._tmpCtx.save();let L=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),v=L%2===1?0.5:0;if(this._tmpCtx.lineWidth=L,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())N=!1,this._tmpCtx.strokeStyle=`rgb(${n6.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{N=!1;let X5=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&X5<8&&(X5+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(X5).css}this._tmpCtx.beginPath();let d=E,p=Math.ceil(E+this._config.deviceCharHeight)-v-(Y?L*2:0),u=p+L,A5=p+L*2,c=this._workAttributeData.getUnderlineVariantOffset();for(let X5=0;X5<U;X5++){this._tmpCtx.save();let a=d+X5*this._config.deviceCellWidth,q5=d+(X5+1)*this._config.deviceCellWidth,P6=a+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(a,p),this._tmpCtx.lineTo(q5,p),this._tmpCtx.moveTo(a,A5),this._tmpCtx.lineTo(q5,A5);break;case 3:let i5=L<=1?A5:Math.ceil(E+this._config.deviceCharHeight-L/2)-v,b5=L<=1?p:Math.ceil(E+this._config.deviceCharHeight+L/2)-v,h=new Path2D;h.rect(a,p,this._config.deviceCellWidth,A5-p),this._tmpCtx.clip(h),this._tmpCtx.moveTo(a-this._config.deviceCellWidth/2,u),this._tmpCtx.bezierCurveTo(a-this._config.deviceCellWidth/2,b5,a,b5,a,u),this._tmpCtx.bezierCurveTo(a,i5,P6,i5,P6,u),this._tmpCtx.bezierCurveTo(P6,b5,q5,b5,q5,u),this._tmpCtx.bezierCurveTo(q5,i5,q5+this._config.deviceCellWidth/2,i5,q5+this._config.deviceCellWidth/2,u);break;case 4:let W6=c===0?0:c>=L?L*2-c:L-c;!(c>=L)===!1||W6===0?(this._tmpCtx.setLineDash([Math.round(L),Math.round(L)]),this._tmpCtx.moveTo(a+W6,p),this._tmpCtx.lineTo(q5,p)):(this._tmpCtx.setLineDash([Math.round(L),Math.round(L)]),this._tmpCtx.moveTo(a,p),this._tmpCtx.lineTo(a+W6,p),this._tmpCtx.moveTo(a+W6+L,p),this._tmpCtx.lineTo(q5,p)),c=dJ(q5-a,L,c);break;case 5:let D2=0.6,Q2=0.3,A8=q5-a,V0=Math.floor(D2*A8),j0=Math.floor(Q2*A8),P2=A8-V0-j0;this._tmpCtx.setLineDash([V0,j0,P2]),this._tmpCtx.moveTo(a,p),this._tmpCtx.lineTo(q5,p);break;case 1:default:this._tmpCtx.moveTo(a,p),this._tmpCtx.lineTo(q5,p);break}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!d5&&this._config.fontSize>=12&&!this._config.allowTransparency&&X!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let X5=this._tmpCtx.measureText(X);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in X5&&X5.actualBoundingBoxDescent>0){this._tmpCtx.save();let a=new Path2D;a.rect(d,p-Math.ceil(L/2),this._config.deviceCellWidth*U,A5-p+Math.ceil(L/2)),this._tmpCtx.clip(a),this._tmpCtx.lineWidth=this._config.devicePixelRatio*3,this._tmpCtx.strokeStyle=w.css,this._tmpCtx.strokeText(X,E,E+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(k){let L=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),v=L%2===1?0.5:0;this._tmpCtx.lineWidth=L,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(E,E+v),this._tmpCtx.lineTo(E+this._config.deviceCharWidth*U,E+v),this._tmpCtx.stroke()}if(d5||this._tmpCtx.fillText(X,E,E+this._config.deviceCharHeight),X==="_"&&!this._config.allowTransparency){let L=T9(this._tmpCtx.getImageData(E,E,this._config.deviceCellWidth,this._config.deviceCellHeight),w,S5,N);if(L)for(let v=1;v<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=w.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(X,E,E+this._config.deviceCharHeight-v),L=T9(this._tmpCtx.getImageData(E,E,this._config.deviceCellWidth,this._config.deviceCellHeight),w,S5,N),!!L);v++);}if(M){let L=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),v=this._tmpCtx.lineWidth%2===1?0.5:0;this._tmpCtx.lineWidth=L,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(E,E+Math.floor(this._config.deviceCharHeight/2)-v),this._tmpCtx.lineTo(E+this._config.deviceCharWidth*U,E+Math.floor(this._config.deviceCharHeight/2)-v),this._tmpCtx.stroke()}this._tmpCtx.restore();let W=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),Q;if(this._config.allowTransparency?Q=NZ(W):Q=T9(W,w,S5,N),Q)return D4;let P=this._findGlyphBoundingBox(W,this._workBoundingBox,j,K5,d5,E),D,A;for(;;){if(this._activePages.length===0){let L=this._createNewPage();D=L,A=L.currentRow,A.height=P.size.y;break}D=this._activePages[this._activePages.length-1],A=D.currentRow;for(let L of this._activePages)P.size.y<=L.currentRow.height&&(D=L,A=L.currentRow);for(let L=this._activePages.length-1;L>=0;L--)for(let v of this._activePages[L].fixedRows)v.height<=A.height&&P.size.y<=v.height&&(D=this._activePages[L],A=v);if(P.size.x>this._textureSize){this._overflowSizePage||(this._overflowSizePage=new I9(this._document,this._config.deviceMaxTextureSize),this.pages.push(this._overflowSizePage),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(this._overflowSizePage.canvas)),D=this._overflowSizePage,A=this._overflowSizePage.currentRow,A.x+P.size.x>=D.canvas.width&&(A.x=0,A.y+=A.height,A.height=0);break}if(A.y+P.size.y>=D.canvas.height||A.height>P.size.y+2){let L=!1;if(D.currentRow.y+D.currentRow.height+P.size.y>=D.canvas.height){let v;for(let d of this._activePages)if(d.currentRow.y+d.currentRow.height+P.size.y<d.canvas.height){v=d;break}if(v)D=v;else if(q.maxAtlasPages&&this._pages.length>=q.maxAtlasPages&&A.y+P.size.y<=D.canvas.height&&A.height>=P.size.y&&A.x+P.size.x<=D.canvas.width)L=!0;else{let d=this._createNewPage();D=d,A=d.currentRow,A.height=P.size.y,L=!0}}L||(D.currentRow.height>0&&D.fixedRows.push(D.currentRow),A={x:0,y:D.currentRow.y+D.currentRow.height,height:P.size.y},D.fixedRows.push(A),D.currentRow={x:0,y:A.y+A.height,height:0})}if(A.x+P.size.x<=D.canvas.width)break;A===D.currentRow?(A.x=0,A.y+=A.height,A.height=0):D.fixedRows.splice(D.fixedRows.indexOf(A),1)}return P.texturePage=this._pages.indexOf(D),P.texturePosition.x=A.x,P.texturePosition.y=A.y,P.texturePositionClipSpace.x=A.x/D.canvas.width,P.texturePositionClipSpace.y=A.y/D.canvas.height,P.sizeClipSpace.x/=D.canvas.width,P.sizeClipSpace.y/=D.canvas.height,A.height=Math.max(A.height,P.size.y),A.x+=P.size.x,D.ctx.putImageData(W,P.texturePosition.x-this._workBoundingBox.left,P.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,P.size.x,P.size.y),D.addGlyph(P),D.version++,P}_findGlyphBoundingBox(G,J,Z,$,Y,K){J.top=0;let X=$?this._config.deviceCellHeight:this._tmpCanvas.height,j=$?this._config.deviceCellWidth:Z,V=!1;for(let B=0;B<X;B++){for(let z=0;z<j;z++){let H=B*this._tmpCanvas.width*4+z*4+3;if(G.data[H]!==0){J.top=B,V=!0;break}}if(V)break}J.left=0,V=!1;for(let B=0;B<K+j;B++){for(let z=0;z<X;z++){let H=z*this._tmpCanvas.width*4+B*4+3;if(G.data[H]!==0){J.left=B,V=!0;break}}if(V)break}J.right=j,V=!1;for(let B=K+j-1;B>=K;B--){for(let z=0;z<X;z++){let H=z*this._tmpCanvas.width*4+B*4+3;if(G.data[H]!==0){J.right=B,V=!0;break}}if(V)break}J.bottom=X,V=!1;for(let B=X-1;B>=0;B--){for(let z=0;z<j;z++){let H=B*this._tmpCanvas.width*4+z*4+3;if(G.data[H]!==0){J.bottom=B,V=!0;break}}if(V)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:J.right-J.left+1,y:J.bottom-J.top+1},sizeClipSpace:{x:J.right-J.left+1,y:J.bottom-J.top+1},offset:{x:-J.left+K+($||Y?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-J.top+K+($||Y?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}},I9=class{constructor(q,G,J){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],J)for(let Z of J)this._glyphs.push(...Z.glyphs),this._usedPixels+=Z._usedPixels;this.canvas=Z2(q,G,G),this.ctx=B5(this.canvas.getContext("2d",{alpha:!0}))}get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(q){this._glyphs.push(q),this._usedPixels+=q.size.x*q.size.y}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}};function T9(q,G,J,Z){let $=G.rgba>>>24,Y=G.rgba>>>16&255,K=G.rgba>>>8&255,X=J.rgba>>>24,j=J.rgba>>>16&255,V=J.rgba>>>8&255,B=Math.floor((Math.abs($-X)+Math.abs(Y-j)+Math.abs(K-V))/12),z=!0;for(let H=0;H<q.data.length;H+=4)q.data[H]===$&&q.data[H+1]===Y&&q.data[H+2]===K||Z&&Math.abs(q.data[H]-$)+Math.abs(q.data[H+1]-Y)+Math.abs(q.data[H+2]-K)<B?q.data[H+3]=0:z=!1;return z}function NZ(q){for(let G=0;G<q.data.length;G+=4)if(q.data[G+3]>0)return!1;return!0}function Z2(q,G,J){let Z=q.createElement("canvas");return Z.width=G,Z.height=J,Z}function UZ(q,G,J,Z,$,Y,K,X){let j={foreground:Y.foreground,background:Y.background,cursor:o5,cursorAccent:o5,selectionForeground:o5,selectionBackgroundTransparent:o5,selectionBackgroundOpaque:o5,selectionInactiveBackgroundTransparent:o5,selectionInactiveBackgroundOpaque:o5,overviewRulerBorder:o5,scrollbarSliderBackground:o5,scrollbarSliderHoverBackground:o5,scrollbarSliderActiveBackground:o5,ansi:Y.ansi.slice(),contrastCache:Y.contrastCache,halfContrastCache:Y.halfContrastCache};return{customGlyphs:$.customGlyphs,devicePixelRatio:K,deviceMaxTextureSize:X,letterSpacing:$.letterSpacing,lineHeight:$.lineHeight,deviceCellWidth:q,deviceCellHeight:G,deviceCharWidth:J,deviceCharHeight:Z,fontFamily:$.fontFamily,fontSize:$.fontSize,fontWeight:$.fontWeight,fontWeightBold:$.fontWeightBold,allowTransparency:$.allowTransparency,drawBoldTextInBrightColors:$.drawBoldTextInBrightColors,minimumContrastRatio:$.minimumContrastRatio,colors:j}}function Q4(q,G){for(let J=0;J<q.colors.ansi.length;J++)if(q.colors.ansi[J].rgba!==G.colors.ansi[J].rgba)return!1;return q.devicePixelRatio===G.devicePixelRatio&&q.customGlyphs===G.customGlyphs&&q.lineHeight===G.lineHeight&&q.letterSpacing===G.letterSpacing&&q.fontFamily===G.fontFamily&&q.fontSize===G.fontSize&&q.fontWeight===G.fontWeight&&q.fontWeightBold===G.fontWeightBold&&q.allowTransparency===G.allowTransparency&&q.deviceCharWidth===G.deviceCharWidth&&q.deviceCharHeight===G.deviceCharHeight&&q.drawBoldTextInBrightColors===G.drawBoldTextInBrightColors&&q.minimumContrastRatio===G.minimumContrastRatio&&q.colors.foreground.rgba===G.colors.foreground.rgba&&q.colors.background.rgba===G.colors.background.rgba}function MZ(q){return(q&50331648)===16777216||(q&50331648)===33554432}var s5=[];function $2(q,G,J,Z,$,Y,K,X,j){let V=UZ(Z,$,Y,K,G,J,X,j);for(let H=0;H<s5.length;H++){let F=s5[H],C=F.ownedBy.indexOf(q);if(C>=0){if(Q4(F.config,V))return F.atlas;F.ownedBy.length===1?(F.atlas.dispose(),s5.splice(H,1)):F.ownedBy.splice(C,1);break}}for(let H=0;H<s5.length;H++){let F=s5[H];if(Q4(F.config,V))return F.ownedBy.push(q),F.atlas}let B=q._core,z={atlas:new I6(document,V,B.unicodeService),config:V,ownedBy:[q]};return s5.push(z),z.atlas}function P4(q){for(let G=0;G<s5.length;G++){let J=s5[G].ownedBy.indexOf(q);if(J!==-1){s5[G].ownedBy.length===1?(s5[G].atlas.dispose(),s5.splice(G,1)):s5[G].ownedBy.splice(J,1);break}}}var j8=600,DZ=class{constructor(q,G){this._renderCallback=q,this._coreBrowserService=G,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(q=j8){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let G=j8-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,G>0){this._restartInterval(G);return}}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let G=j8-(Date.now()-this._animationTimeRestarted);this._animationTimeRestarted=void 0,this._restartInterval(G);return}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},j8)},q)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}};function W4(q,G,J){let Z=new G.ResizeObserver(($)=>{let Y=$.find((j)=>j.target===q);if(!Y)return;if(!("devicePixelContentBoxSize"in Y)){Z?.disconnect(),Z=void 0;return}let K=Y.devicePixelContentBoxSize[0].inlineSize,X=Y.devicePixelContentBoxSize[0].blockSize;K>0&&X>0&&J(K,X)});try{Z.observe(q,{box:["device-pixel-content-box"]})}catch{Z.disconnect(),Z=void 0}return x5(()=>Z?.disconnect())}function QZ(q){return q>65535?(q-=65536,String.fromCharCode((q>>10)+55296)+String.fromCharCode(q%1024+56320)):String.fromCharCode(q)}var R4=class q extends n6{constructor(){super(...arguments);this.content=0,this.fg=0,this.bg=0,this.extended=new G2,this.combinedData=""}static fromCharData(G){let J=new q;return J.setFromCharData(G),J}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?QZ(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(G){this.fg=G[0],this.bg=0;let J=!1;if(G[1].length>2)J=!0;else if(G[1].length===2){let Z=G[1].charCodeAt(0);if(55296<=Z&&Z<=56319){let $=G[1].charCodeAt(1);56320<=$&&$<=57343?this.content=(Z-55296)*1024+$-56320+65536|G[2]<<22:J=!0}else J=!0}else this.content=G[1].charCodeAt(0)|G[2]<<22;J&&(this.combinedData=G[1],this.content=2097152|G[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},Y2=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]);function K2(q,G,J){let Z=B5(q.createProgram());if(q.attachShader(Z,B5(O4(q,q.VERTEX_SHADER,G))),q.attachShader(Z,B5(O4(q,q.FRAGMENT_SHADER,J))),q.linkProgram(Z),q.getProgramParameter(Z,q.LINK_STATUS))return Z;console.error(q.getProgramInfoLog(Z)),q.deleteProgram(Z)}function O4(q,G,J){let Z=B5(q.createShader(G));if(q.shaderSource(Z,J),q.compileShader(Z),q.getShaderParameter(Z,q.COMPILE_STATUS))return Z;console.error(q.getShaderInfoLog(Z)),q.deleteShader(Z)}function PZ(q,G){let J=Math.min(q.length*2,G),Z=new Float32Array(J);for(let $=0;$<q.length;$++)Z[$]=q[$];return Z}var WZ=class{constructor(q){this.texture=q,this.version=-1}},RZ=`#version 300 es
layout (location = 0) in vec2 a_unitquad;
layout (location = 1) in vec2 a_cellpos;
layout (location = 2) in vec2 a_offset;
layout (location = 3) in vec2 a_size;
layout (location = 4) in float a_texpage;
layout (location = 5) in vec2 a_texcoord;
layout (location = 6) in vec2 a_texsize;

uniform mat4 u_projection;
uniform vec2 u_resolution;

out vec2 v_texcoord;
flat out int v_texpage;

void main() {
  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_texpage = int(a_texpage);
  v_texcoord = a_texcoord + a_unitquad * a_texsize;
}`;function OZ(q){let G="";for(let J=1;J<q;J++)G+=` else if (v_texpage == ${J}) { outColor = texture(u_texture[${J}], v_texcoord); }`;return`#version 300 es
precision lowp float;

in vec2 v_texcoord;
flat in int v_texpage;

uniform sampler2D u_texture[${q}];

out vec4 outColor;

void main() {
  if (v_texpage == 0) {
    outColor = texture(u_texture[0], v_texcoord);
  } ${G}
}`}var T6=11,s6=T6*Float32Array.BYTES_PER_ELEMENT,AZ=2,$5=0,i,_9=0,L7=0,kZ=class extends u5{constructor(q,G,J,Z){super();this._terminal=q,this._gl=G,this._dimensions=J,this._optionsService=Z,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};let $=this._gl;I6.maxAtlasPages===void 0&&(I6.maxAtlasPages=Math.min(32,B5($.getParameter($.MAX_TEXTURE_IMAGE_UNITS))),I6.maxTextureSize=B5($.getParameter($.MAX_TEXTURE_SIZE))),this._program=B5(K2($,RZ,OZ(I6.maxAtlasPages))),this._register(x5(()=>$.deleteProgram(this._program))),this._projectionLocation=B5($.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=B5($.getUniformLocation(this._program,"u_resolution")),this._textureLocation=B5($.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=$.createVertexArray(),$.bindVertexArray(this._vertexArrayObject);let Y=new Float32Array([0,0,1,0,0,1,1,1]),K=$.createBuffer();this._register(x5(()=>$.deleteBuffer(K))),$.bindBuffer($.ARRAY_BUFFER,K),$.bufferData($.ARRAY_BUFFER,Y,$.STATIC_DRAW),$.enableVertexAttribArray(0),$.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);let X=new Uint8Array([0,1,2,3]),j=$.createBuffer();this._register(x5(()=>$.deleteBuffer(j))),$.bindBuffer($.ELEMENT_ARRAY_BUFFER,j),$.bufferData($.ELEMENT_ARRAY_BUFFER,X,$.STATIC_DRAW),this._attributesBuffer=B5($.createBuffer()),this._register(x5(()=>$.deleteBuffer(this._attributesBuffer))),$.bindBuffer($.ARRAY_BUFFER,this._attributesBuffer),$.enableVertexAttribArray(2),$.vertexAttribPointer(2,2,$.FLOAT,!1,s6,0),$.vertexAttribDivisor(2,1),$.enableVertexAttribArray(3),$.vertexAttribPointer(3,2,$.FLOAT,!1,s6,2*Float32Array.BYTES_PER_ELEMENT),$.vertexAttribDivisor(3,1),$.enableVertexAttribArray(4),$.vertexAttribPointer(4,1,$.FLOAT,!1,s6,4*Float32Array.BYTES_PER_ELEMENT),$.vertexAttribDivisor(4,1),$.enableVertexAttribArray(5),$.vertexAttribPointer(5,2,$.FLOAT,!1,s6,5*Float32Array.BYTES_PER_ELEMENT),$.vertexAttribDivisor(5,1),$.enableVertexAttribArray(6),$.vertexAttribPointer(6,2,$.FLOAT,!1,s6,7*Float32Array.BYTES_PER_ELEMENT),$.vertexAttribDivisor(6,1),$.enableVertexAttribArray(1),$.vertexAttribPointer(1,2,$.FLOAT,!1,s6,9*Float32Array.BYTES_PER_ELEMENT),$.vertexAttribDivisor(1,1),$.useProgram(this._program);let V=new Int32Array(I6.maxAtlasPages);for(let B=0;B<I6.maxAtlasPages;B++)V[B]=B;$.uniform1iv(this._textureLocation,V),$.uniformMatrix4fv(this._projectionLocation,!1,Y2),this._atlasTextures=[];for(let B=0;B<I6.maxAtlasPages;B++){let z=new WZ(B5($.createTexture()));this._register(x5(()=>$.deleteTexture(z.texture))),$.activeTexture($.TEXTURE0+B),$.bindTexture($.TEXTURE_2D,z.texture),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texImage2D($.TEXTURE_2D,0,$.RGBA,1,1,0,$.RGBA,$.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[B]=z}$.enable($.BLEND),$.blendFunc($.SRC_ALPHA,$.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return this._atlas?this._atlas.beginFrame():!0}updateCell(q,G,J,Z,$,Y,K,X,j){this._updateCell(this._vertices.attributes,q,G,J,Z,$,Y,K,X,j)}_updateCell(q,G,J,Z,$,Y,K,X,j,V){if($5=(J*this._terminal.cols+G)*T6,Z===0||Z===void 0){q.fill(0,$5,$5+T6-1-AZ);return}this._atlas&&(X&&X.length>1?i=this._atlas.getRasterizedGlyphCombinedChar(X,$,Y,K,!1,this._terminal.element):i=this._atlas.getRasterizedGlyph(Z,$,Y,K,!1,this._terminal.element),_9=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),$!==V&&i.offset.x>_9?(L7=i.offset.x-_9,q[$5]=-(i.offset.x-L7)+this._dimensions.device.char.left,q[$5+1]=-i.offset.y+this._dimensions.device.char.top,q[$5+2]=(i.size.x-L7)/this._dimensions.device.canvas.width,q[$5+3]=i.size.y/this._dimensions.device.canvas.height,q[$5+4]=i.texturePage,q[$5+5]=i.texturePositionClipSpace.x+L7/this._atlas.pages[i.texturePage].canvas.width,q[$5+6]=i.texturePositionClipSpace.y,q[$5+7]=i.sizeClipSpace.x-L7/this._atlas.pages[i.texturePage].canvas.width,q[$5+8]=i.sizeClipSpace.y):(q[$5]=-i.offset.x+this._dimensions.device.char.left,q[$5+1]=-i.offset.y+this._dimensions.device.char.top,q[$5+2]=i.size.x/this._dimensions.device.canvas.width,q[$5+3]=i.size.y/this._dimensions.device.canvas.height,q[$5+4]=i.texturePage,q[$5+5]=i.texturePositionClipSpace.x,q[$5+6]=i.texturePositionClipSpace.y,q[$5+7]=i.sizeClipSpace.x,q[$5+8]=i.sizeClipSpace.y),this._optionsService.rawOptions.rescaleOverlappingGlyphs&&hJ(Z,j,i.size.x,this._dimensions.device.cell.width)&&(q[$5+2]=(this._dimensions.device.cell.width-1)/this._dimensions.device.canvas.width))}clear(){let q=this._terminal,G=q.cols*q.rows*T6;this._vertices.count!==G?this._vertices.attributes=new Float32Array(G):this._vertices.attributes.fill(0);let J=0;for(;J<this._vertices.attributesBuffers.length;J++)this._vertices.count!==G?this._vertices.attributesBuffers[J]=new Float32Array(G):this._vertices.attributesBuffers[J].fill(0);this._vertices.count=G,J=0;for(let Z=0;Z<q.rows;Z++)for(let $=0;$<q.cols;$++)this._vertices.attributes[J+9]=$/q.cols,this._vertices.attributes[J+10]=Z/q.rows,J+=T6}handleResize(){let q=this._gl;q.useProgram(this._program),q.viewport(0,0,q.canvas.width,q.canvas.height),q.uniform2f(this._resolutionLocation,q.canvas.width,q.canvas.height),this.clear()}render(q){if(!this._atlas)return;let G=this._gl;G.useProgram(this._program),G.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;let J=this._vertices.attributesBuffers[this._activeBuffer],Z=0;for(let $=0;$<q.lineLengths.length;$++){let Y=$*this._terminal.cols*T6,K=this._vertices.attributes.subarray(Y,Y+q.lineLengths[$]*T6);J.set(K,Z),Z+=K.length}G.bindBuffer(G.ARRAY_BUFFER,this._attributesBuffer),G.bufferData(G.ARRAY_BUFFER,J.subarray(0,Z),G.STREAM_DRAW);for(let $=0;$<this._atlas.pages.length;$++)this._atlas.pages[$].version!==this._atlasTextures[$].version&&this._bindAtlasPageTexture(G,this._atlas,$);G.drawElementsInstanced(G.TRIANGLE_STRIP,4,G.UNSIGNED_BYTE,0,Z/T6)}setAtlas(q){this._atlas=q;for(let G of this._atlasTextures)G.version=-1}_bindAtlasPageTexture(q,G,J){q.activeTexture(q.TEXTURE0+J),q.bindTexture(q.TEXTURE_2D,this._atlasTextures[J].texture),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texImage2D(q.TEXTURE_2D,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,G.pages[J].canvas),q.generateMipmap(q.TEXTURE_2D),this._atlasTextures[J].version=G.pages[J].version}setDimensions(q){this._dimensions=q}},LZ=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(q,G,J,Z=!1){if(this.selectionStart=G,this.selectionEnd=J,!G||!J||G[0]===J[0]&&G[1]===J[1]){this.clear();return}let $=q.buffers.active.ydisp,Y=G[1]-$,K=J[1]-$,X=Math.max(Y,0),j=Math.min(K,q.rows-1);if(X>=q.rows||j<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=Z,this.viewportStartRow=Y,this.viewportEndRow=K,this.viewportCappedStartRow=X,this.viewportCappedEndRow=j,this.startCol=G[0],this.endCol=J[0]}isCellSelected(q,G,J){return this.hasSelection?(J-=q.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?G>=this.startCol&&J>=this.viewportCappedStartRow&&G<this.endCol&&J<=this.viewportCappedEndRow:G<this.startCol&&J>=this.viewportCappedStartRow&&G>=this.endCol&&J<=this.viewportCappedEndRow:J>this.viewportStartRow&&J<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&J===this.viewportStartRow&&G>=this.startCol&&G<this.endCol||this.viewportStartRow<this.viewportEndRow&&J===this.viewportEndRow&&G<this.endCol||this.viewportStartRow<this.viewportEndRow&&J===this.viewportStartRow&&G>=this.startCol):!1}};function xZ(){return new LZ}var Q8=4,C8=1,N8=2,v9=3,SZ=2147483648,wZ=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=xZ()}resize(q,G){let J=q*G*Q8;J!==this.cells.length&&(this.cells=new Uint32Array(J),this.lineLengths=new Uint32Array(G))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}},yZ=`#version 300 es
layout (location = 0) in vec2 a_position;
layout (location = 1) in vec2 a_size;
layout (location = 2) in vec4 a_color;
layout (location = 3) in vec2 a_unitquad;

uniform mat4 u_projection;

out vec4 v_color;

void main() {
  vec2 zeroToOne = a_position + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_color = a_color;
}`,IZ=`#version 300 es
precision lowp float;

in vec4 v_color;

out vec4 outColor;

void main() {
  outColor = v_color;
}`,U6=8,E9=U6*Float32Array.BYTES_PER_ELEMENT,TZ=20*U6,A4=class{constructor(){this.attributes=new Float32Array(TZ),this.count=0}},C6=0,k4=0,L4=0,x4=0,S4=0,w4=0,y4=0,_Z=class extends u5{constructor(q,G,J,Z){super();this._terminal=q,this._gl=G,this._dimensions=J,this._themeService=Z,this._vertices=new A4,this._verticesCursor=new A4;let $=this._gl;this._program=B5(K2($,yZ,IZ)),this._register(x5(()=>$.deleteProgram(this._program))),this._projectionLocation=B5($.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=$.createVertexArray(),$.bindVertexArray(this._vertexArrayObject);let Y=new Float32Array([0,0,1,0,0,1,1,1]),K=$.createBuffer();this._register(x5(()=>$.deleteBuffer(K))),$.bindBuffer($.ARRAY_BUFFER,K),$.bufferData($.ARRAY_BUFFER,Y,$.STATIC_DRAW),$.enableVertexAttribArray(3),$.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);let X=new Uint8Array([0,1,2,3]),j=$.createBuffer();this._register(x5(()=>$.deleteBuffer(j))),$.bindBuffer($.ELEMENT_ARRAY_BUFFER,j),$.bufferData($.ELEMENT_ARRAY_BUFFER,X,$.STATIC_DRAW),this._attributesBuffer=B5($.createBuffer()),this._register(x5(()=>$.deleteBuffer(this._attributesBuffer))),$.bindBuffer($.ARRAY_BUFFER,this._attributesBuffer),$.enableVertexAttribArray(0),$.vertexAttribPointer(0,2,$.FLOAT,!1,E9,0),$.vertexAttribDivisor(0,1),$.enableVertexAttribArray(1),$.vertexAttribPointer(1,2,$.FLOAT,!1,E9,2*Float32Array.BYTES_PER_ELEMENT),$.vertexAttribDivisor(1,1),$.enableVertexAttribArray(2),$.vertexAttribPointer(2,4,$.FLOAT,!1,E9,4*Float32Array.BYTES_PER_ELEMENT),$.vertexAttribDivisor(2,1),this._updateCachedColors(Z.colors),this._register(this._themeService.onChangeColors((V)=>{this._updateCachedColors(V),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices(q){let G=this._gl;G.useProgram(this._program),G.bindVertexArray(this._vertexArrayObject),G.uniformMatrix4fv(this._projectionLocation,!1,Y2),G.bindBuffer(G.ARRAY_BUFFER,this._attributesBuffer),G.bufferData(G.ARRAY_BUFFER,q.attributes,G.DYNAMIC_DRAW),G.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,G.UNSIGNED_BYTE,0,q.count)}handleResize(){this._updateViewportRectangle()}setDimensions(q){this._dimensions=q}_updateCachedColors(q){this._bgFloat=this._colorToFloat32Array(q.background),this._cursorFloat=this._colorToFloat32Array(q.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds(q){let G=this._terminal,J=this._vertices,Z=1,$,Y,K,X,j,V,B,z,H,F,C;for($=0;$<G.rows;$++){for(K=-1,X=0,j=0,V=!1,Y=0;Y<G.cols;Y++)B=($*G.cols+Y)*Q8,z=q.cells[B+C8],H=q.cells[B+N8],F=!!(H&67108864),(z!==X||H!==j&&(V||F))&&((X!==0||V&&j!==0)&&(C=Z++*U6,this._updateRectangle(J,C,j,X,K,Y,$)),K=Y,X=z,j=H,V=F);(X!==0||V&&j!==0)&&(C=Z++*U6,this._updateRectangle(J,C,j,X,K,G.cols,$))}J.count=Z}updateCursor(q){let G=this._verticesCursor,J=q.cursor;if(!J||J.style==="block"){G.count=0;return}let Z,$=0;(J.style==="bar"||J.style==="outline")&&(Z=$++*U6,this._addRectangleFloat(G.attributes,Z,J.x*this._dimensions.device.cell.width,J.y*this._dimensions.device.cell.height,J.style==="bar"?J.dpr*J.cursorWidth:J.dpr,this._dimensions.device.cell.height,this._cursorFloat)),(J.style==="underline"||J.style==="outline")&&(Z=$++*U6,this._addRectangleFloat(G.attributes,Z,J.x*this._dimensions.device.cell.width,(J.y+1)*this._dimensions.device.cell.height-J.dpr,J.width*this._dimensions.device.cell.width,J.dpr,this._cursorFloat)),J.style==="outline"&&(Z=$++*U6,this._addRectangleFloat(G.attributes,Z,J.x*this._dimensions.device.cell.width,J.y*this._dimensions.device.cell.height,J.width*this._dimensions.device.cell.width,J.dpr,this._cursorFloat),Z=$++*U6,this._addRectangleFloat(G.attributes,Z,(J.x+J.width)*this._dimensions.device.cell.width-J.dpr,J.y*this._dimensions.device.cell.height,J.dpr,this._dimensions.device.cell.height,this._cursorFloat)),G.count=$}_updateRectangle(q,G,J,Z,$,Y,K){if(J&67108864)switch(J&50331648){case 16777216:case 33554432:C6=this._themeService.colors.ansi[J&255].rgba;break;case 50331648:C6=(J&16777215)<<8;break;case 0:default:C6=this._themeService.colors.foreground.rgba}else switch(Z&50331648){case 16777216:case 33554432:C6=this._themeService.colors.ansi[Z&255].rgba;break;case 50331648:C6=(Z&16777215)<<8;break;case 0:default:C6=this._themeService.colors.background.rgba}q.attributes.length<G+4&&(q.attributes=PZ(q.attributes,this._terminal.rows*this._terminal.cols*U6)),k4=$*this._dimensions.device.cell.width,L4=K*this._dimensions.device.cell.height,x4=(C6>>24&255)/255,S4=(C6>>16&255)/255,w4=(C6>>8&255)/255,y4=1,this._addRectangle(q.attributes,G,k4,L4,(Y-$)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,x4,S4,w4,y4)}_addRectangle(q,G,J,Z,$,Y,K,X,j,V){q[G]=J/this._dimensions.device.canvas.width,q[G+1]=Z/this._dimensions.device.canvas.height,q[G+2]=$/this._dimensions.device.canvas.width,q[G+3]=Y/this._dimensions.device.canvas.height,q[G+4]=K,q[G+5]=X,q[G+6]=j,q[G+7]=V}_addRectangleFloat(q,G,J,Z,$,Y,K){q[G]=J/this._dimensions.device.canvas.width,q[G+1]=Z/this._dimensions.device.canvas.height,q[G+2]=$/this._dimensions.device.canvas.width,q[G+3]=Y/this._dimensions.device.canvas.height,q[G+4]=K[0],q[G+5]=K[1],q[G+6]=K[2],q[G+7]=K[3]}_colorToFloat32Array(q){return new Float32Array([(q.rgba>>24&255)/255,(q.rgba>>16&255)/255,(q.rgba>>8&255)/255,(q.rgba&255)/255])}},vZ=class extends u5{constructor(q,G,J,Z,$,Y,K,X){super();this._container=G,this._alpha=$,this._coreBrowserService=Y,this._optionsService=K,this._themeService=X,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${J}-layer`),this._canvas.style.zIndex=Z.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._register(this._themeService.onChangeColors((j)=>{this._refreshCharAtlas(q,j),this.reset(q)})),this._register(x5(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=B5(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(q){}handleFocus(q){}handleCursorMove(q){}handleGridChanged(q,G,J){}handleSelectionChanged(q,G,J,Z=!1){}_setTransparency(q,G){if(G===this._alpha)return;let J=this._canvas;this._alpha=G,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,J),this._refreshCharAtlas(q,this._themeService.colors),this.handleGridChanged(q,0,q.rows-1)}_refreshCharAtlas(q,G){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=$2(q,this._optionsService.rawOptions,G,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr,2048),this._charAtlas.warmUp())}resize(q,G){this._deviceCellWidth=G.device.cell.width,this._deviceCellHeight=G.device.cell.height,this._deviceCharWidth=G.device.char.width,this._deviceCharHeight=G.device.char.height,this._deviceCharLeft=G.device.char.left,this._deviceCharTop=G.device.char.top,this._canvas.width=G.device.canvas.width,this._canvas.height=G.device.canvas.height,this._canvas.style.width=`${G.css.canvas.width}px`,this._canvas.style.height=`${G.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(q,this._themeService.colors)}_fillBottomLineAtCells(q,G,J=1){this._ctx.fillRect(q*this._deviceCellWidth,(G+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,J*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(q,G,J,Z){this._alpha?this._ctx.clearRect(q*this._deviceCellWidth,G*this._deviceCellHeight,J*this._deviceCellWidth,Z*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(q*this._deviceCellWidth,G*this._deviceCellHeight,J*this._deviceCellWidth,Z*this._deviceCellHeight))}_fillCharTrueColor(q,G,J,Z){this._ctx.font=this._getFont(q,!1,!1),this._ctx.textBaseline=i4,this._clipCell(J,Z,G.getWidth()),this._ctx.fillText(G.getChars(),J*this._deviceCellWidth+this._deviceCharLeft,Z*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell(q,G,J){this._ctx.beginPath(),this._ctx.rect(q*this._deviceCellWidth,G*this._deviceCellHeight,J*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(q,G,J){let Z=G?q.options.fontWeightBold:q.options.fontWeight;return`${J?"italic":""} ${Z} ${q.options.fontSize*this._coreBrowserService.dpr}px ${q.options.fontFamily}`}},EZ=class extends vZ{constructor(q,G,J,Z,$,Y,K){super(J,q,"link",G,!0,$,Y,K),this._register(Z.onShowLinkUnderline((X)=>this._handleShowLinkUnderline(X))),this._register(Z.onHideLinkUnderline((X)=>this._handleHideLinkUnderline(X)))}resize(q,G){super.resize(q,G),this._state=void 0}reset(q){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let q=this._state.y2-this._state.y1-1;q>0&&this._clearCells(0,this._state.y1+1,this._state.cols,q),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(q){if(q.fg===257?this._ctx.fillStyle=this._themeService.colors.background.css:q.fg!==void 0&&MZ(q.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[q.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,q.y1===q.y2)this._fillBottomLineAtCells(q.x1,q.y1,q.x2-q.x1);else{this._fillBottomLineAtCells(q.x1,q.y1,q.cols-q.x1);for(let G=q.y1+1;G<q.y2;G++)this._fillBottomLineAtCells(0,G,q.cols);this._fillBottomLineAtCells(0,q.y2,q.x2)}this._state=q}_handleHideLinkUnderline(q){this._clearCurrentLink()}},r5=typeof window=="object"?window:globalThis,o9=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new s,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new s,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(G){return this.mapWindowIdToZoomLevel.get(this.getWindowId(G))??0}setZoomLevel(G,J){if(this.getZoomLevel(J)===G)return;let Z=this.getWindowId(J);this.mapWindowIdToZoomLevel.set(Z,G),this._onDidChangeZoomLevel.fire(Z)}getZoomFactor(G){return this.mapWindowIdToZoomFactor.get(this.getWindowId(G))??1}setZoomFactor(G,J){this.mapWindowIdToZoomFactor.set(this.getWindowId(J),G)}setFullscreen(G,J){if(this.isFullscreen(J)===G)return;let Z=this.getWindowId(J);this.mapWindowIdToFullScreen.set(Z,G),this._onDidChangeFullscreen.fire(Z)}isFullscreen(G){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(G))}getWindowId(G){return G.vscodeWindowId}};o9.INSTANCE=new o9;var X2=o9;function bZ(q,G,J){typeof G=="string"&&(G=q.matchMedia(G)),G.addEventListener("change",J)}var HX=X2.INSTANCE.onDidChangeZoomLevel,FX=X2.INSTANCE.onDidChangeFullscreen,e6=typeof navigator=="object"?navigator.userAgent:"",CX=e6.indexOf("Firefox")>=0,b9=e6.indexOf("AppleWebKit")>=0,gZ=e6.indexOf("Chrome")>=0,mZ=!gZ&&e6.indexOf("Safari")>=0,NX=e6.indexOf("Electron/")>=0,UX=e6.indexOf("Android")>=0,U8=!1;if(typeof r5.matchMedia=="function"){let q=r5.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),G=r5.matchMedia("(display-mode: fullscreen)");U8=q.matches,bZ(r5,q,({matches:J})=>{U8&&G.matches||(U8=J)})}function fZ(){return U8}var r6="en",s9=!1,n9=!1,M8=!1,pZ=!1,V2=!1,j2=!1,hZ=!1,uZ=!1,dZ=!1,cZ=!1,z8,D8=r6,I4=r6,aZ,N6,Q6=globalThis,h5;typeof Q6.vscode<"u"&&typeof Q6.vscode.process<"u"?h5=Q6.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(h5=process);var z2=typeof h5?.versions?.electron=="string",lZ=z2&&h5?.type==="renderer";if(typeof h5=="object"){s9=h5.platform==="win32",n9=h5.platform==="darwin",M8=h5.platform==="linux",pZ=M8&&!!h5.env.SNAP&&!!h5.env.SNAP_REVISION,hZ=z2,dZ=!!h5.env.CI||!!h5.env.BUILD_ARTIFACTSTAGINGDIRECTORY,z8=r6,D8=r6;let q=h5.env.VSCODE_NLS_CONFIG;if(q)try{let G=JSON.parse(q);z8=G.userLocale,I4=G.osLocale,D8=G.resolvedLanguage||r6,aZ=G.languagePack?.translationsConfigFile}catch{}V2=!0}else typeof navigator=="object"&&!lZ?(N6=navigator.userAgent,s9=N6.indexOf("Windows")>=0,n9=N6.indexOf("Macintosh")>=0,uZ=(N6.indexOf("Macintosh")>=0||N6.indexOf("iPad")>=0||N6.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,M8=N6.indexOf("Linux")>=0,cZ=N6?.indexOf("Mobi")>=0,j2=!0,D8=globalThis._VSCODE_NLS_LANGUAGE||r6,z8=navigator.language.toLowerCase(),I4=z8):console.error("Unable to resolve platform.");var g9=0;n9?g9=1:s9?g9=3:M8&&(g9=2);var m9=V2,oZ=j2&&typeof Q6.importScripts=="function",MX=oZ?Q6.origin:void 0,$6=N6,w6=D8,sZ;((q)=>{function G(){return w6}q.value=G;function J(){return w6.length===2?w6==="en":w6.length>=3?w6[0]==="e"&&w6[1]==="n"&&w6[2]==="-":!1}q.isDefaultVariant=J;function Z(){return w6==="en"}q.isDefault=Z})(sZ||={});var nZ=typeof Q6.postMessage=="function"&&!Q6.importScripts,rZ=(()=>{if(nZ){let q=[];Q6.addEventListener("message",(J)=>{if(J.data&&J.data.vscodeScheduleAsyncWork)for(let Z=0,$=q.length;Z<$;Z++){let Y=q[Z];if(Y.id===J.data.vscodeScheduleAsyncWork){q.splice(Z,1),Y.callback();return}}});let G=0;return(J)=>{let Z=++G;q.push({id:Z,callback:J}),Q6.postMessage({vscodeScheduleAsyncWork:Z},"*")}}return(q)=>setTimeout(q)})(),iZ=!!($6&&$6.indexOf("Chrome")>=0),DX=!!($6&&$6.indexOf("Firefox")>=0),QX=!!(!iZ&&$6&&$6.indexOf("Safari")>=0),PX=!!($6&&$6.indexOf("Edg/")>=0),WX=!!($6&&$6.indexOf("Android")>=0),y6=typeof navigator=="object"?navigator:{},RX={clipboard:{writeText:m9||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(y6&&y6.clipboard&&y6.clipboard.writeText),readText:m9||!!(y6&&y6.clipboard&&y6.clipboard.readText)},keyboard:m9||fZ()?0:y6.keyboard||mZ?1:2,touch:"ontouchstart"in r5||y6.maxTouchPoints>0,pointerEvents:r5.PointerEvent&&(("ontouchstart"in r5)||navigator.maxTouchPoints>0)},q0=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(q,G){this._keyCodeToStr[q]=G,this._strToKeyCode[G.toLowerCase()]=q}keyCodeToStr(q){return this._keyCodeToStr[q]}strToKeyCode(q){return this._strToKeyCode[q.toLowerCase()]||0}},f9=new q0,T4=new q0,_4=new q0,OX=Array(230),tZ;((q)=>{function G(X){return f9.keyCodeToStr(X)}q.toString=G;function J(X){return f9.strToKeyCode(X)}q.fromString=J;function Z(X){return T4.keyCodeToStr(X)}q.toUserSettingsUS=Z;function $(X){return _4.keyCodeToStr(X)}q.toUserSettingsGeneral=$;function Y(X){return T4.strToKeyCode(X)||_4.strToKeyCode(X)}q.fromUserSettings=Y;function K(X){if(X>=98&&X<=113)return null;switch(X){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return f9.keyCodeToStr(X)}q.toElectronAccelerator=K})(tZ||={});var B2=Object.freeze(function(q,G){let J=setTimeout(q.bind(G),0);return{dispose(){clearTimeout(J)}}}),eZ;((q)=>{function G(J){return J===q.None||J===q.Cancelled||J instanceof q$?!0:!J||typeof J!="object"?!1:typeof J.isCancellationRequested=="boolean"&&typeof J.onCancellationRequested=="function"}q.isCancellationToken=G,q.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:M6.None}),q.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:B2})})(eZ||={});var q$=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?B2:(this._emitter||(this._emitter=new s),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},AX=Symbol("MicrotaskDelay"),G$,p9;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?p9=(q,G)=>{rZ(()=>{if(J)return;let Z=Date.now()+15;G(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,Z-Date.now())}}))});let J=!1;return{dispose(){J||(J=!0)}}}:p9=(q,G,J)=>{let Z=q.requestIdleCallback(G,typeof J=="number"?{timeout:J}:void 0),$=!1;return{dispose(){$||($=!0,q.cancelIdleCallback(Z))}}},G$=(q)=>p9(globalThis,q)})();var J$;((q)=>{async function G(Z){let $,Y=await Promise.all(Z.map((K)=>K.then((X)=>X,(X)=>{$||($=X)})));if(typeof $<"u")throw $;return Y}q.settled=G;function J(Z){return new Promise(async($,Y)=>{try{await Z($,Y)}catch(K){Y(K)}})}q.withAsyncBody=J})(J$||={});var v4=class q{static fromArray(G){return new q((J)=>{J.emitMany(G)})}static fromPromise(G){return new q(async(J)=>{J.emitMany(await G)})}static fromPromises(G){return new q(async(J)=>{await Promise.all(G.map(async(Z)=>J.emitOne(await Z)))})}static merge(G){return new q(async(J)=>{await Promise.all(G.map(async(Z)=>{for await(let $ of Z)J.emitOne($)}))})}constructor(G,J){this._state=0,this._results=[],this._error=null,this._onReturn=J,this._onStateChanged=new s,queueMicrotask(async()=>{let Z={emitOne:($)=>this.emitOne($),emitMany:($)=>this.emitMany($),reject:($)=>this.reject($)};try{await Promise.resolve(G(Z)),this.resolve()}catch($){this.reject($)}finally{Z.emitOne=void 0,Z.emitMany=void 0,Z.reject=void 0}})}[Symbol.asyncIterator](){let G=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(G<this._results.length)return{done:!1,value:this._results[G++]};if(this._state===1)return{done:!0,value:void 0};await M6.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(G,J){return new q(async(Z)=>{for await(let $ of G)Z.emitOne(J($))})}map(G){return q.map(this,G)}static filter(G,J){return new q(async(Z)=>{for await(let $ of G)J($)&&Z.emitOne($)})}filter(G){return q.filter(this,G)}static coalesce(G){return q.filter(G,(J)=>!!J)}coalesce(){return q.coalesce(this)}static async toPromise(G){let J=[];for await(let Z of G)J.push(Z);return J}toPromise(){return q.toPromise(this)}emitOne(G){this._state===0&&(this._results.push(G),this._onStateChanged.fire())}emitMany(G){this._state===0&&(this._results=this._results.concat(G),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(G){this._state===0&&(this._state=2,this._error=G,this._onStateChanged.fire())}};v4.EMPTY=v4.fromArray([]);function Z$(q){return 55296<=q&&q<=56319}function E4(q){return 56320<=q&&q<=57343}function $$(q,G){return(q-55296<<10)+(G-56320)+65536}function Y$(q){return G0(q,0)}function G0(q,G){switch(typeof q){case"object":return q===null?D6(349,G):Array.isArray(q)?X$(q,G):V$(q,G);case"string":return H2(q,G);case"boolean":return K$(q,G);case"number":return D6(q,G);case"undefined":return D6(937,G);default:return D6(617,G)}}function D6(q,G){return(G<<5)-G+q|0}function K$(q,G){return D6(q?433:863,G)}function H2(q,G){G=D6(149417,G);for(let J=0,Z=q.length;J<Z;J++)G=D6(q.charCodeAt(J),G);return G}function X$(q,G){return G=D6(104579,G),q.reduce((J,Z)=>G0(Z,J),G)}function V$(q,G){return G=D6(181387,G),Object.keys(q).sort().reduce((J,Z)=>(J=H2(Z,J),G0(q[Z],J)),G)}function h9(q,G,J=32){let Z=J-G,$=~((1<<Z)-1);return(q<<G|($&q)>>>Z)>>>0}function b4(q,G=0,J=q.byteLength,Z=0){for(let $=0;$<J;$++)q[G+$]=Z}function j$(q,G,J="0"){for(;q.length<G;)q=J+q;return q}function x7(q,G=32){return q instanceof ArrayBuffer?Array.from(new Uint8Array(q)).map((J)=>J.toString(16).padStart(2,"0")).join(""):j$((q>>>0).toString(16),G/4)}var z$=class q{constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(G){let J=G.length;if(J===0)return;let Z=this._buff,$=this._buffLen,Y=this._leftoverHighSurrogate,K,X;for(Y!==0?(K=Y,X=-1,Y=0):(K=G.charCodeAt(0),X=0);;){let j=K;if(Z$(K))if(X+1<J){let V=G.charCodeAt(X+1);E4(V)?(X++,j=$$(K,V)):j=65533}else{Y=K;break}else E4(K)&&(j=65533);if($=this._push(Z,$,j),X++,X<J)K=G.charCodeAt(X);else break}this._buffLen=$,this._leftoverHighSurrogate=Y}_push(G,J,Z){return Z<128?G[J++]=Z:Z<2048?(G[J++]=192|(Z&1984)>>>6,G[J++]=128|(Z&63)>>>0):Z<65536?(G[J++]=224|(Z&61440)>>>12,G[J++]=128|(Z&4032)>>>6,G[J++]=128|(Z&63)>>>0):(G[J++]=240|(Z&1835008)>>>18,G[J++]=128|(Z&258048)>>>12,G[J++]=128|(Z&4032)>>>6,G[J++]=128|(Z&63)>>>0),J>=64&&(this._step(),J-=64,this._totalLen+=64,G[0]=G[64],G[1]=G[65],G[2]=G[66]),J}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),x7(this._h0)+x7(this._h1)+x7(this._h2)+x7(this._h3)+x7(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,b4(this._buff,this._buffLen),this._buffLen>56&&(this._step(),b4(this._buff));let G=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(G/4294967296),!1),this._buffDV.setUint32(60,G%4294967296,!1),this._step()}_step(){let G=q._bigBlock32,J=this._buffDV;for(let z=0;z<64;z+=4)G.setUint32(z,J.getUint32(z,!1),!1);for(let z=64;z<320;z+=4)G.setUint32(z,h9(G.getUint32(z-12,!1)^G.getUint32(z-32,!1)^G.getUint32(z-56,!1)^G.getUint32(z-64,!1),1),!1);let Z=this._h0,$=this._h1,Y=this._h2,K=this._h3,X=this._h4,j,V,B;for(let z=0;z<80;z++)z<20?(j=$&Y|~$&K,V=1518500249):z<40?(j=$^Y^K,V=1859775393):z<60?(j=$&Y|$&K|Y&K,V=2400959708):(j=$^Y^K,V=3395469782),B=h9(Z,5)+j+X+V+G.getUint32(z*4,!1)&4294967295,X=K,K=Y,Y=h9($,30),$=Z,Z=B;this._h0=this._h0+Z&4294967295,this._h1=this._h1+$&4294967295,this._h2=this._h2+Y&4294967295,this._h3=this._h3+K&4294967295,this._h4=this._h4+X&4294967295}};z$._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:kX,getWindow:B$,getDocument:LX,getWindows:xX,getWindowsCount:SX,getWindowId:g4,getWindowById:wX,hasWindow:yX,onDidRegisterWindow:IX,onWillUnregisterWindow:TX,onDidUnregisterWindow:_X}=function(){let q=new Map,G={window:r5,disposables:new i6};q.set(r5.vscodeWindowId,G);let J=new s,Z=new s,$=new s;function Y(K,X){return(typeof K=="number"?q.get(K):void 0)??(X?G:void 0)}return{onDidRegisterWindow:J.event,onWillUnregisterWindow:$.event,onDidUnregisterWindow:Z.event,registerWindow(K){if(q.has(K.vscodeWindowId))return u5.None;let X=new i6,j={window:K,disposables:X.add(new i6)};return q.set(K.vscodeWindowId,j),X.add(x5(()=>{q.delete(K.vscodeWindowId),Z.fire(K)})),X.add(r9(K,C$.BEFORE_UNLOAD,()=>{$.fire(K)})),J.fire(j),X},getWindows(){return q.values()},getWindowsCount(){return q.size},getWindowId(K){return K.vscodeWindowId},hasWindow(K){return q.has(K)},getWindowById:Y,getWindow(K){let X=K;if(X?.ownerDocument?.defaultView)return X.ownerDocument.defaultView.window;let j=K;return j?.view?j.view.window:r5},getDocument(K){return B$(K).document}}}(),H$=class{constructor(q,G,J,Z){this._node=q,this._type=G,this._handler=J,this._options=Z||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function r9(q,G,J,Z){return new H$(q,G,J,Z)}var F$,m4,u9=class{constructor(q,G=0){this._runner=q,this.priority=G,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch(q){B8(q)}}static sort(q,G){return G.priority-q.priority}};(function(){let q=new Map,G=new Map,J=new Map,Z=new Map,$=(Y)=>{J.set(Y,!1);let K=q.get(Y)??[];for(G.set(Y,K),q.set(Y,[]),Z.set(Y,!0);K.length>0;)K.sort(u9.sort),K.shift().execute();Z.set(Y,!1)};m4=(Y,K,X=0)=>{let j=g4(Y),V=new u9(K,X),B=q.get(j);return B||(B=[],q.set(j,B)),B.push(V),J.get(j)||(J.set(j,!0),Y.requestAnimationFrame(()=>$(j))),V},F$=(Y,K,X)=>{let j=g4(Y);if(Z.get(j)){let V=new u9(K,X),B=G.get(j);return B||(B=[],G.set(j,B)),B.push(V),V}else return m4(Y,K,X)}})();var f4=class q{constructor(G,J){this.width=G,this.height=J}with(G=this.width,J=this.height){return G!==this.width||J!==this.height?new q(G,J):this}static is(G){return typeof G=="object"&&typeof G.height=="number"&&typeof G.width=="number"}static lift(G){return G instanceof q?G:new q(G.width,G.height)}static equals(G,J){return G===J?!0:!G||!J?!1:G.width===J.width&&G.height===J.height}};f4.None=new f4(0,0);var vX=new class{constructor(){this.mutationObservers=new Map}observe(q,G,J){let Z=this.mutationObservers.get(q);Z||(Z=new Map,this.mutationObservers.set(q,Z));let $=Y$(J),Y=Z.get($);if(Y)Y.users+=1;else{let K=new s,X=new MutationObserver((V)=>K.fire(V));X.observe(q,J);let j=Y={users:1,observer:X,onDidMutate:K.event};G.add(x5(()=>{j.users-=1,j.users===0&&(K.dispose(),X.disconnect(),Z?.delete($),Z?.size===0&&this.mutationObservers.delete(q))})),Z.set($,Y)}return Y.onDidMutate}},C$={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:b9?"webkitAnimationStart":"animationstart",ANIMATION_END:b9?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:b9?"webkitAnimationIteration":"animationiteration"},N$=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function F2(q,G,J,...Z){let $=N$.exec(G);if(!$)throw Error("Bad use of emmet");let Y=$[1]||"div",K;return q!=="http://www.w3.org/1999/xhtml"?K=document.createElementNS(q,Y):K=document.createElement(Y),$[3]&&(K.id=$[3]),$[4]&&(K.className=$[4].replace(/\./g," ").trim()),J&&Object.entries(J).forEach(([X,j])=>{typeof j>"u"||(/^on\w+$/.test(X)?K[X]=j:X==="selected"?j&&K.setAttribute(X,"true"):K.setAttribute(X,j))}),K.append(...Z),K}function U$(q,G,...J){return F2("http://www.w3.org/1999/xhtml",q,G,...J)}U$.SVG=function(q,G,...J){return F2("http://www.w3.org/2000/svg",q,G,...J)};var M$=class extends u5{constructor(q,G,J,Z,$,Y,K,X,j){super();this._terminal=q,this._characterJoinerService=G,this._charSizeService=J,this._coreBrowserService=Z,this._coreService=$,this._decorationService=Y,this._optionsService=K,this._themeService=X,this._cursorBlinkStateManager=new O7,this._charAtlasDisposable=this._register(new O7),this._observerDisposable=this._register(new O7),this._model=new wZ,this._workCell=new R4,this._workCell2=new R4,this._rectangleRenderer=this._register(new O7),this._glyphRenderer=this._register(new O7),this._onChangeTextureAtlas=this._register(new s),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new s),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new s),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this._register(new s),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this._register(new s),this.onContextLoss=this._onContextLoss.event,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas");let V={antialias:!1,depth:!1,preserveDrawingBuffer:j};if(this._gl=this._canvas.getContext("webgl2",V),!this._gl)throw Error("WebGL2 not supported "+this._gl);this._register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new cJ(this._terminal,this._optionsService,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new EZ(this._core.screenElement,2,this._terminal,this._core.linkifier,this._coreBrowserService,K,this._themeService)],this.dimensions=uJ(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this._register(K.onOptionChange(()=>this._handleOptionsChanged())),this._deviceMaxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._register(r9(this._canvas,"webglcontextlost",(B)=>{console.log("webglcontextlost event received"),B.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(B)},3000)})),this._register(r9(this._canvas,"webglcontextrestored",(B)=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,P4(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this._observerDisposable.value=W4(this._canvas,this._coreBrowserService.window,(B,z)=>this._setCanvasDevicePixelDimensions(B,z)),this._register(this._coreBrowserService.onWindowChange((B)=>{this._observerDisposable.value=W4(this._canvas,B,(z,H)=>this._setCanvasDevicePixelDimensions(z,H))})),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._core.screenElement.isConnected,this._register(x5(()=>{for(let B of this._renderLayers)B.dispose();this._canvas.parentElement?.removeChild(this._canvas),P4(this._terminal)}))}get textureAtlas(){return this._charAtlas?.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize(q,G){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let J of this._renderLayers)J.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,this._rectangleRenderer.value?.setDimensions(this.dimensions),this._rectangleRenderer.value?.handleResize(),this._glyphRenderer.value?.setDimensions(this.dimensions),this._glyphRenderer.value?.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(let q of this._renderLayers)q.handleBlur(this._terminal);this._cursorBlinkStateManager.value?.pause(),this._requestRedrawViewport()}handleFocus(){for(let q of this._renderLayers)q.handleFocus(this._terminal);this._cursorBlinkStateManager.value?.resume(),this._requestRedrawViewport()}handleSelectionChanged(q,G,J){for(let Z of this._renderLayers)Z.handleSelectionChanged(this._terminal,q,G,J);this._model.selection.update(this._core,q,G,J),this._requestRedrawViewport()}handleCursorMove(){for(let q of this._renderLayers)q.handleCursorMove(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new _Z(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new kZ(this._terminal,this._gl,this.dimensions,this._optionsService),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0){this._isAttached=!1;return}let q=$2(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr,this._deviceMaxTextureSize);this._charAtlas!==q&&(this._onChangeTextureAtlas.fire(q.pages[0].canvas),this._charAtlasDisposable.value=o4(M6.forward(q.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),M6.forward(q.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas))),this._charAtlas=q,this._charAtlas.warmUp(),this._glyphRenderer.value?.setAtlas(this._charAtlas)}_clearModel(q){this._model.clear(),q&&this._glyphRenderer.value?.clear()}clearTextureAtlas(){this._charAtlas?.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){this._clearModel(!0);for(let q of this._renderLayers)q.reset(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._updateCursorBlink()}renderRows(q,G){if(!this._isAttached)if(this._core.screenElement?.isConnected&&this._charSizeService.width&&this._charSizeService.height)this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0;else return;for(let J of this._renderLayers)J.handleGridChanged(this._terminal,q,G);!this._glyphRenderer.value||!this._rectangleRenderer.value||(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel(q,G),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible)&&this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._coreService.decPrivateModes.cursorBlink??this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new DZ(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel(q,G){let J=this._core,Z=this._workCell,$,Y,K,X,j,V,B=0,z=!0,H,F,C,M,k,I,_,S,O;q=p4(q,J.rows-1,0),G=p4(G,J.rows-1,0);let w=this._coreService.decPrivateModes.cursorStyle??J.options.cursorStyle??"block",T=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,f=T-J.buffer.ydisp,o=Math.min(this._terminal.buffer.active.cursorX,J.cols-1),K5=-1,S5=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let E=!1;for(Y=q;Y<=G;Y++)for(K=Y+J.buffer.ydisp,X=J.buffer.lines.get(K),this._model.lineLengths[Y]=0,C=T===K,B=0,j=this._characterJoinerService.getJoinedCharacters(K),S=0;S<J.cols;S++){if($=this._cellColorResolver.result.bg,X.loadCell(S,Z),S===0&&($=this._cellColorResolver.result.bg),V=!1,z=S>=B,H=S,j.length>0&&S===j[0][0]&&z){F=j.shift();let d5=this._model.selection.isCellSelected(this._terminal,F[0],K);for(_=F[0]+1;_<F[1];_++)z&&=d5===this._model.selection.isCellSelected(this._terminal,_,K);z&&=!C||o<F[0]||o>=F[1],z?(V=!0,Z=new D$(Z,X.translateToString(!0,F[0],F[1]),F[1]-F[0]),H=F[1]-1):B=F[1]}if(M=Z.getChars(),k=Z.getCode(),_=(Y*J.cols+S)*Q8,this._cellColorResolver.resolve(Z,S,K,this.dimensions.device.cell.width),S5&&K===T&&(S===o&&(this._model.cursor={x:o,y:f,width:Z.getWidth(),style:this._coreBrowserService.isFocused?w:J.options.cursorInactiveStyle,cursorWidth:J.options.cursorWidth,dpr:this._devicePixelRatio},K5=o+Z.getWidth()-1),S>=o&&S<=K5&&(this._coreBrowserService.isFocused&&w==="block"||this._coreBrowserService.isFocused===!1&&J.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),k!==0&&(this._model.lineLengths[Y]=S+1),!(this._model.cells[_]===k&&this._model.cells[_+C8]===this._cellColorResolver.result.bg&&this._model.cells[_+N8]===this._cellColorResolver.result.fg&&this._model.cells[_+v9]===this._cellColorResolver.result.ext)&&(E=!0,M.length>1&&(k|=SZ),this._model.cells[_]=k,this._model.cells[_+C8]=this._cellColorResolver.result.bg,this._model.cells[_+N8]=this._cellColorResolver.result.fg,this._model.cells[_+v9]=this._cellColorResolver.result.ext,I=Z.getWidth(),this._glyphRenderer.value.updateCell(S,Y,k,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,M,I,$),V)){for(Z=this._workCell,S++;S<=H;S++)O=(Y*J.cols+S)*Q8,this._glyphRenderer.value.updateCell(S,Y,0,0,0,0,EJ,0,0),this._model.cells[O]=0,this._model.cells[O+C8]=this._cellColorResolver.result.bg,this._model.cells[O+N8]=this._cellColorResolver.result.fg,this._model.cells[O+v9]=this._cellColorResolver.result.ext;S--}}E&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){!this._charSizeService.width||!this._charSizeService.height||(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions(q,G){this._canvas.width===q&&this._canvas.height===G||(this._canvas.width=q,this._canvas.height=G,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){let q=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:q,end:q})}},D$=class extends n6{constructor(q,G,J){super();this.content=0,this.combinedData="",this.fg=q.fg,this.bg=q.bg,this.combinedData=G,this._width=J}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(q){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};function p4(q,G,J=0){return Math.max(Math.min(q,G),J)}var h4="di$target",u4="di$dependencies",d9=new Map;function Y6(q){if(d9.has(q))return d9.get(q);let G=function(J,Z,$){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");Q$(G,J,$)};return G._id=q,d9.set(q,G),G}function Q$(q,G,J){G[h4]===G?G[u4].push({id:q,index:J}):(G[u4]=[{id:q,index:J}],G[h4]=G)}var EX=Y6("BufferService"),bX=Y6("CoreMouseService"),gX=Y6("CoreService"),mX=Y6("CharsetService"),fX=Y6("InstantiationService"),pX=Y6("LogService"),P$=Y6("OptionsService"),hX=Y6("OscLinkService"),uX=Y6("UnicodeService"),dX=Y6("DecorationService"),W$={trace:0,debug:1,info:2,warn:3,error:4,off:5},R$="xterm.js: ",d4=class extends u5{constructor(q){super();this._optionsService=q,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),C2=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=W$[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(q){for(let G=0;G<q.length;G++)typeof q[G]=="function"&&(q[G]=q[G]())}_log(q,G,J){this._evalLazyOptionalParams(J),q.call(console,(this._optionsService.options.logger?"":R$)+G,...J)}trace(q,...G){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,q,G)}debug(q,...G){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,q,G)}info(q,...G){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,q,G)}warn(q,...G){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,q,G)}error(q,...G){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,q,G)}};d4=NJ([UJ(0,P$)],d4);var C2;function O$(q){C2=q}var N2=class extends u5{constructor(q){if(n4&&vJ()<16){let G={antialias:!1,depth:!1,preserveDrawingBuffer:!0};if(!document.createElement("canvas").getContext("webgl2",G))throw Error("Webgl2 is only supported on Safari 16 and above")}super();this._preserveDrawingBuffer=q,this._onChangeTextureAtlas=this._register(new s),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new s),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new s),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this._register(new s),this.onContextLoss=this._onContextLoss.event}activate(q){let G=q._core;if(!q.element){this._register(G.onWillOpen(()=>this.activate(q)));return}this._terminal=q;let{coreService:J,optionsService:Z}=G,$=G,Y=$._renderService,K=$._characterJoinerService,X=$._charSizeService,j=$._coreBrowserService,V=$._decorationService,B=$._logService,z=$._themeService;O$(B),this._renderer=this._register(new M$(q,K,X,j,J,V,Z,z,this._preserveDrawingBuffer)),this._register(M6.forward(this._renderer.onContextLoss,this._onContextLoss)),this._register(M6.forward(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this._register(M6.forward(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this._register(M6.forward(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),Y.setRenderer(this._renderer),this._register(x5(()=>{if(this._terminal._core._store._isDisposed)return;let H=this._terminal._core._renderService;H.setRenderer(this._terminal._core._createRenderer()),H.handleResize(q.cols,q.rows)}))}get textureAtlas(){return this._renderer?.textureAtlas}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}};class J0{feedIds=[G5.TERMINAL_OUTPUT];collapsible=!1;terminal=null;fitAddon=null;resizeObserver=null;connection;constructor(q){this.connection=q}mount(q){let G=getComputedStyle(document.documentElement).getPropertyValue("--background").trim(),J=getComputedStyle(document.documentElement).getPropertyValue("--foreground").trim();this.terminal=new $4({cursorBlink:!0,fontFamily:"'Menlo', 'Monaco', 'Courier New', monospace",fontSize:14,theme:{background:G,foreground:J}}),this.fitAddon=new Y4,this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(new K4),this.terminal.open(q);try{let Z=new N2;Z.onContextLoss(()=>{Z.dispose(),console.log("tugdeck: WebGL context lost, falling back to canvas")}),this.terminal.loadAddon(Z),console.log("tugdeck: WebGL renderer activated")}catch{console.log("tugdeck: WebGL not available, using canvas renderer")}this.resizeObserver=new ResizeObserver(()=>{if(this.fitAddon)this.fitAddon.fit()}),this.resizeObserver.observe(q),this.terminal.onData((Z)=>{let $=new TextEncoder().encode(Z);this.connection.send(G5.TERMINAL_INPUT,$)}),this.terminal.onResize(({cols:Z,rows:$})=>{let Y=k8(Z,$);this.connection.send(Y.feedId,Y.payload)})}onFrame(q,G){if(q===G5.TERMINAL_OUTPUT&&this.terminal)this.terminal.write(G)}onResize(q,G){if(this.fitAddon&&this.terminal){this.fitAddon.fit();let J=k8(this.terminal.cols,this.terminal.rows);this.connection.send(J.feedId,J.payload)}}destroy(){if(this.resizeObserver)this.resizeObserver.disconnect(),this.resizeObserver=null;if(this.terminal)this.terminal.dispose(),this.terminal=null,this.fitAddon=null}}var A$=100;class Z0{feedIds=[G5.FILESYSTEM];container=null;header=null;eventList=null;mount(q){this.container=q,this.container.classList.add("files-card"),this.header=document.createElement("div"),this.header.className="card-header",this.header.textContent="Files",this.container.appendChild(this.header),this.eventList=document.createElement("div"),this.eventList.className="event-list",this.container.appendChild(this.eventList)}onFrame(q,G){if(q!==G5.FILESYSTEM||!this.eventList)return;if(G.length===0)return;let J=new TextDecoder().decode(G),Z;try{Z=JSON.parse(J)}catch{console.error("files-card: failed to parse FsEvent payload");return}let $=this.eventList,Y=$.scrollHeight-$.scrollTop-$.clientHeight<8;for(let K of Z){let X=document.createElement("div");X.className=`event-entry event-${K.kind.toLowerCase()}`;let j=this.iconForKind(K.kind),V=this.labelForEvent(K);X.innerHTML=`<span class="event-icon">${j}</span><span class="event-label">${V}</span>`,$.appendChild(X)}while($.children.length>A$)$.removeChild($.firstChild);if(Y)$.scrollTop=$.scrollHeight}onResize(q,G){}destroy(){if(this.container)this.container.innerHTML="",this.container=null,this.header=null,this.eventList=null}iconForKind(q){switch(q){case"Created":return"+";case"Modified":return"~";case"Removed":return"-";case"Renamed":return">";default:return"?"}}labelForEvent(q){if(q.kind==="Renamed")return`${q.from}  ${q.to}`;return q.path??""}}class $0{feedIds=[G5.GIT];container=null;header=null;content=null;mount(q){this.container=q,this.container.classList.add("git-card"),this.header=document.createElement("div"),this.header.className="card-header",this.header.textContent="Git",this.container.appendChild(this.header),this.content=document.createElement("div"),this.content.className="git-content",this.container.appendChild(this.content)}onFrame(q,G){if(q!==G5.GIT||!this.content)return;if(G.length===0)return;let J=new TextDecoder().decode(G),Z;try{Z=JSON.parse(J)}catch{console.error("git-card: failed to parse GitStatus payload");return}this.render(Z)}onResize(q,G){}destroy(){if(this.container)this.container.innerHTML="",this.container=null,this.header=null,this.content=null}render(q){if(!this.content)return;this.content.innerHTML="";let G=document.createElement("div");G.className="branch-section";let J=document.createElement("span");if(J.className="branch-badge",J.textContent=q.branch,G.appendChild(J),q.ahead>0||q.behind>0){let Z=document.createElement("span");Z.className="ahead-behind";let $=[];if(q.ahead>0)$.push(`${q.ahead}`);if(q.behind>0)$.push(`${q.behind}`);Z.textContent=$.join(" "),G.appendChild(Z)}if(this.content.appendChild(G),q.head_message){let Z=document.createElement("div");Z.className="head-message",Z.textContent=q.head_message,this.content.appendChild(Z)}if(q.staged.length>0)this.renderFileSection("Staged","staged",q.staged);if(q.unstaged.length>0)this.renderFileSection("Unstaged","unstaged",q.unstaged);if(q.untracked.length>0)this.renderUntrackedSection(q.untracked);if(q.staged.length===0&&q.unstaged.length===0&&q.untracked.length===0){let Z=document.createElement("div");Z.className="clean-status",Z.textContent="Clean working tree",this.content.appendChild(Z)}}renderFileSection(q,G,J){if(!this.content)return;let Z=document.createElement("div");Z.className=`file-section ${G}`;let $=document.createElement("div");$.className="section-title",$.textContent=`${q} (${J.length})`,Z.appendChild($);for(let Y of J){let K=document.createElement("div");K.className="file-entry",K.innerHTML=`<span class="file-status">${Y.status}</span><span class="file-path">${Y.path}</span>`,Z.appendChild(K)}this.content.appendChild(Z)}renderUntrackedSection(q){if(!this.content)return;let G=document.createElement("div");G.className="file-section untracked";let J=document.createElement("div");J.className="section-title",J.textContent=`Untracked (${q.length})`,G.appendChild(J);for(let Z of q){let $=document.createElement("div");$.className="file-entry",$.innerHTML=`<span class="file-status">?</span><span class="file-path">${Z}</span>`,G.appendChild($)}this.content.appendChild(G)}}function Y0(q){return getComputedStyle(document.documentElement).getPropertyValue(q).trim()}class U2{values=[];canvas;ctx;color;bufferSize;constructor(q,G=60,J){this.canvas=q,this.ctx=q.getContext("2d"),this.color=J,this.bufferSize=G}push(q){if(this.values.push(q),this.values.length>this.bufferSize)this.values.shift();this.draw()}draw(){let q=this.canvas.width,G=this.canvas.height;if(this.ctx.clearRect(0,0,q,G),this.values.length<2)return;let J=Math.min(...this.values),Z=Math.max(...this.values);if(Z===J)J=Z-0.5,Z=Z+0.5;let $=Z-J;this.ctx.beginPath(),this.ctx.strokeStyle=this.color,this.ctx.lineWidth=1.5;let Y=q/(this.bufferSize-1);for(let K=0;K<this.values.length;K++){let X=K*Y,j=G-(this.values[K]-J)/$*G;if(K===0)this.ctx.moveTo(X,j);else this.ctx.lineTo(X,j)}this.ctx.stroke()}resize(q,G){this.canvas.width=q,this.canvas.height=G,this.draw()}}class R8{container;nameSpan;valueSpan;sparkline;canvas;constructor(q,G,J=60){this.container=document.createElement("div"),this.container.className="stat-sub-card";let Z=document.createElement("div");Z.className="stat-header",this.nameSpan=document.createElement("span"),this.nameSpan.className="stat-name",this.nameSpan.textContent=q,this.valueSpan=document.createElement("span"),this.valueSpan.className="stat-value",this.valueSpan.textContent="--",Z.appendChild(this.nameSpan),Z.appendChild(this.valueSpan),this.canvas=document.createElement("canvas"),this.canvas.className="sparkline-canvas",this.canvas.width=300,this.canvas.height=32,this.sparkline=new U2(this.canvas,J,G),this.container.appendChild(Z),this.container.appendChild(this.canvas)}mount(q){q.appendChild(this.container)}updateValue(q,G=!1){if(this.valueSpan.textContent=q,G)this.valueSpan.classList.add("stat-na");else this.valueSpan.classList.remove("stat-na")}pushSparkline(q){this.sparkline.push(q)}resize(){let q=this.canvas.clientWidth,G=32;this.sparkline.resize(q,32)}getElement(){return this.container}}class K0{feedIds=[G5.STATS,G5.STATS_PROCESS_INFO,G5.STATS_TOKEN_USAGE,G5.STATS_BUILD_STATUS];container=null;content=null;processInfo=null;tokenUsage=null;buildStatus=null;mount(q){this.container=q,this.container.classList.add("stats-card");let G=document.createElement("div");G.className="card-header",G.textContent="Stats",this.container.appendChild(G),this.content=document.createElement("div"),this.content.className="stats-content",this.container.appendChild(this.content),this.processInfo=new R8("CPU / Memory",Y0("--chart-1")),this.processInfo.mount(this.content),this.tokenUsage=new R8("Token Usage",Y0("--chart-2")),this.tokenUsage.mount(this.content),this.buildStatus=new R8("Build Status",Y0("--chart-3")),this.buildStatus.mount(this.content)}onFrame(q,G){if(G.length===0)return;let J=new TextDecoder().decode(G),Z;try{Z=JSON.parse(J)}catch($){console.error("Stats card: failed to parse JSON payload",$);return}switch(q){case G5.STATS_PROCESS_INFO:this.handleProcessInfo(Z);break;case G5.STATS_TOKEN_USAGE:this.handleTokenUsage(Z);break;case G5.STATS_BUILD_STATUS:this.handleBuildStatus(Z);break;case G5.STATS:break}}handleProcessInfo(q){if(!this.processInfo)return;let G=q.cpu_percent?.toFixed(1)??"0.0",J=q.memory_mb?.toFixed(0)??"0";this.processInfo.updateValue(`CPU: ${G}%  Mem: ${J}MB`),this.processInfo.pushSparkline(q.cpu_percent??0)}handleTokenUsage(q){if(!this.tokenUsage)return;if(q===null||q.total_tokens===null){this.tokenUsage.updateValue("N/A",!0),this.tokenUsage.pushSparkline(0);return}let G=q.total_tokens??0,J=q.context_window_percent?.toFixed(1)??"0.0";this.tokenUsage.updateValue(`${G} tokens (${J}%)`,!1),this.tokenUsage.pushSparkline(G)}handleBuildStatus(q){if(!this.buildStatus)return;let G=q.status??"idle";this.buildStatus.updateValue(G,!1),this.buildStatus.pushSparkline(G==="building"?1:0)}onResize(q,G){if(this.processInfo)this.processInfo.resize();if(this.tokenUsage)this.tokenUsage.resize();if(this.buildStatus)this.buildStatus.resize()}destroy(){if(this.container)this.container.innerHTML="",this.container=null;this.content=null,this.processInfo=null,this.tokenUsage=null,this.buildStatus=null}}var k$=`ws://${window.location.host}/ws`,X0=new L8(k$),M2=document.getElementById("deck-container");if(!M2)throw Error("deck-container element not found");var O8=new x8(M2,X0);O8.addCard(new J0(X0),"terminal");O8.addCard(new $0,"git");O8.addCard(new Z0,"files");O8.addCard(new K0,"stats");X0.connect();console.log("tugdeck initialized");
