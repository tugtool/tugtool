var K0={TERMINAL_OUTPUT:0,TERMINAL_INPUT:1,TERMINAL_RESIZE:2,FILESYSTEM:16,GIT:32,STATS:48,STATS_PROCESS_INFO:49,STATS_TOKEN_USAGE:50,STATS_BUILD_STATUS:51,CONVERSATION_OUTPUT:64,CONVERSATION_INPUT:65,HEARTBEAT:255};function i6($){let J=new ArrayBuffer(5+$.payload.length),Y=new DataView(J);return Y.setUint8(0,$.feedId),Y.setUint32(1,$.payload.length,!1),new Uint8Array(J,5).set($.payload),J}function w2($){let J=new DataView($);if($.byteLength<5)throw Error(`incomplete frame: need 5 bytes, have ${$.byteLength}`);let Y=J.getUint8(0),Z=J.getUint32(1,!1);if(Z>1048576)throw Error(`payload too large: ${Z} bytes`);if($.byteLength<5+Z)throw Error(`incomplete frame: need ${5+Z} bytes, have ${$.byteLength}`);let j=new Uint8Array($,5,Z);return{feedId:Y,payload:j}}function r6($,J){let Y=JSON.stringify({cols:$,rows:J});return{feedId:K0.TERMINAL_RESIZE,payload:new TextEncoder().encode(Y)}}function L2($){let J=JSON.stringify($),Y=new TextEncoder().encode(J),Z={feedId:K0.CONVERSATION_INPUT,payload:Y};return i6(Z)}var DY=15000,m7={CONNECTED:"connected",DISCONNECTED:"disconnected",RECONNECTING:"reconnecting"},E2=2000,_Y=30000;class t6{ws=null;callbacks=new Map;openCallbacks=[];heartbeatTimer=null;url;state=m7.DISCONNECTED;retryDelay=E2;retryTimer=null;countdownTimer=null;countdownSeconds=0;bannerElement=null;intentionalClose=!1;lastCloseCode=null;lastCloseReason=null;constructor($){this.url=$}connect(){this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{console.log("tugdeck: WebSocket connected"),this.state=m7.CONNECTED,this.retryDelay=E2,this.hideDisconnectBanner(),this.startHeartbeat();for(let $ of this.openCallbacks)$()},this.ws.onmessage=($)=>{if($.data instanceof ArrayBuffer)try{let J=w2($.data);this.dispatch(J.feedId,J.payload)}catch(J){console.error("tugdeck: failed to decode frame:",J)}},this.ws.onclose=($)=>{if(console.log("tugdeck: WebSocket closed",$.code,$.reason),this.stopHeartbeat(),this.lastCloseCode=$.code,this.lastCloseReason=$.reason||null,this.intentionalClose)return;this.state=m7.DISCONNECTED,this.scheduleReconnect(),this.retryDelay=Math.min(this.retryDelay*2,_Y)},this.ws.onerror=($)=>{console.error("tugdeck: WebSocket error",$)}}scheduleReconnect(){if(this.retryTimer!==null)window.clearTimeout(this.retryTimer),this.retryTimer=null;this.countdownSeconds=Math.ceil(this.retryDelay/1000),this.showDisconnectBanner(),this.countdownTimer=window.setInterval(()=>{this.updateBannerCountdown()},1000),this.retryTimer=window.setTimeout(()=>{this.reconnect()},this.retryDelay)}reconnect(){if(this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null;this.state=m7.RECONNECTING,this.updateBannerText("Reconnecting..."),console.log("tugdeck: attempting reconnection"),this.connect()}showDisconnectBanner(){if(!this.bannerElement)this.bannerElement=document.getElementById("disconnect-banner");if(this.bannerElement)this.bannerElement.style.display="block",this.updateBannerText()}updateBannerText($){if(!this.bannerElement)return;if($){this.bannerElement.textContent=$;return}let J="Disconnected";if(this.lastCloseReason&&this.lastCloseReason.trim()!=="")J+=` (${this.lastCloseReason})`;J+=` -- reconnecting in ${this.countdownSeconds}s...`,this.bannerElement.textContent=J}updateBannerCountdown(){if(this.countdownSeconds=Math.max(0,this.countdownSeconds-1),this.updateBannerText(),this.countdownSeconds===0&&this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null}hideDisconnectBanner(){if(this.bannerElement)this.bannerElement.style.display="none";if(this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null}send($,J){if(this.ws&&this.ws.readyState===WebSocket.OPEN){let Y={feedId:$,payload:J};this.ws.send(i6(Y))}}onOpen($){this.openCallbacks.push($)}onFrame($,J){if(!this.callbacks.has($))this.callbacks.set($,[]);this.callbacks.get($).push(J)}close(){if(this.intentionalClose=!0,this.stopHeartbeat(),this.retryTimer!==null)window.clearTimeout(this.retryTimer),this.retryTimer=null;if(this.countdownTimer!==null)window.clearInterval(this.countdownTimer),this.countdownTimer=null;if(this.ws)this.ws.close(),this.ws=null}dispatch($,J){let Y=this.callbacks.get($);if(Y)for(let Z of Y)Z(J)}startHeartbeat(){this.heartbeatTimer=window.setInterval(()=>{this.send(K0.HEARTBEAT,new Uint8Array(0))},DY)}stopHeartbeat(){if(this.heartbeatTimer!==null)window.clearInterval(this.heartbeatTimer),this.heartbeatTimer=null}}var MY={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},P2=([$,J,Y])=>{let Z=document.createElementNS("http://www.w3.org/2000/svg",$);if(Object.keys(J).forEach((j)=>{Z.setAttribute(j,String(J[j]))}),Y?.length)Y.forEach((j)=>{let K=P2(j);Z.appendChild(K)});return Z},yY=($,J={})=>{let Z={...MY,...J};return P2(["svg",Z,$])};var wY=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"}]];var LY=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];var EY=[["path",{d:"m6 9 6 6 6-6"}]];var PY=[["path",{d:"m18 15-6-6-6 6"}]];var AY=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m9 12 2 2 4-4"}]];var fY=[["path",{d:"M10.1 2.182a10 10 0 0 1 3.8 0"}],["path",{d:"M13.9 21.818a10 10 0 0 1-3.8 0"}],["path",{d:"M17.609 3.721a10 10 0 0 1 2.69 2.7"}],["path",{d:"M2.182 13.9a10 10 0 0 1 0-3.8"}],["path",{d:"M20.279 17.609a10 10 0 0 1-2.7 2.69"}],["path",{d:"M21.818 10.1a10 10 0 0 1 0 3.8"}],["path",{d:"M3.721 6.391a10 10 0 0 1 2.7-2.69"}],["path",{d:"M6.391 20.279a10 10 0 0 1-2.69-2.7"}]];var TY=[["circle",{cx:"12",cy:"12",r:"10"}],["circle",{cx:"12",cy:"12",r:"1"}]];var kY=[["circle",{cx:"8",cy:"8",r:"6"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18"}],["path",{d:"M7 6h1v4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82"}]];var SY=[["path",{d:"M12.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v9.34"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"M10.378 12.622a1 1 0 0 1 3 3.003L8.36 20.637a2 2 0 0 1-.854.506l-2.867.837a.5.5 0 0 1-.62-.62l.836-2.869a2 2 0 0 1 .506-.853z"}]];var mY=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"M9 15h6"}],["path",{d:"M12 18v-6"}]];var CY=[["path",{d:"M4 11V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h7"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"m10 18 3-3-3-3"}]];var gY=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"m14.5 12.5-5 5"}],["path",{d:"m9.5 12.5 5 5"}]];var hY=[["path",{d:"M15 6a9 9 0 0 0-9 9V3"}],["circle",{cx:"18",cy:"6",r:"3"}],["circle",{cx:"6",cy:"18",r:"3"}]];var pY=[["path",{d:"m15 12-9.373 9.373a1 1 0 0 1-3.001-3L12 9"}],["path",{d:"m18 15 4-4"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172v-.344a2 2 0 0 0-.586-1.414l-1.657-1.657A6 6 0 0 0 12.516 3H9l1.243 1.243A6 6 0 0 1 12 8.485V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5"}]];var e6=wY;var $1=LY;var C7=EY;var g7=PY;var J1=AY;var Y1=fY;var Z1=TY;var j1=kY;var K1=SY;var Q1=mY;var X1=CY;var h7=gY;var z1=hY;var V1=pY;var v0=yY;var A2=100,f2="tugdeck-layout",T2=2,uY=500;class G1{cards=new Map;slots=new Map;gridContainer;connection;colSplit=0.667;rowSplits=[0.25,0.5,0.75];collapsedSlots=new Set;saveTimer=null;_isDragging=!1;constructor($,J){this.connection=J,this.gridContainer=document.createElement("div"),this.gridContainer.className="deck-grid",$.appendChild(this.gridContainer);for(let Y of["conversation","terminal","git","files","stats"]){let Z=document.createElement("div");Z.className=`card-slot card-slot-${Y}`,this.gridContainer.appendChild(Z),this.slots.set(Y,Z)}this.createDragHandles(),this.loadLayout(),this.updateGridTracks(),window.addEventListener("resize",()=>this.handleResize()),J.onOpen(()=>this.handleResize())}get isDragging(){return this._isDragging}addCard($,J){this.cards.set(J,$);for(let Z of $.feedIds)this.connection.onFrame(Z,(j)=>{$.onFrame(Z,j)});let Y=this.slots.get(J);if(Y){if($.mount(Y),$.collapsible!==!1){let Z=Y.querySelector(".card-header");if(Z){let j=document.createElement("button");j.className="collapse-btn";let K=this.collapsedSlots.has(J)?v0(C7,{width:14,height:14}):v0(g7,{width:14,height:14});if(j.appendChild(K),j.addEventListener("click",()=>this.toggleCollapse(J)),Z.appendChild(j),this.collapsedSlots.has(J))this.applyCollapse(J)}}}}toggleCollapse($){if(this.collapsedSlots.has($))this.expandCard($);else this.collapseCard($);this.scheduleSave()}collapseCard($){this.collapsedSlots.add($),this.applyCollapse($)}expandCard($){this.collapsedSlots.delete($),this.applyExpand($)}applyCollapse($){let J=this.slots.get($);if(!J)return;J.classList.add("collapsed");let Y=J.querySelector(".collapse-btn");if(Y)Y.innerHTML="",Y.appendChild(v0(C7,{width:14,height:14}));this.updateGridTracks()}applyExpand($){let J=this.slots.get($);if(!J)return;J.classList.remove("collapsed");let Y=J.querySelector(".collapse-btn");if(Y)Y.innerHTML="",Y.appendChild(v0(g7,{width:14,height:14}));this.updateGridTracks(),this.handleResize()}createDragHandles(){let $=document.createElement("div");$.className="drag-handle drag-handle-col",this.gridContainer.appendChild($),this.setupColDrag($);let J=document.createElement("div");J.className="drag-handle drag-handle-row",J.dataset.index="0",this.gridContainer.appendChild(J),this.setupRowDrag(J,0);let Y=document.createElement("div");Y.className="drag-handle drag-handle-row",Y.dataset.index="1",this.gridContainer.appendChild(Y),this.setupRowDrag(Y,1);let Z=document.createElement("div");Z.className="drag-handle drag-handle-row",Z.dataset.index="2",this.gridContainer.appendChild(Z),this.setupRowDrag(Z,2)}setupColDrag($){let J=0,Y=0;$.addEventListener("pointerdown",(Z)=>{Z.preventDefault(),$.setPointerCapture(Z.pointerId),$.classList.add("active"),this._isDragging=!0,J=Z.clientX,Y=this.colSplit;let j=(Q)=>{let X=Q.clientX-J,V=this.gridContainer.clientWidth,z=Y+X/V,G=A2/V;z=Math.max(G,Math.min(1-G,z)),this.colSplit=z,this.updateGridTracks()},K=(Q)=>{this._isDragging=!1,$.releasePointerCapture(Q.pointerId),$.classList.remove("active"),$.removeEventListener("pointermove",j),$.removeEventListener("pointerup",K),this.handleResize(),this.scheduleSave()};$.addEventListener("pointermove",j),$.addEventListener("pointerup",K)})}setupRowDrag($,J){let Y=0,Z=[];$.addEventListener("pointerdown",(j)=>{j.preventDefault(),$.setPointerCapture(j.pointerId),$.classList.add("active"),this._isDragging=!0,Y=j.clientY,Z=[...this.rowSplits];let K=(X)=>{let V=X.clientY-Y,z=this.gridContainer.clientHeight,G=V/z,W=[...Z],q=A2/z;if(J===0)W[0]=Math.max(q,Math.min(W[1]-q,Z[0]+G));else if(J===1)W[1]=Math.max(W[0]+q,Math.min(W[2]-q,Z[1]+G));else W[2]=Math.max(W[1]+q,Math.min(1-q,Z[2]+G));this.rowSplits=W,this.updateGridTracks()},Q=(X)=>{this._isDragging=!1,$.releasePointerCapture(X.pointerId),$.classList.remove("active"),$.removeEventListener("pointermove",K),$.removeEventListener("pointerup",Q),this.handleResize(),this.scheduleSave()};$.addEventListener("pointermove",K),$.addEventListener("pointerup",Q)})}updateGridTracks(){let $=(this.colSplit*100).toFixed(2)+"%",J=((1-this.colSplit)*100).toFixed(2)+"%";this.gridContainer.style.gridTemplateColumns=`${$} ${J}`;let Y=["terminal","git","files","stats"];if(Y.some((j)=>this.collapsedSlots.has(j))){let j=Y.map((K)=>{return this.collapsedSlots.has(K)?"28px":"1fr"});this.gridContainer.style.gridTemplateRows=j.join(" ")}else{let j=(this.rowSplits[0]*100).toFixed(2)+"%",K=((this.rowSplits[1]-this.rowSplits[0])*100).toFixed(2)+"%",Q=((this.rowSplits[2]-this.rowSplits[1])*100).toFixed(2)+"%",X=((1-this.rowSplits[2])*100).toFixed(2)+"%";this.gridContainer.style.gridTemplateRows=`${j} ${K} ${Q} ${X}`}this.positionHandles()}positionHandles(){let $=this.gridContainer.querySelectorAll(".drag-handle"),J=$[0],Y=$[1],Z=$[2],j=$[3];if(J)J.style.left=`calc(${(this.colSplit*100).toFixed(2)}% - 3px)`;if(Y)Y.style.top=`calc(${(this.rowSplits[0]*100).toFixed(2)}% - 3px)`,Y.style.left=`${(this.colSplit*100).toFixed(2)}%`;if(Z)Z.style.top=`calc(${(this.rowSplits[1]*100).toFixed(2)}% - 3px)`,Z.style.left=`${(this.colSplit*100).toFixed(2)}%`;if(j)j.style.top=`calc(${(this.rowSplits[2]*100).toFixed(2)}% - 3px)`,j.style.left=`${(this.colSplit*100).toFixed(2)}%`}saveLayout(){try{let $={version:T2,colSplit:this.colSplit,rowSplits:this.rowSplits,collapsed:Array.from(this.collapsedSlots)};localStorage.setItem(f2,JSON.stringify($))}catch($){console.warn("tugdeck: failed to save layout to localStorage",$)}}scheduleSave(){if(this.saveTimer!==null)window.clearTimeout(this.saveTimer);this.saveTimer=window.setTimeout(()=>{this.saveLayout(),this.saveTimer=null},uY)}loadLayout(){try{let $=localStorage.getItem(f2);if(!$)return;let J=JSON.parse($);if(J.version===1){console.info("tugdeck: migrating layout from v1 to v2");let Y=J.rowSplits||[0.3333333333333333,0.6666666666666666];if(this.rowSplits=[0.25,0.25+Y[0]*0.75,0.25+Y[1]*0.75],this.colSplit=J.colSplit||0.667,Array.isArray(J.collapsed)){let Z=["conversation","terminal","git","files","stats"],j=J.collapsed.filter((K)=>Z.includes(K));this.collapsedSlots=new Set(j)}this.scheduleSave();return}if(J.version!==T2){console.warn("tugdeck: layout version mismatch, using defaults");return}if(typeof J.colSplit==="number"&&J.colSplit>=0.1&&J.colSplit<=0.9)this.colSplit=J.colSplit;if(Array.isArray(J.rowSplits)&&J.rowSplits.length===3&&J.rowSplits[0]>=0.1&&J.rowSplits[1]>=J.rowSplits[0]+0.1&&J.rowSplits[2]>=J.rowSplits[1]+0.1&&J.rowSplits[2]<=0.9)this.rowSplits=J.rowSplits;if(Array.isArray(J.collapsed)){let Y=["conversation","terminal","git","files","stats"],Z=J.collapsed.filter((j)=>Y.includes(j));this.collapsedSlots=new Set(Z)}}catch($){console.warn("tugdeck: failed to load layout from localStorage",$)}}handleResize(){for(let[$,J]of this.cards){let Y=this.slots.get($);if(Y)J.onResize(Y.clientWidth,Y.clientHeight)}}destroy(){if(this.saveTimer!==null)window.clearTimeout(this.saveTimer),this.saveTimer=null;for(let $ of this.cards.values())$.destroy();this.cards.clear()}}function dY($){if(typeof $!=="object"||$===null)return!1;let J=$;return J.type==="protocol_ack"||J.type==="session_init"||J.type==="assistant_text"||J.type==="tool_use"||J.type==="tool_result"||J.type==="tool_approval_request"||J.type==="question"||J.type==="turn_complete"||J.type==="turn_cancelled"||J.type==="error"}function k2($){try{let J=new TextDecoder().decode($),Y=JSON.parse(J);return dY(Y)?Y:null}catch{return null}}function cY($){return"msg_id"in $&&"seq"in $}class W1{nextExpectedSeq=0;buffer=new Map;seen=new Set;gapTimer=null;onMessage;onResync;constructor($,J){this.onMessage=$,this.onResync=J}push($){if(!cY($)){this.onMessage($);return}let{msg_id:J,seq:Y}=$,Z=`${J}:${Y}`,j="rev"in $&&typeof $.rev==="number"&&"is_partial"in $&&$.is_partial===!0;if(this.seen.has(Z)){if(!j)return}else this.seen.add(Z);if(Y===this.nextExpectedSeq){if(this.deliver($),!j)this.nextExpectedSeq++,this.flushBuffer()}else if(Y>this.nextExpectedSeq)this.buffer.set(Y,$),this.startGapTimer()}deliver($){this.onMessage($)}flushBuffer(){while(this.buffer.has(this.nextExpectedSeq)){let $=this.buffer.get(this.nextExpectedSeq);this.buffer.delete(this.nextExpectedSeq),this.deliver($),this.nextExpectedSeq++}if(this.buffer.size===0&&this.gapTimer!==null)clearTimeout(this.gapTimer),this.gapTimer=null}startGapTimer(){if(this.gapTimer!==null)return;this.gapTimer=setTimeout(()=>{if(this.buffer.size>0){let J=Array.from(this.buffer.keys()).sort((Y,Z)=>Y-Z)[0];this.nextExpectedSeq=J,this.flushBuffer(),this.onResync()}this.gapTimer=null},5000)}reset(){if(this.nextExpectedSeq=0,this.buffer.clear(),this.seen.clear(),this.gapTimer!==null)clearTimeout(this.gapTimer),this.gapTimer=null}}function H1(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var I9=H1();function p2($){I9=$}var o9={exec:()=>null};function e($,J=""){let Y=typeof $==="string"?$:$.source,Z={replace:(j,K)=>{let Q=typeof K==="string"?K:K.source;return Q=Q.replace(l0.caret,"$1"),Y=Y.replace(j,Q),Z},getRegex:()=>{return new RegExp(Y,J)}};return Z}var l0={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:($)=>new RegExp(`^( {0,3}${$})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:($)=>new RegExp(`^ {0,${Math.min(3,$-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:($)=>new RegExp(`^ {0,${Math.min(3,$-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:($)=>new RegExp(`^ {0,${Math.min(3,$-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:($)=>new RegExp(`^ {0,${Math.min(3,$-1)}}#`),htmlBeginRegex:($)=>new RegExp(`^ {0,${Math.min(3,$-1)}}<(?:[a-z].*>|!--)`,"i")},lY=/^(?:[ \t]*(?:\n|$))+/,sY=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,aY=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,n9=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,oY=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,U1=/(?:[*+-]|\d{1,9}[.)])/,u2=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,d2=e(u2).replace(/bull/g,U1).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),nY=e(u2).replace(/bull/g,U1).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),I1=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,iY=/^[^\n]+/,B1=/(?!\s*\])(?:\\.|[^\[\]\\])+/,rY=e(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",B1).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),tY=e(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,U1).getRegex(),s7="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",v1=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,eY=e("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",v1).replace("tag",s7).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),c2=e(I1).replace("hr",n9).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",s7).getRegex(),$Z=e(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",c2).getRegex(),O1={blockquote:$Z,code:sY,def:rY,fences:aY,heading:oY,hr:n9,html:eY,lheading:d2,list:tY,newline:lY,paragraph:c2,table:o9,text:iY},S2=e("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",n9).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",s7).getRegex(),JZ={...O1,lheading:nY,table:S2,paragraph:e(I1).replace("hr",n9).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",S2).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",s7).getRegex()},YZ={...O1,html:e(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",v1).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:o9,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:e(I1).replace("hr",n9).replace("heading",` *#{1,6} *[^
]`).replace("lheading",d2).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},ZZ=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,jZ=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,l2=/^( {2,}|\\)\n(?!\s*$)/,KZ=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,a7=/[\p{P}\p{S}]/u,F1=/[\s\p{P}\p{S}]/u,s2=/[^\s\p{P}\p{S}]/u,QZ=e(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,F1).getRegex(),a2=/(?!~)[\p{P}\p{S}]/u,XZ=/(?!~)[\s\p{P}\p{S}]/u,zZ=/(?:[^\s\p{P}\p{S}]|~)/u,VZ=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,o2=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,GZ=e(o2,"u").replace(/punct/g,a7).getRegex(),WZ=e(o2,"u").replace(/punct/g,a2).getRegex(),n2="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",qZ=e(n2,"gu").replace(/notPunctSpace/g,s2).replace(/punctSpace/g,F1).replace(/punct/g,a7).getRegex(),HZ=e(n2,"gu").replace(/notPunctSpace/g,zZ).replace(/punctSpace/g,XZ).replace(/punct/g,a2).getRegex(),UZ=e("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,s2).replace(/punctSpace/g,F1).replace(/punct/g,a7).getRegex(),IZ=e(/\\(punct)/,"gu").replace(/punct/g,a7).getRegex(),BZ=e(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),vZ=e(v1).replace("(?:-->|$)","-->").getRegex(),OZ=e("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",vZ).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),d7=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,FZ=e(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",d7).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),i2=e(/^!?\[(label)\]\[(ref)\]/).replace("label",d7).replace("ref",B1).getRegex(),r2=e(/^!?\[(ref)\](?:\[\])?/).replace("ref",B1).getRegex(),NZ=e("reflink|nolink(?!\\()","g").replace("reflink",i2).replace("nolink",r2).getRegex(),N1={_backpedal:o9,anyPunctuation:IZ,autolink:BZ,blockSkip:VZ,br:l2,code:jZ,del:o9,emStrongLDelim:GZ,emStrongRDelimAst:qZ,emStrongRDelimUnd:UZ,escape:ZZ,link:FZ,nolink:r2,punctuation:QZ,reflink:i2,reflinkSearch:NZ,tag:OZ,text:KZ,url:o9},xZ={...N1,link:e(/^!?\[(label)\]\((.*?)\)/).replace("label",d7).getRegex(),reflink:e(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",d7).getRegex()},q1={...N1,emStrongRDelimAst:HZ,emStrongLDelim:WZ,url:e(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},bZ={...q1,br:e(l2).replace("{2,}","*").getRegex(),text:e(q1.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},p7={normal:O1,gfm:JZ,pedantic:YZ},s9={normal:N1,gfm:q1,breaks:bZ,pedantic:xZ},RZ={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},m2=($)=>RZ[$];function R8($,J){if(J){if(l0.escapeTest.test($))return $.replace(l0.escapeReplace,m2)}else if(l0.escapeTestNoEncode.test($))return $.replace(l0.escapeReplaceNoEncode,m2);return $}function C2($){try{$=encodeURI($).replace(l0.percentDecode,"%")}catch{return null}return $}function g2($,J){let Y=$.replace(l0.findPipe,(K,Q,X)=>{let V=!1,z=Q;while(--z>=0&&X[z]==="\\")V=!V;if(V)return"|";else return" |"}),Z=Y.split(l0.splitPipe),j=0;if(!Z[0].trim())Z.shift();if(Z.length>0&&!Z.at(-1)?.trim())Z.pop();if(J)if(Z.length>J)Z.splice(J);else while(Z.length<J)Z.push("");for(;j<Z.length;j++)Z[j]=Z[j].trim().replace(l0.slashPipe,"|");return Z}function a9($,J,Y){let Z=$.length;if(Z===0)return"";let j=0;while(j<Z){let K=$.charAt(Z-j-1);if(K===J&&!Y)j++;else if(K!==J&&Y)j++;else break}return $.slice(0,Z-j)}function DZ($,J){if($.indexOf(J[1])===-1)return-1;let Y=0;for(let Z=0;Z<$.length;Z++)if($[Z]==="\\")Z++;else if($[Z]===J[0])Y++;else if($[Z]===J[1]){if(Y--,Y<0)return Z}if(Y>0)return-2;return-1}function h2($,J,Y,Z,j){let K=J.href,Q=J.title||null,X=$[1].replace(j.other.outputLinkReplace,"$1");Z.state.inLink=!0;let V={type:$[0].charAt(0)==="!"?"image":"link",raw:Y,href:K,title:Q,text:X,tokens:Z.inlineTokens(X)};return Z.state.inLink=!1,V}function _Z($,J,Y){let Z=$.match(Y.other.indentCodeCompensation);if(Z===null)return J;let j=Z[1];return J.split(`
`).map((K)=>{let Q=K.match(Y.other.beginningSpace);if(Q===null)return K;let[X]=Q;if(X.length>=j.length)return K.slice(j.length);return K}).join(`
`)}var c7=class{options;rules;lexer;constructor($){this.options=$||I9}space($){let J=this.rules.block.newline.exec($);if(J&&J[0].length>0)return{type:"space",raw:J[0]}}code($){let J=this.rules.block.code.exec($);if(J){let Y=J[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:J[0],codeBlockStyle:"indented",text:!this.options.pedantic?a9(Y,`
`):Y}}}fences($){let J=this.rules.block.fences.exec($);if(J){let Y=J[0],Z=_Z(Y,J[3]||"",this.rules);return{type:"code",raw:Y,lang:J[2]?J[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):J[2],text:Z}}}heading($){let J=this.rules.block.heading.exec($);if(J){let Y=J[2].trim();if(this.rules.other.endingHash.test(Y)){let Z=a9(Y,"#");if(this.options.pedantic)Y=Z.trim();else if(!Z||this.rules.other.endingSpaceChar.test(Z))Y=Z.trim()}return{type:"heading",raw:J[0],depth:J[1].length,text:Y,tokens:this.lexer.inline(Y)}}}hr($){let J=this.rules.block.hr.exec($);if(J)return{type:"hr",raw:a9(J[0],`
`)}}blockquote($){let J=this.rules.block.blockquote.exec($);if(J){let Y=a9(J[0],`
`).split(`
`),Z="",j="",K=[];while(Y.length>0){let Q=!1,X=[],V;for(V=0;V<Y.length;V++)if(this.rules.other.blockquoteStart.test(Y[V]))X.push(Y[V]),Q=!0;else if(!Q)X.push(Y[V]);else break;Y=Y.slice(V);let z=X.join(`
`),G=z.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");Z=Z?`${Z}
${z}`:z,j=j?`${j}
${G}`:G;let W=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(G,K,!0),this.lexer.state.top=W,Y.length===0)break;let q=K.at(-1);if(q?.type==="code")break;else if(q?.type==="blockquote"){let H=q,U=H.raw+`
`+Y.join(`
`),O=this.blockquote(U);K[K.length-1]=O,Z=Z.substring(0,Z.length-H.raw.length)+O.raw,j=j.substring(0,j.length-H.text.length)+O.text;break}else if(q?.type==="list"){let H=q,U=H.raw+`
`+Y.join(`
`),O=this.list(U);K[K.length-1]=O,Z=Z.substring(0,Z.length-q.raw.length)+O.raw,j=j.substring(0,j.length-H.raw.length)+O.raw,Y=U.substring(K.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:Z,tokens:K,text:j}}}list($){let J=this.rules.block.list.exec($);if(J){let Y=J[1].trim(),Z=Y.length>1,j={type:"list",raw:"",ordered:Z,start:Z?+Y.slice(0,-1):"",loose:!1,items:[]};if(Y=Z?`\\d{1,9}\\${Y.slice(-1)}`:`\\${Y}`,this.options.pedantic)Y=Z?Y:"[*+-]";let K=this.rules.other.listItemRegex(Y),Q=!1;while($){let V=!1,z="",G="";if(!(J=K.exec($)))break;if(this.rules.block.hr.test($))break;z=J[0],$=$.substring(z.length);let W=J[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,(A)=>" ".repeat(3*A.length)),q=$.split(`
`,1)[0],H=!W.trim(),U=0;if(this.options.pedantic)U=2,G=W.trimStart();else if(H)U=J[1].length+1;else U=J[2].search(this.rules.other.nonSpaceChar),U=U>4?1:U,G=W.slice(U),U+=J[1].length;if(H&&this.rules.other.blankLine.test(q))z+=q+`
`,$=$.substring(q.length+1),V=!0;if(!V){let A=this.rules.other.nextBulletRegex(U),m=this.rules.other.hrRegex(U),E=this.rules.other.fencesBeginRegex(U),b=this.rules.other.headingBeginRegex(U),P=this.rules.other.htmlBeginRegex(U);while($){let f=$.split(`
`,1)[0],u;if(q=f,this.options.pedantic)q=q.replace(this.rules.other.listReplaceNesting,"  "),u=q;else u=q.replace(this.rules.other.tabCharGlobal,"    ");if(E.test(q))break;if(b.test(q))break;if(P.test(q))break;if(A.test(q))break;if(m.test(q))break;if(u.search(this.rules.other.nonSpaceChar)>=U||!q.trim())G+=`
`+u.slice(U);else{if(H)break;if(W.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(E.test(W))break;if(b.test(W))break;if(m.test(W))break;G+=`
`+q}if(!H&&!q.trim())H=!0;z+=f+`
`,$=$.substring(f.length+1),W=u.slice(U)}}if(!j.loose){if(Q)j.loose=!0;else if(this.rules.other.doubleBlankLine.test(z))Q=!0}let O=null,M;if(this.options.gfm){if(O=this.rules.other.listIsTask.exec(G),O)M=O[0]!=="[ ] ",G=G.replace(this.rules.other.listReplaceTask,"")}j.items.push({type:"list_item",raw:z,task:!!O,checked:M,loose:!1,text:G,tokens:[]}),j.raw+=z}let X=j.items.at(-1);if(X)X.raw=X.raw.trimEnd(),X.text=X.text.trimEnd();else return;j.raw=j.raw.trimEnd();for(let V=0;V<j.items.length;V++)if(this.lexer.state.top=!1,j.items[V].tokens=this.lexer.blockTokens(j.items[V].text,[]),!j.loose){let z=j.items[V].tokens.filter((W)=>W.type==="space"),G=z.length>0&&z.some((W)=>this.rules.other.anyLine.test(W.raw));j.loose=G}if(j.loose)for(let V=0;V<j.items.length;V++)j.items[V].loose=!0;return j}}html($){let J=this.rules.block.html.exec($);if(J)return{type:"html",block:!0,raw:J[0],pre:J[1]==="pre"||J[1]==="script"||J[1]==="style",text:J[0]}}def($){let J=this.rules.block.def.exec($);if(J){let Y=J[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),Z=J[2]?J[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",j=J[3]?J[3].substring(1,J[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):J[3];return{type:"def",tag:Y,raw:J[0],href:Z,title:j}}}table($){let J=this.rules.block.table.exec($);if(!J)return;if(!this.rules.other.tableDelimiter.test(J[2]))return;let Y=g2(J[1]),Z=J[2].replace(this.rules.other.tableAlignChars,"").split("|"),j=J[3]?.trim()?J[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],K={type:"table",raw:J[0],header:[],align:[],rows:[]};if(Y.length!==Z.length)return;for(let Q of Z)if(this.rules.other.tableAlignRight.test(Q))K.align.push("right");else if(this.rules.other.tableAlignCenter.test(Q))K.align.push("center");else if(this.rules.other.tableAlignLeft.test(Q))K.align.push("left");else K.align.push(null);for(let Q=0;Q<Y.length;Q++)K.header.push({text:Y[Q],tokens:this.lexer.inline(Y[Q]),header:!0,align:K.align[Q]});for(let Q of j)K.rows.push(g2(Q,K.header.length).map((X,V)=>{return{text:X,tokens:this.lexer.inline(X),header:!1,align:K.align[V]}}));return K}lheading($){let J=this.rules.block.lheading.exec($);if(J)return{type:"heading",raw:J[0],depth:J[2].charAt(0)==="="?1:2,text:J[1],tokens:this.lexer.inline(J[1])}}paragraph($){let J=this.rules.block.paragraph.exec($);if(J){let Y=J[1].charAt(J[1].length-1)===`
`?J[1].slice(0,-1):J[1];return{type:"paragraph",raw:J[0],text:Y,tokens:this.lexer.inline(Y)}}}text($){let J=this.rules.block.text.exec($);if(J)return{type:"text",raw:J[0],text:J[0],tokens:this.lexer.inline(J[0])}}escape($){let J=this.rules.inline.escape.exec($);if(J)return{type:"escape",raw:J[0],text:J[1]}}tag($){let J=this.rules.inline.tag.exec($);if(J){if(!this.lexer.state.inLink&&this.rules.other.startATag.test(J[0]))this.lexer.state.inLink=!0;else if(this.lexer.state.inLink&&this.rules.other.endATag.test(J[0]))this.lexer.state.inLink=!1;if(!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(J[0]))this.lexer.state.inRawBlock=!0;else if(this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(J[0]))this.lexer.state.inRawBlock=!1;return{type:"html",raw:J[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:J[0]}}}link($){let J=this.rules.inline.link.exec($);if(J){let Y=J[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(Y)){if(!this.rules.other.endAngleBracket.test(Y))return;let K=a9(Y.slice(0,-1),"\\");if((Y.length-K.length)%2===0)return}else{let K=DZ(J[2],"()");if(K===-2)return;if(K>-1){let X=(J[0].indexOf("!")===0?5:4)+J[1].length+K;J[2]=J[2].substring(0,K),J[0]=J[0].substring(0,X).trim(),J[3]=""}}let Z=J[2],j="";if(this.options.pedantic){let K=this.rules.other.pedanticHrefTitle.exec(Z);if(K)Z=K[1],j=K[3]}else j=J[3]?J[3].slice(1,-1):"";if(Z=Z.trim(),this.rules.other.startAngleBracket.test(Z))if(this.options.pedantic&&!this.rules.other.endAngleBracket.test(Y))Z=Z.slice(1);else Z=Z.slice(1,-1);return h2(J,{href:Z?Z.replace(this.rules.inline.anyPunctuation,"$1"):Z,title:j?j.replace(this.rules.inline.anyPunctuation,"$1"):j},J[0],this.lexer,this.rules)}}reflink($,J){let Y;if((Y=this.rules.inline.reflink.exec($))||(Y=this.rules.inline.nolink.exec($))){let Z=(Y[2]||Y[1]).replace(this.rules.other.multipleSpaceGlobal," "),j=J[Z.toLowerCase()];if(!j){let K=Y[0].charAt(0);return{type:"text",raw:K,text:K}}return h2(Y,j,Y[0],this.lexer,this.rules)}}emStrong($,J,Y=""){let Z=this.rules.inline.emStrongLDelim.exec($);if(!Z)return;if(Z[3]&&Y.match(this.rules.other.unicodeAlphaNumeric))return;if(!(Z[1]||Z[2])||!Y||this.rules.inline.punctuation.exec(Y)){let K=[...Z[0]].length-1,Q,X,V=K,z=0,G=Z[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;G.lastIndex=0,J=J.slice(-1*$.length+K);while((Z=G.exec(J))!=null){if(Q=Z[1]||Z[2]||Z[3]||Z[4]||Z[5]||Z[6],!Q)continue;if(X=[...Q].length,Z[3]||Z[4]){V+=X;continue}else if(Z[5]||Z[6]){if(K%3&&!((K+X)%3)){z+=X;continue}}if(V-=X,V>0)continue;X=Math.min(X,X+V+z);let W=[...Z[0]][0].length,q=$.slice(0,K+Z.index+W+X);if(Math.min(K,X)%2){let U=q.slice(1,-1);return{type:"em",raw:q,text:U,tokens:this.lexer.inlineTokens(U)}}let H=q.slice(2,-2);return{type:"strong",raw:q,text:H,tokens:this.lexer.inlineTokens(H)}}}}codespan($){let J=this.rules.inline.code.exec($);if(J){let Y=J[2].replace(this.rules.other.newLineCharGlobal," "),Z=this.rules.other.nonSpaceChar.test(Y),j=this.rules.other.startingSpaceChar.test(Y)&&this.rules.other.endingSpaceChar.test(Y);if(Z&&j)Y=Y.substring(1,Y.length-1);return{type:"codespan",raw:J[0],text:Y}}}br($){let J=this.rules.inline.br.exec($);if(J)return{type:"br",raw:J[0]}}del($){let J=this.rules.inline.del.exec($);if(J)return{type:"del",raw:J[0],text:J[2],tokens:this.lexer.inlineTokens(J[2])}}autolink($){let J=this.rules.inline.autolink.exec($);if(J){let Y,Z;if(J[2]==="@")Y=J[1],Z="mailto:"+Y;else Y=J[1],Z=Y;return{type:"link",raw:J[0],text:Y,href:Z,tokens:[{type:"text",raw:Y,text:Y}]}}}url($){let J;if(J=this.rules.inline.url.exec($)){let Y,Z;if(J[2]==="@")Y=J[0],Z="mailto:"+Y;else{let j;do j=J[0],J[0]=this.rules.inline._backpedal.exec(J[0])?.[0]??"";while(j!==J[0]);if(Y=J[0],J[1]==="www.")Z="http://"+J[0];else Z=J[0]}return{type:"link",raw:J[0],text:Y,href:Z,tokens:[{type:"text",raw:Y,text:Y}]}}}inlineText($){let J=this.rules.inline.text.exec($);if(J){let Y=this.lexer.state.inRawBlock;return{type:"text",raw:J[0],text:J[0],escaped:Y}}}},C8=class ${tokens;options;state;tokenizer;inlineQueue;constructor(J){this.tokens=[],this.tokens.links=Object.create(null),this.options=J||I9,this.options.tokenizer=this.options.tokenizer||new c7,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let Y={other:l0,block:p7.normal,inline:s9.normal};if(this.options.pedantic)Y.block=p7.pedantic,Y.inline=s9.pedantic;else if(this.options.gfm)if(Y.block=p7.gfm,this.options.breaks)Y.inline=s9.breaks;else Y.inline=s9.gfm;this.tokenizer.rules=Y}static get rules(){return{block:p7,inline:s9}}static lex(J,Y){return new $(Y).lex(J)}static lexInline(J,Y){return new $(Y).inlineTokens(J)}lex(J){J=J.replace(l0.carriageReturn,`
`),this.blockTokens(J,this.tokens);for(let Y=0;Y<this.inlineQueue.length;Y++){let Z=this.inlineQueue[Y];this.inlineTokens(Z.src,Z.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(J,Y=[],Z=!1){if(this.options.pedantic)J=J.replace(l0.tabCharGlobal,"    ").replace(l0.spaceLine,"");while(J){let j;if(this.options.extensions?.block?.some((Q)=>{if(j=Q.call({lexer:this},J,Y))return J=J.substring(j.raw.length),Y.push(j),!0;return!1}))continue;if(j=this.tokenizer.space(J)){J=J.substring(j.raw.length);let Q=Y.at(-1);if(j.raw.length===1&&Q!==void 0)Q.raw+=`
`;else Y.push(j);continue}if(j=this.tokenizer.code(J)){J=J.substring(j.raw.length);let Q=Y.at(-1);if(Q?.type==="paragraph"||Q?.type==="text")Q.raw+=`
`+j.raw,Q.text+=`
`+j.text,this.inlineQueue.at(-1).src=Q.text;else Y.push(j);continue}if(j=this.tokenizer.fences(J)){J=J.substring(j.raw.length),Y.push(j);continue}if(j=this.tokenizer.heading(J)){J=J.substring(j.raw.length),Y.push(j);continue}if(j=this.tokenizer.hr(J)){J=J.substring(j.raw.length),Y.push(j);continue}if(j=this.tokenizer.blockquote(J)){J=J.substring(j.raw.length),Y.push(j);continue}if(j=this.tokenizer.list(J)){J=J.substring(j.raw.length),Y.push(j);continue}if(j=this.tokenizer.html(J)){J=J.substring(j.raw.length),Y.push(j);continue}if(j=this.tokenizer.def(J)){J=J.substring(j.raw.length);let Q=Y.at(-1);if(Q?.type==="paragraph"||Q?.type==="text")Q.raw+=`
`+j.raw,Q.text+=`
`+j.raw,this.inlineQueue.at(-1).src=Q.text;else if(!this.tokens.links[j.tag])this.tokens.links[j.tag]={href:j.href,title:j.title};continue}if(j=this.tokenizer.table(J)){J=J.substring(j.raw.length),Y.push(j);continue}if(j=this.tokenizer.lheading(J)){J=J.substring(j.raw.length),Y.push(j);continue}let K=J;if(this.options.extensions?.startBlock){let Q=1/0,X=J.slice(1),V;if(this.options.extensions.startBlock.forEach((z)=>{if(V=z.call({lexer:this},X),typeof V==="number"&&V>=0)Q=Math.min(Q,V)}),Q<1/0&&Q>=0)K=J.substring(0,Q+1)}if(this.state.top&&(j=this.tokenizer.paragraph(K))){let Q=Y.at(-1);if(Z&&Q?.type==="paragraph")Q.raw+=`
`+j.raw,Q.text+=`
`+j.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=Q.text;else Y.push(j);Z=K.length!==J.length,J=J.substring(j.raw.length);continue}if(j=this.tokenizer.text(J)){J=J.substring(j.raw.length);let Q=Y.at(-1);if(Q?.type==="text")Q.raw+=`
`+j.raw,Q.text+=`
`+j.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=Q.text;else Y.push(j);continue}if(J){let Q="Infinite loop on byte: "+J.charCodeAt(0);if(this.options.silent){console.error(Q);break}else throw Error(Q)}}return this.state.top=!0,Y}inline(J,Y=[]){return this.inlineQueue.push({src:J,tokens:Y}),Y}inlineTokens(J,Y=[]){let Z=J,j=null;if(this.tokens.links){let X=Object.keys(this.tokens.links);if(X.length>0){while((j=this.tokenizer.rules.inline.reflinkSearch.exec(Z))!=null)if(X.includes(j[0].slice(j[0].lastIndexOf("[")+1,-1)))Z=Z.slice(0,j.index)+"["+"a".repeat(j[0].length-2)+"]"+Z.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex)}}while((j=this.tokenizer.rules.inline.anyPunctuation.exec(Z))!=null)Z=Z.slice(0,j.index)+"++"+Z.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);while((j=this.tokenizer.rules.inline.blockSkip.exec(Z))!=null)Z=Z.slice(0,j.index)+"["+"a".repeat(j[0].length-2)+"]"+Z.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let K=!1,Q="";while(J){if(!K)Q="";K=!1;let X;if(this.options.extensions?.inline?.some((z)=>{if(X=z.call({lexer:this},J,Y))return J=J.substring(X.raw.length),Y.push(X),!0;return!1}))continue;if(X=this.tokenizer.escape(J)){J=J.substring(X.raw.length),Y.push(X);continue}if(X=this.tokenizer.tag(J)){J=J.substring(X.raw.length),Y.push(X);continue}if(X=this.tokenizer.link(J)){J=J.substring(X.raw.length),Y.push(X);continue}if(X=this.tokenizer.reflink(J,this.tokens.links)){J=J.substring(X.raw.length);let z=Y.at(-1);if(X.type==="text"&&z?.type==="text")z.raw+=X.raw,z.text+=X.text;else Y.push(X);continue}if(X=this.tokenizer.emStrong(J,Z,Q)){J=J.substring(X.raw.length),Y.push(X);continue}if(X=this.tokenizer.codespan(J)){J=J.substring(X.raw.length),Y.push(X);continue}if(X=this.tokenizer.br(J)){J=J.substring(X.raw.length),Y.push(X);continue}if(X=this.tokenizer.del(J)){J=J.substring(X.raw.length),Y.push(X);continue}if(X=this.tokenizer.autolink(J)){J=J.substring(X.raw.length),Y.push(X);continue}if(!this.state.inLink&&(X=this.tokenizer.url(J))){J=J.substring(X.raw.length),Y.push(X);continue}let V=J;if(this.options.extensions?.startInline){let z=1/0,G=J.slice(1),W;if(this.options.extensions.startInline.forEach((q)=>{if(W=q.call({lexer:this},G),typeof W==="number"&&W>=0)z=Math.min(z,W)}),z<1/0&&z>=0)V=J.substring(0,z+1)}if(X=this.tokenizer.inlineText(V)){if(J=J.substring(X.raw.length),X.raw.slice(-1)!=="_")Q=X.raw.slice(-1);K=!0;let z=Y.at(-1);if(z?.type==="text")z.raw+=X.raw,z.text+=X.text;else Y.push(X);continue}if(J){let z="Infinite loop on byte: "+J.charCodeAt(0);if(this.options.silent){console.error(z);break}else throw Error(z)}}return Y}},l7=class{options;parser;constructor($){this.options=$||I9}space($){return""}code({text:$,lang:J,escaped:Y}){let Z=(J||"").match(l0.notSpaceStart)?.[0],j=$.replace(l0.endingNewline,"")+`
`;if(!Z)return"<pre><code>"+(Y?j:R8(j,!0))+`</code></pre>
`;return'<pre><code class="language-'+R8(Z)+'">'+(Y?j:R8(j,!0))+`</code></pre>
`}blockquote({tokens:$}){return`<blockquote>
${this.parser.parse($)}</blockquote>
`}html({text:$}){return $}heading({tokens:$,depth:J}){return`<h${J}>${this.parser.parseInline($)}</h${J}>
`}hr($){return`<hr>
`}list($){let{ordered:J,start:Y}=$,Z="";for(let Q=0;Q<$.items.length;Q++){let X=$.items[Q];Z+=this.listitem(X)}let j=J?"ol":"ul",K=J&&Y!==1?' start="'+Y+'"':"";return"<"+j+K+`>
`+Z+"</"+j+`>
`}listitem($){let J="";if($.task){let Y=this.checkbox({checked:!!$.checked});if($.loose)if($.tokens[0]?.type==="paragraph"){if($.tokens[0].text=Y+" "+$.tokens[0].text,$.tokens[0].tokens&&$.tokens[0].tokens.length>0&&$.tokens[0].tokens[0].type==="text")$.tokens[0].tokens[0].text=Y+" "+R8($.tokens[0].tokens[0].text),$.tokens[0].tokens[0].escaped=!0}else $.tokens.unshift({type:"text",raw:Y+" ",text:Y+" ",escaped:!0});else J+=Y+" "}return J+=this.parser.parse($.tokens,!!$.loose),`<li>${J}</li>
`}checkbox({checked:$}){return"<input "+($?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:$}){return`<p>${this.parser.parseInline($)}</p>
`}table($){let J="",Y="";for(let j=0;j<$.header.length;j++)Y+=this.tablecell($.header[j]);J+=this.tablerow({text:Y});let Z="";for(let j=0;j<$.rows.length;j++){let K=$.rows[j];Y="";for(let Q=0;Q<K.length;Q++)Y+=this.tablecell(K[Q]);Z+=this.tablerow({text:Y})}if(Z)Z=`<tbody>${Z}</tbody>`;return`<table>
<thead>
`+J+`</thead>
`+Z+`</table>
`}tablerow({text:$}){return`<tr>
${$}</tr>
`}tablecell($){let J=this.parser.parseInline($.tokens),Y=$.header?"th":"td";return($.align?`<${Y} align="${$.align}">`:`<${Y}>`)+J+`</${Y}>
`}strong({tokens:$}){return`<strong>${this.parser.parseInline($)}</strong>`}em({tokens:$}){return`<em>${this.parser.parseInline($)}</em>`}codespan({text:$}){return`<code>${R8($,!0)}</code>`}br($){return"<br>"}del({tokens:$}){return`<del>${this.parser.parseInline($)}</del>`}link({href:$,title:J,tokens:Y}){let Z=this.parser.parseInline(Y),j=C2($);if(j===null)return Z;$=j;let K='<a href="'+$+'"';if(J)K+=' title="'+R8(J)+'"';return K+=">"+Z+"</a>",K}image({href:$,title:J,text:Y,tokens:Z}){if(Z)Y=this.parser.parseInline(Z,this.parser.textRenderer);let j=C2($);if(j===null)return R8(Y);$=j;let K=`<img src="${$}" alt="${Y}"`;if(J)K+=` title="${R8(J)}"`;return K+=">",K}text($){return"tokens"in $&&$.tokens?this.parser.parseInline($.tokens):("escaped"in $)&&$.escaped?$.text:R8($.text)}},x1=class{strong({text:$}){return $}em({text:$}){return $}codespan({text:$}){return $}del({text:$}){return $}html({text:$}){return $}text({text:$}){return $}link({text:$}){return""+$}image({text:$}){return""+$}br(){return""}},g8=class ${options;renderer;textRenderer;constructor(J){this.options=J||I9,this.options.renderer=this.options.renderer||new l7,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new x1}static parse(J,Y){return new $(Y).parse(J)}static parseInline(J,Y){return new $(Y).parseInline(J)}parse(J,Y=!0){let Z="";for(let j=0;j<J.length;j++){let K=J[j];if(this.options.extensions?.renderers?.[K.type]){let X=K,V=this.options.extensions.renderers[X.type].call({parser:this},X);if(V!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(X.type)){Z+=V||"";continue}}let Q=K;switch(Q.type){case"space":{Z+=this.renderer.space(Q);continue}case"hr":{Z+=this.renderer.hr(Q);continue}case"heading":{Z+=this.renderer.heading(Q);continue}case"code":{Z+=this.renderer.code(Q);continue}case"table":{Z+=this.renderer.table(Q);continue}case"blockquote":{Z+=this.renderer.blockquote(Q);continue}case"list":{Z+=this.renderer.list(Q);continue}case"html":{Z+=this.renderer.html(Q);continue}case"paragraph":{Z+=this.renderer.paragraph(Q);continue}case"text":{let X=Q,V=this.renderer.text(X);while(j+1<J.length&&J[j+1].type==="text")X=J[++j],V+=`
`+this.renderer.text(X);if(Y)Z+=this.renderer.paragraph({type:"paragraph",raw:V,text:V,tokens:[{type:"text",raw:V,text:V,escaped:!0}]});else Z+=V;continue}default:{let X='Token with "'+Q.type+'" type was not found.';if(this.options.silent)return console.error(X),"";else throw Error(X)}}}return Z}parseInline(J,Y=this.renderer){let Z="";for(let j=0;j<J.length;j++){let K=J[j];if(this.options.extensions?.renderers?.[K.type]){let X=this.options.extensions.renderers[K.type].call({parser:this},K);if(X!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(K.type)){Z+=X||"";continue}}let Q=K;switch(Q.type){case"escape":{Z+=Y.text(Q);break}case"html":{Z+=Y.html(Q);break}case"link":{Z+=Y.link(Q);break}case"image":{Z+=Y.image(Q);break}case"strong":{Z+=Y.strong(Q);break}case"em":{Z+=Y.em(Q);break}case"codespan":{Z+=Y.codespan(Q);break}case"br":{Z+=Y.br(Q);break}case"del":{Z+=Y.del(Q);break}case"text":{Z+=Y.text(Q);break}default:{let X='Token with "'+Q.type+'" type was not found.';if(this.options.silent)return console.error(X),"";else throw Error(X)}}}return Z}},u7=class{options;block;constructor($){this.options=$||I9}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess($){return $}postprocess($){return $}processAllTokens($){return $}provideLexer(){return this.block?C8.lex:C8.lexInline}provideParser(){return this.block?g8.parse:g8.parseInline}},MZ=class{defaults=H1();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=g8;Renderer=l7;TextRenderer=x1;Lexer=C8;Tokenizer=c7;Hooks=u7;constructor(...$){this.use(...$)}walkTokens($,J){let Y=[];for(let Z of $)switch(Y=Y.concat(J.call(this,Z)),Z.type){case"table":{let j=Z;for(let K of j.header)Y=Y.concat(this.walkTokens(K.tokens,J));for(let K of j.rows)for(let Q of K)Y=Y.concat(this.walkTokens(Q.tokens,J));break}case"list":{let j=Z;Y=Y.concat(this.walkTokens(j.items,J));break}default:{let j=Z;if(this.defaults.extensions?.childTokens?.[j.type])this.defaults.extensions.childTokens[j.type].forEach((K)=>{let Q=j[K].flat(1/0);Y=Y.concat(this.walkTokens(Q,J))});else if(j.tokens)Y=Y.concat(this.walkTokens(j.tokens,J))}}return Y}use(...$){let J=this.defaults.extensions||{renderers:{},childTokens:{}};return $.forEach((Y)=>{let Z={...Y};if(Z.async=this.defaults.async||Z.async||!1,Y.extensions)Y.extensions.forEach((j)=>{if(!j.name)throw Error("extension name required");if("renderer"in j){let K=J.renderers[j.name];if(K)J.renderers[j.name]=function(...Q){let X=j.renderer.apply(this,Q);if(X===!1)X=K.apply(this,Q);return X};else J.renderers[j.name]=j.renderer}if("tokenizer"in j){if(!j.level||j.level!=="block"&&j.level!=="inline")throw Error("extension level must be 'block' or 'inline'");let K=J[j.level];if(K)K.unshift(j.tokenizer);else J[j.level]=[j.tokenizer];if(j.start){if(j.level==="block")if(J.startBlock)J.startBlock.push(j.start);else J.startBlock=[j.start];else if(j.level==="inline")if(J.startInline)J.startInline.push(j.start);else J.startInline=[j.start]}}if("childTokens"in j&&j.childTokens)J.childTokens[j.name]=j.childTokens}),Z.extensions=J;if(Y.renderer){let j=this.defaults.renderer||new l7(this.defaults);for(let K in Y.renderer){if(!(K in j))throw Error(`renderer '${K}' does not exist`);if(["options","parser"].includes(K))continue;let Q=K,X=Y.renderer[Q],V=j[Q];j[Q]=(...z)=>{let G=X.apply(j,z);if(G===!1)G=V.apply(j,z);return G||""}}Z.renderer=j}if(Y.tokenizer){let j=this.defaults.tokenizer||new c7(this.defaults);for(let K in Y.tokenizer){if(!(K in j))throw Error(`tokenizer '${K}' does not exist`);if(["options","rules","lexer"].includes(K))continue;let Q=K,X=Y.tokenizer[Q],V=j[Q];j[Q]=(...z)=>{let G=X.apply(j,z);if(G===!1)G=V.apply(j,z);return G}}Z.tokenizer=j}if(Y.hooks){let j=this.defaults.hooks||new u7;for(let K in Y.hooks){if(!(K in j))throw Error(`hook '${K}' does not exist`);if(["options","block"].includes(K))continue;let Q=K,X=Y.hooks[Q],V=j[Q];if(u7.passThroughHooks.has(K))j[Q]=(z)=>{if(this.defaults.async)return Promise.resolve(X.call(j,z)).then((W)=>{return V.call(j,W)});let G=X.call(j,z);return V.call(j,G)};else j[Q]=(...z)=>{let G=X.apply(j,z);if(G===!1)G=V.apply(j,z);return G}}Z.hooks=j}if(Y.walkTokens){let j=this.defaults.walkTokens,K=Y.walkTokens;Z.walkTokens=function(Q){let X=[];if(X.push(K.call(this,Q)),j)X=X.concat(j.call(this,Q));return X}}this.defaults={...this.defaults,...Z}}),this}setOptions($){return this.defaults={...this.defaults,...$},this}lexer($,J){return C8.lex($,J??this.defaults)}parser($,J){return g8.parse($,J??this.defaults)}parseMarkdown($){return(Y,Z)=>{let j={...Z},K={...this.defaults,...j},Q=this.onError(!!K.silent,!!K.async);if(this.defaults.async===!0&&j.async===!1)return Q(Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof Y>"u"||Y===null)return Q(Error("marked(): input parameter is undefined or null"));if(typeof Y!=="string")return Q(Error("marked(): input parameter is of type "+Object.prototype.toString.call(Y)+", string expected"));if(K.hooks)K.hooks.options=K,K.hooks.block=$;let X=K.hooks?K.hooks.provideLexer():$?C8.lex:C8.lexInline,V=K.hooks?K.hooks.provideParser():$?g8.parse:g8.parseInline;if(K.async)return Promise.resolve(K.hooks?K.hooks.preprocess(Y):Y).then((z)=>X(z,K)).then((z)=>K.hooks?K.hooks.processAllTokens(z):z).then((z)=>K.walkTokens?Promise.all(this.walkTokens(z,K.walkTokens)).then(()=>z):z).then((z)=>V(z,K)).then((z)=>K.hooks?K.hooks.postprocess(z):z).catch(Q);try{if(K.hooks)Y=K.hooks.preprocess(Y);let z=X(Y,K);if(K.hooks)z=K.hooks.processAllTokens(z);if(K.walkTokens)this.walkTokens(z,K.walkTokens);let G=V(z,K);if(K.hooks)G=K.hooks.postprocess(G);return G}catch(z){return Q(z)}}}onError($,J){return(Y)=>{if(Y.message+=`
Please report this to https://github.com/markedjs/marked.`,$){let Z="<p>An error occurred:</p><pre>"+R8(Y.message+"",!0)+"</pre>";if(J)return Promise.resolve(Z);return Z}if(J)return Promise.reject(Y);throw Y}}},U9=new MZ;function t($,J){return U9.parse($,J)}t.options=t.setOptions=function($){return U9.setOptions($),t.defaults=U9.defaults,p2(t.defaults),t};t.getDefaults=H1;t.defaults=I9;t.use=function(...$){return U9.use(...$),t.defaults=U9.defaults,p2(t.defaults),t};t.walkTokens=function($,J){return U9.walkTokens($,J)};t.parseInline=U9.parseInline;t.Parser=g8;t.parser=g8.parse;t.Renderer=l7;t.TextRenderer=x1;t.Lexer=C8;t.lexer=C8.lex;t.Tokenizer=c7;t.Hooks=u7;t.parse=t;var{options:X3,setOptions:z3,use:V3,walkTokens:G3,parseInline:W3}=t;var q3=g8.parse,H3=C8.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */var{entries:Q$,setPrototypeOf:t2,isFrozen:yZ,getPrototypeOf:wZ,getOwnPropertyDescriptor:LZ}=Object,{freeze:a0,seal:q8,create:w1}=Object,{apply:L1,construct:E1}=typeof Reflect<"u"&&Reflect;if(!a0)a0=function(J){return J};if(!q8)q8=function(J){return J};if(!L1)L1=function(J,Y){for(var Z=arguments.length,j=Array(Z>2?Z-2:0),K=2;K<Z;K++)j[K-2]=arguments[K];return J.apply(Y,j)};if(!E1)E1=function(J){for(var Y=arguments.length,Z=Array(Y>1?Y-1:0),j=1;j<Y;j++)Z[j-1]=arguments[j];return new J(...Z)};var o7=o0(Array.prototype.forEach),EZ=o0(Array.prototype.lastIndexOf),e2=o0(Array.prototype.pop),i9=o0(Array.prototype.push),PZ=o0(Array.prototype.splice),i7=o0(String.prototype.toLowerCase),b1=o0(String.prototype.toString),R1=o0(String.prototype.match),r9=o0(String.prototype.replace),AZ=o0(String.prototype.indexOf),fZ=o0(String.prototype.trim),O8=o0(Object.prototype.hasOwnProperty),s0=o0(RegExp.prototype.test),t9=TZ(TypeError);function o0($){return function(J){if(J instanceof RegExp)J.lastIndex=0;for(var Y=arguments.length,Z=Array(Y>1?Y-1:0),j=1;j<Y;j++)Z[j-1]=arguments[j];return L1($,J,Z)}}function TZ($){return function(){for(var J=arguments.length,Y=Array(J),Z=0;Z<J;Z++)Y[Z]=arguments[Z];return E1($,Y)}}function a($,J){let Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:i7;if(t2)t2($,null);let Z=J.length;while(Z--){let j=J[Z];if(typeof j==="string"){let K=Y(j);if(K!==j){if(!yZ(J))J[Z]=K;j=K}}$[j]=!0}return $}function kZ($){for(let J=0;J<$.length;J++)if(!O8($,J))$[J]=null;return $}function D8($){let J=w1(null);for(let[Y,Z]of Q$($))if(O8($,Y))if(Array.isArray(Z))J[Y]=kZ(Z);else if(Z&&typeof Z==="object"&&Z.constructor===Object)J[Y]=D8(Z);else J[Y]=Z;return J}function e9($,J){while($!==null){let Z=LZ($,J);if(Z){if(Z.get)return o0(Z.get);if(typeof Z.value==="function")return o0(Z.value)}$=wZ($)}function Y(){return null}return Y}var $$=a0(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),D1=a0(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),_1=a0(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),SZ=a0(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),M1=a0(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),mZ=a0(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),J$=a0(["#text"]),Y$=a0(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),y1=a0(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Z$=a0(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),n7=a0(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),CZ=q8(/\{\{[\w\W]*|[\w\W]*\}\}/gm),gZ=q8(/<%[\w\W]*|[\w\W]*%>/gm),hZ=q8(/\$\{[\w\W]*/gm),pZ=q8(/^data-[\-\w.\u00B7-\uFFFF]+$/),uZ=q8(/^aria-[\-\w]+$/),X$=q8(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),dZ=q8(/^(?:\w+script|data):/i),cZ=q8(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),z$=q8(/^html$/i),lZ=q8(/^[a-z][.\w]*(-[.\w]+)+$/i),j$=Object.freeze({__proto__:null,ARIA_ATTR:uZ,ATTR_WHITESPACE:cZ,CUSTOM_ELEMENT:lZ,DATA_ATTR:pZ,DOCTYPE_NAME:z$,ERB_EXPR:gZ,IS_ALLOWED_URI:X$,IS_SCRIPT_OR_DATA:dZ,MUSTACHE_EXPR:CZ,TMPLIT_EXPR:hZ}),$7={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},sZ=function(){return typeof window>"u"?null:window},aZ=function(J,Y){if(typeof J!=="object"||typeof J.createPolicy!=="function")return null;let Z=null,j="data-tt-policy-suffix";if(Y&&Y.hasAttribute(j))Z=Y.getAttribute(j);let K="dompurify"+(Z?"#"+Z:"");try{return J.createPolicy(K,{createHTML(Q){return Q},createScriptURL(Q){return Q}})}catch(Q){return console.warn("TrustedTypes policy "+K+" could not be created."),null}},K$=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function V$(){let $=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sZ(),J=(g)=>V$(g);if(J.version="3.3.1",J.removed=[],!$||!$.document||$.document.nodeType!==$7.document||!$.Element)return J.isSupported=!1,J;let{document:Y}=$,Z=Y,j=Z.currentScript,{DocumentFragment:K,HTMLTemplateElement:Q,Node:X,Element:V,NodeFilter:z,NamedNodeMap:G=$.NamedNodeMap||$.MozNamedAttrMap,HTMLFormElement:W,DOMParser:q,trustedTypes:H}=$,U=V.prototype,O=e9(U,"cloneNode"),M=e9(U,"remove"),A=e9(U,"nextSibling"),m=e9(U,"childNodes"),E=e9(U,"parentNode");if(typeof Q==="function"){let g=Y.createElement("template");if(g.content&&g.content.ownerDocument)Y=g.content.ownerDocument}let b,P="",{implementation:f,createNodeIterator:u,createDocumentFragment:$0,getElementsByTagName:G0}=Y,{importNode:m0}=Z,S=K$();J.isSupported=typeof Q$==="function"&&typeof E==="function"&&f&&f.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:u0,ERB_EXPR:B,TMPLIT_EXPR:v,DATA_ATTR:R,ARIA_ATTR:N,IS_SCRIPT_OR_DATA:x,ATTR_WHITESPACE:F,CUSTOM_ELEMENT:_}=j$,{IS_ALLOWED_URI:y}=j$,T=null,r=a({},[...$$,...D1,..._1,...M1,...J$]),h=null,i=a({},[...Y$,...y1,...Z$,...n7]),c=Object.seal(w1(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),n=null,Z0=null,o=Object.seal(w1(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}})),j0=!0,W8=!0,Z8=!1,d0=!0,l=!1,j8=!0,f8=!1,d9=!1,W9=!1,T8=!1,q9=!1,y9=!1,W2=!0,q2=!1,BY="user-content-",u6=!0,c9=!1,w9={},x8=null,d6=a({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),H2=null,U2=a({},["audio","video","img","source","image","track"]),c6=null,I2=a({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),f7="http://www.w3.org/1998/Math/MathML",T7="http://www.w3.org/2000/svg",k8="http://www.w3.org/1999/xhtml",L9=k8,l6=!1,s6=null,vY=a({},[f7,T7,k8],b1),k7=a({},["mi","mo","mn","ms","mtext"]),S7=a({},["annotation-xml"]),OY=a({},["title","style","font","a","script"]),l9=null,FY=["application/xhtml+xml","text/html"],NY="text/html",D0=null,E9=null,xY=Y.createElement("form"),B2=function(I){return I instanceof RegExp||I instanceof Function},a6=function(){let I=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(E9&&E9===I)return;if(!I||typeof I!=="object")I={};if(I=D8(I),l9=FY.indexOf(I.PARSER_MEDIA_TYPE)===-1?NY:I.PARSER_MEDIA_TYPE,D0=l9==="application/xhtml+xml"?b1:i7,T=O8(I,"ALLOWED_TAGS")?a({},I.ALLOWED_TAGS,D0):r,h=O8(I,"ALLOWED_ATTR")?a({},I.ALLOWED_ATTR,D0):i,s6=O8(I,"ALLOWED_NAMESPACES")?a({},I.ALLOWED_NAMESPACES,b1):vY,c6=O8(I,"ADD_URI_SAFE_ATTR")?a(D8(I2),I.ADD_URI_SAFE_ATTR,D0):I2,H2=O8(I,"ADD_DATA_URI_TAGS")?a(D8(U2),I.ADD_DATA_URI_TAGS,D0):U2,x8=O8(I,"FORBID_CONTENTS")?a({},I.FORBID_CONTENTS,D0):d6,n=O8(I,"FORBID_TAGS")?a({},I.FORBID_TAGS,D0):D8({}),Z0=O8(I,"FORBID_ATTR")?a({},I.FORBID_ATTR,D0):D8({}),w9=O8(I,"USE_PROFILES")?I.USE_PROFILES:!1,j0=I.ALLOW_ARIA_ATTR!==!1,W8=I.ALLOW_DATA_ATTR!==!1,Z8=I.ALLOW_UNKNOWN_PROTOCOLS||!1,d0=I.ALLOW_SELF_CLOSE_IN_ATTR!==!1,l=I.SAFE_FOR_TEMPLATES||!1,j8=I.SAFE_FOR_XML!==!1,f8=I.WHOLE_DOCUMENT||!1,T8=I.RETURN_DOM||!1,q9=I.RETURN_DOM_FRAGMENT||!1,y9=I.RETURN_TRUSTED_TYPE||!1,W9=I.FORCE_BODY||!1,W2=I.SANITIZE_DOM!==!1,q2=I.SANITIZE_NAMED_PROPS||!1,u6=I.KEEP_CONTENT!==!1,c9=I.IN_PLACE||!1,y=I.ALLOWED_URI_REGEXP||X$,L9=I.NAMESPACE||k8,k7=I.MATHML_TEXT_INTEGRATION_POINTS||k7,S7=I.HTML_INTEGRATION_POINTS||S7,c=I.CUSTOM_ELEMENT_HANDLING||{},I.CUSTOM_ELEMENT_HANDLING&&B2(I.CUSTOM_ELEMENT_HANDLING.tagNameCheck))c.tagNameCheck=I.CUSTOM_ELEMENT_HANDLING.tagNameCheck;if(I.CUSTOM_ELEMENT_HANDLING&&B2(I.CUSTOM_ELEMENT_HANDLING.attributeNameCheck))c.attributeNameCheck=I.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;if(I.CUSTOM_ELEMENT_HANDLING&&typeof I.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements==="boolean")c.allowCustomizedBuiltInElements=I.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;if(l)W8=!1;if(q9)T8=!0;if(w9){if(T=a({},J$),h=[],w9.html===!0)a(T,$$),a(h,Y$);if(w9.svg===!0)a(T,D1),a(h,y1),a(h,n7);if(w9.svgFilters===!0)a(T,_1),a(h,y1),a(h,n7);if(w9.mathMl===!0)a(T,M1),a(h,Z$),a(h,n7)}if(I.ADD_TAGS)if(typeof I.ADD_TAGS==="function")o.tagCheck=I.ADD_TAGS;else{if(T===r)T=D8(T);a(T,I.ADD_TAGS,D0)}if(I.ADD_ATTR)if(typeof I.ADD_ATTR==="function")o.attributeCheck=I.ADD_ATTR;else{if(h===i)h=D8(h);a(h,I.ADD_ATTR,D0)}if(I.ADD_URI_SAFE_ATTR)a(c6,I.ADD_URI_SAFE_ATTR,D0);if(I.FORBID_CONTENTS){if(x8===d6)x8=D8(x8);a(x8,I.FORBID_CONTENTS,D0)}if(I.ADD_FORBID_CONTENTS){if(x8===d6)x8=D8(x8);a(x8,I.ADD_FORBID_CONTENTS,D0)}if(u6)T["#text"]=!0;if(f8)a(T,["html","head","body"]);if(T.table)a(T,["tbody"]),delete n.tbody;if(I.TRUSTED_TYPES_POLICY){if(typeof I.TRUSTED_TYPES_POLICY.createHTML!=="function")throw t9('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof I.TRUSTED_TYPES_POLICY.createScriptURL!=="function")throw t9('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');b=I.TRUSTED_TYPES_POLICY,P=b.createHTML("")}else{if(b===void 0)b=aZ(H,j);if(b!==null&&typeof P==="string")P=b.createHTML("")}if(a0)a0(I);E9=I},v2=a({},[...D1,..._1,...SZ]),O2=a({},[...M1,...mZ]),bY=function(I){let w=E(I);if(!w||!w.tagName)w={namespaceURI:L9,tagName:"template"};let C=i7(I.tagName),V0=i7(w.tagName);if(!s6[I.namespaceURI])return!1;if(I.namespaceURI===T7){if(w.namespaceURI===k8)return C==="svg";if(w.namespaceURI===f7)return C==="svg"&&(V0==="annotation-xml"||k7[V0]);return Boolean(v2[C])}if(I.namespaceURI===f7){if(w.namespaceURI===k8)return C==="math";if(w.namespaceURI===T7)return C==="math"&&S7[V0];return Boolean(O2[C])}if(I.namespaceURI===k8){if(w.namespaceURI===T7&&!S7[V0])return!1;if(w.namespaceURI===f7&&!k7[V0])return!1;return!O2[C]&&(OY[C]||!v2[C])}if(l9==="application/xhtml+xml"&&s6[I.namespaceURI])return!0;return!1},b8=function(I){i9(J.removed,{element:I});try{E(I).removeChild(I)}catch(w){M(I)}},H9=function(I,w){try{i9(J.removed,{attribute:w.getAttributeNode(I),from:w})}catch(C){i9(J.removed,{attribute:null,from:w})}if(w.removeAttribute(I),I==="is")if(T8||q9)try{b8(w)}catch(C){}else try{w.setAttribute(I,"")}catch(C){}},F2=function(I){let w=null,C=null;if(W9)I="<remove></remove>"+I;else{let N0=R1(I,/^[\r\n\t ]+/);C=N0&&N0[0]}if(l9==="application/xhtml+xml"&&L9===k8)I='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+I+"</body></html>";let V0=b?b.createHTML(I):I;if(L9===k8)try{w=new q().parseFromString(V0,l9)}catch(N0){}if(!w||!w.documentElement){w=f.createDocument(L9,"template",null);try{w.documentElement.innerHTML=l6?P:V0}catch(N0){}}let c0=w.body||w.documentElement;if(I&&C)c0.insertBefore(Y.createTextNode(C),c0.childNodes[0]||null);if(L9===k8)return G0.call(w,f8?"html":"body")[0];return f8?w.documentElement:c0},N2=function(I){return u.call(I.ownerDocument||I,I,z.SHOW_ELEMENT|z.SHOW_COMMENT|z.SHOW_TEXT|z.SHOW_PROCESSING_INSTRUCTION|z.SHOW_CDATA_SECTION,null)},o6=function(I){return I instanceof W&&(typeof I.nodeName!=="string"||typeof I.textContent!=="string"||typeof I.removeChild!=="function"||!(I.attributes instanceof G)||typeof I.removeAttribute!=="function"||typeof I.setAttribute!=="function"||typeof I.namespaceURI!=="string"||typeof I.insertBefore!=="function"||typeof I.hasChildNodes!=="function")},x2=function(I){return typeof X==="function"&&I instanceof X};function S8(g,I,w){o7(g,(C)=>{C.call(J,I,w,E9)})}let b2=function(I){let w=null;if(S8(S.beforeSanitizeElements,I,null),o6(I))return b8(I),!0;let C=D0(I.nodeName);if(S8(S.uponSanitizeElement,I,{tagName:C,allowedTags:T}),j8&&I.hasChildNodes()&&!x2(I.firstElementChild)&&s0(/<[/\w!]/g,I.innerHTML)&&s0(/<[/\w!]/g,I.textContent))return b8(I),!0;if(I.nodeType===$7.progressingInstruction)return b8(I),!0;if(j8&&I.nodeType===$7.comment&&s0(/<[/\w]/g,I.data))return b8(I),!0;if(!(o.tagCheck instanceof Function&&o.tagCheck(C))&&(!T[C]||n[C])){if(!n[C]&&D2(C)){if(c.tagNameCheck instanceof RegExp&&s0(c.tagNameCheck,C))return!1;if(c.tagNameCheck instanceof Function&&c.tagNameCheck(C))return!1}if(u6&&!x8[C]){let V0=E(I)||I.parentNode,c0=m(I)||I.childNodes;if(c0&&V0){let N0=c0.length;for(let $8=N0-1;$8>=0;--$8){let m8=O(c0[$8],!0);m8.__removalCount=(I.__removalCount||0)+1,V0.insertBefore(m8,A(I))}}}return b8(I),!0}if(I instanceof V&&!bY(I))return b8(I),!0;if((C==="noscript"||C==="noembed"||C==="noframes")&&s0(/<\/no(script|embed|frames)/i,I.innerHTML))return b8(I),!0;if(l&&I.nodeType===$7.text){if(w=I.textContent,o7([u0,B,v],(V0)=>{w=r9(w,V0," ")}),I.textContent!==w)i9(J.removed,{element:I.cloneNode()}),I.textContent=w}return S8(S.afterSanitizeElements,I,null),!1},R2=function(I,w,C){if(W2&&(w==="id"||w==="name")&&((C in Y)||(C in xY)))return!1;if(W8&&!Z0[w]&&s0(R,w));else if(j0&&s0(N,w));else if(o.attributeCheck instanceof Function&&o.attributeCheck(w,I));else if(!h[w]||Z0[w])if(D2(I)&&(c.tagNameCheck instanceof RegExp&&s0(c.tagNameCheck,I)||c.tagNameCheck instanceof Function&&c.tagNameCheck(I))&&(c.attributeNameCheck instanceof RegExp&&s0(c.attributeNameCheck,w)||c.attributeNameCheck instanceof Function&&c.attributeNameCheck(w,I))||w==="is"&&c.allowCustomizedBuiltInElements&&(c.tagNameCheck instanceof RegExp&&s0(c.tagNameCheck,C)||c.tagNameCheck instanceof Function&&c.tagNameCheck(C)));else return!1;else if(c6[w]);else if(s0(y,r9(C,F,"")));else if((w==="src"||w==="xlink:href"||w==="href")&&I!=="script"&&AZ(C,"data:")===0&&H2[I]);else if(Z8&&!s0(x,r9(C,F,"")));else if(C)return!1;return!0},D2=function(I){return I!=="annotation-xml"&&R1(I,_)},_2=function(I){S8(S.beforeSanitizeAttributes,I,null);let{attributes:w}=I;if(!w||o6(I))return;let C={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:h,forceKeepAttr:void 0},V0=w.length;while(V0--){let c0=w[V0],{name:N0,namespaceURI:$8,value:m8}=c0,P9=D0(N0),n6=m8,C0=N0==="value"?n6:fZ(n6);if(C.attrName=P9,C.attrValue=C0,C.keepAttr=!0,C.forceKeepAttr=void 0,S8(S.uponSanitizeAttribute,I,C),C0=C.attrValue,q2&&(P9==="id"||P9==="name"))H9(N0,I),C0=BY+C0;if(j8&&s0(/((--!?|])>)|<\/(style|title|textarea)/i,C0)){H9(N0,I);continue}if(P9==="attributename"&&R1(C0,"href")){H9(N0,I);continue}if(C.forceKeepAttr)continue;if(!C.keepAttr){H9(N0,I);continue}if(!d0&&s0(/\/>/i,C0)){H9(N0,I);continue}if(l)o7([u0,B,v],(y2)=>{C0=r9(C0,y2," ")});let M2=D0(I.nodeName);if(!R2(M2,P9,C0)){H9(N0,I);continue}if(b&&typeof H==="object"&&typeof H.getAttributeType==="function")if($8);else switch(H.getAttributeType(M2,P9)){case"TrustedHTML":{C0=b.createHTML(C0);break}case"TrustedScriptURL":{C0=b.createScriptURL(C0);break}}if(C0!==n6)try{if($8)I.setAttributeNS($8,N0,C0);else I.setAttribute(N0,C0);if(o6(I))b8(I);else e2(J.removed)}catch(y2){H9(N0,I)}}S8(S.afterSanitizeAttributes,I,null)},RY=function g(I){let w=null,C=N2(I);S8(S.beforeSanitizeShadowDOM,I,null);while(w=C.nextNode())if(S8(S.uponSanitizeShadowNode,w,null),b2(w),_2(w),w.content instanceof K)g(w.content);S8(S.afterSanitizeShadowDOM,I,null)};return J.sanitize=function(g){let I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},w=null,C=null,V0=null,c0=null;if(l6=!g,l6)g="<!-->";if(typeof g!=="string"&&!x2(g))if(typeof g.toString==="function"){if(g=g.toString(),typeof g!=="string")throw t9("dirty is not a string, aborting")}else throw t9("toString is not a function");if(!J.isSupported)return g;if(!d9)a6(I);if(J.removed=[],typeof g==="string")c9=!1;if(c9){if(g.nodeName){let m8=D0(g.nodeName);if(!T[m8]||n[m8])throw t9("root node is forbidden and cannot be sanitized in-place")}}else if(g instanceof X)if(w=F2("<!---->"),C=w.ownerDocument.importNode(g,!0),C.nodeType===$7.element&&C.nodeName==="BODY")w=C;else if(C.nodeName==="HTML")w=C;else w.appendChild(C);else{if(!T8&&!l&&!f8&&g.indexOf("<")===-1)return b&&y9?b.createHTML(g):g;if(w=F2(g),!w)return T8?null:y9?P:""}if(w&&W9)b8(w.firstChild);let N0=N2(c9?g:w);while(V0=N0.nextNode())if(b2(V0),_2(V0),V0.content instanceof K)RY(V0.content);if(c9)return g;if(T8){if(q9){c0=$0.call(w.ownerDocument);while(w.firstChild)c0.appendChild(w.firstChild)}else c0=w;if(h.shadowroot||h.shadowrootmode)c0=m0.call(Z,c0,!0);return c0}let $8=f8?w.outerHTML:w.innerHTML;if(f8&&T["!doctype"]&&w.ownerDocument&&w.ownerDocument.doctype&&w.ownerDocument.doctype.name&&s0(z$,w.ownerDocument.doctype.name))$8="<!DOCTYPE "+w.ownerDocument.doctype.name+`>
`+$8;if(l)o7([u0,B,v],(m8)=>{$8=r9($8,m8," ")});return b&&y9?b.createHTML($8):$8},J.setConfig=function(){let g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};a6(g),d9=!0},J.clearConfig=function(){E9=null,d9=!1},J.isValidAttribute=function(g,I,w){if(!E9)a6({});let C=D0(g),V0=D0(I);return R2(C,V0,w)},J.addHook=function(g,I){if(typeof I!=="function")return;i9(S[g],I)},J.removeHook=function(g,I){if(I!==void 0){let w=EZ(S[g],I);return w===-1?void 0:PZ(S[g],w,1)[0]}return e2(S[g])},J.removeHooks=function(g){S[g]=[]},J.removeAllHooks=function(){S=K$()},J}var O0=V$();var G$=O0,b3=O0.sanitize.bind(O0),R3=O0.isSupported,D3=O0.addHook.bind(O0),_3=O0.removeHook.bind(O0),M3=O0.removeHooks.bind(O0),y3=O0.removeAllHooks.bind(O0),w3=O0.setConfig.bind(O0),L3=O0.clearConfig.bind(O0),E3=O0.isValidAttribute.bind(O0),P3=O0.version,A3=O0.removed;t.setOptions({gfm:!0,breaks:!0});var oZ={ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","p","br","hr","strong","em","del","sup","sub","a","code","pre","ul","ol","li","blockquote","table","thead","tbody","tr","th","td","img"],ALLOWED_ATTR:["href","src","alt","title","class","id"],FORBID_TAGS:["script","iframe","object","embed","form","style","link","meta","base","svg","math"],FORBID_ATTR:["onerror","onload","onclick","onmouseover","onfocus","onblur"]};function W$($){let J=t.parse($,{async:!1});return`<div class="conversation-prose">${G$.sanitize(J,oZ)}</div>`}class P1{feedIds=[K0.CONVERSATION_OUTPUT];connection;container;messageList;textarea;orderingBuffer;deckManager;constructor($){this.connection=$,this.orderingBuffer=new W1((J)=>this.handleOrderedEvent(J),()=>this.handleResync())}setDeckManager($){this.deckManager=$}mount($){this.container=document.createElement("div"),this.container.className="conversation-card";let J=document.createElement("div");J.className="card-header";let Y=document.createElement("span");Y.className="card-title",Y.textContent="Conversation",J.appendChild(Y),this.container.appendChild(J),this.messageList=document.createElement("div"),this.messageList.className="message-list",this.container.appendChild(this.messageList);let Z=document.createElement("div");Z.className="conversation-input-area",this.textarea=document.createElement("textarea"),this.textarea.className="conversation-input",this.textarea.placeholder="Type a message...",this.textarea.rows=1,this.textarea.addEventListener("input",()=>{this.textarea.style.height="auto",this.textarea.style.height=Math.min(this.textarea.scrollHeight,200)+"px"}),this.textarea.addEventListener("keydown",(Q)=>{if(Q.key==="Enter"&&!Q.shiftKey)Q.preventDefault(),this.handleSend()});let j=document.createElement("button");j.className="send-btn";let K=v0($1,{width:20,height:20});j.appendChild(K),j.addEventListener("click",()=>this.handleSend()),Z.appendChild(this.textarea),Z.appendChild(j),this.container.appendChild(Z),$.appendChild(this.container)}onFrame($,J){let Y=k2(J);if(Y)this.orderingBuffer.push(Y)}handleOrderedEvent($){if($.type==="assistant_text")this.renderAssistantMessage($);else if($.type==="error")this.renderError($.message)}handleResync(){console.warn("Conversation message gap detected - resync triggered")}handleSend(){let $=this.textarea.value.trim();if(!$)return;this.renderUserMessage($);let Y=L2({type:"user_message",text:$,attachments:[]});this.connection.send(Y),this.textarea.value="",this.textarea.style.height="auto",this.textarea.focus()}renderUserMessage($){let J=document.createElement("div");J.className="message message-user",J.textContent=$,this.messageList.appendChild(J),this.scrollToBottom()}renderAssistantMessage($){let J=this.messageList.querySelector(`[data-msg-id="${$.msg_id}"]`);if(!J)J=document.createElement("div"),J.className="message message-assistant",J.dataset.msgId=$.msg_id,this.messageList.appendChild(J);if(J.innerHTML=W$($.text),$.is_partial)J.classList.add("partial");else J.classList.remove("partial");this.scrollToBottom()}renderError($){let J=document.createElement("div");J.className="message message-error",J.textContent=`Error: ${$}`,this.messageList.appendChild(J),this.scrollToBottom()}scrollToBottom(){if(!this.deckManager?.isDragging)this.messageList.scrollTop=this.messageList.scrollHeight}resize(){}}var{defineProperty:I4,getOwnPropertyDescriptor:nZ}=Object,iZ=($,J)=>{for(var Y in J)I4($,Y,{get:J[Y],enumerable:!0})},U0=($,J,Y,Z)=>{for(var j=Z>1?void 0:Z?nZ(J,Y):J,K=$.length-1,Q;K>=0;K--)(Q=$[K])&&(j=(Z?Q(J,Y,j):Q(j))||j);return Z&&j&&I4(J,Y,j),j},k=($,J)=>(Y,Z)=>J(Y,Z,$),q$="Terminal input",o1={get:()=>q$,set:($)=>q$=$},H$="Too much output to announce, navigate to rows manually to read",n1={get:()=>H$,set:($)=>H$=$};function rZ($){return $.replace(/\r?\n/g,"\r")}function tZ($,J){return J?"\x1B[200~"+$+"\x1B[201~":$}function eZ($,J){$.clipboardData&&$.clipboardData.setData("text/plain",J.selectionText),$.preventDefault()}function $j($,J,Y,Z){if($.stopPropagation(),$.clipboardData){let j=$.clipboardData.getData("text/plain");B4(j,J,Y,Z)}}function B4($,J,Y,Z){$=rZ($),$=tZ($,Y.decPrivateModes.bracketedPasteMode&&Z.rawOptions.ignoreBracketedPasteMode!==!0),Y.triggerDataEvent($,!0),J.value=""}function v4($,J,Y){let Z=Y.getBoundingClientRect(),j=$.clientX-Z.left-10,K=$.clientY-Z.top-10;J.style.width="20px",J.style.height="20px",J.style.left=`${j}px`,J.style.top=`${K}px`,J.style.zIndex="1000",J.focus()}function U$($,J,Y,Z,j){v4($,J,Y),j&&Z.rightClickSelect($),J.value=Z.selectionText,J.select()}function j9($){return $>65535?($-=65536,String.fromCharCode(($>>10)+55296)+String.fromCharCode($%1024+56320)):String.fromCharCode($)}function F6($,J=0,Y=$.length){let Z="";for(let j=J;j<Y;++j){let K=$[j];K>65535?(K-=65536,Z+=String.fromCharCode((K>>10)+55296)+String.fromCharCode(K%1024+56320)):Z+=String.fromCharCode(K)}return Z}var Jj=class{constructor(){this._interim=0}clear(){this._interim=0}decode($,J){let Y=$.length;if(!Y)return 0;let Z=0,j=0;if(this._interim){let K=$.charCodeAt(j++);56320<=K&&K<=57343?J[Z++]=(this._interim-55296)*1024+K-56320+65536:(J[Z++]=this._interim,J[Z++]=K),this._interim=0}for(let K=j;K<Y;++K){let Q=$.charCodeAt(K);if(55296<=Q&&Q<=56319){if(++K>=Y)return this._interim=Q,Z;let X=$.charCodeAt(K);56320<=X&&X<=57343?J[Z++]=(Q-55296)*1024+X-56320+65536:(J[Z++]=Q,J[Z++]=X);continue}Q!==65279&&(J[Z++]=Q)}return Z}},Yj=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode($,J){let Y=$.length;if(!Y)return 0;let Z=0,j,K,Q,X,V=0,z=0;if(this.interim[0]){let q=!1,H=this.interim[0];H&=(H&224)===192?31:(H&240)===224?15:7;let U=0,O;for(;(O=this.interim[++U]&63)&&U<4;)H<<=6,H|=O;let M=(this.interim[0]&224)===192?2:(this.interim[0]&240)===224?3:4,A=M-U;for(;z<A;){if(z>=Y)return 0;if(O=$[z++],(O&192)!==128){z--,q=!0;break}else this.interim[U++]=O,H<<=6,H|=O&63}q||(M===2?H<128?z--:J[Z++]=H:M===3?H<2048||H>=55296&&H<=57343||H===65279||(J[Z++]=H):H<65536||H>1114111||(J[Z++]=H)),this.interim.fill(0)}let G=Y-4,W=z;for(;W<Y;){for(;W<G&&!((j=$[W])&128)&&!((K=$[W+1])&128)&&!((Q=$[W+2])&128)&&!((X=$[W+3])&128);)J[Z++]=j,J[Z++]=K,J[Z++]=Q,J[Z++]=X,W+=4;if(j=$[W++],j<128)J[Z++]=j;else if((j&224)===192){if(W>=Y)return this.interim[0]=j,Z;if(K=$[W++],(K&192)!==128){W--;continue}if(V=(j&31)<<6|K&63,V<128){W--;continue}J[Z++]=V}else if((j&240)===224){if(W>=Y)return this.interim[0]=j,Z;if(K=$[W++],(K&192)!==128){W--;continue}if(W>=Y)return this.interim[0]=j,this.interim[1]=K,Z;if(Q=$[W++],(Q&192)!==128){W--;continue}if(V=(j&15)<<12|(K&63)<<6|Q&63,V<2048||V>=55296&&V<=57343||V===65279)continue;J[Z++]=V}else if((j&248)===240){if(W>=Y)return this.interim[0]=j,Z;if(K=$[W++],(K&192)!==128){W--;continue}if(W>=Y)return this.interim[0]=j,this.interim[1]=K,Z;if(Q=$[W++],(Q&192)!==128){W--;continue}if(W>=Y)return this.interim[0]=j,this.interim[1]=K,this.interim[2]=Q,Z;if(X=$[W++],(X&192)!==128){W--;continue}if(V=(j&7)<<18|(K&63)<<12|(Q&63)<<6|X&63,V<65536||V>1114111)continue;J[Z++]=V}}return Z}},O4="",K9=" ",N7=class ${constructor(){this.fg=0,this.bg=0,this.extended=new G6}static toColorRGB(J){return[J>>>16&255,J>>>8&255,J&255]}static fromColorRGB(J){return(J[0]&255)<<16|(J[1]&255)<<8|J[2]&255}clone(){let J=new $;return J.fg=this.fg,J.bg=this.bg,J.extended=this.extended.clone(),J}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},G6=class ${constructor(J=0,Y=0){this._ext=0,this._urlId=0,this._ext=J,this._urlId=Y}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(J){this._ext=J}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(J){this._ext&=-469762049,this._ext|=J<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(J){this._ext&=-67108864,this._ext|=J&67108863}get urlId(){return this._urlId}set urlId(J){this._urlId=J}get underlineVariantOffset(){let J=(this._ext&3758096384)>>29;return J<0?J^4294967288:J}set underlineVariantOffset(J){this._ext&=536870911,this._ext|=J<<29&3758096384}clone(){return new $(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},I8=class $ extends N7{constructor(){super(...arguments);this.content=0,this.fg=0,this.bg=0,this.extended=new G6,this.combinedData=""}static fromCharData(J){let Y=new $;return Y.setFromCharData(J),Y}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?j9(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(J){this.fg=J[0],this.bg=0;let Y=!1;if(J[1].length>2)Y=!0;else if(J[1].length===2){let Z=J[1].charCodeAt(0);if(55296<=Z&&Z<=56319){let j=J[1].charCodeAt(1);56320<=j&&j<=57343?this.content=(Z-55296)*1024+j-56320+65536|J[2]<<22:Y=!0}else Y=!0}else this.content=J[1].charCodeAt(0)|J[2]<<22;Y&&(this.combinedData=J[1],this.content=2097152|J[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},I$="di$target",i1="di$dependencies",A1=new Map;function Zj($){return $[i1]||[]}function A0($){if(A1.has($))return A1.get($);let J=function(Y,Z,j){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");jj(J,Y,j)};return J._id=$,A1.set($,J),J}function jj($,J,Y){J[I$]===J?J[i1].push({id:$,index:Y}):(J[i1]=[{id:$,index:Y}],J[I$]=J)}var i0=A0("BufferService"),F4=A0("CoreMouseService"),R9=A0("CoreService"),Kj=A0("CharsetService"),D5=A0("InstantiationService"),N4=A0("LogService"),r0=A0("OptionsService"),x4=A0("OscLinkService"),Qj=A0("UnicodeService"),x7=A0("DecorationService"),r1=class{constructor($,J,Y){this._bufferService=$,this._optionsService=J,this._oscLinkService=Y}provideLinks($,J){let Y=this._bufferService.buffer.lines.get($-1);if(!Y){J(void 0);return}let Z=[],j=this._optionsService.rawOptions.linkHandler,K=new I8,Q=Y.getTrimmedLength(),X=-1,V=-1,z=!1;for(let G=0;G<Q;G++)if(!(V===-1&&!Y.hasContent(G))){if(Y.loadCell(G,K),K.hasExtendedAttrs()&&K.extended.urlId)if(V===-1){V=G,X=K.extended.urlId;continue}else z=K.extended.urlId!==X;else V!==-1&&(z=!0);if(z||V!==-1&&G===Q-1){let W=this._oscLinkService.getLinkData(X)?.uri;if(W){let q={start:{x:V+1,y:$},end:{x:G+(!z&&G===Q-1?1:0),y:$}},H=!1;if(!j?.allowNonHttpProtocols)try{let U=new URL(W);["http:","https:"].includes(U.protocol)||(H=!0)}catch{H=!0}H||Z.push({text:W,range:q,activate:(U,O)=>j?j.activate(U,O,q):Xj(U,O),hover:(U,O)=>j?.hover?.(U,O,q),leave:(U,O)=>j?.leave?.(U,O,q)})}z=!1,K.hasExtendedAttrs()&&K.extended.urlId?(V=G,X=K.extended.urlId):(V=-1,X=-1)}}J(Z)}};r1=U0([k(0,i0),k(1,r0),k(2,x4)],r1);function Xj($,J){if(confirm(`Do you want to navigate to ${J}?

WARNING: This link could potentially be dangerous`)){let Y=window.open();if(Y){try{Y.opener=null}catch{}Y.location.href=J}else console.warn("Opening link blocked as opener could not be cleared")}}var N6=A0("CharSizeService"),c8=A0("CoreBrowserService"),_5=A0("MouseService"),l8=A0("RenderService"),zj=A0("SelectionService"),b4=A0("CharacterJoinerService"),k9=A0("ThemeService"),R4=A0("LinkProviderService"),Vj=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function($){setTimeout(()=>{throw $.stack?B$.isErrorNoTelemetry($)?new B$($.message+`

`+$.stack):Error($.message+`

`+$.stack):$},0)}}addListener($){return this.listeners.push($),()=>{this._removeListener($)}}emit($){this.listeners.forEach((J)=>{J($)})}_removeListener($){this.listeners.splice(this.listeners.indexOf($),1)}setUnexpectedErrorHandler($){this.unexpectedErrorHandler=$}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError($){this.unexpectedErrorHandler($),this.emit($)}onUnexpectedExternalError($){this.unexpectedErrorHandler($)}},Gj=new Vj;function Y6($){Wj($)||Gj.onUnexpectedError($)}var t1="Canceled";function Wj($){return $ instanceof qj?!0:$ instanceof Error&&$.name===t1&&$.message===t1}var qj=class extends Error{constructor(){super(t1),this.name=this.message}};function Hj($){return $?Error(`Illegal argument: ${$}`):Error("Illegal argument")}var B$=class $ extends Error{constructor(J){super(J),this.name="CodeExpectedError"}static fromError(J){if(J instanceof $)return J;let Y=new $;return Y.message=J.message,Y.stack=J.stack,Y}static isErrorNoTelemetry(J){return J.name==="CodeExpectedError"}},e1=class $ extends Error{constructor(J){super(J||"An unexpected bug occurred."),Object.setPrototypeOf(this,$.prototype)}};function Uj($,J,Y=0,Z=$.length){let j=Y,K=Z;for(;j<K;){let Q=Math.floor((j+K)/2);J($[Q])?j=Q+1:K=Q}return j-1}var Ij=class ${constructor(J){this._array=J,this._findLastMonotonousLastIdx=0}findLastMonotonous(J){if($.assertInvariants){if(this._prevFindLastPredicate){for(let Z of this._array)if(this._prevFindLastPredicate(Z)&&!J(Z))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=J}let Y=Uj(this._array,J,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=Y+1,Y===-1?void 0:this._array[Y]}};Ij.assertInvariants=!1;function K8($,J=0){return $[$.length-(1+J)]}var D4;(($)=>{function J(K){return K<0}$.isLessThan=J;function Y(K){return K<=0}$.isLessThanOrEqual=Y;function Z(K){return K>0}$.isGreaterThan=Z;function j(K){return K===0}$.isNeitherLessOrGreaterThan=j,$.greaterThan=1,$.lessThan=-1,$.neitherLessOrGreaterThan=0})(D4||={});function Bj($,J){return(Y,Z)=>J($(Y),$(Z))}var vj=($,J)=>$-J,v$=class ${constructor(J){this.iterate=J}forEach(J){this.iterate((Y)=>(J(Y),!0))}toArray(){let J=[];return this.iterate((Y)=>(J.push(Y),!0)),J}filter(J){return new $((Y)=>this.iterate((Z)=>J(Z)?Y(Z):!0))}map(J){return new $((Y)=>this.iterate((Z)=>Y(J(Z))))}some(J){let Y=!1;return this.iterate((Z)=>(Y=J(Z),!Y)),Y}findFirst(J){let Y;return this.iterate((Z)=>J(Z)?(Y=Z,!1):!0),Y}findLast(J){let Y;return this.iterate((Z)=>(J(Z)&&(Y=Z),!0)),Y}findLastMaxBy(J){let Y,Z=!0;return this.iterate((j)=>((Z||D4.isGreaterThan(J(j,Y)))&&(Z=!1,Y=j),!0)),Y}};v$.empty=new v$(($)=>{});function Oj($,J){let Y=Object.create(null);for(let Z of $){let j=J(Z),K=Y[j];K||(K=Y[j]=[]),K.push(Z)}return Y}var O$,F$,d3=class{constructor($,J){this.toKey=J,this._map=new Map,this[O$]="SetWithKey";for(let Y of $)this.add(Y)}get size(){return this._map.size}add($){let J=this.toKey($);return this._map.set(J,$),this}delete($){return this._map.delete(this.toKey($))}has($){return this._map.has(this.toKey($))}*entries(){for(let $ of this._map.values())yield[$,$]}keys(){return this.values()}*values(){for(let $ of this._map.values())yield $}clear(){this._map.clear()}forEach($,J){this._map.forEach((Y)=>$.call(J,Y,Y,this))}[(F$=Symbol.iterator,O$=Symbol.toStringTag,F$)](){return this.values()}},Fj=class{constructor(){this.map=new Map}add($,J){let Y=this.map.get($);Y||(Y=new Set,this.map.set($,Y)),Y.add(J)}delete($,J){let Y=this.map.get($);Y&&(Y.delete(J),Y.size===0&&this.map.delete($))}forEach($,J){let Y=this.map.get($);Y&&Y.forEach(J)}get($){return this.map.get($)||new Set}};function Nj($,J){let Y=this,Z=!1,j;return function(){if(Z)return j;if(Z=!0,J)try{j=$.apply(Y,arguments)}finally{J()}else j=$.apply(Y,arguments);return j}}var _4;(($)=>{function J(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}$.is=J;let Y=Object.freeze([]);function Z(){return Y}$.empty=Z;function*j(b){yield b}$.single=j;function K(b){return J(b)?b:j(b)}$.wrap=K;function Q(b){return b||Y}$.from=Q;function*X(b){for(let P=b.length-1;P>=0;P--)yield b[P]}$.reverse=X;function V(b){return!b||b[Symbol.iterator]().next().done===!0}$.isEmpty=V;function z(b){return b[Symbol.iterator]().next().value}$.first=z;function G(b,P){let f=0;for(let u of b)if(P(u,f++))return!0;return!1}$.some=G;function W(b,P){for(let f of b)if(P(f))return f}$.find=W;function*q(b,P){for(let f of b)P(f)&&(yield f)}$.filter=q;function*H(b,P){let f=0;for(let u of b)yield P(u,f++)}$.map=H;function*U(b,P){let f=0;for(let u of b)yield*P(u,f++)}$.flatMap=U;function*O(...b){for(let P of b)yield*P}$.concat=O;function M(b,P,f){let u=f;for(let $0 of b)u=P(u,$0);return u}$.reduce=M;function*A(b,P,f=b.length){for(P<0&&(P+=b.length),f<0?f+=b.length:f>b.length&&(f=b.length);P<f;P++)yield b[P]}$.slice=A;function m(b,P=Number.POSITIVE_INFINITY){let f=[];if(P===0)return[f,b];let u=b[Symbol.iterator]();for(let $0=0;$0<P;$0++){let G0=u.next();if(G0.done)return[f,$.empty()];f.push(G0.value)}return[f,{[Symbol.iterator](){return u}}]}$.consume=m;async function E(b){let P=[];for await(let f of b)P.push(f);return Promise.resolve(P)}$.asyncToArray=E})(_4||={});var xj=!1,N9=null,bj=class ${constructor(){this.livingDisposables=new Map}getDisposableData(J){let Y=this.livingDisposables.get(J);return Y||(Y={parent:null,source:null,isSingleton:!1,value:J,idx:$.idx++},this.livingDisposables.set(J,Y)),Y}trackDisposable(J){let Y=this.getDisposableData(J);Y.source||(Y.source=Error().stack)}setParent(J,Y){let Z=this.getDisposableData(J);Z.parent=Y}markAsDisposed(J){this.livingDisposables.delete(J)}markAsSingleton(J){this.getDisposableData(J).isSingleton=!0}getRootParent(J,Y){let Z=Y.get(J);if(Z)return Z;let j=J.parent?this.getRootParent(this.getDisposableData(J.parent),Y):J;return Y.set(J,j),j}getTrackedDisposables(){let J=new Map;return[...this.livingDisposables.entries()].filter(([,Y])=>Y.source!==null&&!this.getRootParent(Y,J).isSingleton).flatMap(([Y])=>Y)}computeLeakingDisposables(J=10,Y){let Z;if(Y)Z=Y;else{let V=new Map,z=[...this.livingDisposables.values()].filter((W)=>W.source!==null&&!this.getRootParent(W,V).isSingleton);if(z.length===0)return;let G=new Set(z.map((W)=>W.value));if(Z=z.filter((W)=>!(W.parent&&G.has(W.parent))),Z.length===0)throw Error("There are cyclic diposable chains!")}if(!Z)return;function j(V){function z(W,q){for(;W.length>0&&q.some((H)=>typeof H=="string"?H===W[0]:W[0].match(H));)W.shift()}let G=V.source.split(`
`).map((W)=>W.trim().replace("at ","")).filter((W)=>W!=="");return z(G,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),G.reverse()}let K=new Fj;for(let V of Z){let z=j(V);for(let G=0;G<=z.length;G++)K.add(z.slice(0,G).join(`
`),V)}Z.sort(Bj((V)=>V.idx,vj));let Q="",X=0;for(let V of Z.slice(0,J)){X++;let z=j(V),G=[];for(let W=0;W<z.length;W++){let q=z[W];q=`(shared with ${K.get(z.slice(0,W+1).join(`
`)).size}/${Z.length} leaks) at ${q}`;let H=K.get(z.slice(0,W).join(`
`)),U=Oj([...H].map((O)=>j(O)[W]),(O)=>O);delete U[z[W]];for(let[O,M]of Object.entries(U))G.unshift(`    - stacktraces of ${M.length} other leaks continue with ${O}`);G.unshift(q)}Q+=`


==================== Leaking disposable ${X}/${Z.length}: ${V.value.constructor.name} ====================
${G.join(`
`)}
============================================================

`}return Z.length>J&&(Q+=`


... and ${Z.length-J} more leaking disposables

`),{leaks:Z,details:Q}}};bj.idx=0;function Rj($){N9=$}if(xj){let $="__is_disposable_tracked__";Rj(new class{trackDisposable(J){let Y=Error("Potentially leaked disposable").stack;setTimeout(()=>{J[$]||console.log(Y)},3000)}setParent(J,Y){if(J&&J!==d.None)try{J[$]=!0}catch{}}markAsDisposed(J){if(J&&J!==d.None)try{J[$]=!0}catch{}}markAsSingleton(J){}})}function x6($){return N9?.trackDisposable($),$}function b6($){N9?.markAsDisposed($)}function B7($,J){N9?.setParent($,J)}function Dj($,J){if(N9)for(let Y of $)N9.setParent(Y,J)}function N$($){return N9?.markAsSingleton($),$}function x9($){if(_4.is($)){let J=[];for(let Y of $)if(Y)try{Y.dispose()}catch(Z){J.push(Z)}if(J.length===1)throw J[0];if(J.length>1)throw AggregateError(J,"Encountered errors while disposing of store");return Array.isArray($)?[]:$}else if($)return $.dispose(),$}function _j(...$){let J=X0(()=>x9($));return Dj($,J),J}function X0($){let J=x6({dispose:Nj(()=>{b6(J),$()})});return J}var M4=class ${constructor(){this._toDispose=new Set,this._isDisposed=!1,x6(this)}dispose(){this._isDisposed||(b6(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{x9(this._toDispose)}finally{this._toDispose.clear()}}add(J){if(!J)return J;if(J===this)throw Error("Cannot register a disposable on itself!");return B7(J,this),this._isDisposed?$.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(J),J}delete(J){if(J){if(J===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(J),J.dispose()}}deleteAndLeak(J){J&&this._toDispose.has(J)&&(this._toDispose.delete(J),B7(J,null))}};M4.DISABLE_DISPOSED_WARNING=!1;var Q9=M4,d=class{constructor(){this._store=new Q9,x6(this),B7(this._store,this)}dispose(){b6(this),this._store.dispose()}_register($){if($===this)throw Error("Cannot register a disposable on itself!");return this._store.add($)}};d.None=Object.freeze({dispose(){}});var T9=class{constructor(){this._isDisposed=!1,x6(this)}get value(){return this._isDisposed?void 0:this._value}set value($){this._isDisposed||$===this._value||(this._value?.dispose(),$&&B7($,this),this._value=$)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,b6(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let $=this._value;return this._value=void 0,$&&B7($,null),$}},z8=typeof window=="object"?window:globalThis,$5=class ${constructor(J){this.element=J,this.next=$.Undefined,this.prev=$.Undefined}};$5.Undefined=new $5(void 0);var W0=$5,x$=class{constructor(){this._first=W0.Undefined,this._last=W0.Undefined,this._size=0}get size(){return this._size}isEmpty(){return this._first===W0.Undefined}clear(){let $=this._first;for(;$!==W0.Undefined;){let J=$.next;$.prev=W0.Undefined,$.next=W0.Undefined,$=J}this._first=W0.Undefined,this._last=W0.Undefined,this._size=0}unshift($){return this._insert($,!1)}push($){return this._insert($,!0)}_insert($,J){let Y=new W0($);if(this._first===W0.Undefined)this._first=Y,this._last=Y;else if(J){let j=this._last;this._last=Y,Y.prev=j,j.next=Y}else{let j=this._first;this._first=Y,Y.next=j,j.prev=Y}this._size+=1;let Z=!1;return()=>{Z||(Z=!0,this._remove(Y))}}shift(){if(this._first!==W0.Undefined){let $=this._first.element;return this._remove(this._first),$}}pop(){if(this._last!==W0.Undefined){let $=this._last.element;return this._remove(this._last),$}}_remove($){if($.prev!==W0.Undefined&&$.next!==W0.Undefined){let J=$.prev;J.next=$.next,$.next.prev=J}else $.prev===W0.Undefined&&$.next===W0.Undefined?(this._first=W0.Undefined,this._last=W0.Undefined):$.next===W0.Undefined?(this._last=this._last.prev,this._last.next=W0.Undefined):$.prev===W0.Undefined&&(this._first=this._first.next,this._first.prev=W0.Undefined);this._size-=1}*[Symbol.iterator](){let $=this._first;for(;$!==W0.Undefined;)yield $.element,$=$.next}},Mj=globalThis.performance&&typeof globalThis.performance.now=="function",yj=class ${static create(J){return new $(J)}constructor(J){this._now=Mj&&J===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},wj=!1,b$=!1,Lj=!1,g0;(($)=>{$.None=()=>d.None;function J(B){if(Lj){let{onDidAddListener:v}=B,R=Y5.create(),N=0;B.onDidAddListener=()=>{++N===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),R.print()),v?.()}}}function Y(B,v){return q(B,()=>{},0,void 0,!0,void 0,v)}$.defer=Y;function Z(B){return(v,R=null,N)=>{let x=!1,F;return F=B((_)=>{if(!x)return F?F.dispose():x=!0,v.call(R,_)},null,N),x&&F.dispose(),F}}$.once=Z;function j(B,v,R){return G((N,x=null,F)=>B((_)=>N.call(x,v(_)),null,F),R)}$.map=j;function K(B,v,R){return G((N,x=null,F)=>B((_)=>{v(_),N.call(x,_)},null,F),R)}$.forEach=K;function Q(B,v,R){return G((N,x=null,F)=>B((_)=>v(_)&&N.call(x,_),null,F),R)}$.filter=Q;function X(B){return B}$.signal=X;function V(...B){return(v,R=null,N)=>{let x=_j(...B.map((F)=>F((_)=>v.call(R,_))));return W(x,N)}}$.any=V;function z(B,v,R,N){let x=R;return j(B,(F)=>(x=v(x,F),x),N)}$.reduce=z;function G(B,v){let R,N={onWillAddFirstListener(){R=B(x.fire,x)},onDidRemoveLastListener(){R?.dispose()}};v||J(N);let x=new L(N);return v?.add(x),x.event}function W(B,v){return v instanceof Array?v.push(B):v&&v.add(B),B}function q(B,v,R=100,N=!1,x=!1,F,_){let y,T,r,h=0,i,c={leakWarningThreshold:F,onWillAddFirstListener(){y=B((Z0)=>{h++,T=v(T,Z0),N&&!r&&(n.fire(T),T=void 0),i=()=>{let o=T;T=void 0,r=void 0,(!N||h>1)&&n.fire(o),h=0},typeof R=="number"?(clearTimeout(r),r=setTimeout(i,R)):r===void 0&&(r=0,queueMicrotask(i))})},onWillRemoveListener(){x&&h>0&&i?.()},onDidRemoveLastListener(){i=void 0,y.dispose()}};_||J(c);let n=new L(c);return _?.add(n),n.event}$.debounce=q;function H(B,v=0,R){return $.debounce(B,(N,x)=>N?(N.push(x),N):[x],v,void 0,!0,void 0,R)}$.accumulate=H;function U(B,v=(N,x)=>N===x,R){let N=!0,x;return Q(B,(F)=>{let _=N||!v(F,x);return N=!1,x=F,_},R)}$.latch=U;function O(B,v,R){return[$.filter(B,v,R),$.filter(B,(N)=>!v(N),R)]}$.split=O;function M(B,v=!1,R=[],N){let x=R.slice(),F=B((T)=>{x?x.push(T):y.fire(T)});N&&N.add(F);let _=()=>{x?.forEach((T)=>y.fire(T)),x=null},y=new L({onWillAddFirstListener(){F||(F=B((T)=>y.fire(T)),N&&N.add(F))},onDidAddFirstListener(){x&&(v?setTimeout(_):_())},onDidRemoveLastListener(){F&&F.dispose(),F=null}});return N&&N.add(y),y.event}$.buffer=M;function A(B,v){return(R,N,x)=>{let F=v(new E);return B(function(_){let y=F.evaluate(_);y!==m&&R.call(N,y)},void 0,x)}}$.chain=A;let m=Symbol("HaltChainable");class E{constructor(){this.steps=[]}map(B){return this.steps.push(B),this}forEach(B){return this.steps.push((v)=>(B(v),v)),this}filter(B){return this.steps.push((v)=>B(v)?v:m),this}reduce(B,v){let R=v;return this.steps.push((N)=>(R=B(R,N),R)),this}latch(B=(v,R)=>v===R){let v=!0,R;return this.steps.push((N)=>{let x=v||!B(N,R);return v=!1,R=N,x?N:m}),this}evaluate(B){for(let v of this.steps)if(B=v(B),B===m)break;return B}}function b(B,v,R=(N)=>N){let N=(...y)=>_.fire(R(...y)),x=()=>B.on(v,N),F=()=>B.removeListener(v,N),_=new L({onWillAddFirstListener:x,onDidRemoveLastListener:F});return _.event}$.fromNodeEventEmitter=b;function P(B,v,R=(N)=>N){let N=(...y)=>_.fire(R(...y)),x=()=>B.addEventListener(v,N),F=()=>B.removeEventListener(v,N),_=new L({onWillAddFirstListener:x,onDidRemoveLastListener:F});return _.event}$.fromDOMEventEmitter=P;function f(B){return new Promise((v)=>Z(B)(v))}$.toPromise=f;function u(B){let v=new L;return B.then((R)=>{v.fire(R)},()=>{v.fire(void 0)}).finally(()=>{v.dispose()}),v.event}$.fromPromise=u;function $0(B,v){return B((R)=>v.fire(R))}$.forward=$0;function G0(B,v,R){return v(R),B((N)=>v(N))}$.runAndSubscribe=G0;class m0{constructor(B,v){this._observable=B,this._counter=0,this._hasChanged=!1;let R={onWillAddFirstListener:()=>{B.addObserver(this)},onDidRemoveLastListener:()=>{B.removeObserver(this)}};v||J(R),this.emitter=new L(R),v&&v.add(this.emitter)}beginUpdate(B){this._counter++}handlePossibleChange(B){}handleChange(B,v){this._hasChanged=!0}endUpdate(B){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function S(B,v){return new m0(B,v).emitter.event}$.fromObservable=S;function u0(B){return(v,R,N)=>{let x=0,F=!1,_={beginUpdate(){x++},endUpdate(){x--,x===0&&(B.reportChanges(),F&&(F=!1,v.call(R)))},handlePossibleChange(){},handleChange(){F=!0}};B.addObserver(_),B.reportChanges();let y={dispose(){B.removeObserver(_)}};return N instanceof Q9?N.add(y):Array.isArray(N)&&N.push(y),y}}$.fromObservableLight=u0})(g0||={});var J5=class ${constructor(J){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${J}_${$._idPool++}`,$.all.add(this)}start(J){this._stopWatch=new yj,this.listenerCount=J}stop(){if(this._stopWatch){let J=this._stopWatch.elapsed();this.durations.push(J),this.elapsedOverall+=J,this.invocationCount+=1,this._stopWatch=void 0}}};J5.all=new Set,J5._idPool=0;var Ej=J5,R$=-1,y4=class ${constructor(J,Y,Z=($._idPool++).toString(16).padStart(3,"0")){this._errorHandler=J,this.threshold=Y,this.name=Z,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(J,Y){let Z=this.threshold;if(Z<=0||Y<Z)return;this._stacks||(this._stacks=new Map);let j=this._stacks.get(J.value)||0;if(this._stacks.set(J.value,j+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=Z*0.5;let[K,Q]=this.getMostFrequentStack(),X=`[${this.name}] potential listener LEAK detected, having ${Y} listeners already. MOST frequent listener (${Q}):`;console.warn(X),console.warn(K);let V=new Aj(X,K);this._errorHandler(V)}return()=>{let K=this._stacks.get(J.value)||0;this._stacks.set(J.value,K-1)}}getMostFrequentStack(){if(!this._stacks)return;let J,Y=0;for(let[Z,j]of this._stacks)(!J||Y<j)&&(J=[Z,j],Y=j);return J}};y4._idPool=1;var Pj=y4,Y5=class ${constructor(J){this.value=J}static create(){let J=Error();return new $(J.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},Aj=class extends Error{constructor($,J){super($),this.name="ListenerLeakError",this.stack=J}},fj=class extends Error{constructor($,J){super($),this.name="ListenerRefusalError",this.stack=J}},Tj=0,Z6=class{constructor($){this.value=$,this.id=Tj++}},kj=2,Sj=($,J)=>{if($ instanceof Z6)J($);else for(let Y=0;Y<$.length;Y++){let Z=$[Y];Z&&J(Z)}},j6;if(wj){let $=[];setInterval(()=>{$.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn($.join(`
`)),$.length=0)},3000),j6=new FinalizationRegistry((J)=>{typeof J=="string"&&$.push(J)})}var L=class{constructor($){this._size=0,this._options=$,this._leakageMon=R$>0||this._options?.leakWarningThreshold?new Pj($?.onListenerError??Y6,this._options?.leakWarningThreshold??R$):void 0,this._perfMon=this._options?._profName?new Ej(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(b$){let $=this._listeners;queueMicrotask(()=>{Sj($,(J)=>J.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=($,J,Y)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let X=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(X);let V=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],z=new fj(`${X}. HINT: Stack shows most frequent listener (${V[1]}-times)`,V[0]);return(this._options?.onListenerError||Y6)(z),d.None}if(this._disposed)return d.None;J&&($=$.bind(J));let Z=new Z6($),j,K;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*0.2)&&(Z.stack=Y5.create(),j=this._leakageMon.check(Z.stack,this._size+1)),b$&&(Z.stack=K??Y5.create()),this._listeners?this._listeners instanceof Z6?(this._deliveryQueue??=new mj,this._listeners=[this._listeners,Z]):this._listeners.push(Z):(this._options?.onWillAddFirstListener?.(this),this._listeners=Z,this._options?.onDidAddFirstListener?.(this)),this._size++;let Q=X0(()=>{j6?.unregister(Q),j?.(),this._removeListener(Z)});if(Y instanceof Q9?Y.add(Q):Array.isArray(Y)&&Y.push(Q),j6){let X=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),V=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(X);j6.register(Q,V?.[2]??X,Q)}return Q},this._event}_removeListener($){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let J=this._listeners,Y=J.indexOf($);if(Y===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,J[Y]=void 0;let Z=this._deliveryQueue.current===this;if(this._size*kj<=J.length){let j=0;for(let K=0;K<J.length;K++)J[K]?J[j++]=J[K]:Z&&(this._deliveryQueue.end--,j<this._deliveryQueue.i&&this._deliveryQueue.i--);J.length=j}}_deliver($,J){if(!$)return;let Y=this._options?.onListenerError||Y6;if(!Y){$.value(J);return}try{$.value(J)}catch(Z){Y(Z)}}_deliverQueue($){let J=$.current._listeners;for(;$.i<$.end;)this._deliver(J[$.i++],$.value);$.reset()}fire($){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof Z6)this._deliver(this._listeners,$);else{let J=this._deliveryQueue;J.enqueue(this,$,this._listeners.length),this._deliverQueue(J)}this._perfMon?.stop()}hasListeners(){return this._size>0}},mj=class{constructor(){this.i=-1,this.end=0}enqueue($,J,Y){this.i=0,this.end=Y,this.current=$,this.value=J}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},Z5=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new L,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new L,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(J){return this.mapWindowIdToZoomLevel.get(this.getWindowId(J))??0}setZoomLevel(J,Y){if(this.getZoomLevel(Y)===J)return;let Z=this.getWindowId(Y);this.mapWindowIdToZoomLevel.set(Z,J),this._onDidChangeZoomLevel.fire(Z)}getZoomFactor(J){return this.mapWindowIdToZoomFactor.get(this.getWindowId(J))??1}setZoomFactor(J,Y){this.mapWindowIdToZoomFactor.set(this.getWindowId(Y),J)}setFullscreen(J,Y){if(this.isFullscreen(Y)===J)return;let Z=this.getWindowId(Y);this.mapWindowIdToFullScreen.set(Z,J),this._onDidChangeFullscreen.fire(Z)}isFullscreen(J){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(J))}getWindowId(J){return J.vscodeWindowId}};Z5.INSTANCE=new Z5;var M5=Z5;function Cj($,J,Y){typeof J=="string"&&(J=$.matchMedia(J)),J.addEventListener("change",Y)}var c3=M5.INSTANCE.onDidChangeZoomLevel;function gj($){return M5.INSTANCE.getZoomFactor($)}var l3=M5.INSTANCE.onDidChangeFullscreen,S9=typeof navigator=="object"?navigator.userAgent:"",j5=S9.indexOf("Firefox")>=0,K6=S9.indexOf("AppleWebKit")>=0,y5=S9.indexOf("Chrome")>=0,w4=!y5&&S9.indexOf("Safari")>=0,s3=S9.indexOf("Electron/")>=0,a3=S9.indexOf("Android")>=0,Q6=!1;if(typeof z8.matchMedia=="function"){let $=z8.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),J=z8.matchMedia("(display-mode: fullscreen)");Q6=$.matches,Cj(z8,$,({matches:Y})=>{Q6&&J.matches||(Q6=Y)})}function hj(){return Q6}var f9="en",W6=!1,q6=!1,U7=!1,pj=!1,L4=!1,E4=!1,uj=!1,dj=!1,cj=!1,lj=!1,r7,X6=f9,D$=f9,sj,p8,d8=globalThis,X8;typeof d8.vscode<"u"&&typeof d8.vscode.process<"u"?X8=d8.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(X8=process);var P4=typeof X8?.versions?.electron=="string",aj=P4&&X8?.type==="renderer";if(typeof X8=="object"){W6=X8.platform==="win32",q6=X8.platform==="darwin",U7=X8.platform==="linux",pj=U7&&!!X8.env.SNAP&&!!X8.env.SNAP_REVISION,uj=P4,cj=!!X8.env.CI||!!X8.env.BUILD_ARTIFACTSTAGINGDIRECTORY,r7=f9,X6=f9;let $=X8.env.VSCODE_NLS_CONFIG;if($)try{let J=JSON.parse($);r7=J.userLocale,D$=J.osLocale,X6=J.resolvedLanguage||f9,sj=J.languagePack?.translationsConfigFile}catch{}L4=!0}else typeof navigator=="object"&&!aj?(p8=navigator.userAgent,W6=p8.indexOf("Windows")>=0,q6=p8.indexOf("Macintosh")>=0,dj=(p8.indexOf("Macintosh")>=0||p8.indexOf("iPad")>=0||p8.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,U7=p8.indexOf("Linux")>=0,lj=p8?.indexOf("Mobi")>=0,E4=!0,X6=globalThis._VSCODE_NLS_LANGUAGE||f9,r7=navigator.language.toLowerCase(),D$=r7):console.error("Unable to resolve platform.");var f1=0;q6?f1=1:W6?f1=3:U7&&(f1=2);var A4=W6,w8=q6,oj=U7,T1=L4,nj=E4&&typeof d8.importScripts=="function",o3=nj?d8.origin:void 0,L8=p8,$9=X6,ij;(($)=>{function J(){return $9}$.value=J;function Y(){return $9.length===2?$9==="en":$9.length>=3?$9[0]==="e"&&$9[1]==="n"&&$9[2]==="-":!1}$.isDefaultVariant=Y;function Z(){return $9==="en"}$.isDefault=Z})(ij||={});var rj=typeof d8.postMessage=="function"&&!d8.importScripts,tj=(()=>{if(rj){let $=[];d8.addEventListener("message",(Y)=>{if(Y.data&&Y.data.vscodeScheduleAsyncWork)for(let Z=0,j=$.length;Z<j;Z++){let K=$[Z];if(K.id===Y.data.vscodeScheduleAsyncWork){$.splice(Z,1),K.callback();return}}});let J=0;return(Y)=>{let Z=++J;$.push({id:Z,callback:Y}),d8.postMessage({vscodeScheduleAsyncWork:Z},"*")}}return($)=>setTimeout($)})(),ej=!!(L8&&L8.indexOf("Chrome")>=0),n3=!!(L8&&L8.indexOf("Firefox")>=0),i3=!!(!ej&&L8&&L8.indexOf("Safari")>=0),r3=!!(L8&&L8.indexOf("Edg/")>=0),t3=!!(L8&&L8.indexOf("Android")>=0),J9=typeof navigator=="object"?navigator:{},e3={clipboard:{writeText:T1||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(J9&&J9.clipboard&&J9.clipboard.writeText),readText:T1||!!(J9&&J9.clipboard&&J9.clipboard.readText)},keyboard:T1||hj()?0:J9.keyboard||w4?1:2,touch:"ontouchstart"in z8||J9.maxTouchPoints>0,pointerEvents:z8.PointerEvent&&(("ontouchstart"in z8)||navigator.maxTouchPoints>0)},w5=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define($,J){this._keyCodeToStr[$]=J,this._strToKeyCode[J.toLowerCase()]=$}keyCodeToStr($){return this._keyCodeToStr[$]}strToKeyCode($){return this._strToKeyCode[$.toLowerCase()]||0}},k1=new w5,_$=new w5,M$=new w5,$K=Array(230),f4;(($)=>{function J(X){return k1.keyCodeToStr(X)}$.toString=J;function Y(X){return k1.strToKeyCode(X)}$.fromString=Y;function Z(X){return _$.keyCodeToStr(X)}$.toUserSettingsUS=Z;function j(X){return M$.keyCodeToStr(X)}$.toUserSettingsGeneral=j;function K(X){return _$.strToKeyCode(X)||M$.strToKeyCode(X)}$.fromUserSettings=K;function Q(X){if(X>=98&&X<=113)return null;switch(X){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return k1.keyCodeToStr(X)}$.toElectronAccelerator=Q})(f4||={});var JK=class ${constructor(J,Y,Z,j,K){this.ctrlKey=J,this.shiftKey=Y,this.altKey=Z,this.metaKey=j,this.keyCode=K}equals(J){return J instanceof $&&this.ctrlKey===J.ctrlKey&&this.shiftKey===J.shiftKey&&this.altKey===J.altKey&&this.metaKey===J.metaKey&&this.keyCode===J.keyCode}getHashCode(){let J=this.ctrlKey?"1":"0",Y=this.shiftKey?"1":"0",Z=this.altKey?"1":"0",j=this.metaKey?"1":"0";return`K${J}${Y}${Z}${j}${this.keyCode}`}isModifierKey(){return this.keyCode===0||this.keyCode===5||this.keyCode===57||this.keyCode===6||this.keyCode===4}toKeybinding(){return new YK([this])}isDuplicateModifierCase(){return this.ctrlKey&&this.keyCode===5||this.shiftKey&&this.keyCode===4||this.altKey&&this.keyCode===6||this.metaKey&&this.keyCode===57}},YK=class{constructor($){if($.length===0)throw Hj("chords");this.chords=$}getHashCode(){let $="";for(let J=0,Y=this.chords.length;J<Y;J++)J!==0&&($+=";"),$+=this.chords[J].getHashCode();return $}equals($){if($===null||this.chords.length!==$.chords.length)return!1;for(let J=0;J<this.chords.length;J++)if(!this.chords[J].equals($.chords[J]))return!1;return!0}};function ZK($){if($.charCode){let Y=String.fromCharCode($.charCode).toUpperCase();return f4.fromString(Y)}let J=$.keyCode;if(J===3)return 7;if(j5)switch(J){case 59:return 85;case 60:if(oj)return 97;break;case 61:return 86;case 107:return 109;case 109:return 111;case 173:return 88;case 224:if(w8)return 57;break}else if(K6){if(w8&&J===93)return 57;if(!w8&&J===92)return 57}return $K[J]||0}var jK=w8?256:2048,KK=512,QK=1024,XK=w8?2048:256,K5=class{constructor($){this._standardKeyboardEventBrand=!0;let J=$;this.browserEvent=J,this.target=J.target,this.ctrlKey=J.ctrlKey,this.shiftKey=J.shiftKey,this.altKey=J.altKey,this.metaKey=J.metaKey,this.altGraphKey=J.getModifierState?.("AltGraph"),this.keyCode=ZK(J),this.code=J.code,this.ctrlKey=this.ctrlKey||this.keyCode===5,this.altKey=this.altKey||this.keyCode===6,this.shiftKey=this.shiftKey||this.keyCode===4,this.metaKey=this.metaKey||this.keyCode===57,this._asKeybinding=this._computeKeybinding(),this._asKeyCodeChord=this._computeKeyCodeChord()}preventDefault(){this.browserEvent&&this.browserEvent.preventDefault&&this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent&&this.browserEvent.stopPropagation&&this.browserEvent.stopPropagation()}toKeyCodeChord(){return this._asKeyCodeChord}equals($){return this._asKeybinding===$}_computeKeybinding(){let $=0;this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&($=this.keyCode);let J=0;return this.ctrlKey&&(J|=jK),this.altKey&&(J|=KK),this.shiftKey&&(J|=QK),this.metaKey&&(J|=XK),J|=$,J}_computeKeyCodeChord(){let $=0;return this.keyCode!==5&&this.keyCode!==4&&this.keyCode!==6&&this.keyCode!==57&&($=this.keyCode),new JK(this.ctrlKey,this.shiftKey,this.altKey,this.metaKey,$)}},y$=new WeakMap;function zK($){if(!$.parent||$.parent===$)return null;try{let J=$.location,Y=$.parent.location;if(J.origin!=="null"&&Y.origin!=="null"&&J.origin!==Y.origin)return null}catch{return null}return $.parent}var VK=class{static getSameOriginWindowChain($){let J=y$.get($);if(!J){J=[],y$.set($,J);let Y=$,Z;do Z=zK(Y),Z?J.push({window:new WeakRef(Y),iframeElement:Y.frameElement||null}):J.push({window:new WeakRef(Y),iframeElement:null}),Y=Z;while(Y)}return J.slice(0)}static getPositionOfChildWindowRelativeToAncestorWindow($,J){if(!J||$===J)return{top:0,left:0};let Y=0,Z=0,j=this.getSameOriginWindowChain($);for(let K of j){let Q=K.window.deref();if(Y+=Q?.scrollY??0,Z+=Q?.scrollX??0,Q===J||!K.iframeElement)break;let X=K.iframeElement.getBoundingClientRect();Y+=X.top,Z+=X.left}return{top:Y,left:Z}}},z7=class{constructor($,J){this.timestamp=Date.now(),this.browserEvent=J,this.leftButton=J.button===0,this.middleButton=J.button===1,this.rightButton=J.button===2,this.buttons=J.buttons,this.target=J.target,this.detail=J.detail||1,J.type==="dblclick"&&(this.detail=2),this.ctrlKey=J.ctrlKey,this.shiftKey=J.shiftKey,this.altKey=J.altKey,this.metaKey=J.metaKey,typeof J.pageX=="number"?(this.posx=J.pageX,this.posy=J.pageY):(this.posx=J.clientX+this.target.ownerDocument.body.scrollLeft+this.target.ownerDocument.documentElement.scrollLeft,this.posy=J.clientY+this.target.ownerDocument.body.scrollTop+this.target.ownerDocument.documentElement.scrollTop);let Y=VK.getPositionOfChildWindowRelativeToAncestorWindow($,J.view);this.posx-=Y.left,this.posy-=Y.top}preventDefault(){this.browserEvent.preventDefault()}stopPropagation(){this.browserEvent.stopPropagation()}},w$=class{constructor($,J=0,Y=0){this.browserEvent=$||null,this.target=$?$.target||$.targetNode||$.srcElement:null,this.deltaY=Y,this.deltaX=J;let Z=!1;if(y5){let j=navigator.userAgent.match(/Chrome\/(\d+)/);Z=(j?parseInt(j[1]):123)<=122}if($){let j=$,K=$,Q=$.view?.devicePixelRatio||1;if(typeof j.wheelDeltaY<"u")Z?this.deltaY=j.wheelDeltaY/(120*Q):this.deltaY=j.wheelDeltaY/120;else if(typeof K.VERTICAL_AXIS<"u"&&K.axis===K.VERTICAL_AXIS)this.deltaY=-K.detail/3;else if($.type==="wheel"){let X=$;X.deltaMode===X.DOM_DELTA_LINE?j5&&!w8?this.deltaY=-$.deltaY/3:this.deltaY=-$.deltaY:this.deltaY=-$.deltaY/40}if(typeof j.wheelDeltaX<"u")w4&&A4?this.deltaX=-(j.wheelDeltaX/120):Z?this.deltaX=j.wheelDeltaX/(120*Q):this.deltaX=j.wheelDeltaX/120;else if(typeof K.HORIZONTAL_AXIS<"u"&&K.axis===K.HORIZONTAL_AXIS)this.deltaX=-$.detail/3;else if($.type==="wheel"){let X=$;X.deltaMode===X.DOM_DELTA_LINE?j5&&!w8?this.deltaX=-$.deltaX/3:this.deltaX=-$.deltaX:this.deltaX=-$.deltaX/40}this.deltaY===0&&this.deltaX===0&&$.wheelDelta&&(Z?this.deltaY=$.wheelDelta/(120*Q):this.deltaY=$.wheelDelta/120)}}preventDefault(){this.browserEvent?.preventDefault()}stopPropagation(){this.browserEvent?.stopPropagation()}},T4=Object.freeze(function($,J){let Y=setTimeout($.bind(J),0);return{dispose(){clearTimeout(Y)}}}),GK;(($)=>{function J(Y){return Y===$.None||Y===$.Cancelled||Y instanceof WK?!0:!Y||typeof Y!="object"?!1:typeof Y.isCancellationRequested=="boolean"&&typeof Y.onCancellationRequested=="function"}$.isCancellationToken=J,$.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:g0.None}),$.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:T4})})(GK||={});var WK=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?T4:(this._emitter||(this._emitter=new L),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},$G=Symbol("MicrotaskDelay"),L5=class{constructor($,J){this._isDisposed=!1,this._token=-1,typeof $=="function"&&typeof J=="number"&&this.setIfNotSet($,J)}dispose(){this.cancel(),this._isDisposed=!0}cancel(){this._token!==-1&&(clearTimeout(this._token),this._token=-1)}cancelAndSet($,J){if(this._isDisposed)throw new e1("Calling 'cancelAndSet' on a disposed TimeoutTimer");this.cancel(),this._token=setTimeout(()=>{this._token=-1,$()},J)}setIfNotSet($,J){if(this._isDisposed)throw new e1("Calling 'setIfNotSet' on a disposed TimeoutTimer");this._token===-1&&(this._token=setTimeout(()=>{this._token=-1,$()},J))}},qK=class{constructor(){this.disposable=void 0,this.isDisposed=!1}cancel(){this.disposable?.dispose(),this.disposable=void 0}cancelAndSet($,J,Y=globalThis){if(this.isDisposed)throw new e1("Calling 'cancelAndSet' on a disposed IntervalTimer");this.cancel();let Z=Y.setInterval(()=>{$()},J);this.disposable=X0(()=>{Y.clearInterval(Z),this.disposable=void 0})}dispose(){this.cancel(),this.isDisposed=!0}},HK,S1;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?S1=($,J)=>{tj(()=>{if(Y)return;let Z=Date.now()+15;J(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,Z-Date.now())}}))});let Y=!1;return{dispose(){Y||(Y=!0)}}}:S1=($,J,Y)=>{let Z=$.requestIdleCallback(J,typeof Y=="number"?{timeout:Y}:void 0),j=!1;return{dispose(){j||(j=!0,$.cancelIdleCallback(Z))}}},HK=($)=>S1(globalThis,$)})();var UK;(($)=>{async function J(Z){let j,K=await Promise.all(Z.map((Q)=>Q.then((X)=>X,(X)=>{j||(j=X)})));if(typeof j<"u")throw j;return K}$.settled=J;function Y(Z){return new Promise(async(j,K)=>{try{await Z(j,K)}catch(Q){K(Q)}})}$.withAsyncBody=Y})(UK||={});var L$=class ${static fromArray(J){return new $((Y)=>{Y.emitMany(J)})}static fromPromise(J){return new $(async(Y)=>{Y.emitMany(await J)})}static fromPromises(J){return new $(async(Y)=>{await Promise.all(J.map(async(Z)=>Y.emitOne(await Z)))})}static merge(J){return new $(async(Y)=>{await Promise.all(J.map(async(Z)=>{for await(let j of Z)Y.emitOne(j)}))})}constructor(J,Y){this._state=0,this._results=[],this._error=null,this._onReturn=Y,this._onStateChanged=new L,queueMicrotask(async()=>{let Z={emitOne:(j)=>this.emitOne(j),emitMany:(j)=>this.emitMany(j),reject:(j)=>this.reject(j)};try{await Promise.resolve(J(Z)),this.resolve()}catch(j){this.reject(j)}finally{Z.emitOne=void 0,Z.emitMany=void 0,Z.reject=void 0}})}[Symbol.asyncIterator](){let J=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(J<this._results.length)return{done:!1,value:this._results[J++]};if(this._state===1)return{done:!0,value:void 0};await g0.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(J,Y){return new $(async(Z)=>{for await(let j of J)Z.emitOne(Y(j))})}map(J){return $.map(this,J)}static filter(J,Y){return new $(async(Z)=>{for await(let j of J)Y(j)&&Z.emitOne(j)})}filter(J){return $.filter(this,J)}static coalesce(J){return $.filter(J,(Y)=>!!Y)}coalesce(){return $.coalesce(this)}static async toPromise(J){let Y=[];for await(let Z of J)Y.push(Z);return Y}toPromise(){return $.toPromise(this)}emitOne(J){this._state===0&&(this._results.push(J),this._onStateChanged.fire())}emitMany(J){this._state===0&&(this._results=this._results.concat(J),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(J){this._state===0&&(this._state=2,this._error=J,this._onStateChanged.fire())}};L$.EMPTY=L$.fromArray([]);function IK($){return 55296<=$&&$<=56319}function E$($){return 56320<=$&&$<=57343}function BK($,J){return($-55296<<10)+(J-56320)+65536}function vK($){return E5($,0)}function E5($,J){switch(typeof $){case"object":return $===null?u8(349,J):Array.isArray($)?FK($,J):NK($,J);case"string":return k4($,J);case"boolean":return OK($,J);case"number":return u8($,J);case"undefined":return u8(937,J);default:return u8(617,J)}}function u8($,J){return(J<<5)-J+$|0}function OK($,J){return u8($?433:863,J)}function k4($,J){J=u8(149417,J);for(let Y=0,Z=$.length;Y<Z;Y++)J=u8($.charCodeAt(Y),J);return J}function FK($,J){return J=u8(104579,J),$.reduce((Y,Z)=>E5(Z,Y),J)}function NK($,J){return J=u8(181387,J),Object.keys($).sort().reduce((Y,Z)=>(Y=k4(Z,Y),E5($[Z],Y)),J)}function m1($,J,Y=32){let Z=Y-J,j=~((1<<Z)-1);return($<<J|(j&$)>>>Z)>>>0}function P$($,J=0,Y=$.byteLength,Z=0){for(let j=0;j<Y;j++)$[J+j]=Z}function xK($,J,Y="0"){for(;$.length<J;)$=Y+$;return $}function J7($,J=32){return $ instanceof ArrayBuffer?Array.from(new Uint8Array($)).map((Y)=>Y.toString(16).padStart(2,"0")).join(""):xK(($>>>0).toString(16),J/4)}var bK=class ${constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(J){let Y=J.length;if(Y===0)return;let Z=this._buff,j=this._buffLen,K=this._leftoverHighSurrogate,Q,X;for(K!==0?(Q=K,X=-1,K=0):(Q=J.charCodeAt(0),X=0);;){let V=Q;if(IK(Q))if(X+1<Y){let z=J.charCodeAt(X+1);E$(z)?(X++,V=BK(Q,z)):V=65533}else{K=Q;break}else E$(Q)&&(V=65533);if(j=this._push(Z,j,V),X++,X<Y)Q=J.charCodeAt(X);else break}this._buffLen=j,this._leftoverHighSurrogate=K}_push(J,Y,Z){return Z<128?J[Y++]=Z:Z<2048?(J[Y++]=192|(Z&1984)>>>6,J[Y++]=128|(Z&63)>>>0):Z<65536?(J[Y++]=224|(Z&61440)>>>12,J[Y++]=128|(Z&4032)>>>6,J[Y++]=128|(Z&63)>>>0):(J[Y++]=240|(Z&1835008)>>>18,J[Y++]=128|(Z&258048)>>>12,J[Y++]=128|(Z&4032)>>>6,J[Y++]=128|(Z&63)>>>0),Y>=64&&(this._step(),Y-=64,this._totalLen+=64,J[0]=J[64],J[1]=J[65],J[2]=J[66]),Y}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),J7(this._h0)+J7(this._h1)+J7(this._h2)+J7(this._h3)+J7(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,P$(this._buff,this._buffLen),this._buffLen>56&&(this._step(),P$(this._buff));let J=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(J/4294967296),!1),this._buffDV.setUint32(60,J%4294967296,!1),this._step()}_step(){let J=$._bigBlock32,Y=this._buffDV;for(let W=0;W<64;W+=4)J.setUint32(W,Y.getUint32(W,!1),!1);for(let W=64;W<320;W+=4)J.setUint32(W,m1(J.getUint32(W-12,!1)^J.getUint32(W-32,!1)^J.getUint32(W-56,!1)^J.getUint32(W-64,!1),1),!1);let Z=this._h0,j=this._h1,K=this._h2,Q=this._h3,X=this._h4,V,z,G;for(let W=0;W<80;W++)W<20?(V=j&K|~j&Q,z=1518500249):W<40?(V=j^K^Q,z=1859775393):W<60?(V=j&K|j&Q|K&Q,z=2400959708):(V=j^K^Q,z=3395469782),G=m1(Z,5)+V+X+z+J.getUint32(W*4,!1)&4294967295,X=Q,Q=K,K=m1(j,30),j=Z,Z=G;this._h0=this._h0+Z&4294967295,this._h1=this._h1+j&4294967295,this._h2=this._h2+K&4294967295,this._h3=this._h3+Q&4294967295,this._h4=this._h4+X&4294967295}};bK._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:JG,getWindow:F8,getDocument:YG,getWindows:ZG,getWindowsCount:jG,getWindowId:A$,getWindowById:KG,hasWindow:QG,onDidRegisterWindow:RK,onWillUnregisterWindow:XG,onDidUnregisterWindow:zG}=function(){let $=new Map,J={window:z8,disposables:new Q9};$.set(z8.vscodeWindowId,J);let Y=new L,Z=new L,j=new L;function K(Q,X){return(typeof Q=="number"?$.get(Q):void 0)??(X?J:void 0)}return{onDidRegisterWindow:Y.event,onWillUnregisterWindow:j.event,onDidUnregisterWindow:Z.event,registerWindow(Q){if($.has(Q.vscodeWindowId))return d.None;let X=new Q9,V={window:Q,disposables:X.add(new Q9)};return $.set(Q.vscodeWindowId,V),X.add(X0(()=>{$.delete(Q.vscodeWindowId),Z.fire(Q)})),X.add(p(Q,w0.BEFORE_UNLOAD,()=>{j.fire(Q)})),Y.fire(V),X},getWindows(){return $.values()},getWindowsCount(){return $.size},getWindowId(Q){return Q.vscodeWindowId},hasWindow(Q){return $.has(Q)},getWindowById:K,getWindow(Q){let X=Q;if(X?.ownerDocument?.defaultView)return X.ownerDocument.defaultView.window;let V=Q;return V?.view?V.view.window:z8},getDocument(Q){return F8(Q).document}}}(),DK=class{constructor($,J,Y,Z){this._node=$,this._type=J,this._handler=Y,this._options=Z||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function p($,J,Y,Z){return new DK($,J,Y,Z)}function _K($,J){return function(Y){return J(new z7($,Y))}}function MK($){return function(J){return $(new K5(J))}}var f$=function($,J,Y,Z){let j=Y;return J==="click"||J==="mousedown"||J==="contextmenu"?j=_K(F8($),Y):(J==="keydown"||J==="keypress"||J==="keyup")&&(j=MK(Y)),p($,J,j,Z)},yK,H6,wK=class extends qK{constructor($){super(),this.defaultTarget=$&&F8($)}cancelAndSet($,J,Y){return super.cancelAndSet($,J,Y??this.defaultTarget)}},C1=class{constructor($,J=0){this._runner=$,this.priority=J,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch($){Y6($)}}static sort($,J){return J.priority-$.priority}};(function(){let $=new Map,J=new Map,Y=new Map,Z=new Map,j=(K)=>{Y.set(K,!1);let Q=$.get(K)??[];for(J.set(K,Q),$.set(K,[]),Z.set(K,!0);Q.length>0;)Q.sort(C1.sort),Q.shift().execute();Z.set(K,!1)};H6=(K,Q,X=0)=>{let V=A$(K),z=new C1(Q,X),G=$.get(V);return G||(G=[],$.set(V,G)),G.push(z),Y.get(V)||(Y.set(V,!0),K.requestAnimationFrame(()=>j(V))),z},yK=(K,Q,X)=>{let V=A$(K);if(Z.get(V)){let z=new C1(Q,X),G=J.get(V);return G||(G=[],J.set(V,G)),G.push(z),z}else return H6(K,Q,X)}})();var T$=class ${constructor(J,Y){this.width=J,this.height=Y}with(J=this.width,Y=this.height){return J!==this.width||Y!==this.height?new $(J,Y):this}static is(J){return typeof J=="object"&&typeof J.height=="number"&&typeof J.width=="number"}static lift(J){return J instanceof $?J:new $(J.width,J.height)}static equals(J,Y){return J===Y?!0:!J||!Y?!1:J.width===Y.width&&J.height===Y.height}};T$.None=new T$(0,0);function LK($){let J=$.getBoundingClientRect(),Y=F8($);return{left:J.left+Y.scrollX,top:J.top+Y.scrollY,width:J.width,height:J.height}}var VG=new class{constructor(){this.mutationObservers=new Map}observe($,J,Y){let Z=this.mutationObservers.get($);Z||(Z=new Map,this.mutationObservers.set($,Z));let j=vK(Y),K=Z.get(j);if(K)K.users+=1;else{let Q=new L,X=new MutationObserver((z)=>Q.fire(z));X.observe($,Y);let V=K={users:1,observer:X,onDidMutate:Q.event};J.add(X0(()=>{V.users-=1,V.users===0&&(Q.dispose(),X.disconnect(),Z?.delete(j),Z?.size===0&&this.mutationObservers.delete($))})),Z.set(j,K)}return K.onDidMutate}},w0={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:K6?"webkitAnimationStart":"animationstart",ANIMATION_END:K6?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:K6?"webkitAnimationIteration":"animationiteration"},EK=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function S4($,J,Y,...Z){let j=EK.exec(J);if(!j)throw Error("Bad use of emmet");let K=j[1]||"div",Q;return $!=="http://www.w3.org/1999/xhtml"?Q=document.createElementNS($,K):Q=document.createElement(K),j[3]&&(Q.id=j[3]),j[4]&&(Q.className=j[4].replace(/\./g," ").trim()),Y&&Object.entries(Y).forEach(([X,V])=>{typeof V>"u"||(/^on\w+$/.test(X)?Q[X]=V:X==="selected"?V&&Q.setAttribute(X,"true"):Q.setAttribute(X,V))}),Q.append(...Z),Q}function PK($,J,...Y){return S4("http://www.w3.org/1999/xhtml",$,J,...Y)}PK.SVG=function($,J,...Y){return S4("http://www.w3.org/2000/svg",$,J,...Y)};var AK=class{constructor($){this.domNode=$,this._maxWidth="",this._width="",this._height="",this._top="",this._left="",this._bottom="",this._right="",this._paddingTop="",this._paddingLeft="",this._paddingBottom="",this._paddingRight="",this._fontFamily="",this._fontWeight="",this._fontSize="",this._fontStyle="",this._fontFeatureSettings="",this._fontVariationSettings="",this._textDecoration="",this._lineHeight="",this._letterSpacing="",this._className="",this._display="",this._position="",this._visibility="",this._color="",this._backgroundColor="",this._layerHint=!1,this._contain="none",this._boxShadow=""}setMaxWidth($){let J=J8($);this._maxWidth!==J&&(this._maxWidth=J,this.domNode.style.maxWidth=this._maxWidth)}setWidth($){let J=J8($);this._width!==J&&(this._width=J,this.domNode.style.width=this._width)}setHeight($){let J=J8($);this._height!==J&&(this._height=J,this.domNode.style.height=this._height)}setTop($){let J=J8($);this._top!==J&&(this._top=J,this.domNode.style.top=this._top)}setLeft($){let J=J8($);this._left!==J&&(this._left=J,this.domNode.style.left=this._left)}setBottom($){let J=J8($);this._bottom!==J&&(this._bottom=J,this.domNode.style.bottom=this._bottom)}setRight($){let J=J8($);this._right!==J&&(this._right=J,this.domNode.style.right=this._right)}setPaddingTop($){let J=J8($);this._paddingTop!==J&&(this._paddingTop=J,this.domNode.style.paddingTop=this._paddingTop)}setPaddingLeft($){let J=J8($);this._paddingLeft!==J&&(this._paddingLeft=J,this.domNode.style.paddingLeft=this._paddingLeft)}setPaddingBottom($){let J=J8($);this._paddingBottom!==J&&(this._paddingBottom=J,this.domNode.style.paddingBottom=this._paddingBottom)}setPaddingRight($){let J=J8($);this._paddingRight!==J&&(this._paddingRight=J,this.domNode.style.paddingRight=this._paddingRight)}setFontFamily($){this._fontFamily!==$&&(this._fontFamily=$,this.domNode.style.fontFamily=this._fontFamily)}setFontWeight($){this._fontWeight!==$&&(this._fontWeight=$,this.domNode.style.fontWeight=this._fontWeight)}setFontSize($){let J=J8($);this._fontSize!==J&&(this._fontSize=J,this.domNode.style.fontSize=this._fontSize)}setFontStyle($){this._fontStyle!==$&&(this._fontStyle=$,this.domNode.style.fontStyle=this._fontStyle)}setFontFeatureSettings($){this._fontFeatureSettings!==$&&(this._fontFeatureSettings=$,this.domNode.style.fontFeatureSettings=this._fontFeatureSettings)}setFontVariationSettings($){this._fontVariationSettings!==$&&(this._fontVariationSettings=$,this.domNode.style.fontVariationSettings=this._fontVariationSettings)}setTextDecoration($){this._textDecoration!==$&&(this._textDecoration=$,this.domNode.style.textDecoration=this._textDecoration)}setLineHeight($){let J=J8($);this._lineHeight!==J&&(this._lineHeight=J,this.domNode.style.lineHeight=this._lineHeight)}setLetterSpacing($){let J=J8($);this._letterSpacing!==J&&(this._letterSpacing=J,this.domNode.style.letterSpacing=this._letterSpacing)}setClassName($){this._className!==$&&(this._className=$,this.domNode.className=this._className)}toggleClassName($,J){this.domNode.classList.toggle($,J),this._className=this.domNode.className}setDisplay($){this._display!==$&&(this._display=$,this.domNode.style.display=this._display)}setPosition($){this._position!==$&&(this._position=$,this.domNode.style.position=this._position)}setVisibility($){this._visibility!==$&&(this._visibility=$,this.domNode.style.visibility=this._visibility)}setColor($){this._color!==$&&(this._color=$,this.domNode.style.color=this._color)}setBackgroundColor($){this._backgroundColor!==$&&(this._backgroundColor=$,this.domNode.style.backgroundColor=this._backgroundColor)}setLayerHinting($){this._layerHint!==$&&(this._layerHint=$,this.domNode.style.transform=this._layerHint?"translate3d(0px, 0px, 0px)":"")}setBoxShadow($){this._boxShadow!==$&&(this._boxShadow=$,this.domNode.style.boxShadow=$)}setContain($){this._contain!==$&&(this._contain=$,this.domNode.style.contain=this._contain)}setAttribute($,J){this.domNode.setAttribute($,J)}removeAttribute($){this.domNode.removeAttribute($)}appendChild($){this.domNode.appendChild($.domNode)}removeChild($){this.domNode.removeChild($.domNode)}};function J8($){return typeof $=="number"?`${$}px`:$}function I7($){return new AK($)}var m4=class{constructor(){this._hooks=new Q9,this._pointerMoveCallback=null,this._onStopCallback=null}dispose(){this.stopMonitoring(!1),this._hooks.dispose()}stopMonitoring($,J){if(!this.isMonitoring())return;this._hooks.clear(),this._pointerMoveCallback=null;let Y=this._onStopCallback;this._onStopCallback=null,$&&Y&&Y(J)}isMonitoring(){return!!this._pointerMoveCallback}startMonitoring($,J,Y,Z,j){this.isMonitoring()&&this.stopMonitoring(!1),this._pointerMoveCallback=Z,this._onStopCallback=j;let K=$;try{$.setPointerCapture(J),this._hooks.add(X0(()=>{try{$.releasePointerCapture(J)}catch{}}))}catch{K=F8($)}this._hooks.add(p(K,w0.POINTER_MOVE,(Q)=>{if(Q.buttons!==Y){this.stopMonitoring(!0);return}Q.preventDefault(),this._pointerMoveCallback(Q)})),this._hooks.add(p(K,w0.POINTER_UP,(Q)=>this.stopMonitoring(!0)))}};function fK($,J,Y){let Z=null,j=null;if(typeof Y.value=="function"?(Z="value",j=Y.value,j.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof Y.get=="function"&&(Z="get",j=Y.get),!j)throw Error("not supported");let K=`$memoize$${J}`;Y[Z]=function(...Q){return this.hasOwnProperty(K)||Object.defineProperty(this,K,{configurable:!1,enumerable:!1,writable:!1,value:j.apply(this,Q)}),this[K]}}var y8;(($)=>($.Tap="-xterm-gesturetap",$.Change="-xterm-gesturechange",$.Start="-xterm-gesturestart",$.End="-xterm-gesturesend",$.Contextmenu="-xterm-gesturecontextmenu"))(y8||={});var V7=class $ extends d{constructor(){super();this.dispatched=!1,this.targets=new x$,this.ignoreTargets=new x$,this.activeTouches={},this.handle=null,this._lastSetTapCountTime=0,this._register(g0.runAndSubscribe(RK,({window:J,disposables:Y})=>{Y.add(p(J.document,"touchstart",(Z)=>this.onTouchStart(Z),{passive:!1})),Y.add(p(J.document,"touchend",(Z)=>this.onTouchEnd(J,Z))),Y.add(p(J.document,"touchmove",(Z)=>this.onTouchMove(Z),{passive:!1}))},{window:z8,disposables:this._store}))}static addTarget(J){if(!$.isTouchDevice())return d.None;$.INSTANCE||($.INSTANCE=N$(new $));let Y=$.INSTANCE.targets.push(J);return X0(Y)}static ignoreTarget(J){if(!$.isTouchDevice())return d.None;$.INSTANCE||($.INSTANCE=N$(new $));let Y=$.INSTANCE.ignoreTargets.push(J);return X0(Y)}static isTouchDevice(){return"ontouchstart"in z8||navigator.maxTouchPoints>0}dispose(){this.handle&&(this.handle.dispose(),this.handle=null),super.dispose()}onTouchStart(J){let Y=Date.now();this.handle&&(this.handle.dispose(),this.handle=null);for(let Z=0,j=J.targetTouches.length;Z<j;Z++){let K=J.targetTouches.item(Z);this.activeTouches[K.identifier]={id:K.identifier,initialTarget:K.target,initialTimeStamp:Y,initialPageX:K.pageX,initialPageY:K.pageY,rollingTimestamps:[Y],rollingPageX:[K.pageX],rollingPageY:[K.pageY]};let Q=this.newGestureEvent(y8.Start,K.target);Q.pageX=K.pageX,Q.pageY=K.pageY,this.dispatchEvent(Q)}this.dispatched&&(J.preventDefault(),J.stopPropagation(),this.dispatched=!1)}onTouchEnd(J,Y){let Z=Date.now(),j=Object.keys(this.activeTouches).length;for(let K=0,Q=Y.changedTouches.length;K<Q;K++){let X=Y.changedTouches.item(K);if(!this.activeTouches.hasOwnProperty(String(X.identifier))){console.warn("move of an UNKNOWN touch",X);continue}let V=this.activeTouches[X.identifier],z=Date.now()-V.initialTimeStamp;if(z<$.HOLD_DELAY&&Math.abs(V.initialPageX-K8(V.rollingPageX))<30&&Math.abs(V.initialPageY-K8(V.rollingPageY))<30){let G=this.newGestureEvent(y8.Tap,V.initialTarget);G.pageX=K8(V.rollingPageX),G.pageY=K8(V.rollingPageY),this.dispatchEvent(G)}else if(z>=$.HOLD_DELAY&&Math.abs(V.initialPageX-K8(V.rollingPageX))<30&&Math.abs(V.initialPageY-K8(V.rollingPageY))<30){let G=this.newGestureEvent(y8.Contextmenu,V.initialTarget);G.pageX=K8(V.rollingPageX),G.pageY=K8(V.rollingPageY),this.dispatchEvent(G)}else if(j===1){let G=K8(V.rollingPageX),W=K8(V.rollingPageY),q=K8(V.rollingTimestamps)-V.rollingTimestamps[0],H=G-V.rollingPageX[0],U=W-V.rollingPageY[0],O=[...this.targets].filter((M)=>V.initialTarget instanceof Node&&M.contains(V.initialTarget));this.inertia(J,O,Z,Math.abs(H)/q,H>0?1:-1,G,Math.abs(U)/q,U>0?1:-1,W)}this.dispatchEvent(this.newGestureEvent(y8.End,V.initialTarget)),delete this.activeTouches[X.identifier]}this.dispatched&&(Y.preventDefault(),Y.stopPropagation(),this.dispatched=!1)}newGestureEvent(J,Y){let Z=document.createEvent("CustomEvent");return Z.initEvent(J,!1,!0),Z.initialTarget=Y,Z.tapCount=0,Z}dispatchEvent(J){if(J.type===y8.Tap){let Y=new Date().getTime(),Z=0;Y-this._lastSetTapCountTime>$.CLEAR_TAP_COUNT_TIME?Z=1:Z=2,this._lastSetTapCountTime=Y,J.tapCount=Z}else(J.type===y8.Change||J.type===y8.Contextmenu)&&(this._lastSetTapCountTime=0);if(J.initialTarget instanceof Node){for(let Z of this.ignoreTargets)if(Z.contains(J.initialTarget))return;let Y=[];for(let Z of this.targets)if(Z.contains(J.initialTarget)){let j=0,K=J.initialTarget;for(;K&&K!==Z;)j++,K=K.parentElement;Y.push([j,Z])}Y.sort((Z,j)=>Z[0]-j[0]);for(let[Z,j]of Y)j.dispatchEvent(J),this.dispatched=!0}}inertia(J,Y,Z,j,K,Q,X,V,z){this.handle=H6(J,()=>{let G=Date.now(),W=G-Z,q=0,H=0,U=!0;j+=$.SCROLL_FRICTION*W,X+=$.SCROLL_FRICTION*W,j>0&&(U=!1,q=K*j*W),X>0&&(U=!1,H=V*X*W);let O=this.newGestureEvent(y8.Change);O.translationX=q,O.translationY=H,Y.forEach((M)=>M.dispatchEvent(O)),U||this.inertia(J,Y,G,j,K,Q+q,X,V,z+H)})}onTouchMove(J){let Y=Date.now();for(let Z=0,j=J.changedTouches.length;Z<j;Z++){let K=J.changedTouches.item(Z);if(!this.activeTouches.hasOwnProperty(String(K.identifier))){console.warn("end of an UNKNOWN touch",K);continue}let Q=this.activeTouches[K.identifier],X=this.newGestureEvent(y8.Change,Q.initialTarget);X.translationX=K.pageX-K8(Q.rollingPageX),X.translationY=K.pageY-K8(Q.rollingPageY),X.pageX=K.pageX,X.pageY=K.pageY,this.dispatchEvent(X),Q.rollingPageX.length>3&&(Q.rollingPageX.shift(),Q.rollingPageY.shift(),Q.rollingTimestamps.shift()),Q.rollingPageX.push(K.pageX),Q.rollingPageY.push(K.pageY),Q.rollingTimestamps.push(Y)}this.dispatched&&(J.preventDefault(),J.stopPropagation(),this.dispatched=!1)}};V7.SCROLL_FRICTION=-0.005,V7.HOLD_DELAY=700,V7.CLEAR_TAP_COUNT_TIME=400,U0([fK],V7,"isTouchDevice",1);var TK=V7,P5=class extends d{onclick($,J){this._register(p($,w0.CLICK,(Y)=>J(new z7(F8($),Y))))}onmousedown($,J){this._register(p($,w0.MOUSE_DOWN,(Y)=>J(new z7(F8($),Y))))}onmouseover($,J){this._register(p($,w0.MOUSE_OVER,(Y)=>J(new z7(F8($),Y))))}onmouseleave($,J){this._register(p($,w0.MOUSE_LEAVE,(Y)=>J(new z7(F8($),Y))))}onkeydown($,J){this._register(p($,w0.KEY_DOWN,(Y)=>J(new K5(Y))))}onkeyup($,J){this._register(p($,w0.KEY_UP,(Y)=>J(new K5(Y))))}oninput($,J){this._register(p($,w0.INPUT,J))}onblur($,J){this._register(p($,w0.BLUR,J))}onfocus($,J){this._register(p($,w0.FOCUS,J))}onchange($,J){this._register(p($,w0.CHANGE,J))}ignoreGesture($){return TK.ignoreTarget($)}},k$=11,kK=class extends P5{constructor($){super(),this._onActivate=$.onActivate,this.bgDomNode=document.createElement("div"),this.bgDomNode.className="arrow-background",this.bgDomNode.style.position="absolute",this.bgDomNode.style.width=$.bgWidth+"px",this.bgDomNode.style.height=$.bgHeight+"px",typeof $.top<"u"&&(this.bgDomNode.style.top="0px"),typeof $.left<"u"&&(this.bgDomNode.style.left="0px"),typeof $.bottom<"u"&&(this.bgDomNode.style.bottom="0px"),typeof $.right<"u"&&(this.bgDomNode.style.right="0px"),this.domNode=document.createElement("div"),this.domNode.className=$.className,this.domNode.style.position="absolute",this.domNode.style.width=k$+"px",this.domNode.style.height=k$+"px",typeof $.top<"u"&&(this.domNode.style.top=$.top+"px"),typeof $.left<"u"&&(this.domNode.style.left=$.left+"px"),typeof $.bottom<"u"&&(this.domNode.style.bottom=$.bottom+"px"),typeof $.right<"u"&&(this.domNode.style.right=$.right+"px"),this._pointerMoveMonitor=this._register(new m4),this._register(f$(this.bgDomNode,w0.POINTER_DOWN,(J)=>this._arrowPointerDown(J))),this._register(f$(this.domNode,w0.POINTER_DOWN,(J)=>this._arrowPointerDown(J))),this._pointerdownRepeatTimer=this._register(new wK),this._pointerdownScheduleRepeatTimer=this._register(new L5)}_arrowPointerDown($){if(!$.target||!($.target instanceof Element))return;let J=()=>{this._pointerdownRepeatTimer.cancelAndSet(()=>this._onActivate(),41.666666666666664,F8($))};this._onActivate(),this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancelAndSet(J,200),this._pointerMoveMonitor.startMonitoring($.target,$.pointerId,$.buttons,(Y)=>{},()=>{this._pointerdownRepeatTimer.cancel(),this._pointerdownScheduleRepeatTimer.cancel()}),$.preventDefault()}},SK=class ${constructor(J,Y,Z,j,K,Q,X){this._forceIntegerValues=J,this._scrollStateBrand=void 0,this._forceIntegerValues&&(Y=Y|0,Z=Z|0,j=j|0,K=K|0,Q=Q|0,X=X|0),this.rawScrollLeft=j,this.rawScrollTop=X,Y<0&&(Y=0),j+Y>Z&&(j=Z-Y),j<0&&(j=0),K<0&&(K=0),X+K>Q&&(X=Q-K),X<0&&(X=0),this.width=Y,this.scrollWidth=Z,this.scrollLeft=j,this.height=K,this.scrollHeight=Q,this.scrollTop=X}equals(J){return this.rawScrollLeft===J.rawScrollLeft&&this.rawScrollTop===J.rawScrollTop&&this.width===J.width&&this.scrollWidth===J.scrollWidth&&this.scrollLeft===J.scrollLeft&&this.height===J.height&&this.scrollHeight===J.scrollHeight&&this.scrollTop===J.scrollTop}withScrollDimensions(J,Y){return new $(this._forceIntegerValues,typeof J.width<"u"?J.width:this.width,typeof J.scrollWidth<"u"?J.scrollWidth:this.scrollWidth,Y?this.rawScrollLeft:this.scrollLeft,typeof J.height<"u"?J.height:this.height,typeof J.scrollHeight<"u"?J.scrollHeight:this.scrollHeight,Y?this.rawScrollTop:this.scrollTop)}withScrollPosition(J){return new $(this._forceIntegerValues,this.width,this.scrollWidth,typeof J.scrollLeft<"u"?J.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof J.scrollTop<"u"?J.scrollTop:this.rawScrollTop)}createScrollEvent(J,Y){let Z=this.width!==J.width,j=this.scrollWidth!==J.scrollWidth,K=this.scrollLeft!==J.scrollLeft,Q=this.height!==J.height,X=this.scrollHeight!==J.scrollHeight,V=this.scrollTop!==J.scrollTop;return{inSmoothScrolling:Y,oldWidth:J.width,oldScrollWidth:J.scrollWidth,oldScrollLeft:J.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:J.height,oldScrollHeight:J.scrollHeight,oldScrollTop:J.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:Z,scrollWidthChanged:j,scrollLeftChanged:K,heightChanged:Q,scrollHeightChanged:X,scrollTopChanged:V}}},mK=class extends d{constructor($){super();this._scrollableBrand=void 0,this._onScroll=this._register(new L),this.onScroll=this._onScroll.event,this._smoothScrollDuration=$.smoothScrollDuration,this._scheduleAtNextAnimationFrame=$.scheduleAtNextAnimationFrame,this._state=new SK($.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration($){this._smoothScrollDuration=$}validateScrollPosition($){return this._state.withScrollPosition($)}getScrollDimensions(){return this._state}setScrollDimensions($,J){let Y=this._state.withScrollDimensions($,J);this._setState(Y,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow($){let J=this._state.withScrollPosition($);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(J,!1)}setScrollPositionSmooth($,J){if(this._smoothScrollDuration===0)return this.setScrollPositionNow($);if(this._smoothScrolling){$={scrollLeft:typeof $.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:$.scrollLeft,scrollTop:typeof $.scrollTop>"u"?this._smoothScrolling.to.scrollTop:$.scrollTop};let Y=this._state.withScrollPosition($);if(this._smoothScrolling.to.scrollLeft===Y.scrollLeft&&this._smoothScrolling.to.scrollTop===Y.scrollTop)return;let Z;J?Z=new m$(this._smoothScrolling.from,Y,this._smoothScrolling.startTime,this._smoothScrolling.duration):Z=this._smoothScrolling.combine(this._state,Y,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=Z}else{let Y=this._state.withScrollPosition($);this._smoothScrolling=m$.start(this._state,Y,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;let $=this._smoothScrolling.tick(),J=this._state.withScrollPosition($);if(this._setState(J,!0),!!this._smoothScrolling){if($.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState($,J){let Y=this._state;Y.equals($)||(this._state=$,this._onScroll.fire(this._state.createScrollEvent(Y,J)))}},S$=class{constructor($,J,Y){this.scrollLeft=$,this.scrollTop=J,this.isDone=Y}};function g1($,J){let Y=J-$;return function(Z){return $+Y*hK(Z)}}function CK($,J,Y){return function(Z){return Z<Y?$(Z/Y):J((Z-Y)/(1-Y))}}var m$=class ${constructor(J,Y,Z,j){this.from=J,this.to=Y,this.duration=j,this.startTime=Z,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(J,Y,Z){if(Math.abs(J-Y)>2.5*Z){let j,K;return J<Y?(j=J+0.75*Z,K=Y-0.75*Z):(j=J-0.75*Z,K=Y+0.75*Z),CK(g1(J,j),g1(K,Y),0.33)}return g1(J,Y)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(J){this.to=J.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(J){let Y=(J-this.startTime)/this.duration;if(Y<1){let Z=this.scrollLeft(Y),j=this.scrollTop(Y);return new S$(Z,j,!1)}return new S$(this.to.scrollLeft,this.to.scrollTop,!0)}combine(J,Y,Z){return $.start(J,Y,Z)}static start(J,Y,Z){Z=Z+10;let j=Date.now()-10;return new $(J,Y,j,Z)}};function gK($){return Math.pow($,3)}function hK($){return 1-gK(1-$)}var pK=class extends d{constructor($,J,Y){super(),this._visibility=$,this._visibleClassName=J,this._invisibleClassName=Y,this._domNode=null,this._isVisible=!1,this._isNeeded=!1,this._rawShouldBeVisible=!1,this._shouldBeVisible=!1,this._revealTimer=this._register(new L5)}setVisibility($){this._visibility!==$&&(this._visibility=$,this._updateShouldBeVisible())}setShouldBeVisible($){this._rawShouldBeVisible=$,this._updateShouldBeVisible()}_applyVisibilitySetting(){return this._visibility===2?!1:this._visibility===3?!0:this._rawShouldBeVisible}_updateShouldBeVisible(){let $=this._applyVisibilitySetting();this._shouldBeVisible!==$&&(this._shouldBeVisible=$,this.ensureVisibility())}setIsNeeded($){this._isNeeded!==$&&(this._isNeeded=$,this.ensureVisibility())}setDomNode($){this._domNode=$,this._domNode.setClassName(this._invisibleClassName),this.setShouldBeVisible(!1)}ensureVisibility(){if(!this._isNeeded){this._hide(!1);return}this._shouldBeVisible?this._reveal():this._hide(!0)}_reveal(){this._isVisible||(this._isVisible=!0,this._revealTimer.setIfNotSet(()=>{this._domNode?.setClassName(this._visibleClassName)},0))}_hide($){this._revealTimer.cancel(),this._isVisible&&(this._isVisible=!1,this._domNode?.setClassName(this._invisibleClassName+($?" fade":"")))}},uK=140,C4=class extends P5{constructor($){super(),this._lazyRender=$.lazyRender,this._host=$.host,this._scrollable=$.scrollable,this._scrollByPage=$.scrollByPage,this._scrollbarState=$.scrollbarState,this._visibilityController=this._register(new pK($.visibility,"visible scrollbar "+$.extraScrollbarClassName,"invisible scrollbar "+$.extraScrollbarClassName)),this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._pointerMoveMonitor=this._register(new m4),this._shouldRender=!0,this.domNode=I7(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this._visibilityController.setDomNode(this.domNode),this.domNode.setPosition("absolute"),this._register(p(this.domNode.domNode,w0.POINTER_DOWN,(J)=>this._domNodePointerDown(J)))}_createArrow($){let J=this._register(new kK($));this.domNode.domNode.appendChild(J.bgDomNode),this.domNode.domNode.appendChild(J.domNode)}_createSlider($,J,Y,Z){this.slider=I7(document.createElement("div")),this.slider.setClassName("slider"),this.slider.setPosition("absolute"),this.slider.setTop($),this.slider.setLeft(J),typeof Y=="number"&&this.slider.setWidth(Y),typeof Z=="number"&&this.slider.setHeight(Z),this.slider.setLayerHinting(!0),this.slider.setContain("strict"),this.domNode.domNode.appendChild(this.slider.domNode),this._register(p(this.slider.domNode,w0.POINTER_DOWN,(j)=>{j.button===0&&(j.preventDefault(),this._sliderPointerDown(j))})),this.onclick(this.slider.domNode,(j)=>{j.leftButton&&j.stopPropagation()})}_onElementSize($){return this._scrollbarState.setVisibleSize($)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollSize($){return this._scrollbarState.setScrollSize($)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}_onElementScrollPosition($){return this._scrollbarState.setScrollPosition($)&&(this._visibilityController.setIsNeeded(this._scrollbarState.isNeeded()),this._shouldRender=!0,this._lazyRender||this.render()),this._shouldRender}beginReveal(){this._visibilityController.setShouldBeVisible(!0)}beginHide(){this._visibilityController.setShouldBeVisible(!1)}render(){this._shouldRender&&(this._shouldRender=!1,this._renderDomNode(this._scrollbarState.getRectangleLargeSize(),this._scrollbarState.getRectangleSmallSize()),this._updateSlider(this._scrollbarState.getSliderSize(),this._scrollbarState.getArrowSize()+this._scrollbarState.getSliderPosition()))}_domNodePointerDown($){$.target===this.domNode.domNode&&this._onPointerDown($)}delegatePointerDown($){let J=this.domNode.domNode.getClientRects()[0].top,Y=J+this._scrollbarState.getSliderPosition(),Z=J+this._scrollbarState.getSliderPosition()+this._scrollbarState.getSliderSize(),j=this._sliderPointerPosition($);Y<=j&&j<=Z?$.button===0&&($.preventDefault(),this._sliderPointerDown($)):this._onPointerDown($)}_onPointerDown($){let J,Y;if($.target===this.domNode.domNode&&typeof $.offsetX=="number"&&typeof $.offsetY=="number")J=$.offsetX,Y=$.offsetY;else{let j=LK(this.domNode.domNode);J=$.pageX-j.left,Y=$.pageY-j.top}let Z=this._pointerDownRelativePosition(J,Y);this._setDesiredScrollPositionNow(this._scrollByPage?this._scrollbarState.getDesiredScrollPositionFromOffsetPaged(Z):this._scrollbarState.getDesiredScrollPositionFromOffset(Z)),$.button===0&&($.preventDefault(),this._sliderPointerDown($))}_sliderPointerDown($){if(!$.target||!($.target instanceof Element))return;let J=this._sliderPointerPosition($),Y=this._sliderOrthogonalPointerPosition($),Z=this._scrollbarState.clone();this.slider.toggleClassName("active",!0),this._pointerMoveMonitor.startMonitoring($.target,$.pointerId,$.buttons,(j)=>{let K=this._sliderOrthogonalPointerPosition(j),Q=Math.abs(K-Y);if(A4&&Q>uK){this._setDesiredScrollPositionNow(Z.getScrollPosition());return}let X=this._sliderPointerPosition(j)-J;this._setDesiredScrollPositionNow(Z.getDesiredScrollPositionFromDelta(X))},()=>{this.slider.toggleClassName("active",!1),this._host.onDragEnd()}),this._host.onDragStart()}_setDesiredScrollPositionNow($){let J={};this.writeScrollPosition(J,$),this._scrollable.setScrollPositionNow(J)}updateScrollbarSize($){this._updateScrollbarSize($),this._scrollbarState.setScrollbarSize($),this._shouldRender=!0,this._lazyRender||this.render()}isNeeded(){return this._scrollbarState.isNeeded()}},g4=class ${constructor(J,Y,Z,j,K,Q){this._scrollbarSize=Math.round(Y),this._oppositeScrollbarSize=Math.round(Z),this._arrowSize=Math.round(J),this._visibleSize=j,this._scrollSize=K,this._scrollPosition=Q,this._computedAvailableSize=0,this._computedIsNeeded=!1,this._computedSliderSize=0,this._computedSliderRatio=0,this._computedSliderPosition=0,this._refreshComputedValues()}clone(){return new $(this._arrowSize,this._scrollbarSize,this._oppositeScrollbarSize,this._visibleSize,this._scrollSize,this._scrollPosition)}setVisibleSize(J){let Y=Math.round(J);return this._visibleSize!==Y?(this._visibleSize=Y,this._refreshComputedValues(),!0):!1}setScrollSize(J){let Y=Math.round(J);return this._scrollSize!==Y?(this._scrollSize=Y,this._refreshComputedValues(),!0):!1}setScrollPosition(J){let Y=Math.round(J);return this._scrollPosition!==Y?(this._scrollPosition=Y,this._refreshComputedValues(),!0):!1}setScrollbarSize(J){this._scrollbarSize=Math.round(J)}setOppositeScrollbarSize(J){this._oppositeScrollbarSize=Math.round(J)}static _computeValues(J,Y,Z,j,K){let Q=Math.max(0,Z-J),X=Math.max(0,Q-2*Y),V=j>0&&j>Z;if(!V)return{computedAvailableSize:Math.round(Q),computedIsNeeded:V,computedSliderSize:Math.round(X),computedSliderRatio:0,computedSliderPosition:0};let z=Math.round(Math.max(20,Math.floor(Z*X/j))),G=(X-z)/(j-Z),W=K*G;return{computedAvailableSize:Math.round(Q),computedIsNeeded:V,computedSliderSize:Math.round(z),computedSliderRatio:G,computedSliderPosition:Math.round(W)}}_refreshComputedValues(){let J=$._computeValues(this._oppositeScrollbarSize,this._arrowSize,this._visibleSize,this._scrollSize,this._scrollPosition);this._computedAvailableSize=J.computedAvailableSize,this._computedIsNeeded=J.computedIsNeeded,this._computedSliderSize=J.computedSliderSize,this._computedSliderRatio=J.computedSliderRatio,this._computedSliderPosition=J.computedSliderPosition}getArrowSize(){return this._arrowSize}getScrollPosition(){return this._scrollPosition}getRectangleLargeSize(){return this._computedAvailableSize}getRectangleSmallSize(){return this._scrollbarSize}isNeeded(){return this._computedIsNeeded}getSliderSize(){return this._computedSliderSize}getSliderPosition(){return this._computedSliderPosition}getDesiredScrollPositionFromOffset(J){if(!this._computedIsNeeded)return 0;let Y=J-this._arrowSize-this._computedSliderSize/2;return Math.round(Y/this._computedSliderRatio)}getDesiredScrollPositionFromOffsetPaged(J){if(!this._computedIsNeeded)return 0;let Y=J-this._arrowSize,Z=this._scrollPosition;return Y<this._computedSliderPosition?Z-=this._visibleSize:Z+=this._visibleSize,Z}getDesiredScrollPositionFromDelta(J){if(!this._computedIsNeeded)return 0;let Y=this._computedSliderPosition+J;return Math.round(Y/this._computedSliderRatio)}},dK=class extends C4{constructor($,J,Y){let Z=$.getScrollDimensions(),j=$.getCurrentScrollPosition();if(super({lazyRender:J.lazyRender,host:Y,scrollbarState:new g4(J.horizontalHasArrows?J.arrowSize:0,J.horizontal===2?0:J.horizontalScrollbarSize,J.vertical===2?0:J.verticalScrollbarSize,Z.width,Z.scrollWidth,j.scrollLeft),visibility:J.horizontal,extraScrollbarClassName:"horizontal",scrollable:$,scrollByPage:J.scrollByPage}),J.horizontalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(Math.floor((J.horizontalScrollbarSize-J.horizontalSliderSize)/2),0,void 0,J.horizontalSliderSize)}_updateSlider($,J){this.slider.setWidth($),this.slider.setLeft(J)}_renderDomNode($,J){this.domNode.setWidth($),this.domNode.setHeight(J),this.domNode.setLeft(0),this.domNode.setBottom(0)}onDidScroll($){return this._shouldRender=this._onElementScrollSize($.scrollWidth)||this._shouldRender,this._shouldRender=this._onElementScrollPosition($.scrollLeft)||this._shouldRender,this._shouldRender=this._onElementSize($.width)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition($,J){return $}_sliderPointerPosition($){return $.pageX}_sliderOrthogonalPointerPosition($){return $.pageY}_updateScrollbarSize($){this.slider.setHeight($)}writeScrollPosition($,J){$.scrollLeft=J}updateOptions($){this.updateScrollbarSize($.horizontal===2?0:$.horizontalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize($.vertical===2?0:$.verticalScrollbarSize),this._visibilityController.setVisibility($.horizontal),this._scrollByPage=$.scrollByPage}},cK=class extends C4{constructor($,J,Y){let Z=$.getScrollDimensions(),j=$.getCurrentScrollPosition();if(super({lazyRender:J.lazyRender,host:Y,scrollbarState:new g4(J.verticalHasArrows?J.arrowSize:0,J.vertical===2?0:J.verticalScrollbarSize,0,Z.height,Z.scrollHeight,j.scrollTop),visibility:J.vertical,extraScrollbarClassName:"vertical",scrollable:$,scrollByPage:J.scrollByPage}),J.verticalHasArrows)throw Error("horizontalHasArrows is not supported in xterm.js");this._createSlider(0,Math.floor((J.verticalScrollbarSize-J.verticalSliderSize)/2),J.verticalSliderSize,void 0)}_updateSlider($,J){this.slider.setHeight($),this.slider.setTop(J)}_renderDomNode($,J){this.domNode.setWidth(J),this.domNode.setHeight($),this.domNode.setRight(0),this.domNode.setTop(0)}onDidScroll($){return this._shouldRender=this._onElementScrollSize($.scrollHeight)||this._shouldRender,this._shouldRender=this._onElementScrollPosition($.scrollTop)||this._shouldRender,this._shouldRender=this._onElementSize($.height)||this._shouldRender,this._shouldRender}_pointerDownRelativePosition($,J){return J}_sliderPointerPosition($){return $.pageY}_sliderOrthogonalPointerPosition($){return $.pageX}_updateScrollbarSize($){this.slider.setWidth($)}writeScrollPosition($,J){$.scrollTop=J}updateOptions($){this.updateScrollbarSize($.vertical===2?0:$.verticalScrollbarSize),this._scrollbarState.setOppositeScrollbarSize(0),this._visibilityController.setVisibility($.vertical),this._scrollByPage=$.scrollByPage}},lK=500,C$=50,g$=!0,sK=class{constructor($,J,Y){this.timestamp=$,this.deltaX=J,this.deltaY=Y,this.score=0}},Q5=class{constructor(){this._capacity=5,this._memory=[],this._front=-1,this._rear=-1}isPhysicalMouseWheel(){if(this._front===-1&&this._rear===-1)return!1;let J=1,Y=0,Z=1,j=this._rear;do{let K=j===this._front?J:Math.pow(2,-Z);if(J-=K,Y+=this._memory[j].score*K,j===this._front)break;j=(this._capacity+j-1)%this._capacity,Z++}while(!0);return Y<=0.5}acceptStandardWheelEvent(J){if(y5){let Y=F8(J.browserEvent),Z=gj(Y);this.accept(Date.now(),J.deltaX*Z,J.deltaY*Z)}else this.accept(Date.now(),J.deltaX,J.deltaY)}accept(J,Y,Z){let j=null,K=new sK(J,Y,Z);this._front===-1&&this._rear===-1?(this._memory[0]=K,this._front=0,this._rear=0):(j=this._memory[this._rear],this._rear=(this._rear+1)%this._capacity,this._rear===this._front&&(this._front=(this._front+1)%this._capacity),this._memory[this._rear]=K),K.score=this._computeScore(K,j)}_computeScore(J,Y){if(Math.abs(J.deltaX)>0&&Math.abs(J.deltaY)>0)return 1;let Z=0.5;if((!this._isAlmostInt(J.deltaX)||!this._isAlmostInt(J.deltaY))&&(Z+=0.25),Y){let j=Math.abs(J.deltaX),K=Math.abs(J.deltaY),Q=Math.abs(Y.deltaX),X=Math.abs(Y.deltaY),V=Math.max(Math.min(j,Q),1),z=Math.max(Math.min(K,X),1),G=Math.max(j,Q),W=Math.max(K,X);G%V===0&&W%z===0&&(Z-=0.5)}return Math.min(Math.max(Z,0),1)}_isAlmostInt(J){return Math.abs(Math.round(J)-J)<0.01}};Q5.INSTANCE=new Q5;var aK=Q5,oK=class extends P5{constructor($,J,Y){super();this._onScroll=this._register(new L),this.onScroll=this._onScroll.event,this._onWillScroll=this._register(new L),this.onWillScroll=this._onWillScroll.event,this._options=iK(J),this._scrollable=Y,this._register(this._scrollable.onScroll((j)=>{this._onWillScroll.fire(j),this._onDidScroll(j),this._onScroll.fire(j)}));let Z={onMouseWheel:(j)=>this._onMouseWheel(j),onDragStart:()=>this._onDragStart(),onDragEnd:()=>this._onDragEnd()};this._verticalScrollbar=this._register(new cK(this._scrollable,this._options,Z)),this._horizontalScrollbar=this._register(new dK(this._scrollable,this._options,Z)),this._domNode=document.createElement("div"),this._domNode.className="xterm-scrollable-element "+this._options.className,this._domNode.setAttribute("role","presentation"),this._domNode.style.position="relative",this._domNode.appendChild($),this._domNode.appendChild(this._horizontalScrollbar.domNode.domNode),this._domNode.appendChild(this._verticalScrollbar.domNode.domNode),this._options.useShadows?(this._leftShadowDomNode=I7(document.createElement("div")),this._leftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._leftShadowDomNode.domNode),this._topShadowDomNode=I7(document.createElement("div")),this._topShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topShadowDomNode.domNode),this._topLeftShadowDomNode=I7(document.createElement("div")),this._topLeftShadowDomNode.setClassName("shadow"),this._domNode.appendChild(this._topLeftShadowDomNode.domNode)):(this._leftShadowDomNode=null,this._topShadowDomNode=null,this._topLeftShadowDomNode=null),this._listenOnDomNode=this._options.listenOnDomNode||this._domNode,this._mouseWheelToDispose=[],this._setListeningToMouseWheel(this._options.handleMouseWheel),this.onmouseover(this._listenOnDomNode,(j)=>this._onMouseOver(j)),this.onmouseleave(this._listenOnDomNode,(j)=>this._onMouseLeave(j)),this._hideTimeout=this._register(new L5),this._isDragging=!1,this._mouseIsOver=!1,this._shouldRender=!0,this._revealOnScroll=!0}get options(){return this._options}dispose(){this._mouseWheelToDispose=x9(this._mouseWheelToDispose),super.dispose()}getDomNode(){return this._domNode}getOverviewRulerLayoutInfo(){return{parent:this._domNode,insertBefore:this._verticalScrollbar.domNode.domNode}}delegateVerticalScrollbarPointerDown($){this._verticalScrollbar.delegatePointerDown($)}getScrollDimensions(){return this._scrollable.getScrollDimensions()}setScrollDimensions($){this._scrollable.setScrollDimensions($,!1)}updateClassName($){this._options.className=$,w8&&(this._options.className+=" mac"),this._domNode.className="xterm-scrollable-element "+this._options.className}updateOptions($){typeof $.handleMouseWheel<"u"&&(this._options.handleMouseWheel=$.handleMouseWheel,this._setListeningToMouseWheel(this._options.handleMouseWheel)),typeof $.mouseWheelScrollSensitivity<"u"&&(this._options.mouseWheelScrollSensitivity=$.mouseWheelScrollSensitivity),typeof $.fastScrollSensitivity<"u"&&(this._options.fastScrollSensitivity=$.fastScrollSensitivity),typeof $.scrollPredominantAxis<"u"&&(this._options.scrollPredominantAxis=$.scrollPredominantAxis),typeof $.horizontal<"u"&&(this._options.horizontal=$.horizontal),typeof $.vertical<"u"&&(this._options.vertical=$.vertical),typeof $.horizontalScrollbarSize<"u"&&(this._options.horizontalScrollbarSize=$.horizontalScrollbarSize),typeof $.verticalScrollbarSize<"u"&&(this._options.verticalScrollbarSize=$.verticalScrollbarSize),typeof $.scrollByPage<"u"&&(this._options.scrollByPage=$.scrollByPage),this._horizontalScrollbar.updateOptions(this._options),this._verticalScrollbar.updateOptions(this._options),this._options.lazyRender||this._render()}setRevealOnScroll($){this._revealOnScroll=$}delegateScrollFromMouseWheelEvent($){this._onMouseWheel(new w$($))}_setListeningToMouseWheel($){if(this._mouseWheelToDispose.length>0!==$&&(this._mouseWheelToDispose=x9(this._mouseWheelToDispose),$)){let J=(Y)=>{this._onMouseWheel(new w$(Y))};this._mouseWheelToDispose.push(p(this._listenOnDomNode,w0.MOUSE_WHEEL,J,{passive:!1}))}}_onMouseWheel($){if($.browserEvent?.defaultPrevented)return;let J=aK.INSTANCE;g$&&J.acceptStandardWheelEvent($);let Y=!1;if($.deltaY||$.deltaX){let j=$.deltaY*this._options.mouseWheelScrollSensitivity,K=$.deltaX*this._options.mouseWheelScrollSensitivity;this._options.scrollPredominantAxis&&(this._options.scrollYToX&&K+j===0?K=j=0:Math.abs(j)>=Math.abs(K)?K=0:j=0),this._options.flipAxes&&([j,K]=[K,j]);let Q=!w8&&$.browserEvent&&$.browserEvent.shiftKey;(this._options.scrollYToX||Q)&&!K&&(K=j,j=0),$.browserEvent&&$.browserEvent.altKey&&(K=K*this._options.fastScrollSensitivity,j=j*this._options.fastScrollSensitivity);let X=this._scrollable.getFutureScrollPosition(),V={};if(j){let z=C$*j,G=X.scrollTop-(z<0?Math.floor(z):Math.ceil(z));this._verticalScrollbar.writeScrollPosition(V,G)}if(K){let z=C$*K,G=X.scrollLeft-(z<0?Math.floor(z):Math.ceil(z));this._horizontalScrollbar.writeScrollPosition(V,G)}V=this._scrollable.validateScrollPosition(V),(X.scrollLeft!==V.scrollLeft||X.scrollTop!==V.scrollTop)&&(g$&&this._options.mouseWheelSmoothScroll&&J.isPhysicalMouseWheel()?this._scrollable.setScrollPositionSmooth(V):this._scrollable.setScrollPositionNow(V),Y=!0)}let Z=Y;!Z&&this._options.alwaysConsumeMouseWheel&&(Z=!0),!Z&&this._options.consumeMouseWheelIfScrollbarIsNeeded&&(this._verticalScrollbar.isNeeded()||this._horizontalScrollbar.isNeeded())&&(Z=!0),Z&&($.preventDefault(),$.stopPropagation())}_onDidScroll($){this._shouldRender=this._horizontalScrollbar.onDidScroll($)||this._shouldRender,this._shouldRender=this._verticalScrollbar.onDidScroll($)||this._shouldRender,this._options.useShadows&&(this._shouldRender=!0),this._revealOnScroll&&this._reveal(),this._options.lazyRender||this._render()}renderNow(){if(!this._options.lazyRender)throw Error("Please use `lazyRender` together with `renderNow`!");this._render()}_render(){if(this._shouldRender&&(this._shouldRender=!1,this._horizontalScrollbar.render(),this._verticalScrollbar.render(),this._options.useShadows)){let $=this._scrollable.getCurrentScrollPosition(),J=$.scrollTop>0,Y=$.scrollLeft>0,Z=Y?" left":"",j=J?" top":"",K=Y||J?" top-left-corner":"";this._leftShadowDomNode.setClassName(`shadow${Z}`),this._topShadowDomNode.setClassName(`shadow${j}`),this._topLeftShadowDomNode.setClassName(`shadow${K}${j}${Z}`)}}_onDragStart(){this._isDragging=!0,this._reveal()}_onDragEnd(){this._isDragging=!1,this._hide()}_onMouseLeave($){this._mouseIsOver=!1,this._hide()}_onMouseOver($){this._mouseIsOver=!0,this._reveal()}_reveal(){this._verticalScrollbar.beginReveal(),this._horizontalScrollbar.beginReveal(),this._scheduleHide()}_hide(){!this._mouseIsOver&&!this._isDragging&&(this._verticalScrollbar.beginHide(),this._horizontalScrollbar.beginHide())}_scheduleHide(){!this._mouseIsOver&&!this._isDragging&&this._hideTimeout.cancelAndSet(()=>this._hide(),lK)}},nK=class extends oK{constructor($,J,Y){super($,J,Y)}setScrollPosition($){$.reuseAnimation?this._scrollable.setScrollPositionSmooth($,$.reuseAnimation):this._scrollable.setScrollPositionNow($)}getScrollPosition(){return this._scrollable.getCurrentScrollPosition()}};function iK($){let J={lazyRender:typeof $.lazyRender<"u"?$.lazyRender:!1,className:typeof $.className<"u"?$.className:"",useShadows:typeof $.useShadows<"u"?$.useShadows:!0,handleMouseWheel:typeof $.handleMouseWheel<"u"?$.handleMouseWheel:!0,flipAxes:typeof $.flipAxes<"u"?$.flipAxes:!1,consumeMouseWheelIfScrollbarIsNeeded:typeof $.consumeMouseWheelIfScrollbarIsNeeded<"u"?$.consumeMouseWheelIfScrollbarIsNeeded:!1,alwaysConsumeMouseWheel:typeof $.alwaysConsumeMouseWheel<"u"?$.alwaysConsumeMouseWheel:!1,scrollYToX:typeof $.scrollYToX<"u"?$.scrollYToX:!1,mouseWheelScrollSensitivity:typeof $.mouseWheelScrollSensitivity<"u"?$.mouseWheelScrollSensitivity:1,fastScrollSensitivity:typeof $.fastScrollSensitivity<"u"?$.fastScrollSensitivity:5,scrollPredominantAxis:typeof $.scrollPredominantAxis<"u"?$.scrollPredominantAxis:!0,mouseWheelSmoothScroll:typeof $.mouseWheelSmoothScroll<"u"?$.mouseWheelSmoothScroll:!0,arrowSize:typeof $.arrowSize<"u"?$.arrowSize:11,listenOnDomNode:typeof $.listenOnDomNode<"u"?$.listenOnDomNode:null,horizontal:typeof $.horizontal<"u"?$.horizontal:1,horizontalScrollbarSize:typeof $.horizontalScrollbarSize<"u"?$.horizontalScrollbarSize:10,horizontalSliderSize:typeof $.horizontalSliderSize<"u"?$.horizontalSliderSize:0,horizontalHasArrows:typeof $.horizontalHasArrows<"u"?$.horizontalHasArrows:!1,vertical:typeof $.vertical<"u"?$.vertical:1,verticalScrollbarSize:typeof $.verticalScrollbarSize<"u"?$.verticalScrollbarSize:10,verticalHasArrows:typeof $.verticalHasArrows<"u"?$.verticalHasArrows:!1,verticalSliderSize:typeof $.verticalSliderSize<"u"?$.verticalSliderSize:0,scrollByPage:typeof $.scrollByPage<"u"?$.scrollByPage:!1};return J.horizontalSliderSize=typeof $.horizontalSliderSize<"u"?$.horizontalSliderSize:J.horizontalScrollbarSize,J.verticalSliderSize=typeof $.verticalSliderSize<"u"?$.verticalSliderSize:J.verticalScrollbarSize,w8&&(J.className+=" mac"),J}var X5=class extends d{constructor($,J,Y,Z,j,K,Q,X){super();this._bufferService=Y,this._optionsService=Q,this._renderService=X,this._onRequestScrollLines=this._register(new L),this.onRequestScrollLines=this._onRequestScrollLines.event,this._isSyncing=!1,this._isHandlingScroll=!1,this._suppressOnScrollHandler=!1;let V=this._register(new mK({forceIntegerValues:!1,smoothScrollDuration:this._optionsService.rawOptions.smoothScrollDuration,scheduleAtNextAnimationFrame:(z)=>H6(Z.window,z)}));this._register(this._optionsService.onSpecificOptionChange("smoothScrollDuration",()=>{V.setSmoothScrollDuration(this._optionsService.rawOptions.smoothScrollDuration)})),this._scrollableElement=this._register(new nK(J,{vertical:1,horizontal:2,useShadows:!1,mouseWheelSmoothScroll:!0,...this._getChangeOptions()},V)),this._register(this._optionsService.onMultipleOptionChange(["scrollSensitivity","fastScrollSensitivity","overviewRuler"],()=>this._scrollableElement.updateOptions(this._getChangeOptions()))),this._register(j.onProtocolChange((z)=>{this._scrollableElement.updateOptions({handleMouseWheel:!(z&16)})})),this._scrollableElement.setScrollDimensions({height:0,scrollHeight:0}),this._register(g0.runAndSubscribe(K.onChangeColors,()=>{this._scrollableElement.getDomNode().style.backgroundColor=K.colors.background.css})),$.appendChild(this._scrollableElement.getDomNode()),this._register(X0(()=>this._scrollableElement.getDomNode().remove())),this._styleElement=Z.mainDocument.createElement("style"),J.appendChild(this._styleElement),this._register(X0(()=>this._styleElement.remove())),this._register(g0.runAndSubscribe(K.onChangeColors,()=>{this._styleElement.textContent=[".xterm .xterm-scrollable-element > .scrollbar > .slider {",`  background: ${K.colors.scrollbarSliderBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider:hover {",`  background: ${K.colors.scrollbarSliderHoverBackground.css};`,"}",".xterm .xterm-scrollable-element > .scrollbar > .slider.active {",`  background: ${K.colors.scrollbarSliderActiveBackground.css};`,"}"].join(`
`)})),this._register(this._bufferService.onResize(()=>this.queueSync())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._latestYDisp=void 0,this.queueSync()})),this._register(this._bufferService.onScroll(()=>this._sync())),this._register(this._scrollableElement.onScroll((z)=>this._handleScroll(z)))}scrollLines($){let J=this._scrollableElement.getScrollPosition();this._scrollableElement.setScrollPosition({reuseAnimation:!0,scrollTop:J.scrollTop+$*this._renderService.dimensions.css.cell.height})}scrollToLine($,J){J&&(this._latestYDisp=$),this._scrollableElement.setScrollPosition({reuseAnimation:!J,scrollTop:$*this._renderService.dimensions.css.cell.height})}_getChangeOptions(){return{mouseWheelScrollSensitivity:this._optionsService.rawOptions.scrollSensitivity,fastScrollSensitivity:this._optionsService.rawOptions.fastScrollSensitivity,verticalScrollbarSize:this._optionsService.rawOptions.overviewRuler?.width||14}}queueSync($){$!==void 0&&(this._latestYDisp=$),this._queuedAnimationFrame===void 0&&(this._queuedAnimationFrame=this._renderService.addRefreshCallback(()=>{this._queuedAnimationFrame=void 0,this._sync(this._latestYDisp)}))}_sync($=this._bufferService.buffer.ydisp){!this._renderService||this._isSyncing||(this._isSyncing=!0,this._suppressOnScrollHandler=!0,this._scrollableElement.setScrollDimensions({height:this._renderService.dimensions.css.canvas.height,scrollHeight:this._renderService.dimensions.css.cell.height*this._bufferService.buffer.lines.length}),this._suppressOnScrollHandler=!1,$!==this._latestYDisp&&this._scrollableElement.setScrollPosition({scrollTop:$*this._renderService.dimensions.css.cell.height}),this._isSyncing=!1)}_handleScroll($){if(!this._renderService||this._isHandlingScroll||this._suppressOnScrollHandler)return;this._isHandlingScroll=!0;let J=Math.round($.scrollTop/this._renderService.dimensions.css.cell.height),Y=J-this._bufferService.buffer.ydisp;Y!==0&&(this._latestYDisp=J,this._onRequestScrollLines.fire(Y)),this._isHandlingScroll=!1}};X5=U0([k(2,i0),k(3,c8),k(4,F4),k(5,k9),k(6,r0),k(7,l8)],X5);var z5=class extends d{constructor($,J,Y,Z,j){super();this._screenElement=$,this._bufferService=J,this._coreBrowserService=Y,this._decorationService=Z,this._renderService=j,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this._register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this._register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this._register(this._decorationService.onDecorationRemoved((K)=>this._removeDecoration(K))),this._register(X0(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(let $ of this._decorationService.decorations)this._renderDecoration($);this._dimensionsChanged=!1}_renderDecoration($){this._refreshStyle($),this._dimensionsChanged&&this._refreshXPosition($)}_createElement($){let J=this._coreBrowserService.mainDocument.createElement("div");J.classList.add("xterm-decoration"),J.classList.toggle("xterm-decoration-top-layer",$?.options?.layer==="top"),J.style.width=`${Math.round(($.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,J.style.height=`${($.options.height||1)*this._renderService.dimensions.css.cell.height}px`,J.style.top=`${($.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height}px`,J.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let Y=$.options.x??0;return Y&&Y>this._bufferService.cols&&(J.style.display="none"),this._refreshXPosition($,J),J}_refreshStyle($){let J=$.marker.line-this._bufferService.buffers.active.ydisp;if(J<0||J>=this._bufferService.rows)$.element&&($.element.style.display="none",$.onRenderEmitter.fire($.element));else{let Y=this._decorationElements.get($);Y||(Y=this._createElement($),$.element=Y,this._decorationElements.set($,Y),this._container.appendChild(Y),$.onDispose(()=>{this._decorationElements.delete($),Y.remove()})),Y.style.display=this._altBufferIsActive?"none":"block",this._altBufferIsActive||(Y.style.width=`${Math.round(($.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,Y.style.height=`${($.options.height||1)*this._renderService.dimensions.css.cell.height}px`,Y.style.top=`${J*this._renderService.dimensions.css.cell.height}px`,Y.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`),$.onRenderEmitter.fire(Y)}}_refreshXPosition($,J=$.element){if(!J)return;let Y=$.options.x??0;($.options.anchor||"left")==="right"?J.style.right=Y?`${Y*this._renderService.dimensions.css.cell.width}px`:"":J.style.left=Y?`${Y*this._renderService.dimensions.css.cell.width}px`:""}_removeDecoration($){this._decorationElements.get($)?.remove(),this._decorationElements.delete($),$.dispose()}};z5=U0([k(1,i0),k(2,c8),k(3,x7),k(4,l8)],z5);var rK=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration($){if($.options.overviewRulerOptions){for(let J of this._zones)if(J.color===$.options.overviewRulerOptions.color&&J.position===$.options.overviewRulerOptions.position){if(this._lineIntersectsZone(J,$.marker.line))return;if(this._lineAdjacentToZone(J,$.marker.line,$.options.overviewRulerOptions.position)){this._addLineToZone(J,$.marker.line);return}}if(this._zonePoolIndex<this._zonePool.length){this._zonePool[this._zonePoolIndex].color=$.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=$.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=$.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=$.marker.line,this._zones.push(this._zonePool[this._zonePoolIndex++]);return}this._zones.push({color:$.options.overviewRulerOptions.color,position:$.options.overviewRulerOptions.position,startBufferLine:$.marker.line,endBufferLine:$.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding($){this._linePadding=$}_lineIntersectsZone($,J){return J>=$.startBufferLine&&J<=$.endBufferLine}_lineAdjacentToZone($,J,Y){return J>=$.startBufferLine-this._linePadding[Y||"full"]&&J<=$.endBufferLine+this._linePadding[Y||"full"]}_addLineToZone($,J){$.startBufferLine=Math.min($.startBufferLine,J),$.endBufferLine=Math.max($.endBufferLine,J)}},_8={full:0,left:0,center:0,right:0},Y9={full:0,left:0,center:0,right:0},Y7={full:0,left:0,center:0,right:0},U6=class extends d{constructor($,J,Y,Z,j,K,Q,X){super();this._viewportElement=$,this._screenElement=J,this._bufferService=Y,this._decorationService=Z,this._renderService=j,this._optionsService=K,this._themeService=Q,this._coreBrowserService=X,this._colorZoneStore=new rK,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),this._viewportElement.parentElement?.insertBefore(this._canvas,this._viewportElement),this._register(X0(()=>this._canvas?.remove()));let V=this._canvas.getContext("2d");if(V)this._ctx=V;else throw Error("Ctx cannot be null");this._register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this._register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0))),this._register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this._register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this._register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})),this._register(this._renderService.onRender(()=>{(!this._containerHeight||this._containerHeight!==this._screenElement.clientHeight)&&(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this._register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._register(this._optionsService.onSpecificOptionChange("overviewRuler",()=>this._queueRefresh(!0))),this._register(this._themeService.onChangeColors(()=>this._queueRefresh())),this._queueRefresh(!0)}get _width(){return this._optionsService.options.overviewRuler?.width||0}_refreshDrawConstants(){let $=Math.floor((this._canvas.width-1)/3),J=Math.ceil((this._canvas.width-1)/3);Y9.full=this._canvas.width,Y9.left=$,Y9.center=J,Y9.right=$,this._refreshDrawHeightConstants(),Y7.full=1,Y7.left=1,Y7.center=1+Y9.left,Y7.right=1+Y9.left+Y9.center}_refreshDrawHeightConstants(){_8.full=Math.round(2*this._coreBrowserService.dpr);let $=this._canvas.height/this._bufferService.buffer.lines.length,J=Math.round(Math.max(Math.min($,12),6)*this._coreBrowserService.dpr);_8.left=J,_8.center=J,_8.right=J}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_8.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_8.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_8.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*_8.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let J of this._decorationService.decorations)this._colorZoneStore.addDecoration(J);this._ctx.lineWidth=1,this._renderRulerOutline();let $=this._colorZoneStore.zones;for(let J of $)J.position!=="full"&&this._renderColorZone(J);for(let J of $)J.position==="full"&&this._renderColorZone(J);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderRulerOutline(){this._ctx.fillStyle=this._themeService.colors.overviewRulerBorder.css,this._ctx.fillRect(0,0,1,this._canvas.height),this._optionsService.rawOptions.overviewRuler.showTopBorder&&this._ctx.fillRect(1,0,this._canvas.width-1,1),this._optionsService.rawOptions.overviewRuler.showBottomBorder&&this._ctx.fillRect(1,this._canvas.height-1,this._canvas.width-1,this._canvas.height)}_renderColorZone($){this._ctx.fillStyle=$.color,this._ctx.fillRect(Y7[$.position||"full"],Math.round((this._canvas.height-1)*($.startBufferLine/this._bufferService.buffers.active.lines.length)-_8[$.position||"full"]/2),Y9[$.position||"full"],Math.round((this._canvas.height-1)*(($.endBufferLine-$.startBufferLine)/this._bufferService.buffers.active.lines.length)+_8[$.position||"full"]))}_queueRefresh($,J){this._shouldUpdateDimensions=$||this._shouldUpdateDimensions,this._shouldUpdateAnchor=J||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};U6=U0([k(2,i0),k(3,x7),k(4,l8),k(5,r0),k(6,k9),k(7,c8)],U6);var D;(($)=>($.NUL="\x00",$.SOH="\x01",$.STX="\x02",$.ETX="\x03",$.EOT="\x04",$.ENQ="\x05",$.ACK="\x06",$.BEL="\x07",$.BS="\b",$.HT="\t",$.LF=`
`,$.VT="\v",$.FF="\f",$.CR="\r",$.SO="\x0E",$.SI="\x0F",$.DLE="\x10",$.DC1="\x11",$.DC2="\x12",$.DC3="\x13",$.DC4="\x14",$.NAK="\x15",$.SYN="\x16",$.ETB="\x17",$.CAN="\x18",$.EM="\x19",$.SUB="\x1A",$.ESC="\x1B",$.FS="\x1C",$.GS="\x1D",$.RS="\x1E",$.US="\x1F",$.SP=" ",$.DEL=""))(D||={});var z6;(($)=>($.PAD="",$.HOP="",$.BPH="",$.NBH="",$.IND="",$.NEL="",$.SSA="",$.ESA="",$.HTS="",$.HTJ="",$.VTS="",$.PLD="",$.PLU="",$.RI="",$.SS2="",$.SS3="",$.DCS="",$.PU1="",$.PU2="",$.STS="",$.CCH="",$.MW="",$.SPA="",$.EPA="",$.SOS="",$.SGCI="",$.SCI="",$.CSI="",$.ST="",$.OSC="",$.PM="",$.APC=""))(z6||={});var h4;(($)=>$.ST=`${D.ESC}\\`)(h4||={});var V5=class{constructor($,J,Y,Z,j,K){this._textarea=$,this._compositionView=J,this._bufferService=Y,this._optionsService=Z,this._coreService=j,this._renderService=K,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}get isComposing(){return this._isComposing}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate($){this._compositionView.textContent=$.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown($){if(this._isComposing||this._isSendingComposition){if($.keyCode===20||$.keyCode===229||$.keyCode===16||$.keyCode===17||$.keyCode===18)return!1;this._finalizeComposition(!1)}return $.keyCode===229?(this._handleAnyTextareaChanges(),!1):!0}_finalizeComposition($){if(this._compositionView.classList.remove("active"),this._isComposing=!1,$){let J={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){this._isSendingComposition=!1;let Y;J.start+=this._dataAlreadySent.length,this._isComposing?Y=this._textarea.value.substring(J.start,this._compositionPosition.start):Y=this._textarea.value.substring(J.start),Y.length>0&&this._coreService.triggerDataEvent(Y,!0)}},0)}else{this._isSendingComposition=!1;let J=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(J,!0)}}_handleAnyTextareaChanges(){let $=this._textarea.value;setTimeout(()=>{if(!this._isComposing){let J=this._textarea.value,Y=J.replace($,"");this._dataAlreadySent=Y,J.length>$.length?this._coreService.triggerDataEvent(Y,!0):J.length<$.length?this._coreService.triggerDataEvent(`${D.DEL}`,!0):J.length===$.length&&J!==$&&this._coreService.triggerDataEvent(J,!0)}},0)}updateCompositionElements($){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let J=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),Y=this._renderService.dimensions.css.cell.height,Z=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,j=J*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=j+"px",this._compositionView.style.top=Z+"px",this._compositionView.style.height=Y+"px",this._compositionView.style.lineHeight=Y+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let K=this._compositionView.getBoundingClientRect();this._textarea.style.left=j+"px",this._textarea.style.top=Z+"px",this._textarea.style.width=Math.max(K.width,1)+"px",this._textarea.style.height=Math.max(K.height,1)+"px",this._textarea.style.lineHeight=K.height+"px"}$||setTimeout(()=>this.updateCompositionElements(!0),0)}}};V5=U0([k(2,i0),k(3,r0),k(4,R9),k(5,l8)],V5);var L0=0,E0=0,P0=0,H0=0,h$={css:"#00000000",rgba:0},b0;(($)=>{function J(j,K,Q,X){return X!==void 0?`#${B9(j)}${B9(K)}${B9(Q)}${B9(X)}`:`#${B9(j)}${B9(K)}${B9(Q)}`}$.toCss=J;function Y(j,K,Q,X=255){return(j<<24|K<<16|Q<<8|X)>>>0}$.toRgba=Y;function Z(j,K,Q,X){return{css:$.toCss(j,K,Q,X),rgba:$.toRgba(j,K,Q,X)}}$.toColor=Z})(b0||={});var Q0;(($)=>{function J(V,z){if(H0=(z.rgba&255)/255,H0===1)return{css:z.css,rgba:z.rgba};let G=z.rgba>>24&255,W=z.rgba>>16&255,q=z.rgba>>8&255,H=V.rgba>>24&255,U=V.rgba>>16&255,O=V.rgba>>8&255;L0=H+Math.round((G-H)*H0),E0=U+Math.round((W-U)*H0),P0=O+Math.round((q-O)*H0);let M=b0.toCss(L0,E0,P0),A=b0.toRgba(L0,E0,P0);return{css:M,rgba:A}}$.blend=J;function Y(V){return(V.rgba&255)===255}$.isOpaque=Y;function Z(V,z,G){let W=V6.ensureContrastRatio(V.rgba,z.rgba,G);if(W)return b0.toColor(W>>24&255,W>>16&255,W>>8&255)}$.ensureContrastRatio=Z;function j(V){let z=(V.rgba|255)>>>0;return[L0,E0,P0]=V6.toChannels(z),{css:b0.toCss(L0,E0,P0),rgba:z}}$.opaque=j;function K(V,z){return H0=Math.round(z*255),[L0,E0,P0]=V6.toChannels(V.rgba),{css:b0.toCss(L0,E0,P0,H0),rgba:b0.toRgba(L0,E0,P0,H0)}}$.opacity=K;function Q(V,z){return H0=V.rgba&255,K(V,H0*z/255)}$.multiplyOpacity=Q;function X(V){return[V.rgba>>24&255,V.rgba>>16&255,V.rgba>>8&255]}$.toColorRGB=X})(Q0||={});var q0;(($)=>{let J,Y;try{let j=document.createElement("canvas");j.width=1,j.height=1;let K=j.getContext("2d",{willReadFrequently:!0});K&&(J=K,J.globalCompositeOperation="copy",Y=J.createLinearGradient(0,0,1,1))}catch{}function Z(j){if(j.match(/#[\da-f]{3,8}/i))switch(j.length){case 4:return L0=parseInt(j.slice(1,2).repeat(2),16),E0=parseInt(j.slice(2,3).repeat(2),16),P0=parseInt(j.slice(3,4).repeat(2),16),b0.toColor(L0,E0,P0);case 5:return L0=parseInt(j.slice(1,2).repeat(2),16),E0=parseInt(j.slice(2,3).repeat(2),16),P0=parseInt(j.slice(3,4).repeat(2),16),H0=parseInt(j.slice(4,5).repeat(2),16),b0.toColor(L0,E0,P0,H0);case 7:return{css:j,rgba:(parseInt(j.slice(1),16)<<8|255)>>>0};case 9:return{css:j,rgba:parseInt(j.slice(1),16)>>>0}}let K=j.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(K)return L0=parseInt(K[1]),E0=parseInt(K[2]),P0=parseInt(K[3]),H0=Math.round((K[5]===void 0?1:parseFloat(K[5]))*255),b0.toColor(L0,E0,P0,H0);if(!J||!Y)throw Error("css.toColor: Unsupported css format");if(J.fillStyle=Y,J.fillStyle=j,typeof J.fillStyle!="string")throw Error("css.toColor: Unsupported css format");if(J.fillRect(0,0,1,1),[L0,E0,P0,H0]=J.getImageData(0,0,1,1).data,H0!==255)throw Error("css.toColor: Unsupported css format");return{rgba:b0.toRgba(L0,E0,P0,H0),css:j}}$.toColor=Z})(q0||={});var n0;(($)=>{function J(Z){return Y(Z>>16&255,Z>>8&255,Z&255)}$.relativeLuminance=J;function Y(Z,j,K){let Q=Z/255,X=j/255,V=K/255,z=Q<=0.03928?Q/12.92:Math.pow((Q+0.055)/1.055,2.4),G=X<=0.03928?X/12.92:Math.pow((X+0.055)/1.055,2.4),W=V<=0.03928?V/12.92:Math.pow((V+0.055)/1.055,2.4);return z*0.2126+G*0.7152+W*0.0722}$.relativeLuminance2=Y})(n0||={});var V6;(($)=>{function J(Q,X){if(H0=(X&255)/255,H0===1)return X;let V=X>>24&255,z=X>>16&255,G=X>>8&255,W=Q>>24&255,q=Q>>16&255,H=Q>>8&255;return L0=W+Math.round((V-W)*H0),E0=q+Math.round((z-q)*H0),P0=H+Math.round((G-H)*H0),b0.toRgba(L0,E0,P0)}$.blend=J;function Y(Q,X,V){let z=n0.relativeLuminance(Q>>8),G=n0.relativeLuminance(X>>8);if(h8(z,G)<V){if(G<z){let H=Z(Q,X,V),U=h8(z,n0.relativeLuminance(H>>8));if(U<V){let O=j(Q,X,V),M=h8(z,n0.relativeLuminance(O>>8));return U>M?H:O}return H}let W=j(Q,X,V),q=h8(z,n0.relativeLuminance(W>>8));if(q<V){let H=Z(Q,X,V),U=h8(z,n0.relativeLuminance(H>>8));return q>U?W:H}return W}}$.ensureContrastRatio=Y;function Z(Q,X,V){let z=Q>>24&255,G=Q>>16&255,W=Q>>8&255,q=X>>24&255,H=X>>16&255,U=X>>8&255,O=h8(n0.relativeLuminance2(q,H,U),n0.relativeLuminance2(z,G,W));for(;O<V&&(q>0||H>0||U>0);)q-=Math.max(0,Math.ceil(q*0.1)),H-=Math.max(0,Math.ceil(H*0.1)),U-=Math.max(0,Math.ceil(U*0.1)),O=h8(n0.relativeLuminance2(q,H,U),n0.relativeLuminance2(z,G,W));return(q<<24|H<<16|U<<8|255)>>>0}$.reduceLuminance=Z;function j(Q,X,V){let z=Q>>24&255,G=Q>>16&255,W=Q>>8&255,q=X>>24&255,H=X>>16&255,U=X>>8&255,O=h8(n0.relativeLuminance2(q,H,U),n0.relativeLuminance2(z,G,W));for(;O<V&&(q<255||H<255||U<255);)q=Math.min(255,q+Math.ceil((255-q)*0.1)),H=Math.min(255,H+Math.ceil((255-H)*0.1)),U=Math.min(255,U+Math.ceil((255-U)*0.1)),O=h8(n0.relativeLuminance2(q,H,U),n0.relativeLuminance2(z,G,W));return(q<<24|H<<16|U<<8|255)>>>0}$.increaseLuminance=j;function K(Q){return[Q>>24&255,Q>>16&255,Q>>8&255,Q&255]}$.toChannels=K})(V6||={});function B9($){let J=$.toString(16);return J.length<2?"0"+J:J}function h8($,J){return $<J?(J+0.05)/($+0.05):($+0.05)/(J+0.05)}var tK=class extends N7{constructor($,J,Y){super();this.content=0,this.combinedData="",this.fg=$.fg,this.bg=$.bg,this.combinedData=J,this._width=Y}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData($){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},I6=class{constructor($){this._bufferService=$,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new I8}register($){let J={id:this._nextCharacterJoinerId++,handler:$};return this._characterJoiners.push(J),J.id}deregister($){for(let J=0;J<this._characterJoiners.length;J++)if(this._characterJoiners[J].id===$)return this._characterJoiners.splice(J,1),!0;return!1}getJoinedCharacters($){if(this._characterJoiners.length===0)return[];let J=this._bufferService.buffer.lines.get($);if(!J||J.length===0)return[];let Y=[],Z=J.translateToString(!0),j=0,K=0,Q=0,X=J.getFg(0),V=J.getBg(0);for(let z=0;z<J.getTrimmedLength();z++)if(J.loadCell(z,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==X||this._workCell.bg!==V){if(z-j>1){let G=this._getJoinedRanges(Z,Q,K,J,j);for(let W=0;W<G.length;W++)Y.push(G[W])}j=z,Q=K,X=this._workCell.fg,V=this._workCell.bg}K+=this._workCell.getChars().length||K9.length}if(this._bufferService.cols-j>1){let z=this._getJoinedRanges(Z,Q,K,J,j);for(let G=0;G<z.length;G++)Y.push(z[G])}return Y}_getJoinedRanges($,J,Y,Z,j){let K=$.substring(J,Y),Q=[];try{Q=this._characterJoiners[0].handler(K)}catch(X){console.error(X)}for(let X=1;X<this._characterJoiners.length;X++)try{let V=this._characterJoiners[X].handler(K);for(let z=0;z<V.length;z++)I6._mergeRanges(Q,V[z])}catch(V){console.error(V)}return this._stringRangesToCellRanges(Q,Z,j),Q}_stringRangesToCellRanges($,J,Y){let Z=0,j=!1,K=0,Q=$[Z];if(Q){for(let X=Y;X<this._bufferService.cols;X++){let V=J.getWidth(X),z=J.getString(X).length||K9.length;if(V!==0){if(!j&&Q[0]<=K&&(Q[0]=X,j=!0),Q[1]<=K){if(Q[1]=X,Q=$[++Z],!Q)break;Q[0]<=K?(Q[0]=X,j=!0):j=!1}K+=z}}Q&&(Q[1]=this._bufferService.cols)}}static _mergeRanges($,J){let Y=!1;for(let Z=0;Z<$.length;Z++){let j=$[Z];if(Y){if(J[1]<=j[0])return $[Z-1][1]=J[1],$;if(J[1]<=j[1])return $[Z-1][1]=Math.max(J[1],j[1]),$.splice(Z,1),$;$.splice(Z,1),Z--}else{if(J[1]<=j[0])return $.splice(Z,0,J),$;if(J[1]<=j[1])return j[0]=Math.min(J[0],j[0]),$;J[0]<j[1]&&(j[0]=Math.min(J[0],j[0]),Y=!0);continue}}return Y?$[$.length-1][1]=J[1]:$.push(J),$}};I6=U0([k(0,i0)],I6);function eK($){return 57508<=$&&$<=57558}function $Q($){return 9472<=$&&$<=9631}function JQ($){return eK($)||$Q($)}function YQ(){return{css:{canvas:t7(),cell:t7()},device:{canvas:t7(),cell:t7(),char:{width:0,height:0,left:0,top:0}}}}function t7(){return{width:0,height:0}}var G5=class{constructor($,J,Y,Z,j,K,Q){this._document=$,this._characterJoinerService=J,this._optionsService=Y,this._coreBrowserService=Z,this._coreService=j,this._decorationService=K,this._themeService=Q,this._workCell=new I8,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged($,J,Y){this._selectionStart=$,this._selectionEnd=J,this._columnSelectMode=Y}createRow($,J,Y,Z,j,K,Q,X,V,z,G){let W=[],q=this._characterJoinerService.getJoinedCharacters(J),H=this._themeService.colors,U=$.getNoBgTrimmedLength();Y&&U<K+1&&(U=K+1);let O,M=0,A="",m=0,E=0,b=0,P=0,f=!1,u=0,$0=!1,G0=0,m0=0,S=[],u0=z!==-1&&G!==-1;for(let B=0;B<U;B++){$.loadCell(B,this._workCell);let v=this._workCell.getWidth();if(v===0)continue;let R=!1,N=B>=m0,x=B,F=this._workCell;if(q.length>0&&B===q[0][0]&&N){let l=q.shift(),j8=this._isCellInSelection(l[0],J);for(m=l[0]+1;m<l[1];m++)N&&=j8===this._isCellInSelection(m,J);N&&=!Y||K<l[0]||K>=l[1],N?(R=!0,F=new tK(this._workCell,$.translateToString(!0,l[0],l[1]),l[1]-l[0]),x=l[1]-1,v=F.getWidth()):m0=l[1]}let _=this._isCellInSelection(B,J),y=Y&&B===K,T=u0&&B>=z&&B<=G,r=!1;this._decorationService.forEachDecorationAtCell(B,J,void 0,(l)=>{r=!0});let h=F.getChars()||K9;if(h===" "&&(F.isUnderline()||F.isOverline())&&(h=" "),G0=v*X-V.get(h,F.isBold(),F.isItalic()),!O)O=this._document.createElement("span");else if(M&&(_&&$0||!_&&!$0&&F.bg===E)&&(_&&$0&&H.selectionForeground||F.fg===b)&&F.extended.ext===P&&T===f&&G0===u&&!y&&!R&&!r&&N){F.isInvisible()?A+=K9:A+=h,M++;continue}else M&&(O.textContent=A),O=this._document.createElement("span"),M=0,A="";if(E=F.bg,b=F.fg,P=F.extended.ext,f=T,u=G0,$0=_,R&&K>=B&&K<=x&&(K=B),!this._coreService.isCursorHidden&&y&&this._coreService.isCursorInitialized){if(S.push("xterm-cursor"),this._coreBrowserService.isFocused)Q&&S.push("xterm-cursor-blink"),S.push(Z==="bar"?"xterm-cursor-bar":Z==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(j)switch(j){case"outline":S.push("xterm-cursor-outline");break;case"block":S.push("xterm-cursor-block");break;case"bar":S.push("xterm-cursor-bar");break;case"underline":S.push("xterm-cursor-underline");break;default:break}}if(F.isBold()&&S.push("xterm-bold"),F.isItalic()&&S.push("xterm-italic"),F.isDim()&&S.push("xterm-dim"),F.isInvisible()?A=K9:A=F.getChars()||K9,F.isUnderline()&&(S.push(`xterm-underline-${F.extended.underlineStyle}`),A===" "&&(A=" "),!F.isUnderlineColorDefault()))if(F.isUnderlineColorRGB())O.style.textDecorationColor=`rgb(${N7.toColorRGB(F.getUnderlineColor()).join(",")})`;else{let l=F.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&F.isBold()&&l<8&&(l+=8),O.style.textDecorationColor=H.ansi[l].css}F.isOverline()&&(S.push("xterm-overline"),A===" "&&(A=" ")),F.isStrikethrough()&&S.push("xterm-strikethrough"),T&&(O.style.textDecoration="underline");let i=F.getFgColor(),c=F.getFgColorMode(),n=F.getBgColor(),Z0=F.getBgColorMode(),o=!!F.isInverse();if(o){let l=i;i=n,n=l;let j8=c;c=Z0,Z0=j8}let j0,W8,Z8=!1;this._decorationService.forEachDecorationAtCell(B,J,void 0,(l)=>{l.options.layer!=="top"&&Z8||(l.backgroundColorRGB&&(Z0=50331648,n=l.backgroundColorRGB.rgba>>8&16777215,j0=l.backgroundColorRGB),l.foregroundColorRGB&&(c=50331648,i=l.foregroundColorRGB.rgba>>8&16777215,W8=l.foregroundColorRGB),Z8=l.options.layer==="top")}),!Z8&&_&&(j0=this._coreBrowserService.isFocused?H.selectionBackgroundOpaque:H.selectionInactiveBackgroundOpaque,n=j0.rgba>>8&16777215,Z0=50331648,Z8=!0,H.selectionForeground&&(c=50331648,i=H.selectionForeground.rgba>>8&16777215,W8=H.selectionForeground)),Z8&&S.push("xterm-decoration-top");let d0;switch(Z0){case 16777216:case 33554432:d0=H.ansi[n],S.push(`xterm-bg-${n}`);break;case 50331648:d0=b0.toColor(n>>16,n>>8&255,n&255),this._addStyle(O,`background-color:#${p$((n>>>0).toString(16),"0",6)}`);break;case 0:default:o?(d0=H.foreground,S.push("xterm-bg-257")):d0=H.background}switch(j0||F.isDim()&&(j0=Q0.multiplyOpacity(d0,0.5)),c){case 16777216:case 33554432:F.isBold()&&i<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(i+=8),this._applyMinimumContrast(O,d0,H.ansi[i],F,j0,void 0)||S.push(`xterm-fg-${i}`);break;case 50331648:let l=b0.toColor(i>>16&255,i>>8&255,i&255);this._applyMinimumContrast(O,d0,l,F,j0,W8)||this._addStyle(O,`color:#${p$(i.toString(16),"0",6)}`);break;case 0:default:this._applyMinimumContrast(O,d0,H.foreground,F,j0,W8)||o&&S.push("xterm-fg-257")}S.length&&(O.className=S.join(" "),S.length=0),!y&&!R&&!r&&N?M++:O.textContent=A,G0!==this.defaultSpacing&&(O.style.letterSpacing=`${G0}px`),W.push(O),B=x}return O&&M&&(O.textContent=A),W}_applyMinimumContrast($,J,Y,Z,j,K){if(this._optionsService.rawOptions.minimumContrastRatio===1||JQ(Z.getCode()))return!1;let Q=this._getContrastCache(Z),X;if(!j&&!K&&(X=Q.getColor(J.rgba,Y.rgba)),X===void 0){let V=this._optionsService.rawOptions.minimumContrastRatio/(Z.isDim()?2:1);X=Q0.ensureContrastRatio(j||J,K||Y,V),Q.setColor((j||J).rgba,(K||Y).rgba,X??null)}return X?(this._addStyle($,`color:${X.css}`),!0):!1}_getContrastCache($){return $.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle($,J){$.setAttribute("style",`${$.getAttribute("style")||""}${J};`)}_isCellInSelection($,J){let Y=this._selectionStart,Z=this._selectionEnd;return!Y||!Z?!1:this._columnSelectMode?Y[0]<=Z[0]?$>=Y[0]&&J>=Y[1]&&$<Z[0]&&J<=Z[1]:$<Y[0]&&J>=Y[1]&&$>=Z[0]&&J<=Z[1]:J>Y[1]&&J<Z[1]||Y[1]===Z[1]&&J===Y[1]&&$>=Y[0]&&$<Z[0]||Y[1]<Z[1]&&J===Z[1]&&$<Z[0]||Y[1]<Z[1]&&J===Y[1]&&$>=Y[0]}};G5=U0([k(1,b4),k(2,r0),k(3,c8),k(4,R9),k(5,x7),k(6,k9)],G5);function p$($,J,Y){for(;$.length<Y;)$=J+$;return $}var ZQ=class{constructor($,J){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=$.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let Y=$.createElement("span");Y.classList.add("xterm-char-measure-element");let Z=$.createElement("span");Z.classList.add("xterm-char-measure-element"),Z.style.fontWeight="bold";let j=$.createElement("span");j.classList.add("xterm-char-measure-element"),j.style.fontStyle="italic";let K=$.createElement("span");K.classList.add("xterm-char-measure-element"),K.style.fontWeight="bold",K.style.fontStyle="italic",this._measureElements=[Y,Z,j,K],this._container.appendChild(Y),this._container.appendChild(Z),this._container.appendChild(j),this._container.appendChild(K),J.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont($,J,Y,Z){$===this._font&&J===this._fontSize&&Y===this._weight&&Z===this._weightBold||(this._font=$,this._fontSize=J,this._weight=Y,this._weightBold=Z,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${Y}`,this._measureElements[1].style.fontWeight=`${Z}`,this._measureElements[2].style.fontWeight=`${Y}`,this._measureElements[3].style.fontWeight=`${Z}`,this.clear())}get($,J,Y){let Z=0;if(!J&&!Y&&$.length===1&&(Z=$.charCodeAt(0))<256){if(this._flat[Z]!==-9999)return this._flat[Z];let Q=this._measure($,0);return Q>0&&(this._flat[Z]=Q),Q}let j=$;J&&(j+="B"),Y&&(j+="I");let K=this._holey.get(j);if(K===void 0){let Q=0;J&&(Q|=1),Y&&(Q|=2),K=this._measure($,Q),K>0&&this._holey.set(j,K)}return K}_measure($,J){let Y=this._measureElements[J];return Y.textContent=$.repeat(32),Y.offsetWidth/32}},jQ=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update($,J,Y,Z=!1){if(this.selectionStart=J,this.selectionEnd=Y,!J||!Y||J[0]===Y[0]&&J[1]===Y[1]){this.clear();return}let j=$.buffers.active.ydisp,K=J[1]-j,Q=Y[1]-j,X=Math.max(K,0),V=Math.min(Q,$.rows-1);if(X>=$.rows||V<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=Z,this.viewportStartRow=K,this.viewportEndRow=Q,this.viewportCappedStartRow=X,this.viewportCappedEndRow=V,this.startCol=J[0],this.endCol=Y[0]}isCellSelected($,J,Y){return this.hasSelection?(Y-=$.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?J>=this.startCol&&Y>=this.viewportCappedStartRow&&J<this.endCol&&Y<=this.viewportCappedEndRow:J<this.startCol&&Y>=this.viewportCappedStartRow&&J>=this.endCol&&Y<=this.viewportCappedEndRow:Y>this.viewportStartRow&&Y<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&Y===this.viewportStartRow&&J>=this.startCol&&J<this.endCol||this.viewportStartRow<this.viewportEndRow&&Y===this.viewportEndRow&&J<this.endCol||this.viewportStartRow<this.viewportEndRow&&Y===this.viewportStartRow&&J>=this.startCol):!1}};function KQ(){return new jQ}var h1="xterm-dom-renderer-owner-",H8="xterm-rows",e7="xterm-fg-",u$="xterm-bg-",Z7="xterm-focus",$6="xterm-selection",QQ=1,W5=class extends d{constructor($,J,Y,Z,j,K,Q,X,V,z,G,W,q,H){super();this._terminal=$,this._document=J,this._element=Y,this._screenElement=Z,this._viewportElement=j,this._helperContainer=K,this._linkifier2=Q,this._charSizeService=V,this._optionsService=z,this._bufferService=G,this._coreService=W,this._coreBrowserService=q,this._themeService=H,this._terminalClass=QQ++,this._rowElements=[],this._selectionRenderModel=KQ(),this.onRequestRedraw=this._register(new L).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(H8),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add($6),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=YQ(),this._updateDimensions(),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._themeService.onChangeColors((U)=>this._injectCss(U))),this._injectCss(this._themeService.colors),this._rowFactory=X.createInstance(G5,document),this._element.classList.add(h1+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this._register(this._linkifier2.onShowLinkUnderline((U)=>this._handleLinkHover(U))),this._register(this._linkifier2.onHideLinkUnderline((U)=>this._handleLinkLeave(U))),this._register(X0(()=>{this._element.classList.remove(h1+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new ZQ(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let $=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*$,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*$),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/$),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/$),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let Y of this._rowElements)Y.style.width=`${this.dimensions.css.canvas.width}px`,Y.style.height=`${this.dimensions.css.cell.height}px`,Y.style.lineHeight=`${this.dimensions.css.cell.height}px`,Y.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let J=`${this._terminalSelector} .${H8} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=J,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss($){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let J=`${this._terminalSelector} .${H8} { pointer-events: none; color: ${$.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;J+=`${this._terminalSelector} .${H8} .xterm-dim { color: ${Q0.multiplyOpacity($.foreground,0.5).css};}`,J+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let Y=`blink_underline_${this._terminalClass}`,Z=`blink_bar_${this._terminalClass}`,j=`blink_block_${this._terminalClass}`;J+=`@keyframes ${Y} { 50% {  border-bottom-style: hidden; }}`,J+=`@keyframes ${Z} { 50% {  box-shadow: none; }}`,J+=`@keyframes ${j} { 0% {  background-color: ${$.cursor.css};  color: ${$.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${$.cursor.css}; }}`,J+=`${this._terminalSelector} .${H8}.${Z7} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${Y} 1s step-end infinite;}${this._terminalSelector} .${H8}.${Z7} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${Z} 1s step-end infinite;}${this._terminalSelector} .${H8}.${Z7} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${j} 1s step-end infinite;}${this._terminalSelector} .${H8} .xterm-cursor.xterm-cursor-block { background-color: ${$.cursor.css}; color: ${$.cursorAccent.css};}${this._terminalSelector} .${H8} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${$.cursor.css} !important; color: ${$.cursorAccent.css} !important;}${this._terminalSelector} .${H8} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${$.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${H8} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${$.cursor.css} inset;}${this._terminalSelector} .${H8} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${$.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,J+=`${this._terminalSelector} .${$6} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${$6} div { position: absolute; background-color: ${$.selectionBackgroundOpaque.css};}${this._terminalSelector} .${$6} div { position: absolute; background-color: ${$.selectionInactiveBackgroundOpaque.css};}`;for(let[K,Q]of $.ansi.entries())J+=`${this._terminalSelector} .${e7}${K} { color: ${Q.css}; }${this._terminalSelector} .${e7}${K}.xterm-dim { color: ${Q0.multiplyOpacity(Q,0.5).css}; }${this._terminalSelector} .${u$}${K} { background-color: ${Q.css}; }`;J+=`${this._terminalSelector} .${e7}257 { color: ${Q0.opaque($.background).css}; }${this._terminalSelector} .${e7}257.xterm-dim { color: ${Q0.multiplyOpacity(Q0.opaque($.background),0.5).css}; }${this._terminalSelector} .${u$}257 { background-color: ${$.foreground.css}; }`,this._themeStyleElement.textContent=J}_setDefaultSpacing(){let $=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${$}px`,this._rowFactory.defaultSpacing=$}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements($,J){for(let Y=this._rowElements.length;Y<=J;Y++){let Z=this._document.createElement("div");this._rowContainer.appendChild(Z),this._rowElements.push(Z)}for(;this._rowElements.length>J;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize($,J){this._refreshRowElements($,J),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(Z7),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(Z7),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged($,J,Y){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged($,J,Y),this.renderRows(0,this._bufferService.rows-1),!$||!J||(this._selectionRenderModel.update(this._terminal,$,J,Y),!this._selectionRenderModel.hasSelection))return;let Z=this._selectionRenderModel.viewportStartRow,j=this._selectionRenderModel.viewportEndRow,K=this._selectionRenderModel.viewportCappedStartRow,Q=this._selectionRenderModel.viewportCappedEndRow,X=this._document.createDocumentFragment();if(Y){let V=$[0]>J[0];X.appendChild(this._createSelectionElement(K,V?J[0]:$[0],V?$[0]:J[0],Q-K+1))}else{let V=Z===K?$[0]:0,z=K===j?J[0]:this._bufferService.cols;X.appendChild(this._createSelectionElement(K,V,z));let G=Q-K-1;if(X.appendChild(this._createSelectionElement(K+1,0,this._bufferService.cols,G)),K!==Q){let W=j===Q?J[0]:this._bufferService.cols;X.appendChild(this._createSelectionElement(Q,0,W))}}this._selectionContainer.appendChild(X)}_createSelectionElement($,J,Y,Z=1){let j=this._document.createElement("div"),K=J*this.dimensions.css.cell.width,Q=this.dimensions.css.cell.width*(Y-J);return K+Q>this.dimensions.css.canvas.width&&(Q=this.dimensions.css.canvas.width-K),j.style.height=`${Z*this.dimensions.css.cell.height}px`,j.style.top=`${$*this.dimensions.css.cell.height}px`,j.style.left=`${K}px`,j.style.width=`${Q}px`,j}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let $ of this._rowElements)$.replaceChildren()}renderRows($,J){let Y=this._bufferService.buffer,Z=Y.ybase+Y.y,j=Math.min(Y.x,this._bufferService.cols-1),K=this._coreService.decPrivateModes.cursorBlink??this._optionsService.rawOptions.cursorBlink,Q=this._coreService.decPrivateModes.cursorStyle??this._optionsService.rawOptions.cursorStyle,X=this._optionsService.rawOptions.cursorInactiveStyle;for(let V=$;V<=J;V++){let z=V+Y.ydisp,G=this._rowElements[V],W=Y.lines.get(z);if(!G||!W)break;G.replaceChildren(...this._rowFactory.createRow(W,z,z===Z,Q,X,j,K,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${h1}${this._terminalClass}`}_handleLinkHover($){this._setCellUnderline($.x1,$.x2,$.y1,$.y2,$.cols,!0)}_handleLinkLeave($){this._setCellUnderline($.x1,$.x2,$.y1,$.y2,$.cols,!1)}_setCellUnderline($,J,Y,Z,j,K){Y<0&&($=0),Z<0&&(J=0);let Q=this._bufferService.rows-1;Y=Math.max(Math.min(Y,Q),0),Z=Math.max(Math.min(Z,Q),0),j=Math.min(j,this._bufferService.cols);let X=this._bufferService.buffer,V=X.ybase+X.y,z=Math.min(X.x,j-1),G=this._optionsService.rawOptions.cursorBlink,W=this._optionsService.rawOptions.cursorStyle,q=this._optionsService.rawOptions.cursorInactiveStyle;for(let H=Y;H<=Z;++H){let U=H+X.ydisp,O=this._rowElements[H],M=X.lines.get(U);if(!O||!M)break;O.replaceChildren(...this._rowFactory.createRow(M,U,U===V,W,q,z,G,this.dimensions.css.cell.width,this._widthCache,K?H===Y?$:0:-1,K?(H===Z?J:j)-1:-1))}}};W5=U0([k(7,D5),k(8,N6),k(9,r0),k(10,i0),k(11,R9),k(12,c8),k(13,k9)],W5);var q5=class extends d{constructor($,J,Y){super();this._optionsService=Y,this.width=0,this.height=0,this._onCharSizeChange=this._register(new L),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this._register(new zQ(this._optionsService))}catch{this._measureStrategy=this._register(new XQ($,J,this._optionsService))}this._register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}get hasValidSize(){return this.width>0&&this.height>0}measure(){let $=this._measureStrategy.measure();($.width!==this.width||$.height!==this.height)&&(this.width=$.width,this.height=$.height,this._onCharSizeChange.fire())}};q5=U0([k(2,r0)],q5);var p4=class extends d{constructor(){super(...arguments);this._result={width:0,height:0}}_validateAndSet($,J){$!==void 0&&$>0&&J!==void 0&&J>0&&(this._result.width=$,this._result.height=J)}},XQ=class extends p4{constructor($,J,Y){super();this._document=$,this._parentElement=J,this._optionsService=Y,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}},zQ=class extends p4{constructor($){super();this._optionsService=$,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let J=this._ctx.measureText("W");if(!(("width"in J)&&("fontBoundingBoxAscent"in J)&&("fontBoundingBoxDescent"in J)))throw Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let $=this._ctx.measureText("W");return this._validateAndSet($.width,$.fontBoundingBoxAscent+$.fontBoundingBoxDescent),this._result}},VQ=class extends d{constructor($,J,Y){super();this._textarea=$,this._window=J,this.mainDocument=Y,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=this._register(new GQ(this._window)),this._onDprChange=this._register(new L),this.onDprChange=this._onDprChange.event,this._onWindowChange=this._register(new L),this.onWindowChange=this._onWindowChange.event,this._register(this.onWindowChange((Z)=>this._screenDprMonitor.setWindow(Z))),this._register(g0.forward(this._screenDprMonitor.onDprChange,this._onDprChange)),this._register(p(this._textarea,"focus",()=>this._isFocused=!0)),this._register(p(this._textarea,"blur",()=>this._isFocused=!1))}get window(){return this._window}set window($){this._window!==$&&(this._window=$,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}},GQ=class extends d{constructor($){super();this._parentWindow=$,this._windowResizeListener=this._register(new T9),this._onDprChange=this._register(new L),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this._register(X0(()=>this.clearListener()))}setWindow($){this._parentWindow=$,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=p(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){this._outerListener&&(this._resolutionMediaMatchList?.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){!this._resolutionMediaMatchList||!this._outerListener||(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}},WQ=class extends d{constructor(){super();this.linkProviders=[],this._register(X0(()=>this.linkProviders.length=0))}registerLinkProvider($){return this.linkProviders.push($),{dispose:()=>{let J=this.linkProviders.indexOf($);J!==-1&&this.linkProviders.splice(J,1)}}}};function A5($,J,Y){let Z=Y.getBoundingClientRect(),j=$.getComputedStyle(Y),K=parseInt(j.getPropertyValue("padding-left")),Q=parseInt(j.getPropertyValue("padding-top"));return[J.clientX-Z.left-K,J.clientY-Z.top-Q]}function qQ($,J,Y,Z,j,K,Q,X,V){if(!K)return;let z=A5($,J,Y);if(z)return z[0]=Math.ceil((z[0]+(V?Q/2:0))/Q),z[1]=Math.ceil(z[1]/X),z[0]=Math.min(Math.max(z[0],1),Z+(V?1:0)),z[1]=Math.min(Math.max(z[1],1),j),z}var H5=class{constructor($,J){this._renderService=$,this._charSizeService=J}getCoords($,J,Y,Z,j){return qQ(window,$,J,Y,Z,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,j)}getMouseReportCoords($,J){let Y=A5(window,$,J);if(this._charSizeService.hasValidSize)return Y[0]=Math.min(Math.max(Y[0],0),this._renderService.dimensions.css.canvas.width-1),Y[1]=Math.min(Math.max(Y[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(Y[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(Y[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(Y[0]),y:Math.floor(Y[1])}}};H5=U0([k(0,l8),k(1,N6)],H5);var HQ=class{constructor($,J){this._renderCallback=$,this._coreBrowserService=J,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback($){return this._refreshCallbacks.push($),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh($,J,Y){this._rowCount=Y,$=$!==void 0?$:0,J=J!==void 0?J:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,$):$,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,J):J,!this._animationFrame&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0){this._runRefreshCallbacks();return}let $=Math.max(this._rowStart,0),J=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback($,J),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let $ of this._refreshCallbacks)$(0);this._refreshCallbacks=[]}},u4={};iZ(u4,{getSafariVersion:()=>IQ,isChromeOS:()=>s4,isFirefox:()=>d4,isIpad:()=>BQ,isIphone:()=>vQ,isLegacyEdge:()=>UQ,isLinux:()=>f5,isMac:()=>B6,isNode:()=>R6,isSafari:()=>c4,isWindows:()=>l4});var R6=typeof process<"u"&&"title"in process,b7=R6?"node":navigator.userAgent,R7=R6?"node":navigator.platform,d4=b7.includes("Firefox"),UQ=b7.includes("Edge"),c4=/^((?!chrome|android).)*safari/i.test(b7);function IQ(){if(!c4)return 0;let $=b7.match(/Version\/(\d+)/);return $===null||$.length<2?0:parseInt($[1])}var B6=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(R7),BQ=R7==="iPad",vQ=R7==="iPhone",l4=["Windows","Win16","Win32","WinCE"].includes(R7),f5=R7.indexOf("Linux")>=0,s4=/\bCrOS\b/.test(b7),a4=class{constructor(){this._tasks=[],this._i=0}enqueue($){this._tasks.push($),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process($){this._idleCallback=void 0;let J=0,Y=0,Z=$.timeRemaining(),j=0;for(;this._i<this._tasks.length;){if(J=performance.now(),this._tasks[this._i]()||this._i++,J=Math.max(1,performance.now()-J),Y=Math.max(J,Y),j=$.timeRemaining(),Y*1.5>j){Z-J<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(Z-J))}ms`),this._start();return}Z=j}this.clear()}},OQ=class extends a4{_requestCallback($){return setTimeout(()=>$(this._createDeadline(16)))}_cancelCallback($){clearTimeout($)}_createDeadline($){let J=performance.now()+$;return{timeRemaining:()=>Math.max(0,J-performance.now())}}},FQ=class extends a4{_requestCallback($){return requestIdleCallback($)}_cancelCallback($){cancelIdleCallback($)}},v6=!R6&&"requestIdleCallback"in window?FQ:OQ,NQ=class{constructor(){this._queue=new v6}set($){this._queue.clear(),this._queue.enqueue($)}flush(){this._queue.flush()}},U5=class extends d{constructor($,J,Y,Z,j,K,Q,X,V){super();this._rowCount=$,this._optionsService=Y,this._charSizeService=Z,this._coreService=j,this._coreBrowserService=X,this._renderer=this._register(new T9),this._pausedResizeTask=new NQ,this._observerDisposable=this._register(new T9),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this._register(new L),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this._register(new L),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this._register(new L),this.onRender=this._onRender.event,this._onRefreshRequest=this._register(new L),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new HQ((z,G)=>this._renderRows(z,G),this._coreBrowserService),this._register(this._renderDebouncer),this._syncOutputHandler=new xQ(this._coreBrowserService,this._coreService,()=>this._fullRefresh()),this._register(X0(()=>this._syncOutputHandler.dispose())),this._register(this._coreBrowserService.onDprChange(()=>this.handleDevicePixelRatioChange())),this._register(Q.onResize(()=>this._fullRefresh())),this._register(Q.buffers.onBufferActivate(()=>this._renderer.value?.clear())),this._register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this._register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this._register(K.onDecorationRegistered(()=>this._fullRefresh())),this._register(K.onDecorationRemoved(()=>this._fullRefresh())),this._register(this._optionsService.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(Q.cols,Q.rows),this._fullRefresh()})),this._register(this._optionsService.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(Q.buffer.y,Q.buffer.y,!0))),this._register(V.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(this._coreBrowserService.window,J),this._register(this._coreBrowserService.onWindowChange((z)=>this._registerIntersectionObserver(z,J)))}get dimensions(){return this._renderer.value.dimensions}_registerIntersectionObserver($,J){if("IntersectionObserver"in $){let Y=new $.IntersectionObserver((Z)=>this._handleIntersectionChange(Z[Z.length-1]),{threshold:0});Y.observe(J),this._observerDisposable.value=X0(()=>Y.disconnect())}}_handleIntersectionChange($){this._isPaused=$.isIntersecting===void 0?$.intersectionRatio===0:!$.isIntersecting,!this._isPaused&&!this._charSizeService.hasValidSize&&this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows($,J,Y=!1){if(this._isPaused){this._needsFullRefresh=!0;return}if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows($,J);return}let Z=this._syncOutputHandler.flush();Z&&($=Math.min($,Z.start),J=Math.max(J,Z.end)),Y||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh($,J,this._rowCount)}_renderRows($,J){if(this._renderer.value){if(this._coreService.decPrivateModes.synchronizedOutput){this._syncOutputHandler.bufferRows($,J);return}$=Math.min($,this._rowCount-1),J=Math.min(J,this._rowCount-1),this._renderer.value.renderRows($,J),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:$,end:J}),this._onRender.fire({start:$,end:J}),this._isNextRenderRedrawOnly=!0}}resize($,J){this._rowCount=J,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer($){this._renderer.value=$,this._renderer.value&&(this._renderer.value.onRequestRedraw((J)=>this.refreshRows(J.start,J.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback($){return this._renderDebouncer.addRefreshCallback($)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){this._renderer.value&&(this._renderer.value.clearTextureAtlas?.(),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize($,J){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value?.handleResize($,J)):this._renderer.value.handleResize($,J),this._fullRefresh())}handleCharSizeChanged(){this._renderer.value?.handleCharSizeChanged()}handleBlur(){this._renderer.value?.handleBlur()}handleFocus(){this._renderer.value?.handleFocus()}handleSelectionChanged($,J,Y){this._selectionState.start=$,this._selectionState.end=J,this._selectionState.columnSelectMode=Y,this._renderer.value?.handleSelectionChanged($,J,Y)}handleCursorMove(){this._renderer.value?.handleCursorMove()}clear(){this._renderer.value?.clear()}};U5=U0([k(2,r0),k(3,N6),k(4,R9),k(5,x7),k(6,i0),k(7,c8),k(8,k9)],U5);var xQ=class{constructor($,J,Y){this._coreBrowserService=$,this._coreService=J,this._onTimeout=Y,this._start=0,this._end=0,this._isBuffering=!1}bufferRows($,J){this._isBuffering?(this._start=Math.min(this._start,$),this._end=Math.max(this._end,J)):(this._start=$,this._end=J,this._isBuffering=!0),this._timeout===void 0&&(this._timeout=this._coreBrowserService.window.setTimeout(()=>{this._timeout=void 0,this._coreService.decPrivateModes.synchronizedOutput=!1,this._onTimeout()},1000))}flush(){if(this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0),!this._isBuffering)return;let $={start:this._start,end:this._end};return this._isBuffering=!1,$}dispose(){this._timeout!==void 0&&(this._coreBrowserService.window.clearTimeout(this._timeout),this._timeout=void 0)}};function bQ($,J,Y,Z){let j=Y.buffer.x,K=Y.buffer.y;if(!Y.buffer.hasScrollback)return _Q(j,K,$,J,Y,Z)+D6(K,J,Y,Z)+MQ(j,K,$,J,Y,Z);let Q;if(K===J)return Q=j>$?"D":"C",O7(Math.abs(j-$),v7(Q,Z));Q=K>J?"D":"C";let X=Math.abs(K-J),V=DQ(K>J?$:j,Y)+(X-1)*Y.cols+1+RQ(K>J?j:$,Y);return O7(V,v7(Q,Z))}function RQ($,J){return $-1}function DQ($,J){return J.cols-$}function _Q($,J,Y,Z,j,K){return D6(J,Z,j,K).length===0?"":O7(n4($,J,$,J-b9(J,j),!1,j).length,v7("D",K))}function D6($,J,Y,Z){let j=$-b9($,Y),K=J-b9(J,Y),Q=Math.abs(j-K)-yQ($,J,Y);return O7(Q,v7(o4($,J),Z))}function MQ($,J,Y,Z,j,K){let Q;D6(J,Z,j,K).length>0?Q=Z-b9(Z,j):Q=J;let X=Z,V=wQ($,J,Y,Z,j,K);return O7(n4($,Q,Y,X,V==="C",j).length,v7(V,K))}function yQ($,J,Y){let Z=0,j=$-b9($,Y),K=J-b9(J,Y);for(let Q=0;Q<Math.abs(j-K);Q++){let X=o4($,J)==="A"?-1:1;Y.buffer.lines.get(j+X*Q)?.isWrapped&&Z++}return Z}function b9($,J){let Y=0,Z=J.buffer.lines.get($),j=Z?.isWrapped;for(;j&&$>=0&&$<J.rows;)Y++,Z=J.buffer.lines.get(--$),j=Z?.isWrapped;return Y}function wQ($,J,Y,Z,j,K){let Q;return D6(Y,Z,j,K).length>0?Q=Z-b9(Z,j):Q=J,$<Y&&Q<=Z||$>=Y&&Q<Z?"C":"D"}function o4($,J){return $>J?"A":"B"}function n4($,J,Y,Z,j,K){let Q=$,X=J,V="";for(;(Q!==Y||X!==Z)&&X>=0&&X<K.buffer.lines.length;)Q+=j?1:-1,j&&Q>K.cols-1?(V+=K.buffer.translateBufferLineToString(X,!1,$,Q),Q=0,$=0,X++):!j&&Q<0&&(V+=K.buffer.translateBufferLineToString(X,!1,0,$+1),Q=K.cols-1,$=Q,X--);return V+K.buffer.translateBufferLineToString(X,!1,$,Q)}function v7($,J){let Y=J?"O":"[";return D.ESC+Y+$}function O7($,J){$=Math.floor($);let Y="";for(let Z=0;Z<$;Z++)Y+=J;return Y}var LQ=class{constructor($){this._bufferService=$,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:!this.selectionEnd||!this.selectionStart?this.selectionStart:this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let $=this.selectionStart[0]+this.selectionStartLength;return $>this._bufferService.cols?$%this._bufferService.cols===0?[this._bufferService.cols,this.selectionStart[1]+Math.floor($/this._bufferService.cols)-1]:[$%this._bufferService.cols,this.selectionStart[1]+Math.floor($/this._bufferService.cols)]:[$,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let $=this.selectionStart[0]+this.selectionStartLength;return $>this._bufferService.cols?[$%this._bufferService.cols,this.selectionStart[1]+Math.floor($/this._bufferService.cols)]:[Math.max($,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let $=this.selectionStart,J=this.selectionEnd;return!$||!J?!1:$[1]>J[1]||$[1]===J[1]&&$[0]>J[0]}handleTrim($){return this.selectionStart&&(this.selectionStart[1]-=$),this.selectionEnd&&(this.selectionEnd[1]-=$),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}};function d$($,J){if($.start.y>$.end.y)throw Error(`Buffer range end (${$.end.x}, ${$.end.y}) cannot be before start (${$.start.x}, ${$.start.y})`);return J*($.end.y-$.start.y)+($.end.x-$.start.x+1)}var p1=50,EQ=15,PQ=50,AQ=500,fQ=" ",TQ=new RegExp(fQ,"g"),I5=class extends d{constructor($,J,Y,Z,j,K,Q,X,V){super();this._element=$,this._screenElement=J,this._linkifier=Y,this._bufferService=Z,this._coreService=j,this._mouseService=K,this._optionsService=Q,this._renderService=X,this._coreBrowserService=V,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new I8,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this._register(new L),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this._register(new L),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this._register(new L),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this._register(new L),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=(z)=>this._handleMouseMove(z),this._mouseUpListener=(z)=>this._handleMouseUp(z),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim((z)=>this._handleTrim(z)),this._register(this._bufferService.buffers.onBufferActivate((z)=>this._handleBufferActivate(z))),this.enable(),this._model=new LQ(this._bufferService),this._activeSelectionMode=0,this._register(X0(()=>{this._removeMouseDownListeners()})),this._register(this._bufferService.onResize((z)=>{z.rowsChanged&&this.clearSelection()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let $=this._model.finalSelectionStart,J=this._model.finalSelectionEnd;return!$||!J?!1:$[0]!==J[0]||$[1]!==J[1]}get selectionText(){let $=this._model.finalSelectionStart,J=this._model.finalSelectionEnd;if(!$||!J)return"";let Y=this._bufferService.buffer,Z=[];if(this._activeSelectionMode===3){if($[0]===J[0])return"";let j=$[0]<J[0]?$[0]:J[0],K=$[0]<J[0]?J[0]:$[0];for(let Q=$[1];Q<=J[1];Q++){let X=Y.translateBufferLineToString(Q,!0,j,K);Z.push(X)}}else{let j=$[1]===J[1]?J[0]:void 0;Z.push(Y.translateBufferLineToString($[1],!0,$[0],j));for(let K=$[1]+1;K<=J[1]-1;K++){let Q=Y.lines.get(K),X=Y.translateBufferLineToString(K,!0);Q?.isWrapped?Z[Z.length-1]+=X:Z.push(X)}if($[1]!==J[1]){let K=Y.lines.get(J[1]),Q=Y.translateBufferLineToString(J[1],!0,0,J[0]);K&&K.isWrapped?Z[Z.length-1]+=Q:Z.push(Q)}}return Z.map((j)=>j.replace(TQ," ")).join(l4?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh($){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),f5&&$&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection($){let J=this._getMouseBufferCoords($),Y=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd;return!Y||!Z||!J?!1:this._areCoordsInSelection(J,Y,Z)}isCellInSelection($,J){let Y=this._model.finalSelectionStart,Z=this._model.finalSelectionEnd;return!Y||!Z?!1:this._areCoordsInSelection([$,J],Y,Z)}_areCoordsInSelection($,J,Y){return $[1]>J[1]&&$[1]<Y[1]||J[1]===Y[1]&&$[1]===J[1]&&$[0]>=J[0]&&$[0]<Y[0]||J[1]<Y[1]&&$[1]===Y[1]&&$[0]<Y[0]||J[1]<Y[1]&&$[1]===J[1]&&$[0]>=J[0]}_selectWordAtCursor($,J){let Y=this._linkifier.currentLink?.link?.range;if(Y)return this._model.selectionStart=[Y.start.x-1,Y.start.y-1],this._model.selectionStartLength=d$(Y,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let Z=this._getMouseBufferCoords($);return Z?(this._selectWordAt(Z,J),this._model.selectionEnd=void 0,!0):!1}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines($,J){this._model.clearSelection(),$=Math.max($,0),J=Math.min(J,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,$],this._model.selectionEnd=[this._bufferService.cols,J],this.refresh(),this._onSelectionChange.fire()}_handleTrim($){this._model.handleTrim($)&&this.refresh()}_getMouseBufferCoords($){let J=this._mouseService.getCoords($,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(J)return J[0]--,J[1]--,J[1]+=this._bufferService.buffer.ydisp,J}_getMouseEventScrollAmount($){let J=A5(this._coreBrowserService.window,$,this._screenElement)[1],Y=this._renderService.dimensions.css.canvas.height;return J>=0&&J<=Y?0:(J>Y&&(J-=Y),J=Math.min(Math.max(J,-p1),p1),J/=p1,J/Math.abs(J)+Math.round(J*(EQ-1)))}shouldForceSelection($){return B6?$.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:$.shiftKey}handleMouseDown($){if(this._mouseDownTimeStamp=$.timeStamp,!($.button===2&&this.hasSelection)&&$.button===0){if(!this._enabled){if(!this.shouldForceSelection($))return;$.stopPropagation()}$.preventDefault(),this._dragScrollAmount=0,this._enabled&&$.shiftKey?this._handleIncrementalClick($):$.detail===1?this._handleSingleClick($):$.detail===2?this._handleDoubleClick($):$.detail===3&&this._handleTripleClick($),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),PQ)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick($){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords($))}_handleSingleClick($){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect($)?3:0,this._model.selectionStart=this._getMouseBufferCoords($),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let J=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);J&&J.length!==this._model.selectionStart[0]&&J.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick($){this._selectWordAtCursor($,!0)&&(this._activeSelectionMode=1)}_handleTripleClick($){let J=this._getMouseBufferCoords($);J&&(this._activeSelectionMode=2,this._selectLineAt(J[1]))}shouldColumnSelect($){return $.altKey&&!(B6&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove($){if($.stopImmediatePropagation(),!this._model.selectionStart)return;let J=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords($),!this._model.selectionEnd){this.refresh(!0);return}this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount($),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let Y=this._bufferService.buffer;if(this._model.selectionEnd[1]<Y.lines.length){let Z=Y.lines.get(this._model.selectionEnd[1]);Z&&Z.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}(!J||J[0]!==this._model.selectionEnd[0]||J[1]!==this._model.selectionEnd[1])&&this.refresh(!0)}_dragScroll(){if(!(!this._model.selectionEnd||!this._model.selectionStart)&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let $=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min($.ydisp+this._bufferService.rows,$.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=$.ydisp),this.refresh()}}_handleMouseUp($){let J=$.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&J<AQ&&$.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let Y=this._mouseService.getCoords($,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(Y&&Y[0]!==void 0&&Y[1]!==void 0){let Z=bQ(Y[0]-1,Y[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(Z,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let $=this._model.finalSelectionStart,J=this._model.finalSelectionEnd,Y=!!$&&!!J&&($[0]!==J[0]||$[1]!==J[1]);if(!Y){this._oldHasSelection&&this._fireOnSelectionChange($,J,Y);return}!$||!J||(!this._oldSelectionStart||!this._oldSelectionEnd||$[0]!==this._oldSelectionStart[0]||$[1]!==this._oldSelectionStart[1]||J[0]!==this._oldSelectionEnd[0]||J[1]!==this._oldSelectionEnd[1])&&this._fireOnSelectionChange($,J,Y)}_fireOnSelectionChange($,J,Y){this._oldSelectionStart=$,this._oldSelectionEnd=J,this._oldHasSelection=Y,this._onSelectionChange.fire()}_handleBufferActivate($){this.clearSelection(),this._trimListener.dispose(),this._trimListener=$.activeBuffer.lines.onTrim((J)=>this._handleTrim(J))}_convertViewportColToCharacterIndex($,J){let Y=J;for(let Z=0;J>=Z;Z++){let j=$.loadCell(Z,this._workCell).getChars().length;this._workCell.getWidth()===0?Y--:j>1&&J!==Z&&(Y+=j-1)}return Y}setSelection($,J,Y){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[$,J],this._model.selectionStartLength=Y,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect($){this._isClickInSelection($)||(this._selectWordAtCursor($,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt($,J,Y=!0,Z=!0){if($[0]>=this._bufferService.cols)return;let j=this._bufferService.buffer,K=j.lines.get($[1]);if(!K)return;let Q=j.translateBufferLineToString($[1],!1),X=this._convertViewportColToCharacterIndex(K,$[0]),V=X,z=$[0]-X,G=0,W=0,q=0,H=0;if(Q.charAt(X)===" "){for(;X>0&&Q.charAt(X-1)===" ";)X--;for(;V<Q.length&&Q.charAt(V+1)===" ";)V++}else{let M=$[0],A=$[0];K.getWidth(M)===0&&(G++,M--),K.getWidth(A)===2&&(W++,A++);let m=K.getString(A).length;for(m>1&&(H+=m-1,V+=m-1);M>0&&X>0&&!this._isCharWordSeparator(K.loadCell(M-1,this._workCell));){K.loadCell(M-1,this._workCell);let E=this._workCell.getChars().length;this._workCell.getWidth()===0?(G++,M--):E>1&&(q+=E-1,X-=E-1),X--,M--}for(;A<K.length&&V+1<Q.length&&!this._isCharWordSeparator(K.loadCell(A+1,this._workCell));){K.loadCell(A+1,this._workCell);let E=this._workCell.getChars().length;this._workCell.getWidth()===2?(W++,A++):E>1&&(H+=E-1,V+=E-1),V++,A++}}V++;let U=X+z-G+q,O=Math.min(this._bufferService.cols,V-X+G+W-q-H);if(!(!J&&Q.slice(X,V).trim()==="")){if(Y&&U===0&&K.getCodePoint(0)!==32){let M=j.lines.get($[1]-1);if(M&&K.isWrapped&&M.getCodePoint(this._bufferService.cols-1)!==32){let A=this._getWordAt([this._bufferService.cols-1,$[1]-1],!1,!0,!1);if(A){let m=this._bufferService.cols-A.start;U-=m,O+=m}}}if(Z&&U+O===this._bufferService.cols&&K.getCodePoint(this._bufferService.cols-1)!==32){let M=j.lines.get($[1]+1);if(M?.isWrapped&&M.getCodePoint(0)!==32){let A=this._getWordAt([0,$[1]+1],!1,!1,!0);A&&(O+=A.length)}}return{start:U,length:O}}}_selectWordAt($,J){let Y=this._getWordAt($,J);if(Y){for(;Y.start<0;)Y.start+=this._bufferService.cols,$[1]--;this._model.selectionStart=[Y.start,$[1]],this._model.selectionStartLength=Y.length}}_selectToWordAt($){let J=this._getWordAt($,!0);if(J){let Y=$[1];for(;J.start<0;)J.start+=this._bufferService.cols,Y--;if(!this._model.areSelectionValuesReversed())for(;J.start+J.length>this._bufferService.cols;)J.length-=this._bufferService.cols,Y++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?J.start:J.start+J.length,Y]}}_isCharWordSeparator($){return $.getWidth()===0?!1:this._optionsService.rawOptions.wordSeparator.indexOf($.getChars())>=0}_selectLineAt($){let J=this._bufferService.buffer.getWrappedRangeForLine($),Y={start:{x:0,y:J.first},end:{x:this._bufferService.cols-1,y:J.last}};this._model.selectionStart=[0,J.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=d$(Y,this._bufferService.cols)}};I5=U0([k(3,i0),k(4,R9),k(5,_5),k(6,r0),k(7,l8),k(8,c8)],I5);var c$=class{constructor(){this._data={}}set($,J,Y){this._data[$]||(this._data[$]={}),this._data[$][J]=Y}get($,J){return this._data[$]?this._data[$][J]:void 0}clear(){this._data={}}},l$=class{constructor(){this._color=new c$,this._css=new c$}setCss($,J,Y){this._css.set($,J,Y)}getCss($,J){return this._css.get($,J)}setColor($,J,Y){this._color.set($,J,Y)}getColor($,J){return this._color.get($,J)}clear(){this._color.clear(),this._css.clear()}},_0=Object.freeze((()=>{let $=[q0.toColor("#2e3436"),q0.toColor("#cc0000"),q0.toColor("#4e9a06"),q0.toColor("#c4a000"),q0.toColor("#3465a4"),q0.toColor("#75507b"),q0.toColor("#06989a"),q0.toColor("#d3d7cf"),q0.toColor("#555753"),q0.toColor("#ef2929"),q0.toColor("#8ae234"),q0.toColor("#fce94f"),q0.toColor("#729fcf"),q0.toColor("#ad7fa8"),q0.toColor("#34e2e2"),q0.toColor("#eeeeec")],J=[0,95,135,175,215,255];for(let Y=0;Y<216;Y++){let Z=J[Y/36%6|0],j=J[Y/6%6|0],K=J[Y%6];$.push({css:b0.toCss(Z,j,K),rgba:b0.toRgba(Z,j,K)})}for(let Y=0;Y<24;Y++){let Z=8+Y*10;$.push({css:b0.toCss(Z,Z,Z),rgba:b0.toRgba(Z,Z,Z)})}return $})()),v9=q0.toColor("#ffffff"),G7=q0.toColor("#000000"),s$=q0.toColor("#ffffff"),a$=G7,j7={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117},kQ=v9,B5=class extends d{constructor($){super();this._optionsService=$,this._contrastCache=new l$,this._halfContrastCache=new l$,this._onChangeColors=this._register(new L),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:v9,background:G7,cursor:s$,cursorAccent:a$,selectionForeground:void 0,selectionBackgroundTransparent:j7,selectionBackgroundOpaque:Q0.blend(G7,j7),selectionInactiveBackgroundTransparent:j7,selectionInactiveBackgroundOpaque:Q0.blend(G7,j7),scrollbarSliderBackground:Q0.opacity(v9,0.2),scrollbarSliderHoverBackground:Q0.opacity(v9,0.4),scrollbarSliderActiveBackground:Q0.opacity(v9,0.5),overviewRulerBorder:v9,ansi:_0.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this._register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this._register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}get colors(){return this._colors}_setTheme($={}){let J=this._colors;if(J.foreground=J0($.foreground,v9),J.background=J0($.background,G7),J.cursor=Q0.blend(J.background,J0($.cursor,s$)),J.cursorAccent=Q0.blend(J.background,J0($.cursorAccent,a$)),J.selectionBackgroundTransparent=J0($.selectionBackground,j7),J.selectionBackgroundOpaque=Q0.blend(J.background,J.selectionBackgroundTransparent),J.selectionInactiveBackgroundTransparent=J0($.selectionInactiveBackground,J.selectionBackgroundTransparent),J.selectionInactiveBackgroundOpaque=Q0.blend(J.background,J.selectionInactiveBackgroundTransparent),J.selectionForeground=$.selectionForeground?J0($.selectionForeground,h$):void 0,J.selectionForeground===h$&&(J.selectionForeground=void 0),Q0.isOpaque(J.selectionBackgroundTransparent)&&(J.selectionBackgroundTransparent=Q0.opacity(J.selectionBackgroundTransparent,0.3)),Q0.isOpaque(J.selectionInactiveBackgroundTransparent)&&(J.selectionInactiveBackgroundTransparent=Q0.opacity(J.selectionInactiveBackgroundTransparent,0.3)),J.scrollbarSliderBackground=J0($.scrollbarSliderBackground,Q0.opacity(J.foreground,0.2)),J.scrollbarSliderHoverBackground=J0($.scrollbarSliderHoverBackground,Q0.opacity(J.foreground,0.4)),J.scrollbarSliderActiveBackground=J0($.scrollbarSliderActiveBackground,Q0.opacity(J.foreground,0.5)),J.overviewRulerBorder=J0($.overviewRulerBorder,kQ),J.ansi=_0.slice(),J.ansi[0]=J0($.black,_0[0]),J.ansi[1]=J0($.red,_0[1]),J.ansi[2]=J0($.green,_0[2]),J.ansi[3]=J0($.yellow,_0[3]),J.ansi[4]=J0($.blue,_0[4]),J.ansi[5]=J0($.magenta,_0[5]),J.ansi[6]=J0($.cyan,_0[6]),J.ansi[7]=J0($.white,_0[7]),J.ansi[8]=J0($.brightBlack,_0[8]),J.ansi[9]=J0($.brightRed,_0[9]),J.ansi[10]=J0($.brightGreen,_0[10]),J.ansi[11]=J0($.brightYellow,_0[11]),J.ansi[12]=J0($.brightBlue,_0[12]),J.ansi[13]=J0($.brightMagenta,_0[13]),J.ansi[14]=J0($.brightCyan,_0[14]),J.ansi[15]=J0($.brightWhite,_0[15]),$.extendedAnsi){let Y=Math.min(J.ansi.length-16,$.extendedAnsi.length);for(let Z=0;Z<Y;Z++)J.ansi[Z+16]=J0($.extendedAnsi[Z],_0[Z+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor($){this._restoreColor($),this._onChangeColors.fire(this.colors)}_restoreColor($){if($===void 0){for(let J=0;J<this._restoreColors.ansi.length;++J)this._colors.ansi[J]=this._restoreColors.ansi[J];return}switch($){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[$]=this._restoreColors.ansi[$]}}modifyColors($){$(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};B5=U0([k(0,r0)],B5);function J0($,J){if($!==void 0)try{return q0.toColor($)}catch{}return J}var SQ=class{constructor(...$){this._entries=new Map;for(let[J,Y]of $)this.set(J,Y)}set($,J){let Y=this._entries.get($);return this._entries.set($,J),Y}forEach($){for(let[J,Y]of this._entries.entries())$(J,Y)}has($){return this._entries.has($)}get($){return this._entries.get($)}},mQ=class{constructor(){this._services=new SQ,this._services.set(D5,this)}setService($,J){this._services.set($,J)}getService($){return this._services.get($)}createInstance($,...J){let Y=Zj($).sort((K,Q)=>K.index-Q.index),Z=[];for(let K of Y){let Q=this._services.get(K.id);if(!Q)throw Error(`[createInstance] ${$.name} depends on UNKNOWN service ${K.id._id}.`);Z.push(Q)}let j=Y.length>0?Y[0].index:J.length;if(J.length!==j)throw Error(`[createInstance] First service dependency of ${$.name} at position ${j+1} conflicts with ${J.length} static arguments`);return new $(...J,...Z)}},CQ={trace:0,debug:1,info:2,warn:3,error:4,off:5},gQ="xterm.js: ",v5=class extends d{constructor($){super();this._optionsService=$,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),hQ=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=CQ[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams($){for(let J=0;J<$.length;J++)typeof $[J]=="function"&&($[J]=$[J]())}_log($,J,Y){this._evalLazyOptionalParams(Y),$.call(console,(this._optionsService.options.logger?"":gQ)+J,...Y)}trace($,...J){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,$,J)}debug($,...J){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,$,J)}info($,...J){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,$,J)}warn($,...J){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,$,J)}error($,...J){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,$,J)}};v5=U0([k(0,r0)],v5);var hQ,o$=class extends d{constructor($){super();this._maxLength=$,this.onDeleteEmitter=this._register(new L),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this._register(new L),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this._register(new L),this.onTrim=this.onTrimEmitter.event,this._array=Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength($){if(this._maxLength===$)return;let J=Array($);for(let Y=0;Y<Math.min($,this.length);Y++)J[Y]=this._array[this._getCyclicIndex(Y)];this._array=J,this._maxLength=$,this._startIndex=0}get length(){return this._length}set length($){if($>this._length)for(let J=this._length;J<$;J++)this._array[J]=void 0;this._length=$}get($){return this._array[this._getCyclicIndex($)]}set($,J){this._array[this._getCyclicIndex($)]=J}push($){this._array[this._getCyclicIndex(this._length)]=$,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice($,J,...Y){if(J){for(let Z=$;Z<this._length-J;Z++)this._array[this._getCyclicIndex(Z)]=this._array[this._getCyclicIndex(Z+J)];this._length-=J,this.onDeleteEmitter.fire({index:$,amount:J})}for(let Z=this._length-1;Z>=$;Z--)this._array[this._getCyclicIndex(Z+Y.length)]=this._array[this._getCyclicIndex(Z)];for(let Z=0;Z<Y.length;Z++)this._array[this._getCyclicIndex($+Z)]=Y[Z];if(Y.length&&this.onInsertEmitter.fire({index:$,amount:Y.length}),this._length+Y.length>this._maxLength){let Z=this._length+Y.length-this._maxLength;this._startIndex+=Z,this._length=this._maxLength,this.onTrimEmitter.fire(Z)}else this._length+=Y.length}trimStart($){$>this._length&&($=this._length),this._startIndex+=$,this._length-=$,this.onTrimEmitter.fire($)}shiftElements($,J,Y){if(!(J<=0)){if($<0||$>=this._length)throw Error("start argument out of range");if($+Y<0)throw Error("Cannot shift elements in list beyond index 0");if(Y>0){for(let j=J-1;j>=0;j--)this.set($+j+Y,this.get($+j));let Z=$+J+Y-this._length;if(Z>0)for(this._length+=Z;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let Z=0;Z<J;Z++)this.set($+Z+Y,this.get($+Z))}}_getCyclicIndex($){return(this._startIndex+$)%this._maxLength}},s=3,x0=Object.freeze(new N7),J6=0,u1=2,W7=class ${constructor(J,Y,Z=!1){this.isWrapped=Z,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(J*s);let j=Y||I8.fromCharData([0,O4,1,0]);for(let K=0;K<J;++K)this.setCell(K,j);this.length=J}get(J){let Y=this._data[J*s+0],Z=Y&2097151;return[this._data[J*s+1],Y&2097152?this._combined[J]:Z?j9(Z):"",Y>>22,Y&2097152?this._combined[J].charCodeAt(this._combined[J].length-1):Z]}set(J,Y){this._data[J*s+1]=Y[0],Y[1].length>1?(this._combined[J]=Y[1],this._data[J*s+0]=J|2097152|Y[2]<<22):this._data[J*s+0]=Y[1].charCodeAt(0)|Y[2]<<22}getWidth(J){return this._data[J*s+0]>>22}hasWidth(J){return this._data[J*s+0]&12582912}getFg(J){return this._data[J*s+1]}getBg(J){return this._data[J*s+2]}hasContent(J){return this._data[J*s+0]&4194303}getCodePoint(J){let Y=this._data[J*s+0];return Y&2097152?this._combined[J].charCodeAt(this._combined[J].length-1):Y&2097151}isCombined(J){return this._data[J*s+0]&2097152}getString(J){let Y=this._data[J*s+0];return Y&2097152?this._combined[J]:Y&2097151?j9(Y&2097151):""}isProtected(J){return this._data[J*s+2]&536870912}loadCell(J,Y){return J6=J*s,Y.content=this._data[J6+0],Y.fg=this._data[J6+1],Y.bg=this._data[J6+2],Y.content&2097152&&(Y.combinedData=this._combined[J]),Y.bg&268435456&&(Y.extended=this._extendedAttrs[J]),Y}setCell(J,Y){Y.content&2097152&&(this._combined[J]=Y.combinedData),Y.bg&268435456&&(this._extendedAttrs[J]=Y.extended),this._data[J*s+0]=Y.content,this._data[J*s+1]=Y.fg,this._data[J*s+2]=Y.bg}setCellFromCodepoint(J,Y,Z,j){j.bg&268435456&&(this._extendedAttrs[J]=j.extended),this._data[J*s+0]=Y|Z<<22,this._data[J*s+1]=j.fg,this._data[J*s+2]=j.bg}addCodepointToCell(J,Y,Z){let j=this._data[J*s+0];j&2097152?this._combined[J]+=j9(Y):j&2097151?(this._combined[J]=j9(j&2097151)+j9(Y),j&=-2097152,j|=2097152):j=Y|4194304,Z&&(j&=-12582913,j|=Z<<22),this._data[J*s+0]=j}insertCells(J,Y,Z){if(J%=this.length,J&&this.getWidth(J-1)===2&&this.setCellFromCodepoint(J-1,0,1,Z),Y<this.length-J){let j=new I8;for(let K=this.length-J-Y-1;K>=0;--K)this.setCell(J+Y+K,this.loadCell(J+K,j));for(let K=0;K<Y;++K)this.setCell(J+K,Z)}else for(let j=J;j<this.length;++j)this.setCell(j,Z);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,Z)}deleteCells(J,Y,Z){if(J%=this.length,Y<this.length-J){let j=new I8;for(let K=0;K<this.length-J-Y;++K)this.setCell(J+K,this.loadCell(J+Y+K,j));for(let K=this.length-Y;K<this.length;++K)this.setCell(K,Z)}else for(let j=J;j<this.length;++j)this.setCell(j,Z);J&&this.getWidth(J-1)===2&&this.setCellFromCodepoint(J-1,0,1,Z),this.getWidth(J)===0&&!this.hasContent(J)&&this.setCellFromCodepoint(J,0,1,Z)}replaceCells(J,Y,Z,j=!1){if(j){for(J&&this.getWidth(J-1)===2&&!this.isProtected(J-1)&&this.setCellFromCodepoint(J-1,0,1,Z),Y<this.length&&this.getWidth(Y-1)===2&&!this.isProtected(Y)&&this.setCellFromCodepoint(Y,0,1,Z);J<Y&&J<this.length;)this.isProtected(J)||this.setCell(J,Z),J++;return}for(J&&this.getWidth(J-1)===2&&this.setCellFromCodepoint(J-1,0,1,Z),Y<this.length&&this.getWidth(Y-1)===2&&this.setCellFromCodepoint(Y,0,1,Z);J<Y&&J<this.length;)this.setCell(J++,Z)}resize(J,Y){if(J===this.length)return this._data.length*4*u1<this._data.buffer.byteLength;let Z=J*s;if(J>this.length){if(this._data.buffer.byteLength>=Z*4)this._data=new Uint32Array(this._data.buffer,0,Z);else{let j=new Uint32Array(Z);j.set(this._data),this._data=j}for(let j=this.length;j<J;++j)this.setCell(j,Y)}else{this._data=this._data.subarray(0,Z);let j=Object.keys(this._combined);for(let Q=0;Q<j.length;Q++){let X=parseInt(j[Q],10);X>=J&&delete this._combined[X]}let K=Object.keys(this._extendedAttrs);for(let Q=0;Q<K.length;Q++){let X=parseInt(K[Q],10);X>=J&&delete this._extendedAttrs[X]}}return this.length=J,Z*4*u1<this._data.buffer.byteLength}cleanupMemory(){if(this._data.length*4*u1<this._data.buffer.byteLength){let J=new Uint32Array(this._data.length);return J.set(this._data),this._data=J,1}return 0}fill(J,Y=!1){if(Y){for(let Z=0;Z<this.length;++Z)this.isProtected(Z)||this.setCell(Z,J);return}this._combined={},this._extendedAttrs={};for(let Z=0;Z<this.length;++Z)this.setCell(Z,J)}copyFrom(J){this.length!==J.length?this._data=new Uint32Array(J._data):this._data.set(J._data),this.length=J.length,this._combined={};for(let Y in J._combined)this._combined[Y]=J._combined[Y];this._extendedAttrs={};for(let Y in J._extendedAttrs)this._extendedAttrs[Y]=J._extendedAttrs[Y];this.isWrapped=J.isWrapped}clone(){let J=new $(0);J._data=new Uint32Array(this._data),J.length=this.length;for(let Y in this._combined)J._combined[Y]=this._combined[Y];for(let Y in this._extendedAttrs)J._extendedAttrs[Y]=this._extendedAttrs[Y];return J.isWrapped=this.isWrapped,J}getTrimmedLength(){for(let J=this.length-1;J>=0;--J)if(this._data[J*s+0]&4194303)return J+(this._data[J*s+0]>>22);return 0}getNoBgTrimmedLength(){for(let J=this.length-1;J>=0;--J)if(this._data[J*s+0]&4194303||this._data[J*s+2]&50331648)return J+(this._data[J*s+0]>>22);return 0}copyCellsFrom(J,Y,Z,j,K){let Q=J._data;if(K)for(let V=j-1;V>=0;V--){for(let z=0;z<s;z++)this._data[(Z+V)*s+z]=Q[(Y+V)*s+z];Q[(Y+V)*s+2]&268435456&&(this._extendedAttrs[Z+V]=J._extendedAttrs[Y+V])}else for(let V=0;V<j;V++){for(let z=0;z<s;z++)this._data[(Z+V)*s+z]=Q[(Y+V)*s+z];Q[(Y+V)*s+2]&268435456&&(this._extendedAttrs[Z+V]=J._extendedAttrs[Y+V])}let X=Object.keys(J._combined);for(let V=0;V<X.length;V++){let z=parseInt(X[V],10);z>=Y&&(this._combined[z-Y+Z]=J._combined[z])}}translateToString(J,Y,Z,j){Y=Y??0,Z=Z??this.length,J&&(Z=Math.min(Z,this.getTrimmedLength())),j&&(j.length=0);let K="";for(;Y<Z;){let Q=this._data[Y*s+0],X=Q&2097151,V=Q&2097152?this._combined[Y]:X?j9(X):K9;if(K+=V,j)for(let z=0;z<V.length;++z)j.push(Y);Y+=Q>>22||1}return j&&j.push(Y),K}};function pQ($,J,Y,Z,j,K){let Q=[];for(let X=0;X<$.length-1;X++){let V=X,z=$.get(++V);if(!z.isWrapped)continue;let G=[$.get(X)];for(;V<$.length&&z.isWrapped;)G.push(z),z=$.get(++V);if(!K&&Z>=X&&Z<V){X+=G.length-1;continue}let W=0,q=F7(G,W,J),H=1,U=0;for(;H<G.length;){let M=F7(G,H,J),A=M-U,m=Y-q,E=Math.min(A,m);G[W].copyCellsFrom(G[H],U,q,E,!1),q+=E,q===Y&&(W++,q=0),U+=E,U===M&&(H++,U=0),q===0&&W!==0&&G[W-1].getWidth(Y-1)===2&&(G[W].copyCellsFrom(G[W-1],Y-1,q++,1,!1),G[W-1].setCell(Y-1,j))}G[W].replaceCells(q,Y,j);let O=0;for(let M=G.length-1;M>0&&(M>W||G[M].getTrimmedLength()===0);M--)O++;O>0&&(Q.push(X+G.length-O),Q.push(O)),X+=G.length-1}return Q}function uQ($,J){let Y=[],Z=0,j=J[Z],K=0;for(let Q=0;Q<$.length;Q++)if(j===Q){let X=J[++Z];$.onDeleteEmitter.fire({index:Q-K,amount:X}),Q+=X-1,K+=X,j=J[++Z]}else Y.push(Q);return{layout:Y,countRemoved:K}}function dQ($,J){let Y=[];for(let Z=0;Z<J.length;Z++)Y.push($.get(J[Z]));for(let Z=0;Z<Y.length;Z++)$.set(Z,Y[Z]);$.length=J.length}function cQ($,J,Y){let Z=[],j=$.map((V,z)=>F7($,z,J)).reduce((V,z)=>V+z),K=0,Q=0,X=0;for(;X<j;){if(j-X<Y){Z.push(j-X);break}K+=Y;let V=F7($,Q,J);K>V&&(K-=V,Q++);let z=$[Q].getWidth(K-1)===2;z&&K--;let G=z?Y-1:Y;Z.push(G),X+=G}return Z}function F7($,J,Y){if(J===$.length-1)return $[J].getTrimmedLength();let Z=!$[J].hasContent(Y-1)&&$[J].getWidth(Y-1)===1,j=$[J+1].getWidth(0)===2;return Z&&j?Y-1:Y}var i4=class ${constructor(J){this.line=J,this.isDisposed=!1,this._disposables=[],this._id=$._nextId++,this._onDispose=this.register(new L),this.onDispose=this._onDispose.event}get id(){return this._id}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),x9(this._disposables),this._disposables.length=0)}register(J){return this._disposables.push(J),J}};i4._nextId=1;var lQ=i4,y0={},O9=y0.B;y0[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"};y0.A={"#":"£"};y0.B=void 0;y0[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"};y0.C=y0[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"};y0.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"};y0.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"};y0.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"};y0.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"};y0.E=y0[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"};y0.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"};y0.H=y0[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"};y0["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"};var n$=4294967295,i$=class{constructor($,J,Y){this._hasScrollback=$,this._optionsService=J,this._bufferService=Y,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=x0.clone(),this.savedCharset=O9,this.markers=[],this._nullCell=I8.fromCharData([0,O4,1,0]),this._whitespaceCell=I8.fromCharData([0,K9,1,32]),this._isClearing=!1,this._memoryCleanupQueue=new v6,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new o$(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell($){return $?(this._nullCell.fg=$.fg,this._nullCell.bg=$.bg,this._nullCell.extended=$.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new G6),this._nullCell}getWhitespaceCell($){return $?(this._whitespaceCell.fg=$.fg,this._whitespaceCell.bg=$.bg,this._whitespaceCell.extended=$.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new G6),this._whitespaceCell}getBlankLine($,J){return new W7(this._bufferService.cols,this.getNullCell($),J)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let $=this.ybase+this.y-this.ydisp;return $>=0&&$<this._rows}_getCorrectBufferLength($){if(!this._hasScrollback)return $;let J=$+this._optionsService.rawOptions.scrollback;return J>n$?n$:J}fillViewportRows($){if(this.lines.length===0){$===void 0&&($=x0);let J=this._rows;for(;J--;)this.lines.push(this.getBlankLine($))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new o$(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize($,J){let Y=this.getNullCell(x0),Z=0,j=this._getCorrectBufferLength(J);if(j>this.lines.maxLength&&(this.lines.maxLength=j),this.lines.length>0){if(this._cols<$)for(let Q=0;Q<this.lines.length;Q++)Z+=+this.lines.get(Q).resize($,Y);let K=0;if(this._rows<J)for(let Q=this._rows;Q<J;Q++)this.lines.length<J+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new W7($,Y)):this.ybase>0&&this.lines.length<=this.ybase+this.y+K+1?(this.ybase--,K++,this.ydisp>0&&this.ydisp--):this.lines.push(new W7($,Y)));else for(let Q=this._rows;Q>J;Q--)this.lines.length>J+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(j<this.lines.maxLength){let Q=this.lines.length-j;Q>0&&(this.lines.trimStart(Q),this.ybase=Math.max(this.ybase-Q,0),this.ydisp=Math.max(this.ydisp-Q,0),this.savedY=Math.max(this.savedY-Q,0)),this.lines.maxLength=j}this.x=Math.min(this.x,$-1),this.y=Math.min(this.y,J-1),K&&(this.y+=K),this.savedX=Math.min(this.savedX,$-1),this.scrollTop=0}if(this.scrollBottom=J-1,this._isReflowEnabled&&(this._reflow($,J),this._cols>$))for(let K=0;K<this.lines.length;K++)Z+=+this.lines.get(K).resize($,Y);this._cols=$,this._rows=J,this._memoryCleanupQueue.clear(),Z>0.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let $=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,$=!1);let J=0;for(;this._memoryCleanupPosition<this.lines.length;)if(J+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),J>100)return!0;return $}get _isReflowEnabled(){let $=this._optionsService.rawOptions.windowsPty;return $&&$.buildNumber?this._hasScrollback&&$.backend==="conpty"&&$.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow($,J){this._cols!==$&&($>this._cols?this._reflowLarger($,J):this._reflowSmaller($,J))}_reflowLarger($,J){let Y=this._optionsService.rawOptions.reflowCursorLine,Z=pQ(this.lines,this._cols,$,this.ybase+this.y,this.getNullCell(x0),Y);if(Z.length>0){let j=uQ(this.lines,Z);dQ(this.lines,j.layout),this._reflowLargerAdjustViewport($,J,j.countRemoved)}}_reflowLargerAdjustViewport($,J,Y){let Z=this.getNullCell(x0),j=Y;for(;j-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<J&&this.lines.push(new W7($,Z))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-Y,0)}_reflowSmaller($,J){let Y=this._optionsService.rawOptions.reflowCursorLine,Z=this.getNullCell(x0),j=[],K=0;for(let Q=this.lines.length-1;Q>=0;Q--){let X=this.lines.get(Q);if(!X||!X.isWrapped&&X.getTrimmedLength()<=$)continue;let V=[X];for(;X.isWrapped&&Q>0;)X=this.lines.get(--Q),V.unshift(X);if(!Y){let E=this.ybase+this.y;if(E>=Q&&E<Q+V.length)continue}let z=V[V.length-1].getTrimmedLength(),G=cQ(V,this._cols,$),W=G.length-V.length,q;this.ybase===0&&this.y!==this.lines.length-1?q=Math.max(0,this.y-this.lines.maxLength+W):q=Math.max(0,this.lines.length-this.lines.maxLength+W);let H=[];for(let E=0;E<W;E++){let b=this.getBlankLine(x0,!0);H.push(b)}H.length>0&&(j.push({start:Q+V.length+K,newLines:H}),K+=H.length),V.push(...H);let U=G.length-1,O=G[U];O===0&&(U--,O=G[U]);let M=V.length-W-1,A=z;for(;M>=0;){let E=Math.min(A,O);if(V[U]===void 0)break;if(V[U].copyCellsFrom(V[M],A-E,O-E,E,!0),O-=E,O===0&&(U--,O=G[U]),A-=E,A===0){M--;let b=Math.max(M,0);A=F7(V,b,this._cols)}}for(let E=0;E<V.length;E++)G[E]<$&&V[E].setCell(G[E],Z);let m=W-q;for(;m-- >0;)this.ybase===0?this.y<J-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+K)-J&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+W,this.ybase+J-1)}if(j.length>0){let Q=[],X=[];for(let O=0;O<this.lines.length;O++)X.push(this.lines.get(O));let V=this.lines.length,z=V-1,G=0,W=j[G];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+K);let q=0;for(let O=Math.min(this.lines.maxLength-1,V+K-1);O>=0;O--)if(W&&W.start>z+q){for(let M=W.newLines.length-1;M>=0;M--)this.lines.set(O--,W.newLines[M]);O++,Q.push({index:z+1,amount:W.newLines.length}),q+=W.newLines.length,W=j[++G]}else this.lines.set(O,X[z--]);let H=0;for(let O=Q.length-1;O>=0;O--)Q[O].index+=H,this.lines.onInsertEmitter.fire(Q[O]),H+=Q[O].amount;let U=Math.max(0,V+K-this.lines.maxLength);U>0&&this.lines.onTrimEmitter.fire(U)}}translateBufferLineToString($,J,Y=0,Z){let j=this.lines.get($);return j?j.translateToString(J,Y,Z):""}getWrappedRangeForLine($){let J=$,Y=$;for(;J>0&&this.lines.get(J).isWrapped;)J--;for(;Y+1<this.lines.length&&this.lines.get(Y+1).isWrapped;)Y++;return{first:J,last:Y}}setupTabStops($){for($!=null?this.tabs[$]||($=this.prevStop($)):(this.tabs={},$=0);$<this._cols;$+=this._optionsService.rawOptions.tabStopWidth)this.tabs[$]=!0}prevStop($){for($==null&&($=this.x);!this.tabs[--$]&&$>0;);return $>=this._cols?this._cols-1:$<0?0:$}nextStop($){for($==null&&($=this.x);!this.tabs[++$]&&$<this._cols;);return $>=this._cols?this._cols-1:$<0?0:$}clearMarkers($){this._isClearing=!0;for(let J=0;J<this.markers.length;J++)this.markers[J].line===$&&(this.markers[J].dispose(),this.markers.splice(J--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let $=0;$<this.markers.length;$++)this.markers[$].dispose();this.markers.length=0,this._isClearing=!1}addMarker($){let J=new lQ($);return this.markers.push(J),J.register(this.lines.onTrim((Y)=>{J.line-=Y,J.line<0&&J.dispose()})),J.register(this.lines.onInsert((Y)=>{J.line>=Y.index&&(J.line+=Y.amount)})),J.register(this.lines.onDelete((Y)=>{J.line>=Y.index&&J.line<Y.index+Y.amount&&J.dispose(),J.line>Y.index&&(J.line-=Y.amount)})),J.register(J.onDispose(()=>this._removeMarker(J))),J}_removeMarker($){this._isClearing||this.markers.splice(this.markers.indexOf($),1)}},sQ=class extends d{constructor($,J){super();this._optionsService=$,this._bufferService=J,this._onBufferActivate=this._register(new L),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this._register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this._register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new i$(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new i$(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer($){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows($),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize($,J){this._normal.resize($,J),this._alt.resize($,J),this.setupTabStops($)}setupTabStops($){this._normal.setupTabStops($),this._alt.setupTabStops($)}},r4=2,t4=1,O5=class extends d{constructor($){super();this.isUserScrolling=!1,this._onResize=this._register(new L),this.onResize=this._onResize.event,this._onScroll=this._register(new L),this.onScroll=this._onScroll.event,this.cols=Math.max($.rawOptions.cols||0,r4),this.rows=Math.max($.rawOptions.rows||0,t4),this.buffers=this._register(new sQ($,this)),this._register(this.buffers.onBufferActivate((J)=>{this._onScroll.fire(J.activeBuffer.ydisp)}))}get buffer(){return this.buffers.active}resize($,J){let Y=this.cols!==$,Z=this.rows!==J;this.cols=$,this.rows=J,this.buffers.resize($,J),this._onResize.fire({cols:$,rows:J,colsChanged:Y,rowsChanged:Z})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll($,J=!1){let Y=this.buffer,Z;Z=this._cachedBlankLine,(!Z||Z.length!==this.cols||Z.getFg(0)!==$.fg||Z.getBg(0)!==$.bg)&&(Z=Y.getBlankLine($,J),this._cachedBlankLine=Z),Z.isWrapped=J;let j=Y.ybase+Y.scrollTop,K=Y.ybase+Y.scrollBottom;if(Y.scrollTop===0){let Q=Y.lines.isFull;K===Y.lines.length-1?Q?Y.lines.recycle().copyFrom(Z):Y.lines.push(Z.clone()):Y.lines.splice(K+1,0,Z.clone()),Q?this.isUserScrolling&&(Y.ydisp=Math.max(Y.ydisp-1,0)):(Y.ybase++,this.isUserScrolling||Y.ydisp++)}else{let Q=K-j+1;Y.lines.shiftElements(j+1,Q-1,-1),Y.lines.set(K,Z.clone())}this.isUserScrolling||(Y.ydisp=Y.ybase),this._onScroll.fire(Y.ydisp)}scrollLines($,J){let Y=this.buffer;if($<0){if(Y.ydisp===0)return;this.isUserScrolling=!0}else $+Y.ydisp>=Y.ybase&&(this.isUserScrolling=!1);let Z=Y.ydisp;Y.ydisp=Math.max(Math.min(Y.ydisp+$,Y.ybase),0),Z!==Y.ydisp&&(J||this._onScroll.fire(Y.ydisp))}};O5=U0([k(0,r0)],O5);var A9={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1000,scrollOnEraseInDisplay:!1,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},reflowCursorLine:!1,rescaleOverlappingGlyphs:!1,rightClickSelectsWord:B6,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRuler:{}},aQ=["normal","bold","100","200","300","400","500","600","700","800","900"],oQ=class extends d{constructor($){super();this._onOptionChange=this._register(new L),this.onOptionChange=this._onOptionChange.event;let J={...A9};for(let Y in $)if(Y in J)try{let Z=$[Y];J[Y]=this._sanitizeAndValidateOption(Y,Z)}catch(Z){console.error(Z)}this.rawOptions=J,this.options={...J},this._setupOptions(),this._register(X0(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange($,J){return this.onOptionChange((Y)=>{Y===$&&J(this.rawOptions[$])})}onMultipleOptionChange($,J){return this.onOptionChange((Y)=>{$.indexOf(Y)!==-1&&J()})}_setupOptions(){let $=(Y)=>{if(!(Y in A9))throw Error(`No option with key "${Y}"`);return this.rawOptions[Y]},J=(Y,Z)=>{if(!(Y in A9))throw Error(`No option with key "${Y}"`);Z=this._sanitizeAndValidateOption(Y,Z),this.rawOptions[Y]!==Z&&(this.rawOptions[Y]=Z,this._onOptionChange.fire(Y))};for(let Y in this.rawOptions){let Z={get:$.bind(this,Y),set:J.bind(this,Y)};Object.defineProperty(this.options,Y,Z)}}_sanitizeAndValidateOption($,J){switch($){case"cursorStyle":if(J||(J=A9[$]),!nQ(J))throw Error(`"${J}" is not a valid value for ${$}`);break;case"wordSeparator":J||(J=A9[$]);break;case"fontWeight":case"fontWeightBold":if(typeof J=="number"&&1<=J&&J<=1000)break;J=aQ.includes(J)?J:A9[$];break;case"cursorWidth":J=Math.floor(J);case"lineHeight":case"tabStopWidth":if(J<1)throw Error(`${$} cannot be less than 1, value: ${J}`);break;case"minimumContrastRatio":J=Math.max(1,Math.min(21,Math.round(J*10)/10));break;case"scrollback":if(J=Math.min(J,4294967295),J<0)throw Error(`${$} cannot be less than 0, value: ${J}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(J<=0)throw Error(`${$} cannot be less than or equal to 0, value: ${J}`);break;case"rows":case"cols":if(!J&&J!==0)throw Error(`${$} must be numeric, value: ${J}`);break;case"windowsPty":J=J??{};break}return J}};function nQ($){return $==="block"||$==="underline"||$==="bar"}function q7($,J=5){if(typeof $!="object")return $;let Y=Array.isArray($)?[]:{};for(let Z in $)Y[Z]=J<=1?$[Z]:$[Z]&&q7($[Z],J-1);return Y}var r$=Object.freeze({insertMode:!1}),t$=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,cursorBlink:void 0,cursorStyle:void 0,origin:!1,reverseWraparound:!1,sendFocus:!1,synchronizedOutput:!1,wraparound:!0}),F5=class extends d{constructor($,J,Y){super();this._bufferService=$,this._logService=J,this._optionsService=Y,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this._register(new L),this.onData=this._onData.event,this._onUserInput=this._register(new L),this.onUserInput=this._onUserInput.event,this._onBinary=this._register(new L),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this._register(new L),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=q7(r$),this.decPrivateModes=q7(t$)}reset(){this.modes=q7(r$),this.decPrivateModes=q7(t$)}triggerDataEvent($,J=!1){if(this._optionsService.rawOptions.disableStdin)return;let Y=this._bufferService.buffer;J&&this._optionsService.rawOptions.scrollOnUserInput&&Y.ybase!==Y.ydisp&&this._onRequestScrollToBottom.fire(),J&&this._onUserInput.fire(),this._logService.debug(`sending data "${$}"`),this._logService.trace("sending data (codes)",()=>$.split("").map((Z)=>Z.charCodeAt(0))),this._onData.fire($)}triggerBinaryEvent($){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${$}"`),this._logService.trace("sending binary (codes)",()=>$.split("").map((J)=>J.charCodeAt(0))),this._onBinary.fire($))}};F5=U0([k(0,i0),k(1,N4),k(2,r0)],F5);var e$={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:($)=>$.button===4||$.action!==1?!1:($.ctrl=!1,$.alt=!1,$.shift=!1,!0)},VT200:{events:19,restrict:($)=>$.action!==32},DRAG:{events:23,restrict:($)=>!($.action===32&&$.button===3)},ANY:{events:31,restrict:($)=>!0}};function d1($,J){let Y=($.ctrl?16:0)|($.shift?4:0)|($.alt?8:0);return $.button===4?(Y|=64,Y|=$.action):(Y|=$.button&3,$.button&4&&(Y|=64),$.button&8&&(Y|=128),$.action===32?Y|=32:$.action===0&&!J&&(Y|=3)),Y}var c1=String.fromCharCode,$4={DEFAULT:($)=>{let J=[d1($,!1)+32,$.col+32,$.row+32];return J[0]>255||J[1]>255||J[2]>255?"":`\x1B[M${c1(J[0])}${c1(J[1])}${c1(J[2])}`},SGR:($)=>{let J=$.action===0&&$.button!==4?"m":"M";return`\x1B[<${d1($,!0)};${$.col};${$.row}${J}`},SGR_PIXELS:($)=>{let J=$.action===0&&$.button!==4?"m":"M";return`\x1B[<${d1($,!0)};${$.x};${$.y}${J}`}},N5=class extends d{constructor($,J,Y){super();this._bufferService=$,this._coreService=J,this._optionsService=Y,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._wheelPartialScroll=0,this._onProtocolChange=this._register(new L),this.onProtocolChange=this._onProtocolChange.event;for(let Z of Object.keys(e$))this.addProtocol(Z,e$[Z]);for(let Z of Object.keys($4))this.addEncoding(Z,$4[Z]);this.reset()}addProtocol($,J){this._protocols[$]=J}addEncoding($,J){this._encodings[$]=J}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol($){if(!this._protocols[$])throw Error(`unknown protocol "${$}"`);this._activeProtocol=$,this._onProtocolChange.fire(this._protocols[$].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding($){if(!this._encodings[$])throw Error(`unknown encoding "${$}"`);this._activeEncoding=$}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null,this._wheelPartialScroll=0}consumeWheelEvent($,J,Y){if($.deltaY===0||$.shiftKey||J===void 0||Y===void 0)return 0;let Z=J/Y,j=this._applyScrollModifier($.deltaY,$);return $.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(j/=Z+0,Math.abs($.deltaY)<50&&(j*=0.3),this._wheelPartialScroll+=j,j=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):$.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(j*=this._bufferService.rows),j}_applyScrollModifier($,J){return J.altKey||J.ctrlKey||J.shiftKey?$*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:$*this._optionsService.rawOptions.scrollSensitivity}triggerMouseEvent($){if($.col<0||$.col>=this._bufferService.cols||$.row<0||$.row>=this._bufferService.rows||$.button===4&&$.action===32||$.button===3&&$.action!==32||$.button!==4&&($.action===2||$.action===3)||($.col++,$.row++,$.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,$,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict($))return!1;let J=this._encodings[this._activeEncoding]($);return J&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(J):this._coreService.triggerDataEvent(J,!0)),this._lastEvent=$,!0}explainEvents($){return{down:!!($&1),up:!!($&2),drag:!!($&4),move:!!($&8),wheel:!!($&16)}}_equalEvents($,J,Y){if(Y){if($.x!==J.x||$.y!==J.y)return!1}else if($.col!==J.col||$.row!==J.row)return!1;return!($.button!==J.button||$.action!==J.action||$.ctrl!==J.ctrl||$.alt!==J.alt||$.shift!==J.shift)}};N5=U0([k(0,i0),k(1,R9),k(2,r0)],N5);var l1=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],iQ=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],M0;function rQ($,J){let Y=0,Z=J.length-1,j;if($<J[0][0]||$>J[Z][1])return!1;for(;Z>=Y;)if(j=Y+Z>>1,$>J[j][1])Y=j+1;else if($<J[j][0])Z=j-1;else return!0;return!1}var tQ=class{constructor(){if(this.version="6",!M0){M0=new Uint8Array(65536),M0.fill(1),M0[0]=0,M0.fill(0,1,32),M0.fill(0,127,160),M0.fill(2,4352,4448),M0[9001]=2,M0[9002]=2,M0.fill(2,11904,42192),M0[12351]=1,M0.fill(2,44032,55204),M0.fill(2,63744,64256),M0.fill(2,65040,65050),M0.fill(2,65072,65136),M0.fill(2,65280,65377),M0.fill(2,65504,65511);for(let $=0;$<l1.length;++$)M0.fill(0,l1[$][0],l1[$][1]+1)}}wcwidth($){return $<32?0:$<127?1:$<65536?M0[$]:rQ($,iQ)?0:$>=131072&&$<=196605||$>=196608&&$<=262141?2:1}charProperties($,J){let Y=this.wcwidth($),Z=Y===0&&J!==0;if(Z){let j=F9.extractWidth(J);j===0?Z=!1:j>Y&&(Y=j)}return F9.createPropertyValue(0,Y,Z)}},F9=class ${constructor(){this._providers=Object.create(null),this._active="",this._onChange=new L,this.onChange=this._onChange.event;let J=new tQ;this.register(J),this._active=J.version,this._activeProvider=J}static extractShouldJoin(J){return(J&1)!==0}static extractWidth(J){return J>>1&3}static extractCharKind(J){return J>>3}static createPropertyValue(J,Y,Z=!1){return(J&16777215)<<3|(Y&3)<<1|(Z?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(J){if(!this._providers[J])throw Error(`unknown Unicode version "${J}"`);this._active=J,this._activeProvider=this._providers[J],this._onChange.fire(J)}register(J){this._providers[J.version]=J}wcwidth(J){return this._activeProvider.wcwidth(J)}getStringCellWidth(J){let Y=0,Z=0,j=J.length;for(let K=0;K<j;++K){let Q=J.charCodeAt(K);if(55296<=Q&&Q<=56319){if(++K>=j)return Y+this.wcwidth(Q);let z=J.charCodeAt(K);56320<=z&&z<=57343?Q=(Q-55296)*1024+z-56320+65536:Y+=this.wcwidth(z)}let X=this.charProperties(Q,Z),V=$.extractWidth(X);$.extractShouldJoin(X)&&(V-=$.extractWidth(Z)),Y+=V,Z=X}return Y}charProperties(J,Y){return this._activeProvider.charProperties(J,Y)}},eQ=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel($){this.glevel=$,this.charset=this._charsets[$]}setgCharset($,J){this._charsets[$]=J,this.glevel===$&&(this.charset=J)}};function J4($){let J=$.buffer.lines.get($.buffer.ybase+$.buffer.y-1)?.get($.cols-1),Y=$.buffer.lines.get($.buffer.ybase+$.buffer.y);Y&&J&&(Y.isWrapped=J[3]!==0&&J[3]!==32)}var K7=2147483647,$X=256,e4=class ${constructor(J=32,Y=32){if(this.maxLength=J,this.maxSubParamsLength=Y,Y>$X)throw Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(J),this.length=0,this._subParams=new Int32Array(Y),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(J),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}static fromArray(J){let Y=new $;if(!J.length)return Y;for(let Z=Array.isArray(J[0])?1:0;Z<J.length;++Z){let j=J[Z];if(Array.isArray(j))for(let K=0;K<j.length;++K)Y.addSubParam(j[K]);else Y.addParam(j)}return Y}clone(){let J=new $(this.maxLength,this.maxSubParamsLength);return J.params.set(this.params),J.length=this.length,J._subParams.set(this._subParams),J._subParamsLength=this._subParamsLength,J._subParamsIdx.set(this._subParamsIdx),J._rejectDigits=this._rejectDigits,J._rejectSubDigits=this._rejectSubDigits,J._digitIsSub=this._digitIsSub,J}toArray(){let J=[];for(let Y=0;Y<this.length;++Y){J.push(this.params[Y]);let Z=this._subParamsIdx[Y]>>8,j=this._subParamsIdx[Y]&255;j-Z>0&&J.push(Array.prototype.slice.call(this._subParams,Z,j))}return J}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(J){if(this._digitIsSub=!1,this.length>=this.maxLength){this._rejectDigits=!0;return}if(J<-1)throw Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=J>K7?K7:J}addSubParam(J){if(this._digitIsSub=!0,!!this.length){if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength){this._rejectSubDigits=!0;return}if(J<-1)throw Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=J>K7?K7:J,this._subParamsIdx[this.length-1]++}}hasSubParams(J){return(this._subParamsIdx[J]&255)-(this._subParamsIdx[J]>>8)>0}getSubParams(J){let Y=this._subParamsIdx[J]>>8,Z=this._subParamsIdx[J]&255;return Z-Y>0?this._subParams.subarray(Y,Z):null}getSubParamsAll(){let J={};for(let Y=0;Y<this.length;++Y){let Z=this._subParamsIdx[Y]>>8,j=this._subParamsIdx[Y]&255;j-Z>0&&(J[Y]=this._subParams.slice(Z,j))}return J}addDigit(J){let Y;if(this._rejectDigits||!(Y=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let Z=this._digitIsSub?this._subParams:this.params,j=Z[Y-1];Z[Y-1]=~j?Math.min(j*10+J,K7):J}},Q7=[],JX=class{constructor(){this._state=0,this._active=Q7,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler($,J){this._handlers[$]===void 0&&(this._handlers[$]=[]);let Y=this._handlers[$];return Y.push(J),{dispose:()=>{let Z=Y.indexOf(J);Z!==-1&&Y.splice(Z,1)}}}clearHandler($){this._handlers[$]&&delete this._handlers[$]}setHandlerFallback($){this._handlerFb=$}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=Q7}reset(){if(this._state===2)for(let $=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;$>=0;--$)this._active[$].end(!1);this._stack.paused=!1,this._active=Q7,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||Q7,!this._active.length)this._handlerFb(this._id,"START");else for(let $=this._active.length-1;$>=0;$--)this._active[$].start()}_put($,J,Y){if(!this._active.length)this._handlerFb(this._id,"PUT",F6($,J,Y));else for(let Z=this._active.length-1;Z>=0;Z--)this._active[Z].put($,J,Y)}start(){this.reset(),this._state=1}put($,J,Y){if(this._state!==3){if(this._state===1)for(;J<Y;){let Z=$[J++];if(Z===59){this._state=2,this._start();break}if(Z<48||57<Z){this._state=3;return}this._id===-1&&(this._id=0),this._id=this._id*10+Z-48}this._state===2&&Y-J>0&&this._put($,J,Y)}}end($,J=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),!this._active.length)this._handlerFb(this._id,"END",$);else{let Y=!1,Z=this._active.length-1,j=!1;if(this._stack.paused&&(Z=this._stack.loopPosition-1,Y=J,j=this._stack.fallThrough,this._stack.paused=!1),!j&&Y===!1){for(;Z>=0&&(Y=this._active[Z].end($),Y!==!0);Z--)if(Y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Z,this._stack.fallThrough=!1,Y;Z--}for(;Z>=0;Z--)if(Y=this._active[Z].end(!1),Y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Z,this._stack.fallThrough=!0,Y}this._active=Q7,this._id=-1,this._state=0}}},Q8=class{constructor($){this._handler=$,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put($,J,Y){this._hitLimit||(this._data+=F6($,J,Y),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}end($){let J=!1;if(this._hitLimit)J=!1;else if($&&(J=this._handler(this._data),J instanceof Promise))return J.then((Y)=>(this._data="",this._hitLimit=!1,Y));return this._data="",this._hitLimit=!1,J}},X7=[],YX=class{constructor(){this._handlers=Object.create(null),this._active=X7,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=X7}registerHandler($,J){this._handlers[$]===void 0&&(this._handlers[$]=[]);let Y=this._handlers[$];return Y.push(J),{dispose:()=>{let Z=Y.indexOf(J);Z!==-1&&Y.splice(Z,1)}}}clearHandler($){this._handlers[$]&&delete this._handlers[$]}setHandlerFallback($){this._handlerFb=$}reset(){if(this._active.length)for(let $=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;$>=0;--$)this._active[$].unhook(!1);this._stack.paused=!1,this._active=X7,this._ident=0}hook($,J){if(this.reset(),this._ident=$,this._active=this._handlers[$]||X7,!this._active.length)this._handlerFb(this._ident,"HOOK",J);else for(let Y=this._active.length-1;Y>=0;Y--)this._active[Y].hook(J)}put($,J,Y){if(!this._active.length)this._handlerFb(this._ident,"PUT",F6($,J,Y));else for(let Z=this._active.length-1;Z>=0;Z--)this._active[Z].put($,J,Y)}unhook($,J=!0){if(!this._active.length)this._handlerFb(this._ident,"UNHOOK",$);else{let Y=!1,Z=this._active.length-1,j=!1;if(this._stack.paused&&(Z=this._stack.loopPosition-1,Y=J,j=this._stack.fallThrough,this._stack.paused=!1),!j&&Y===!1){for(;Z>=0&&(Y=this._active[Z].unhook($),Y!==!0);Z--)if(Y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Z,this._stack.fallThrough=!1,Y;Z--}for(;Z>=0;Z--)if(Y=this._active[Z].unhook(!1),Y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=Z,this._stack.fallThrough=!0,Y}this._active=X7,this._ident=0}},H7=new e4;H7.addParam(0);var Y4=class{constructor($){this._handler=$,this._data="",this._params=H7,this._hitLimit=!1}hook($){this._params=$.length>1||$.params[0]?$.clone():H7,this._data="",this._hitLimit=!1}put($,J,Y){this._hitLimit||(this._data+=F6($,J,Y),this._data.length>1e7&&(this._data="",this._hitLimit=!0))}unhook($){let J=!1;if(this._hitLimit)J=!1;else if($&&(J=this._handler(this._data,this._params),J instanceof Promise))return J.then((Y)=>(this._params=H7,this._data="",this._hitLimit=!1,Y));return this._params=H7,this._data="",this._hitLimit=!1,J}},ZX=class{constructor($){this.table=new Uint8Array($)}setDefault($,J){this.table.fill($<<4|J)}add($,J,Y,Z){this.table[J<<8|$]=Y<<4|Z}addMany($,J,Y,Z){for(let j=0;j<$.length;j++)this.table[J<<8|$[j]]=Y<<4|Z}},U8=160,jX=function(){let $=new ZX(4095),J=Array.apply(null,Array(256)).map((X,V)=>V),Y=(X,V)=>J.slice(X,V),Z=Y(32,127),j=Y(0,24);j.push(25),j.push.apply(j,Y(28,32));let K=Y(0,14),Q;$.setDefault(1,0),$.addMany(Z,0,2,0);for(Q in K)$.addMany([24,26,153,154],Q,3,0),$.addMany(Y(128,144),Q,3,0),$.addMany(Y(144,152),Q,3,0),$.add(156,Q,0,0),$.add(27,Q,11,1),$.add(157,Q,4,8),$.addMany([152,158,159],Q,0,7),$.add(155,Q,11,3),$.add(144,Q,11,9);return $.addMany(j,0,3,0),$.addMany(j,1,3,1),$.add(127,1,0,1),$.addMany(j,8,0,8),$.addMany(j,3,3,3),$.add(127,3,0,3),$.addMany(j,4,3,4),$.add(127,4,0,4),$.addMany(j,6,3,6),$.addMany(j,5,3,5),$.add(127,5,0,5),$.addMany(j,2,3,2),$.add(127,2,0,2),$.add(93,1,4,8),$.addMany(Z,8,5,8),$.add(127,8,5,8),$.addMany([156,27,24,26,7],8,6,0),$.addMany(Y(28,32),8,0,8),$.addMany([88,94,95],1,0,7),$.addMany(Z,7,0,7),$.addMany(j,7,0,7),$.add(156,7,0,0),$.add(127,7,0,7),$.add(91,1,11,3),$.addMany(Y(64,127),3,7,0),$.addMany(Y(48,60),3,8,4),$.addMany([60,61,62,63],3,9,4),$.addMany(Y(48,60),4,8,4),$.addMany(Y(64,127),4,7,0),$.addMany([60,61,62,63],4,0,6),$.addMany(Y(32,64),6,0,6),$.add(127,6,0,6),$.addMany(Y(64,127),6,0,0),$.addMany(Y(32,48),3,9,5),$.addMany(Y(32,48),5,9,5),$.addMany(Y(48,64),5,0,6),$.addMany(Y(64,127),5,7,0),$.addMany(Y(32,48),4,9,5),$.addMany(Y(32,48),1,9,2),$.addMany(Y(32,48),2,9,2),$.addMany(Y(48,127),2,10,0),$.addMany(Y(48,80),1,10,0),$.addMany(Y(81,88),1,10,0),$.addMany([89,90,92],1,10,0),$.addMany(Y(96,127),1,10,0),$.add(80,1,11,9),$.addMany(j,9,0,9),$.add(127,9,0,9),$.addMany(Y(28,32),9,0,9),$.addMany(Y(32,48),9,9,12),$.addMany(Y(48,60),9,8,10),$.addMany([60,61,62,63],9,9,10),$.addMany(j,11,0,11),$.addMany(Y(32,128),11,0,11),$.addMany(Y(28,32),11,0,11),$.addMany(j,10,0,10),$.add(127,10,0,10),$.addMany(Y(28,32),10,0,10),$.addMany(Y(48,60),10,8,10),$.addMany([60,61,62,63],10,0,11),$.addMany(Y(32,48),10,9,12),$.addMany(j,12,0,12),$.add(127,12,0,12),$.addMany(Y(28,32),12,0,12),$.addMany(Y(32,48),12,9,12),$.addMany(Y(48,64),12,0,11),$.addMany(Y(64,127),12,12,13),$.addMany(Y(64,127),10,12,13),$.addMany(Y(64,127),9,12,13),$.addMany(j,13,13,13),$.addMany(Z,13,13,13),$.add(127,13,0,13),$.addMany([27,156,24,26],13,14,0),$.add(U8,0,2,0),$.add(U8,8,5,8),$.add(U8,6,0,6),$.add(U8,11,0,11),$.add(U8,13,13,13),$}(),KX=class extends d{constructor($=jX){super();this._transitions=$,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new e4,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(J,Y,Z)=>{},this._executeHandlerFb=(J)=>{},this._csiHandlerFb=(J,Y)=>{},this._escHandlerFb=(J)=>{},this._errorHandlerFb=(J)=>J,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this._register(X0(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this._register(new JX),this._dcsParser=this._register(new YX),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier($,J=[64,126]){let Y=0;if($.prefix){if($.prefix.length>1)throw Error("only one byte as prefix supported");if(Y=$.prefix.charCodeAt(0),Y&&60>Y||Y>63)throw Error("prefix must be in range 0x3c .. 0x3f")}if($.intermediates){if($.intermediates.length>2)throw Error("only two bytes as intermediates are supported");for(let j=0;j<$.intermediates.length;++j){let K=$.intermediates.charCodeAt(j);if(32>K||K>47)throw Error("intermediate must be in range 0x20 .. 0x2f");Y<<=8,Y|=K}}if($.final.length!==1)throw Error("final must be a single byte");let Z=$.final.charCodeAt(0);if(J[0]>Z||Z>J[1])throw Error(`final must be in range ${J[0]} .. ${J[1]}`);return Y<<=8,Y|=Z,Y}identToString($){let J=[];for(;$;)J.push(String.fromCharCode($&255)),$>>=8;return J.reverse().join("")}setPrintHandler($){this._printHandler=$}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler($,J){let Y=this._identifier($,[48,126]);this._escHandlers[Y]===void 0&&(this._escHandlers[Y]=[]);let Z=this._escHandlers[Y];return Z.push(J),{dispose:()=>{let j=Z.indexOf(J);j!==-1&&Z.splice(j,1)}}}clearEscHandler($){this._escHandlers[this._identifier($,[48,126])]&&delete this._escHandlers[this._identifier($,[48,126])]}setEscHandlerFallback($){this._escHandlerFb=$}setExecuteHandler($,J){this._executeHandlers[$.charCodeAt(0)]=J}clearExecuteHandler($){this._executeHandlers[$.charCodeAt(0)]&&delete this._executeHandlers[$.charCodeAt(0)]}setExecuteHandlerFallback($){this._executeHandlerFb=$}registerCsiHandler($,J){let Y=this._identifier($);this._csiHandlers[Y]===void 0&&(this._csiHandlers[Y]=[]);let Z=this._csiHandlers[Y];return Z.push(J),{dispose:()=>{let j=Z.indexOf(J);j!==-1&&Z.splice(j,1)}}}clearCsiHandler($){this._csiHandlers[this._identifier($)]&&delete this._csiHandlers[this._identifier($)]}setCsiHandlerFallback($){this._csiHandlerFb=$}registerDcsHandler($,J){return this._dcsParser.registerHandler(this._identifier($),J)}clearDcsHandler($){this._dcsParser.clearHandler(this._identifier($))}setDcsHandlerFallback($){this._dcsParser.setHandlerFallback($)}registerOscHandler($,J){return this._oscParser.registerHandler($,J)}clearOscHandler($){this._oscParser.clearHandler($)}setOscHandlerFallback($){this._oscParser.setHandlerFallback($)}setErrorHandler($){this._errorHandler=$}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack($,J,Y,Z,j){this._parseStack.state=$,this._parseStack.handlers=J,this._parseStack.handlerPos=Y,this._parseStack.transition=Z,this._parseStack.chunkPos=j}parse($,J,Y){let Z=0,j=0,K=0,Q;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,K=this._parseStack.chunkPos+1;else{if(Y===void 0||this._parseStack.state===1)throw this._parseStack.state=1,Error("improper continuation due to previous async handler, giving up parsing");let X=this._parseStack.handlers,V=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(Y===!1&&V>-1){for(;V>=0&&(Q=X[V](this._params),Q!==!0);V--)if(Q instanceof Promise)return this._parseStack.handlerPos=V,Q}this._parseStack.handlers=[];break;case 4:if(Y===!1&&V>-1){for(;V>=0&&(Q=X[V](),Q!==!0);V--)if(Q instanceof Promise)return this._parseStack.handlerPos=V,Q}this._parseStack.handlers=[];break;case 6:if(Z=$[this._parseStack.chunkPos],Q=this._dcsParser.unhook(Z!==24&&Z!==26,Y),Q)return Q;Z===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(Z=$[this._parseStack.chunkPos],Q=this._oscParser.end(Z!==24&&Z!==26,Y),Q)return Q;Z===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break}this._parseStack.state=0,K=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=this._parseStack.transition&15}for(let X=K;X<J;++X){switch(Z=$[X],j=this._transitions.table[this.currentState<<8|(Z<160?Z:U8)],j>>4){case 2:for(let q=X+1;;++q){if(q>=J||(Z=$[q])<32||Z>126&&Z<U8){this._printHandler($,X,q),X=q-1;break}if(++q>=J||(Z=$[q])<32||Z>126&&Z<U8){this._printHandler($,X,q),X=q-1;break}if(++q>=J||(Z=$[q])<32||Z>126&&Z<U8){this._printHandler($,X,q),X=q-1;break}if(++q>=J||(Z=$[q])<32||Z>126&&Z<U8){this._printHandler($,X,q),X=q-1;break}}break;case 3:this._executeHandlers[Z]?this._executeHandlers[Z]():this._executeHandlerFb(Z),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:X,code:Z,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let V=this._csiHandlers[this._collect<<8|Z],z=V?V.length-1:-1;for(;z>=0&&(Q=V[z](this._params),Q!==!0);z--)if(Q instanceof Promise)return this._preserveStack(3,V,z,j,X),Q;z<0&&this._csiHandlerFb(this._collect<<8|Z,this._params),this.precedingJoinState=0;break;case 8:do switch(Z){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(Z-48)}while(++X<J&&(Z=$[X])>47&&Z<60);X--;break;case 9:this._collect<<=8,this._collect|=Z;break;case 10:let G=this._escHandlers[this._collect<<8|Z],W=G?G.length-1:-1;for(;W>=0&&(Q=G[W](),Q!==!0);W--)if(Q instanceof Promise)return this._preserveStack(4,G,W,j,X),Q;W<0&&this._escHandlerFb(this._collect<<8|Z),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|Z,this._params);break;case 13:for(let q=X+1;;++q)if(q>=J||(Z=$[q])===24||Z===26||Z===27||Z>127&&Z<U8){this._dcsParser.put($,X,q),X=q-1;break}break;case 14:if(Q=this._dcsParser.unhook(Z!==24&&Z!==26),Q)return this._preserveStack(6,[],0,j,X),Q;Z===27&&(j|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let q=X+1;;q++)if(q>=J||(Z=$[q])<32||Z>127&&Z<U8){this._oscParser.put($,X,q),X=q-1;break}break;case 6:if(Q=this._oscParser.end(Z!==24&&Z!==26),Q)return this._preserveStack(5,[],0,j,X),Q;Z===27&&(j|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break}this.currentState=j&15}}},QX=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,XX=/^[\da-f]+$/;function Z4($){if(!$)return;let J=$.toLowerCase();if(J.indexOf("rgb:")===0){J=J.slice(4);let Y=QX.exec(J);if(Y){let Z=Y[1]?15:Y[4]?255:Y[7]?4095:65535;return[Math.round(parseInt(Y[1]||Y[4]||Y[7]||Y[10],16)/Z*255),Math.round(parseInt(Y[2]||Y[5]||Y[8]||Y[11],16)/Z*255),Math.round(parseInt(Y[3]||Y[6]||Y[9]||Y[12],16)/Z*255)]}}else if(J.indexOf("#")===0&&(J=J.slice(1),XX.exec(J)&&[3,6,9,12].includes(J.length))){let Y=J.length/3,Z=[0,0,0];for(let j=0;j<3;++j){let K=parseInt(J.slice(Y*j,Y*j+Y),16);Z[j]=Y===1?K<<4:Y===2?K:Y===3?K>>4:K>>8}return Z}}function s1($,J){let Y=$.toString(16),Z=Y.length<2?"0"+Y:Y;switch(J){case 4:return Y[0];case 8:return Z;case 12:return(Z+Z).slice(0,3);default:return Z+Z}}function zX($,J=16){let[Y,Z,j]=$;return`rgb:${s1(Y,J)}/${s1(Z,J)}/${s1(j,J)}`}var VX={"(":0,")":1,"*":2,"+":3,"-":1,".":2},Z9=131072,j4=10;function K4($,J){if($>24)return J.setWinLines||!1;switch($){case 1:return!!J.restoreWin;case 2:return!!J.minimizeWin;case 3:return!!J.setWinPosition;case 4:return!!J.setWinSizePixels;case 5:return!!J.raiseWin;case 6:return!!J.lowerWin;case 7:return!!J.refreshWin;case 8:return!!J.setWinSizeChars;case 9:return!!J.maximizeWin;case 10:return!!J.fullscreenWin;case 11:return!!J.getWinState;case 13:return!!J.getWinPosition;case 14:return!!J.getWinSizePixels;case 15:return!!J.getScreenSizePixels;case 16:return!!J.getCellSizePixels;case 18:return!!J.getWinSizeChars;case 19:return!!J.getScreenSizeChars;case 20:return!!J.getIconTitle;case 21:return!!J.getWinTitle;case 22:return!!J.pushTitle;case 23:return!!J.popTitle;case 24:return!!J.setWinLines}return!1}var Q4=5000,X4=0,GX=class extends d{constructor($,J,Y,Z,j,K,Q,X,V=new KX){super();this._bufferService=$,this._charsetService=J,this._coreService=Y,this._logService=Z,this._optionsService=j,this._oscLinkService=K,this._coreMouseService=Q,this._unicodeService=X,this._parser=V,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new Jj,this._utf8Decoder=new Yj,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=x0.clone(),this._eraseAttrDataInternal=x0.clone(),this._onRequestBell=this._register(new L),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this._register(new L),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this._register(new L),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this._register(new L),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this._register(new L),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this._register(new L),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this._register(new L),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this._register(new L),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this._register(new L),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this._register(new L),this.onLineFeed=this._onLineFeed.event,this._onScroll=this._register(new L),this.onScroll=this._onScroll.event,this._onTitleChange=this._register(new L),this.onTitleChange=this._onTitleChange.event,this._onColor=this._register(new L),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this._register(this._parser),this._dirtyRowTracker=new x5(this._bufferService),this._activeBuffer=this._bufferService.buffer,this._register(this._bufferService.buffers.onBufferActivate((z)=>this._activeBuffer=z.activeBuffer)),this._parser.setCsiHandlerFallback((z,G)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(z),params:G.toArray()})}),this._parser.setEscHandlerFallback((z)=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(z)})}),this._parser.setExecuteHandlerFallback((z)=>{this._logService.debug("Unknown EXECUTE code: ",{code:z})}),this._parser.setOscHandlerFallback((z,G,W)=>{this._logService.debug("Unknown OSC code: ",{identifier:z,action:G,data:W})}),this._parser.setDcsHandlerFallback((z,G,W)=>{G==="HOOK"&&(W=W.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(z),action:G,payload:W})}),this._parser.setPrintHandler((z,G,W)=>this.print(z,G,W)),this._parser.registerCsiHandler({final:"@"},(z)=>this.insertChars(z)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(z)=>this.scrollLeft(z)),this._parser.registerCsiHandler({final:"A"},(z)=>this.cursorUp(z)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(z)=>this.scrollRight(z)),this._parser.registerCsiHandler({final:"B"},(z)=>this.cursorDown(z)),this._parser.registerCsiHandler({final:"C"},(z)=>this.cursorForward(z)),this._parser.registerCsiHandler({final:"D"},(z)=>this.cursorBackward(z)),this._parser.registerCsiHandler({final:"E"},(z)=>this.cursorNextLine(z)),this._parser.registerCsiHandler({final:"F"},(z)=>this.cursorPrecedingLine(z)),this._parser.registerCsiHandler({final:"G"},(z)=>this.cursorCharAbsolute(z)),this._parser.registerCsiHandler({final:"H"},(z)=>this.cursorPosition(z)),this._parser.registerCsiHandler({final:"I"},(z)=>this.cursorForwardTab(z)),this._parser.registerCsiHandler({final:"J"},(z)=>this.eraseInDisplay(z,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},(z)=>this.eraseInDisplay(z,!0)),this._parser.registerCsiHandler({final:"K"},(z)=>this.eraseInLine(z,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},(z)=>this.eraseInLine(z,!0)),this._parser.registerCsiHandler({final:"L"},(z)=>this.insertLines(z)),this._parser.registerCsiHandler({final:"M"},(z)=>this.deleteLines(z)),this._parser.registerCsiHandler({final:"P"},(z)=>this.deleteChars(z)),this._parser.registerCsiHandler({final:"S"},(z)=>this.scrollUp(z)),this._parser.registerCsiHandler({final:"T"},(z)=>this.scrollDown(z)),this._parser.registerCsiHandler({final:"X"},(z)=>this.eraseChars(z)),this._parser.registerCsiHandler({final:"Z"},(z)=>this.cursorBackwardTab(z)),this._parser.registerCsiHandler({final:"`"},(z)=>this.charPosAbsolute(z)),this._parser.registerCsiHandler({final:"a"},(z)=>this.hPositionRelative(z)),this._parser.registerCsiHandler({final:"b"},(z)=>this.repeatPrecedingCharacter(z)),this._parser.registerCsiHandler({final:"c"},(z)=>this.sendDeviceAttributesPrimary(z)),this._parser.registerCsiHandler({prefix:">",final:"c"},(z)=>this.sendDeviceAttributesSecondary(z)),this._parser.registerCsiHandler({final:"d"},(z)=>this.linePosAbsolute(z)),this._parser.registerCsiHandler({final:"e"},(z)=>this.vPositionRelative(z)),this._parser.registerCsiHandler({final:"f"},(z)=>this.hVPosition(z)),this._parser.registerCsiHandler({final:"g"},(z)=>this.tabClear(z)),this._parser.registerCsiHandler({final:"h"},(z)=>this.setMode(z)),this._parser.registerCsiHandler({prefix:"?",final:"h"},(z)=>this.setModePrivate(z)),this._parser.registerCsiHandler({final:"l"},(z)=>this.resetMode(z)),this._parser.registerCsiHandler({prefix:"?",final:"l"},(z)=>this.resetModePrivate(z)),this._parser.registerCsiHandler({final:"m"},(z)=>this.charAttributes(z)),this._parser.registerCsiHandler({final:"n"},(z)=>this.deviceStatus(z)),this._parser.registerCsiHandler({prefix:"?",final:"n"},(z)=>this.deviceStatusPrivate(z)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(z)=>this.softReset(z)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(z)=>this.setCursorStyle(z)),this._parser.registerCsiHandler({final:"r"},(z)=>this.setScrollRegion(z)),this._parser.registerCsiHandler({final:"s"},(z)=>this.saveCursor(z)),this._parser.registerCsiHandler({final:"t"},(z)=>this.windowOptions(z)),this._parser.registerCsiHandler({final:"u"},(z)=>this.restoreCursor(z)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(z)=>this.insertColumns(z)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(z)=>this.deleteColumns(z)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(z)=>this.selectProtected(z)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(z)=>this.requestMode(z,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(z)=>this.requestMode(z,!1)),this._parser.setExecuteHandler(D.BEL,()=>this.bell()),this._parser.setExecuteHandler(D.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(D.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(D.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(D.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(D.BS,()=>this.backspace()),this._parser.setExecuteHandler(D.HT,()=>this.tab()),this._parser.setExecuteHandler(D.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(D.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(z6.IND,()=>this.index()),this._parser.setExecuteHandler(z6.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(z6.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new Q8((z)=>(this.setTitle(z),this.setIconName(z),!0))),this._parser.registerOscHandler(1,new Q8((z)=>this.setIconName(z))),this._parser.registerOscHandler(2,new Q8((z)=>this.setTitle(z))),this._parser.registerOscHandler(4,new Q8((z)=>this.setOrReportIndexedColor(z))),this._parser.registerOscHandler(8,new Q8((z)=>this.setHyperlink(z))),this._parser.registerOscHandler(10,new Q8((z)=>this.setOrReportFgColor(z))),this._parser.registerOscHandler(11,new Q8((z)=>this.setOrReportBgColor(z))),this._parser.registerOscHandler(12,new Q8((z)=>this.setOrReportCursorColor(z))),this._parser.registerOscHandler(104,new Q8((z)=>this.restoreIndexedColor(z))),this._parser.registerOscHandler(110,new Q8((z)=>this.restoreFgColor(z))),this._parser.registerOscHandler(111,new Q8((z)=>this.restoreBgColor(z))),this._parser.registerOscHandler(112,new Q8((z)=>this.restoreCursorColor(z))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(let z in y0)this._parser.registerEscHandler({intermediates:"(",final:z},()=>this.selectCharset("("+z)),this._parser.registerEscHandler({intermediates:")",final:z},()=>this.selectCharset(")"+z)),this._parser.registerEscHandler({intermediates:"*",final:z},()=>this.selectCharset("*"+z)),this._parser.registerEscHandler({intermediates:"+",final:z},()=>this.selectCharset("+"+z)),this._parser.registerEscHandler({intermediates:"-",final:z},()=>this.selectCharset("-"+z)),this._parser.registerEscHandler({intermediates:".",final:z},()=>this.selectCharset("."+z)),this._parser.registerEscHandler({intermediates:"/",final:z},()=>this.selectCharset("/"+z));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler((z)=>(this._logService.error("Parsing error: ",z),z)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new Y4((z,G)=>this.requestStatusString(z,G)))}getAttrData(){return this._curAttrData}_preserveStack($,J,Y,Z){this._parseStack.paused=!0,this._parseStack.cursorStartX=$,this._parseStack.cursorStartY=J,this._parseStack.decodedLength=Y,this._parseStack.position=Z}_logSlowResolvingAsync($){this._logService.logLevel<=3&&Promise.race([$,new Promise((J,Y)=>setTimeout(()=>Y("#SLOW_TIMEOUT"),Q4))]).catch((J)=>{if(J!=="#SLOW_TIMEOUT")throw J;console.warn(`async parser handler taking longer than ${Q4} ms`)})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse($,J){let Y,Z=this._activeBuffer.x,j=this._activeBuffer.y,K=0,Q=this._parseStack.paused;if(Q){if(Y=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,J))return this._logSlowResolvingAsync(Y),Y;Z=this._parseStack.cursorStartX,j=this._parseStack.cursorStartY,this._parseStack.paused=!1,$.length>Z9&&(K=this._parseStack.position+Z9)}if(this._logService.logLevel<=1&&this._logService.debug(`parsing data ${typeof $=="string"?` "${$}"`:` "${Array.prototype.map.call($,(z)=>String.fromCharCode(z)).join("")}"`}`),this._logService.logLevel===0&&this._logService.trace("parsing data (codes)",typeof $=="string"?$.split("").map((z)=>z.charCodeAt(0)):$),this._parseBuffer.length<$.length&&this._parseBuffer.length<Z9&&(this._parseBuffer=new Uint32Array(Math.min($.length,Z9))),Q||this._dirtyRowTracker.clearRange(),$.length>Z9)for(let z=K;z<$.length;z+=Z9){let G=z+Z9<$.length?z+Z9:$.length,W=typeof $=="string"?this._stringDecoder.decode($.substring(z,G),this._parseBuffer):this._utf8Decoder.decode($.subarray(z,G),this._parseBuffer);if(Y=this._parser.parse(this._parseBuffer,W))return this._preserveStack(Z,j,W,z),this._logSlowResolvingAsync(Y),Y}else if(!Q){let z=typeof $=="string"?this._stringDecoder.decode($,this._parseBuffer):this._utf8Decoder.decode($,this._parseBuffer);if(Y=this._parser.parse(this._parseBuffer,z))return this._preserveStack(Z,j,z,0),this._logSlowResolvingAsync(Y),Y}(this._activeBuffer.x!==Z||this._activeBuffer.y!==j)&&this._onCursorMove.fire();let X=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),V=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);V<this._bufferService.rows&&this._onRequestRefreshRows.fire({start:Math.min(V,this._bufferService.rows-1),end:Math.min(X,this._bufferService.rows-1)})}print($,J,Y){let Z,j,K=this._charsetService.charset,Q=this._optionsService.rawOptions.screenReaderMode,X=this._bufferService.cols,V=this._coreService.decPrivateModes.wraparound,z=this._coreService.modes.insertMode,G=this._curAttrData,W=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&Y-J>0&&W.getWidth(this._activeBuffer.x-1)===2&&W.setCellFromCodepoint(this._activeBuffer.x-1,0,1,G);let q=this._parser.precedingJoinState;for(let H=J;H<Y;++H){if(Z=$[H],Z<127&&K){let A=K[String.fromCharCode(Z)];A&&(Z=A.charCodeAt(0))}let U=this._unicodeService.charProperties(Z,q);j=F9.extractWidth(U);let O=F9.extractShouldJoin(U),M=O?F9.extractWidth(q):0;if(q=U,Q&&this._onA11yChar.fire(j9(Z)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+j-M>X){if(V){let A=W,m=this._activeBuffer.x-M;for(this._activeBuffer.x=M,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),W=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),M>0&&W instanceof W7&&W.copyCellsFrom(A,m,0,M,!1);m<X;)A.setCellFromCodepoint(m++,0,1,G)}else if(this._activeBuffer.x=X-1,j===2)continue}if(O&&this._activeBuffer.x){let A=W.getWidth(this._activeBuffer.x-1)?1:2;W.addCodepointToCell(this._activeBuffer.x-A,Z,j);for(let m=j-M;--m>=0;)W.setCellFromCodepoint(this._activeBuffer.x++,0,0,G);continue}if(z&&(W.insertCells(this._activeBuffer.x,j-M,this._activeBuffer.getNullCell(G)),W.getWidth(X-1)===2&&W.setCellFromCodepoint(X-1,0,1,G)),W.setCellFromCodepoint(this._activeBuffer.x++,Z,j,G),j>0)for(;--j;)W.setCellFromCodepoint(this._activeBuffer.x++,0,0,G)}this._parser.precedingJoinState=q,this._activeBuffer.x<X&&Y-J>0&&W.getWidth(this._activeBuffer.x)===0&&!W.hasContent(this._activeBuffer.x)&&W.setCellFromCodepoint(this._activeBuffer.x,0,1,G),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler($,J){return $.final==="t"&&!$.prefix&&!$.intermediates?this._parser.registerCsiHandler($,(Y)=>K4(Y.params[0],this._optionsService.rawOptions.windowOptions)?J(Y):!0):this._parser.registerCsiHandler($,J)}registerDcsHandler($,J){return this._parser.registerDcsHandler($,new Y4(J))}registerEscHandler($,J){return this._parser.registerEscHandler($,J)}registerOscHandler($,J){return this._parser.registerOscHandler($,new Q8(J))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)?.isWrapped){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let $=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);$.hasWidth(this._activeBuffer.x)&&!$.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let $=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-$),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor($=this._bufferService.cols-1){this._activeBuffer.x=Math.min($,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor($,J){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=$,this._activeBuffer.y=this._activeBuffer.scrollTop+J):(this._activeBuffer.x=$,this._activeBuffer.y=J),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor($,J){this._restrictCursor(),this._setCursor(this._activeBuffer.x+$,this._activeBuffer.y+J)}cursorUp($){let J=this._activeBuffer.y-this._activeBuffer.scrollTop;return J>=0?this._moveCursor(0,-Math.min(J,$.params[0]||1)):this._moveCursor(0,-($.params[0]||1)),!0}cursorDown($){let J=this._activeBuffer.scrollBottom-this._activeBuffer.y;return J>=0?this._moveCursor(0,Math.min(J,$.params[0]||1)):this._moveCursor(0,$.params[0]||1),!0}cursorForward($){return this._moveCursor($.params[0]||1,0),!0}cursorBackward($){return this._moveCursor(-($.params[0]||1),0),!0}cursorNextLine($){return this.cursorDown($),this._activeBuffer.x=0,!0}cursorPrecedingLine($){return this.cursorUp($),this._activeBuffer.x=0,!0}cursorCharAbsolute($){return this._setCursor(($.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition($){return this._setCursor($.length>=2?($.params[1]||1)-1:0,($.params[0]||1)-1),!0}charPosAbsolute($){return this._setCursor(($.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative($){return this._moveCursor($.params[0]||1,0),!0}linePosAbsolute($){return this._setCursor(this._activeBuffer.x,($.params[0]||1)-1),!0}vPositionRelative($){return this._moveCursor(0,$.params[0]||1),!0}hVPosition($){return this.cursorPosition($),!0}tabClear($){let J=$.params[0];return J===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:J===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab($){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let J=$.params[0]||1;for(;J--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab($){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let J=$.params[0]||1;for(;J--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected($){let J=$.params[0];return J===1&&(this._curAttrData.bg|=536870912),(J===2||J===0)&&(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine($,J,Y,Z=!1,j=!1){let K=this._activeBuffer.lines.get(this._activeBuffer.ybase+$);K.replaceCells(J,Y,this._activeBuffer.getNullCell(this._eraseAttrData()),j),Z&&(K.isWrapped=!1)}_resetBufferLine($,J=!1){let Y=this._activeBuffer.lines.get(this._activeBuffer.ybase+$);Y&&(Y.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),J),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+$),Y.isWrapped=!1)}eraseInDisplay($,J=!1){this._restrictCursor(this._bufferService.cols);let Y;switch($.params[0]){case 0:for(Y=this._activeBuffer.y,this._dirtyRowTracker.markDirty(Y),this._eraseInBufferLine(Y++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,J);Y<this._bufferService.rows;Y++)this._resetBufferLine(Y,J);this._dirtyRowTracker.markDirty(Y);break;case 1:for(Y=this._activeBuffer.y,this._dirtyRowTracker.markDirty(Y),this._eraseInBufferLine(Y,0,this._activeBuffer.x+1,!0,J),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(Y+1).isWrapped=!1);Y--;)this._resetBufferLine(Y,J);this._dirtyRowTracker.markDirty(0);break;case 2:if(this._optionsService.rawOptions.scrollOnEraseInDisplay){for(Y=this._bufferService.rows,this._dirtyRowTracker.markRangeDirty(0,Y-1);Y--&&!this._activeBuffer.lines.get(this._activeBuffer.ybase+Y)?.getTrimmedLength(););for(;Y>=0;Y--)this._bufferService.scroll(this._eraseAttrData())}else{for(Y=this._bufferService.rows,this._dirtyRowTracker.markDirty(Y-1);Y--;)this._resetBufferLine(Y,J);this._dirtyRowTracker.markDirty(0)}break;case 3:let Z=this._activeBuffer.lines.length-this._bufferService.rows;Z>0&&(this._activeBuffer.lines.trimStart(Z),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-Z,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-Z,0),this._onScroll.fire(0));break}return!0}eraseInLine($,J=!1){switch(this._restrictCursor(this._bufferService.cols),$.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,J);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,J);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,J);break}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines($){this._restrictCursor();let J=$.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=this._activeBuffer.ybase+this._activeBuffer.y,Z=this._bufferService.rows-1-this._activeBuffer.scrollBottom,j=this._bufferService.rows-1+this._activeBuffer.ybase-Z+1;for(;J--;)this._activeBuffer.lines.splice(j-1,1),this._activeBuffer.lines.splice(Y,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines($){this._restrictCursor();let J=$.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let Y=this._activeBuffer.ybase+this._activeBuffer.y,Z;for(Z=this._bufferService.rows-1-this._activeBuffer.scrollBottom,Z=this._bufferService.rows-1+this._activeBuffer.ybase-Z;J--;)this._activeBuffer.lines.splice(Y,1),this._activeBuffer.lines.splice(Z,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars($){this._restrictCursor();let J=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return J&&(J.insertCells(this._activeBuffer.x,$.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars($){this._restrictCursor();let J=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return J&&(J.deleteCells(this._activeBuffer.x,$.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp($){let J=$.params[0]||1;for(;J--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown($){let J=$.params[0]||1;for(;J--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(x0));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft($){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let J=$.params[0]||1;for(let Y=this._activeBuffer.scrollTop;Y<=this._activeBuffer.scrollBottom;++Y){let Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+Y);Z.deleteCells(0,J,this._activeBuffer.getNullCell(this._eraseAttrData())),Z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight($){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let J=$.params[0]||1;for(let Y=this._activeBuffer.scrollTop;Y<=this._activeBuffer.scrollBottom;++Y){let Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+Y);Z.insertCells(0,J,this._activeBuffer.getNullCell(this._eraseAttrData())),Z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns($){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let J=$.params[0]||1;for(let Y=this._activeBuffer.scrollTop;Y<=this._activeBuffer.scrollBottom;++Y){let Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+Y);Z.insertCells(this._activeBuffer.x,J,this._activeBuffer.getNullCell(this._eraseAttrData())),Z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns($){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let J=$.params[0]||1;for(let Y=this._activeBuffer.scrollTop;Y<=this._activeBuffer.scrollBottom;++Y){let Z=this._activeBuffer.lines.get(this._activeBuffer.ybase+Y);Z.deleteCells(this._activeBuffer.x,J,this._activeBuffer.getNullCell(this._eraseAttrData())),Z.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars($){this._restrictCursor();let J=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return J&&(J.replaceCells(this._activeBuffer.x,this._activeBuffer.x+($.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter($){let J=this._parser.precedingJoinState;if(!J)return!0;let Y=$.params[0]||1,Z=F9.extractWidth(J),j=this._activeBuffer.x-Z,K=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(j),Q=new Uint32Array(K.length*Y),X=0;for(let z=0;z<K.length;){let G=K.codePointAt(z)||0;Q[X++]=G,z+=G>65535?2:1}let V=X;for(let z=1;z<Y;++z)Q.copyWithin(V,0,X),V+=X;return this.print(Q,0,V),!0}sendDeviceAttributesPrimary($){return $.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(D.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(D.ESC+"[?6c")),!0}sendDeviceAttributesSecondary($){return $.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(D.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(D.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent($.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(D.ESC+"[>83;40003;0c")),!0}_is($){return(this._optionsService.rawOptions.termName+"").indexOf($)===0}setMode($){for(let J=0;J<$.length;J++)switch($.params[J]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0;break}return!0}setModePrivate($){for(let J=0;J<$.length;J++)switch($.params[J]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,O9),this._charsetService.setgCharset(1,O9),this._charsetService.setgCharset(2,O9),this._charsetService.setgCharset(3,O9);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1000:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!0;break}return!0}resetMode($){for(let J=0;J<$.length;J++)switch($.params[J]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1;break}return!0}resetModePrivate($){for(let J=0;J<$.length;J++)switch($.params[J]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1000:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),$.params[J]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(void 0),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1;break;case 2026:this._coreService.decPrivateModes.synchronizedOutput=!1,this._onRequestRefreshRows.fire(void 0);break}return!0}requestMode($,J){let Y;((O)=>(O[O.NOT_RECOGNIZED=0]="NOT_RECOGNIZED",O[O.SET=1]="SET",O[O.RESET=2]="RESET",O[O.PERMANENTLY_SET=3]="PERMANENTLY_SET",O[O.PERMANENTLY_RESET=4]="PERMANENTLY_RESET"))(Y||={});let Z=this._coreService.decPrivateModes,{activeProtocol:j,activeEncoding:K}=this._coreMouseService,Q=this._coreService,{buffers:X,cols:V}=this._bufferService,{active:z,alt:G}=X,W=this._optionsService.rawOptions,q=(O,M)=>(Q.triggerDataEvent(`${D.ESC}[${J?"":"?"}${O};${M}$y`),!0),H=(O)=>O?1:2,U=$.params[0];return J?U===2?q(U,4):U===4?q(U,H(Q.modes.insertMode)):U===12?q(U,3):U===20?q(U,H(W.convertEol)):q(U,0):U===1?q(U,H(Z.applicationCursorKeys)):U===3?q(U,W.windowOptions.setWinLines?V===80?2:V===132?1:0:0):U===6?q(U,H(Z.origin)):U===7?q(U,H(Z.wraparound)):U===8?q(U,3):U===9?q(U,H(j==="X10")):U===12?q(U,H(W.cursorBlink)):U===25?q(U,H(!Q.isCursorHidden)):U===45?q(U,H(Z.reverseWraparound)):U===66?q(U,H(Z.applicationKeypad)):U===67?q(U,4):U===1000?q(U,H(j==="VT200")):U===1002?q(U,H(j==="DRAG")):U===1003?q(U,H(j==="ANY")):U===1004?q(U,H(Z.sendFocus)):U===1005?q(U,4):U===1006?q(U,H(K==="SGR")):U===1015?q(U,4):U===1016?q(U,H(K==="SGR_PIXELS")):U===1048?q(U,1):U===47||U===1047||U===1049?q(U,H(z===G)):U===2004?q(U,H(Z.bracketedPasteMode)):U===2026?q(U,H(Z.synchronizedOutput)):q(U,0)}_updateAttrColor($,J,Y,Z,j){return J===2?($|=50331648,$&=-16777216,$|=N7.fromColorRGB([Y,Z,j])):J===5&&($&=-50331904,$|=33554432|Y&255),$}_extractColor($,J,Y){let Z=[0,0,-1,0,0,0],j=0,K=0;do{if(Z[K+j]=$.params[J+K],$.hasSubParams(J+K)){let Q=$.getSubParams(J+K),X=0;do Z[1]===5&&(j=1),Z[K+X+1+j]=Q[X];while(++X<Q.length&&X+K+1+j<Z.length);break}if(Z[1]===5&&K+j>=2||Z[1]===2&&K+j>=5)break;Z[1]&&(j=1)}while(++K+J<$.length&&K+j<Z.length);for(let Q=2;Q<Z.length;++Q)Z[Q]===-1&&(Z[Q]=0);switch(Z[0]){case 38:Y.fg=this._updateAttrColor(Y.fg,Z[1],Z[3],Z[4],Z[5]);break;case 48:Y.bg=this._updateAttrColor(Y.bg,Z[1],Z[3],Z[4],Z[5]);break;case 58:Y.extended=Y.extended.clone(),Y.extended.underlineColor=this._updateAttrColor(Y.extended.underlineColor,Z[1],Z[3],Z[4],Z[5])}return K}_processUnderline($,J){J.extended=J.extended.clone(),(!~$||$>5)&&($=1),J.extended.underlineStyle=$,J.fg|=268435456,$===0&&(J.fg&=-268435457),J.updateExtended()}_processSGR0($){$.fg=x0.fg,$.bg=x0.bg,$.extended=$.extended.clone(),$.extended.underlineStyle=0,$.extended.underlineColor&=-67108864,$.updateExtended()}charAttributes($){if($.length===1&&$.params[0]===0)return this._processSGR0(this._curAttrData),!0;let J=$.length,Y,Z=this._curAttrData;for(let j=0;j<J;j++)Y=$.params[j],Y>=30&&Y<=37?(Z.fg&=-50331904,Z.fg|=16777216|Y-30):Y>=40&&Y<=47?(Z.bg&=-50331904,Z.bg|=16777216|Y-40):Y>=90&&Y<=97?(Z.fg&=-50331904,Z.fg|=16777216|Y-90|8):Y>=100&&Y<=107?(Z.bg&=-50331904,Z.bg|=16777216|Y-100|8):Y===0?this._processSGR0(Z):Y===1?Z.fg|=134217728:Y===3?Z.bg|=67108864:Y===4?(Z.fg|=268435456,this._processUnderline($.hasSubParams(j)?$.getSubParams(j)[0]:1,Z)):Y===5?Z.fg|=536870912:Y===7?Z.fg|=67108864:Y===8?Z.fg|=1073741824:Y===9?Z.fg|=2147483648:Y===2?Z.bg|=134217728:Y===21?this._processUnderline(2,Z):Y===22?(Z.fg&=-134217729,Z.bg&=-134217729):Y===23?Z.bg&=-67108865:Y===24?(Z.fg&=-268435457,this._processUnderline(0,Z)):Y===25?Z.fg&=-536870913:Y===27?Z.fg&=-67108865:Y===28?Z.fg&=-1073741825:Y===29?Z.fg&=2147483647:Y===39?(Z.fg&=-67108864,Z.fg|=x0.fg&16777215):Y===49?(Z.bg&=-67108864,Z.bg|=x0.bg&16777215):Y===38||Y===48||Y===58?j+=this._extractColor($,j,Z):Y===53?Z.bg|=1073741824:Y===55?Z.bg&=-1073741825:Y===59?(Z.extended=Z.extended.clone(),Z.extended.underlineColor=-1,Z.updateExtended()):Y===100?(Z.fg&=-67108864,Z.fg|=x0.fg&16777215,Z.bg&=-67108864,Z.bg|=x0.bg&16777215):this._logService.debug("Unknown SGR attribute: %d.",Y);return!0}deviceStatus($){switch($.params[0]){case 5:this._coreService.triggerDataEvent(`${D.ESC}[0n`);break;case 6:let J=this._activeBuffer.y+1,Y=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${D.ESC}[${J};${Y}R`);break}return!0}deviceStatusPrivate($){switch($.params[0]){case 6:let J=this._activeBuffer.y+1,Y=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${D.ESC}[?${J};${Y}R`);break;case 15:break;case 25:break;case 26:break;case 53:break}return!0}softReset($){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=x0.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle($){let J=$.length===0?1:$.params[0];if(J===0)this._coreService.decPrivateModes.cursorStyle=void 0,this._coreService.decPrivateModes.cursorBlink=void 0;else{switch(J){case 1:case 2:this._coreService.decPrivateModes.cursorStyle="block";break;case 3:case 4:this._coreService.decPrivateModes.cursorStyle="underline";break;case 5:case 6:this._coreService.decPrivateModes.cursorStyle="bar";break}let Y=J%2===1;this._coreService.decPrivateModes.cursorBlink=Y}return!0}setScrollRegion($){let J=$.params[0]||1,Y;return($.length<2||(Y=$.params[1])>this._bufferService.rows||Y===0)&&(Y=this._bufferService.rows),Y>J&&(this._activeBuffer.scrollTop=J-1,this._activeBuffer.scrollBottom=Y-1,this._setCursor(0,0)),!0}windowOptions($){if(!K4($.params[0],this._optionsService.rawOptions.windowOptions))return!0;let J=$.length>1?$.params[1]:0;switch($.params[0]){case 14:J!==2&&this._onRequestWindowsOptionsReport.fire(0);break;case 16:this._onRequestWindowsOptionsReport.fire(1);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${D.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:(J===0||J===2)&&(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>j4&&this._windowTitleStack.shift()),(J===0||J===1)&&(this._iconNameStack.push(this._iconName),this._iconNameStack.length>j4&&this._iconNameStack.shift());break;case 23:(J===0||J===2)&&this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),(J===0||J===1)&&this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop());break}return!0}saveCursor($){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor($){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle($){return this._windowTitle=$,this._onTitleChange.fire($),!0}setIconName($){return this._iconName=$,!0}setOrReportIndexedColor($){let J=[],Y=$.split(";");for(;Y.length>1;){let Z=Y.shift(),j=Y.shift();if(/^\d+$/.exec(Z)){let K=parseInt(Z);if(z4(K))if(j==="?")J.push({type:0,index:K});else{let Q=Z4(j);Q&&J.push({type:1,index:K,color:Q})}}}return J.length&&this._onColor.fire(J),!0}setHyperlink($){let J=$.indexOf(";");if(J===-1)return!0;let Y=$.slice(0,J).trim(),Z=$.slice(J+1);return Z?this._createHyperlink(Y,Z):Y.trim()?!1:this._finishHyperlink()}_createHyperlink($,J){this._getCurrentLinkId()&&this._finishHyperlink();let Y=$.split(":"),Z,j=Y.findIndex((K)=>K.startsWith("id="));return j!==-1&&(Z=Y[j].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:Z,uri:J}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor($,J){let Y=$.split(";");for(let Z=0;Z<Y.length&&!(J>=this._specialColors.length);++Z,++J)if(Y[Z]==="?")this._onColor.fire([{type:0,index:this._specialColors[J]}]);else{let j=Z4(Y[Z]);j&&this._onColor.fire([{type:1,index:this._specialColors[J],color:j}])}return!0}setOrReportFgColor($){return this._setOrReportSpecialColor($,0)}setOrReportBgColor($){return this._setOrReportSpecialColor($,1)}setOrReportCursorColor($){return this._setOrReportSpecialColor($,2)}restoreIndexedColor($){if(!$)return this._onColor.fire([{type:2}]),!0;let J=[],Y=$.split(";");for(let Z=0;Z<Y.length;++Z)if(/^\d+$/.exec(Y[Z])){let j=parseInt(Y[Z]);z4(j)&&J.push({type:2,index:j})}return J.length&&this._onColor.fire(J),!0}restoreFgColor($){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor($){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor($){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,O9),!0}selectCharset($){return $.length!==2?(this.selectDefaultCharset(),!0):($[0]==="/"||this._charsetService.setgCharset(VX[$[0]],y0[$[1]]||O9),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let $=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,$,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=x0.clone(),this._eraseAttrDataInternal=x0.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=this._curAttrData.bg&67108863,this._eraseAttrDataInternal}setgLevel($){return this._charsetService.setgLevel($),!0}screenAlignmentPattern(){let $=new I8;$.content=4194373,$.fg=this._curAttrData.fg,$.bg=this._curAttrData.bg,this._setCursor(0,0);for(let J=0;J<this._bufferService.rows;++J){let Y=this._activeBuffer.ybase+this._activeBuffer.y+J,Z=this._activeBuffer.lines.get(Y);Z&&(Z.fill($),Z.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString($,J){let Y=(Q)=>(this._coreService.triggerDataEvent(`${D.ESC}${Q}${D.ESC}\\`),!0),Z=this._bufferService.buffer,j=this._optionsService.rawOptions;return Y($==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:$==='"p'?'P1$r61;1"p':$==="r"?`P1$r${Z.scrollTop+1};${Z.scrollBottom+1}r`:$==="m"?"P1$r0m":$===" q"?`P1$r${{block:2,underline:4,bar:6}[j.cursorStyle]-(j.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty($,J){this._dirtyRowTracker.markRangeDirty($,J)}},x5=class{constructor($){this._bufferService=$,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty($){$<this.start?this.start=$:$>this.end&&(this.end=$)}markRangeDirty($,J){$>J&&(X4=$,$=J,J=X4),$<this.start&&(this.start=$),J>this.end&&(this.end=J)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};x5=U0([k(0,i0)],x5);function z4($){return 0<=$&&$<256}var WX=50000000,V4=12,qX=50,HX=class extends d{constructor($){super();this._action=$,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this._register(new L),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync($,J){if(J!==void 0&&this._syncCalls>J){this._syncCalls=0;return}if(this._pendingData+=$.length,this._writeBuffer.push($),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;this._isSyncWriting=!0;let Y;for(;Y=this._writeBuffer.shift();){this._action(Y);let Z=this._callbacks.shift();Z&&Z()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write($,J){if(this._pendingData>WX)throw Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput){this._didUserInput=!1,this._pendingData+=$.length,this._writeBuffer.push($),this._callbacks.push(J),this._innerWrite();return}setTimeout(()=>this._innerWrite())}this._pendingData+=$.length,this._writeBuffer.push($),this._callbacks.push(J)}_innerWrite($=0,J=!0){let Y=$||performance.now();for(;this._writeBuffer.length>this._bufferOffset;){let Z=this._writeBuffer[this._bufferOffset],j=this._action(Z,J);if(j){let Q=(X)=>performance.now()-Y>=V4?setTimeout(()=>this._innerWrite(0,X)):this._innerWrite(Y,X);j.catch((X)=>(queueMicrotask(()=>{throw X}),Promise.resolve(!1))).then(Q);return}let K=this._callbacks[this._bufferOffset];if(K&&K(),this._bufferOffset++,this._pendingData-=Z.length,performance.now()-Y>=V4)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>qX&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}},b5=class{constructor($){this._bufferService=$,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink($){let J=this._bufferService.buffer;if($.id===void 0){let X=J.addMarker(J.ybase+J.y),V={data:$,id:this._nextId++,lines:[X]};return X.onDispose(()=>this._removeMarkerFromLink(V,X)),this._dataByLinkId.set(V.id,V),V.id}let Y=$,Z=this._getEntryIdKey(Y),j=this._entriesWithId.get(Z);if(j)return this.addLineToLink(j.id,J.ybase+J.y),j.id;let K=J.addMarker(J.ybase+J.y),Q={id:this._nextId++,key:this._getEntryIdKey(Y),data:Y,lines:[K]};return K.onDispose(()=>this._removeMarkerFromLink(Q,K)),this._entriesWithId.set(Q.key,Q),this._dataByLinkId.set(Q.id,Q),Q.id}addLineToLink($,J){let Y=this._dataByLinkId.get($);if(Y&&Y.lines.every((Z)=>Z.line!==J)){let Z=this._bufferService.buffer.addMarker(J);Y.lines.push(Z),Z.onDispose(()=>this._removeMarkerFromLink(Y,Z))}}getLinkData($){return this._dataByLinkId.get($)?.data}_getEntryIdKey($){return`${$.id};;${$.uri}`}_removeMarkerFromLink($,J){let Y=$.lines.indexOf(J);Y!==-1&&($.lines.splice(Y,1),$.lines.length===0&&($.data.id!==void 0&&this._entriesWithId.delete($.key),this._dataByLinkId.delete($.id)))}};b5=U0([k(0,i0)],b5);var G4=!1,UX=class extends d{constructor($){super();this._windowsWrappingHeuristics=this._register(new T9),this._onBinary=this._register(new L),this.onBinary=this._onBinary.event,this._onData=this._register(new L),this.onData=this._onData.event,this._onLineFeed=this._register(new L),this.onLineFeed=this._onLineFeed.event,this._onResize=this._register(new L),this.onResize=this._onResize.event,this._onWriteParsed=this._register(new L),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this._register(new L),this._instantiationService=new mQ,this.optionsService=this._register(new oQ($)),this._instantiationService.setService(r0,this.optionsService),this._bufferService=this._register(this._instantiationService.createInstance(O5)),this._instantiationService.setService(i0,this._bufferService),this._logService=this._register(this._instantiationService.createInstance(v5)),this._instantiationService.setService(N4,this._logService),this.coreService=this._register(this._instantiationService.createInstance(F5)),this._instantiationService.setService(R9,this.coreService),this.coreMouseService=this._register(this._instantiationService.createInstance(N5)),this._instantiationService.setService(F4,this.coreMouseService),this.unicodeService=this._register(this._instantiationService.createInstance(F9)),this._instantiationService.setService(Qj,this.unicodeService),this._charsetService=this._instantiationService.createInstance(eQ),this._instantiationService.setService(Kj,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(b5),this._instantiationService.setService(x4,this._oscLinkService),this._inputHandler=this._register(new GX(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this._register(g0.forward(this._inputHandler.onLineFeed,this._onLineFeed)),this._register(this._inputHandler),this._register(g0.forward(this._bufferService.onResize,this._onResize)),this._register(g0.forward(this.coreService.onData,this._onData)),this._register(g0.forward(this.coreService.onBinary,this._onBinary)),this._register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom(!0))),this._register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this._register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this._register(this._bufferService.onScroll(()=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this._register(new HX((J,Y)=>this._inputHandler.parse(J,Y))),this._register(g0.forward(this._writeBuffer.onWriteParsed,this._onWriteParsed))}get onScroll(){return this._onScrollApi||(this._onScrollApi=this._register(new L),this._onScroll.event(($)=>{this._onScrollApi?.fire($.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options($){for(let J in $)this.optionsService.options[J]=$[J]}write($,J){this._writeBuffer.write($,J)}writeSync($,J){this._logService.logLevel<=3&&!G4&&(this._logService.warn("writeSync is unreliable and will be removed soon."),G4=!0),this._writeBuffer.writeSync($,J)}input($,J=!0){this.coreService.triggerDataEvent($,J)}resize($,J){isNaN($)||isNaN(J)||($=Math.max($,r4),J=Math.max(J,t4),this._bufferService.resize($,J))}scroll($,J=!1){this._bufferService.scroll($,J)}scrollLines($,J){this._bufferService.scrollLines($,J)}scrollPages($){this.scrollLines($*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom($){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine($){let J=$-this._bufferService.buffer.ydisp;J!==0&&this.scrollLines(J)}registerEscHandler($,J){return this._inputHandler.registerEscHandler($,J)}registerDcsHandler($,J){return this._inputHandler.registerDcsHandler($,J)}registerCsiHandler($,J){return this._inputHandler.registerCsiHandler($,J)}registerOscHandler($,J){return this._inputHandler.registerOscHandler($,J)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let $=!1,J=this.optionsService.rawOptions.windowsPty;J&&J.buildNumber!==void 0&&J.buildNumber!==void 0?$=J.backend==="conpty"&&J.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&($=!0),$?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let $=[];$.push(this.onLineFeed(J4.bind(null,this._bufferService))),$.push(this.registerCsiHandler({final:"H"},()=>(J4(this._bufferService),!1))),this._windowsWrappingHeuristics.value=X0(()=>{for(let J of $)J.dispose()})}}},IX={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};function BX($,J,Y,Z){let j={type:0,cancel:!1,key:void 0},K=($.shiftKey?1:0)|($.altKey?2:0)|($.ctrlKey?4:0)|($.metaKey?8:0);switch($.keyCode){case 0:$.key==="UIKeyInputUpArrow"?J?j.key=D.ESC+"OA":j.key=D.ESC+"[A":$.key==="UIKeyInputLeftArrow"?J?j.key=D.ESC+"OD":j.key=D.ESC+"[D":$.key==="UIKeyInputRightArrow"?J?j.key=D.ESC+"OC":j.key=D.ESC+"[C":$.key==="UIKeyInputDownArrow"&&(J?j.key=D.ESC+"OB":j.key=D.ESC+"[B");break;case 8:j.key=$.ctrlKey?"\b":D.DEL,$.altKey&&(j.key=D.ESC+j.key);break;case 9:if($.shiftKey){j.key=D.ESC+"[Z";break}j.key=D.HT,j.cancel=!0;break;case 13:j.key=$.altKey?D.ESC+D.CR:D.CR,j.cancel=!0;break;case 27:j.key=D.ESC,$.altKey&&(j.key=D.ESC+D.ESC),j.cancel=!0;break;case 37:if($.metaKey)break;K?j.key=D.ESC+"[1;"+(K+1)+"D":J?j.key=D.ESC+"OD":j.key=D.ESC+"[D";break;case 39:if($.metaKey)break;K?j.key=D.ESC+"[1;"+(K+1)+"C":J?j.key=D.ESC+"OC":j.key=D.ESC+"[C";break;case 38:if($.metaKey)break;K?j.key=D.ESC+"[1;"+(K+1)+"A":J?j.key=D.ESC+"OA":j.key=D.ESC+"[A";break;case 40:if($.metaKey)break;K?j.key=D.ESC+"[1;"+(K+1)+"B":J?j.key=D.ESC+"OB":j.key=D.ESC+"[B";break;case 45:!$.shiftKey&&!$.ctrlKey&&(j.key=D.ESC+"[2~");break;case 46:K?j.key=D.ESC+"[3;"+(K+1)+"~":j.key=D.ESC+"[3~";break;case 36:K?j.key=D.ESC+"[1;"+(K+1)+"H":J?j.key=D.ESC+"OH":j.key=D.ESC+"[H";break;case 35:K?j.key=D.ESC+"[1;"+(K+1)+"F":J?j.key=D.ESC+"OF":j.key=D.ESC+"[F";break;case 33:$.shiftKey?j.type=2:$.ctrlKey?j.key=D.ESC+"[5;"+(K+1)+"~":j.key=D.ESC+"[5~";break;case 34:$.shiftKey?j.type=3:$.ctrlKey?j.key=D.ESC+"[6;"+(K+1)+"~":j.key=D.ESC+"[6~";break;case 112:K?j.key=D.ESC+"[1;"+(K+1)+"P":j.key=D.ESC+"OP";break;case 113:K?j.key=D.ESC+"[1;"+(K+1)+"Q":j.key=D.ESC+"OQ";break;case 114:K?j.key=D.ESC+"[1;"+(K+1)+"R":j.key=D.ESC+"OR";break;case 115:K?j.key=D.ESC+"[1;"+(K+1)+"S":j.key=D.ESC+"OS";break;case 116:K?j.key=D.ESC+"[15;"+(K+1)+"~":j.key=D.ESC+"[15~";break;case 117:K?j.key=D.ESC+"[17;"+(K+1)+"~":j.key=D.ESC+"[17~";break;case 118:K?j.key=D.ESC+"[18;"+(K+1)+"~":j.key=D.ESC+"[18~";break;case 119:K?j.key=D.ESC+"[19;"+(K+1)+"~":j.key=D.ESC+"[19~";break;case 120:K?j.key=D.ESC+"[20;"+(K+1)+"~":j.key=D.ESC+"[20~";break;case 121:K?j.key=D.ESC+"[21;"+(K+1)+"~":j.key=D.ESC+"[21~";break;case 122:K?j.key=D.ESC+"[23;"+(K+1)+"~":j.key=D.ESC+"[23~";break;case 123:K?j.key=D.ESC+"[24;"+(K+1)+"~":j.key=D.ESC+"[24~";break;default:if($.ctrlKey&&!$.shiftKey&&!$.altKey&&!$.metaKey)$.keyCode>=65&&$.keyCode<=90?j.key=String.fromCharCode($.keyCode-64):$.keyCode===32?j.key=D.NUL:$.keyCode>=51&&$.keyCode<=55?j.key=String.fromCharCode($.keyCode-51+27):$.keyCode===56?j.key=D.DEL:$.keyCode===219?j.key=D.ESC:$.keyCode===220?j.key=D.FS:$.keyCode===221&&(j.key=D.GS);else if((!Y||Z)&&$.altKey&&!$.metaKey){let Q=IX[$.keyCode]?.[$.shiftKey?1:0];if(Q)j.key=D.ESC+Q;else if($.keyCode>=65&&$.keyCode<=90){let X=$.ctrlKey?$.keyCode-64:$.keyCode+32,V=String.fromCharCode(X);$.shiftKey&&(V=V.toUpperCase()),j.key=D.ESC+V}else if($.keyCode===32)j.key=D.ESC+($.ctrlKey?D.NUL:" ");else if($.key==="Dead"&&$.code.startsWith("Key")){let X=$.code.slice(3,4);$.shiftKey||(X=X.toLowerCase()),j.key=D.ESC+X,j.cancel=!0}}else Y&&!$.altKey&&!$.ctrlKey&&!$.shiftKey&&$.metaKey?$.keyCode===65&&(j.type=1):$.key&&!$.ctrlKey&&!$.altKey&&!$.metaKey&&$.keyCode>=48&&$.key.length===1?j.key=$.key:$.key&&$.ctrlKey&&($.key==="_"&&(j.key=D.US),$.key==="@"&&(j.key=D.NUL));break}return j}var F0=0,vX=class{constructor($){this._getKey=$,this._array=[],this._insertedValues=[],this._flushInsertedTask=new v6,this._isFlushingInserted=!1,this._deletedIndices=[],this._flushDeletedTask=new v6,this._isFlushingDeleted=!1}clear(){this._array.length=0,this._insertedValues.length=0,this._flushInsertedTask.clear(),this._isFlushingInserted=!1,this._deletedIndices.length=0,this._flushDeletedTask.clear(),this._isFlushingDeleted=!1}insert($){this._flushCleanupDeleted(),this._insertedValues.length===0&&this._flushInsertedTask.enqueue(()=>this._flushInserted()),this._insertedValues.push($)}_flushInserted(){let $=this._insertedValues.sort((j,K)=>this._getKey(j)-this._getKey(K)),J=0,Y=0,Z=Array(this._array.length+this._insertedValues.length);for(let j=0;j<Z.length;j++)Y>=this._array.length||this._getKey($[J])<=this._getKey(this._array[Y])?(Z[j]=$[J],J++):Z[j]=this._array[Y++];this._array=Z,this._insertedValues.length=0}_flushCleanupInserted(){!this._isFlushingInserted&&this._insertedValues.length>0&&this._flushInsertedTask.flush()}delete($){if(this._flushCleanupInserted(),this._array.length===0)return!1;let J=this._getKey($);if(J===void 0||(F0=this._search(J),F0===-1)||this._getKey(this._array[F0])!==J)return!1;do if(this._array[F0]===$)return this._deletedIndices.length===0&&this._flushDeletedTask.enqueue(()=>this._flushDeleted()),this._deletedIndices.push(F0),!0;while(++F0<this._array.length&&this._getKey(this._array[F0])===J);return!1}_flushDeleted(){this._isFlushingDeleted=!0;let $=this._deletedIndices.sort((j,K)=>j-K),J=0,Y=Array(this._array.length-$.length),Z=0;for(let j=0;j<this._array.length;j++)$[J]===j?J++:Y[Z++]=this._array[j];this._array=Y,this._deletedIndices.length=0,this._isFlushingDeleted=!1}_flushCleanupDeleted(){!this._isFlushingDeleted&&this._deletedIndices.length>0&&this._flushDeletedTask.flush()}*getKeyIterator($){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(F0=this._search($),!(F0<0||F0>=this._array.length)&&this._getKey(this._array[F0])===$))do yield this._array[F0];while(++F0<this._array.length&&this._getKey(this._array[F0])===$)}forEachByKey($,J){if(this._flushCleanupInserted(),this._flushCleanupDeleted(),this._array.length!==0&&(F0=this._search($),!(F0<0||F0>=this._array.length)&&this._getKey(this._array[F0])===$))do J(this._array[F0]);while(++F0<this._array.length&&this._getKey(this._array[F0])===$)}values(){return this._flushCleanupInserted(),this._flushCleanupDeleted(),[...this._array].values()}_search($){let J=0,Y=this._array.length-1;for(;Y>=J;){let Z=J+Y>>1,j=this._getKey(this._array[Z]);if(j>$)Y=Z-1;else if(j<$)J=Z+1;else{for(;Z>0&&this._getKey(this._array[Z-1])===$;)Z--;return Z}}return J}},a1=0,W4=0,OX=class extends d{constructor(){super();this._decorations=new vX(($)=>$?.marker.line),this._onDecorationRegistered=this._register(new L),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this._register(new L),this.onDecorationRemoved=this._onDecorationRemoved.event,this._register(X0(()=>this.reset()))}get decorations(){return this._decorations.values()}registerDecoration($){if($.marker.isDisposed)return;let J=new FX($);if(J){let Y=J.marker.onDispose(()=>J.dispose()),Z=J.onDispose(()=>{Z.dispose(),J&&(this._decorations.delete(J)&&this._onDecorationRemoved.fire(J),Y.dispose())});this._decorations.insert(J),this._onDecorationRegistered.fire(J)}return J}reset(){for(let $ of this._decorations.values())$.dispose();this._decorations.clear()}*getDecorationsAtCell($,J,Y){let Z=0,j=0;for(let K of this._decorations.getKeyIterator(J))Z=K.options.x??0,j=Z+(K.options.width??1),$>=Z&&$<j&&(!Y||(K.options.layer??"bottom")===Y)&&(yield K)}forEachDecorationAtCell($,J,Y,Z){this._decorations.forEachByKey(J,(j)=>{a1=j.options.x??0,W4=a1+(j.options.width??1),$>=a1&&$<W4&&(!Y||(j.options.layer??"bottom")===Y)&&Z(j)})}},FX=class extends Q9{constructor($){super();this.options=$,this.onRenderEmitter=this.add(new L),this.onRender=this.onRenderEmitter.event,this._onDispose=this.add(new L),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=$.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=q0.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=q0.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}dispose(){this._onDispose.fire(),super.dispose()}},NX=1000,xX=class{constructor($,J=NX){this._renderCallback=$,this._debounceThresholdMS=J,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh($,J,Y){this._rowCount=Y,$=$!==void 0?$:0,J=J!==void 0?J:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,$):$,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,J):J;let Z=performance.now();if(Z-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=Z,this._innerRefresh();else if(!this._additionalRefreshRequested){let j=Z-this._lastRefreshMs,K=this._debounceThresholdMS-j;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=performance.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},K)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let $=Math.max(this._rowStart,0),J=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback($,J)}},q4=20,H4=!1,O6=class extends d{constructor($,J,Y,Z){super();this._terminal=$,this._coreBrowserService=Y,this._renderService=Z,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="";let j=this._coreBrowserService.mainDocument;this._accessibilityContainer=j.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=j.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let K=0;K<this._terminal.rows;K++)this._rowElements[K]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[K]);if(this._topBoundaryFocusListener=(K)=>this._handleBoundaryFocus(K,0),this._bottomBoundaryFocusListener=(K)=>this._handleBoundaryFocus(K,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=j.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this._register(new xX(this._renderRows.bind(this))),!this._terminal.element)throw Error("Cannot enable accessibility before Terminal.open");H4?(this._accessibilityContainer.classList.add("debug"),this._rowContainer.classList.add("debug"),this._debugRootContainer=j.createElement("div"),this._debugRootContainer.classList.add("xterm"),this._debugRootContainer.appendChild(j.createTextNode("------start a11y------")),this._debugRootContainer.appendChild(this._accessibilityContainer),this._debugRootContainer.appendChild(j.createTextNode("------end a11y------")),this._terminal.element.insertAdjacentElement("afterend",this._debugRootContainer)):this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this._register(this._terminal.onResize((K)=>this._handleResize(K.rows))),this._register(this._terminal.onRender((K)=>this._refreshRows(K.start,K.end))),this._register(this._terminal.onScroll(()=>this._refreshRows())),this._register(this._terminal.onA11yChar((K)=>this._handleChar(K))),this._register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this._register(this._terminal.onA11yTab((K)=>this._handleTab(K))),this._register(this._terminal.onKey((K)=>this._handleKey(K.key))),this._register(this._terminal.onBlur(()=>this._clearLiveRegion())),this._register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._register(p(j,"selectionchange",()=>this._handleSelectionChange())),this._register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRowsDimensions(),this._refreshRows(),this._register(X0(()=>{H4?this._debugRootContainer.remove():this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab($){for(let J=0;J<$;J++)this._handleChar(" ")}_handleChar($){this._liveRegionLineCount<q4+1&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==$&&(this._charsToAnnounce+=$):this._charsToAnnounce+=$,$===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===q4+1&&(this._liveRegion.textContent+=n1.get())))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey($){this._clearLiveRegion(),/\p{Control}/u.test($)||this._charsToConsume.push($)}_refreshRows($,J){this._liveRegionDebouncer.refresh($,J,this._terminal.rows)}_renderRows($,J){let Y=this._terminal.buffer,Z=Y.lines.length.toString();for(let j=$;j<=J;j++){let K=Y.lines.get(Y.ydisp+j),Q=[],X=K?.translateToString(!0,void 0,void 0,Q)||"",V=(Y.ydisp+j+1).toString(),z=this._rowElements[j];z&&(X.length===0?(z.textContent=" ",this._rowColumns.set(z,[0,1])):(z.textContent=X,this._rowColumns.set(z,Q)),z.setAttribute("aria-posinset",V),z.setAttribute("aria-setsize",Z),this._alignRowWidth(z))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus($,J){let Y=$.target,Z=this._rowElements[J===0?1:this._rowElements.length-2],j=Y.getAttribute("aria-posinset"),K=J===0?"1":`${this._terminal.buffer.lines.length}`;if(j===K||$.relatedTarget!==Z)return;let Q,X;if(J===0?(Q=Y,X=this._rowElements.pop(),this._rowContainer.removeChild(X)):(Q=this._rowElements.shift(),X=Y,this._rowContainer.removeChild(Q)),Q.removeEventListener("focus",this._topBoundaryFocusListener),X.removeEventListener("focus",this._bottomBoundaryFocusListener),J===0){let V=this._createAccessibilityTreeNode();this._rowElements.unshift(V),this._rowContainer.insertAdjacentElement("afterbegin",V)}else{let V=this._createAccessibilityTreeNode();this._rowElements.push(V),this._rowContainer.appendChild(V)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(J===0?-1:1),this._rowElements[J===0?1:this._rowElements.length-2].focus(),$.preventDefault(),$.stopImmediatePropagation()}_handleSelectionChange(){if(this._rowElements.length===0)return;let $=this._coreBrowserService.mainDocument.getSelection();if(!$)return;if($.isCollapsed){this._rowContainer.contains($.anchorNode)&&this._terminal.clearSelection();return}if(!$.anchorNode||!$.focusNode){console.error("anchorNode and/or focusNode are null");return}let J={node:$.anchorNode,offset:$.anchorOffset},Y={node:$.focusNode,offset:$.focusOffset};if((J.node.compareDocumentPosition(Y.node)&Node.DOCUMENT_POSITION_PRECEDING||J.node===Y.node&&J.offset>Y.offset)&&([J,Y]=[Y,J]),J.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(J={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(J.node))return;let Z=this._rowElements.slice(-1)[0];if(Y.node.compareDocumentPosition(Z)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(Y={node:Z,offset:Z.textContent?.length??0}),!this._rowContainer.contains(Y.node))return;let j=({node:X,offset:V})=>{let z=X instanceof Text?X.parentNode:X,G=parseInt(z?.getAttribute("aria-posinset"),10)-1;if(isNaN(G))return console.warn("row is invalid. Race condition?"),null;let W=this._rowColumns.get(z);if(!W)return console.warn("columns is null. Race condition?"),null;let q=V<W.length?W[V]:W.slice(-1)[0]+1;return q>=this._terminal.cols&&(++G,q=0),{row:G,column:q}},K=j(J),Q=j(Y);if(!(!K||!Q)){if(K.row>Q.row||K.row===Q.row&&K.column>=Q.column)throw Error("invalid range");this._terminal.select(K.column,K.row,(Q.row-K.row)*this._terminal.cols-K.column+Q.column)}}_handleResize($){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let J=this._rowContainer.children.length;J<this._terminal.rows;J++)this._rowElements[J]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[J]);for(;this._rowElements.length>$;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let $=this._coreBrowserService.mainDocument.createElement("div");return $.setAttribute("role","listitem"),$.tabIndex=-1,this._refreshRowDimensions($),$}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){Object.assign(this._accessibilityContainer.style,{width:`${this._renderService.dimensions.css.canvas.width}px`,fontSize:`${this._terminal.options.fontSize}px`}),this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let $=0;$<this._terminal.rows;$++)this._refreshRowDimensions(this._rowElements[$]),this._alignRowWidth(this._rowElements[$])}}_refreshRowDimensions($){$.style.height=`${this._renderService.dimensions.css.cell.height}px`}_alignRowWidth($){$.style.transform="";let J=$.getBoundingClientRect().width,Y=this._rowColumns.get($)?.slice(-1)?.[0];if(!Y)return;let Z=Y*this._renderService.dimensions.css.cell.width;$.style.transform=`scaleX(${Z/J})`}};O6=U0([k(1,D5),k(2,c8),k(3,l8)],O6);var R5=class extends d{constructor($,J,Y,Z,j){super();this._element=$,this._mouseService=J,this._renderService=Y,this._bufferService=Z,this._linkProviderService=j,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this._register(new L),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this._register(new L),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this._register(X0(()=>{x9(this._linkCacheDisposables),this._linkCacheDisposables.length=0,this._lastMouseEvent=void 0,this._activeProviderReplies?.clear()})),this._register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this._register(p(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this._register(p(this._element,"mousemove",this._handleMouseMove.bind(this))),this._register(p(this._element,"mousedown",this._handleMouseDown.bind(this))),this._register(p(this._element,"mouseup",this._handleMouseUp.bind(this)))}get currentLink(){return this._currentLink}_handleMouseMove($){this._lastMouseEvent=$;let J=this._positionFromMouseEvent($,this._element,this._mouseService);if(!J)return;this._isMouseOut=!1;let Y=$.composedPath();for(let Z=0;Z<Y.length;Z++){let j=Y[Z];if(j.classList.contains("xterm"))break;if(j.classList.contains("xterm-hover"))return}(!this._lastBufferCell||J.x!==this._lastBufferCell.x||J.y!==this._lastBufferCell.y)&&(this._handleHover(J),this._lastBufferCell=J)}_handleHover($){if(this._activeLine!==$.y||this._wasResized){this._clearCurrentLink(),this._askForLink($,!1),this._wasResized=!1;return}this._currentLink&&this._linkAtPosition(this._currentLink.link,$)||(this._clearCurrentLink(),this._askForLink($,!0))}_askForLink($,J){(!this._activeProviderReplies||!J)&&(this._activeProviderReplies?.forEach((Z)=>{Z?.forEach((j)=>{j.link.dispose&&j.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=$.y);let Y=!1;for(let[Z,j]of this._linkProviderService.linkProviders.entries())J?this._activeProviderReplies?.get(Z)&&(Y=this._checkLinkProviderResult(Z,$,Y)):j.provideLinks($.y,(K)=>{if(this._isMouseOut)return;let Q=K?.map((X)=>({link:X}));this._activeProviderReplies?.set(Z,Q),Y=this._checkLinkProviderResult(Z,$,Y),this._activeProviderReplies?.size===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks($.y,this._activeProviderReplies)})}_removeIntersectingLinks($,J){let Y=new Set;for(let Z=0;Z<J.size;Z++){let j=J.get(Z);if(j)for(let K=0;K<j.length;K++){let Q=j[K],X=Q.link.range.start.y<$?0:Q.link.range.start.x,V=Q.link.range.end.y>$?this._bufferService.cols:Q.link.range.end.x;for(let z=X;z<=V;z++){if(Y.has(z)){j.splice(K--,1);break}Y.add(z)}}}}_checkLinkProviderResult($,J,Y){if(!this._activeProviderReplies)return Y;let Z=this._activeProviderReplies.get($),j=!1;for(let K=0;K<$;K++)(!this._activeProviderReplies.has(K)||this._activeProviderReplies.get(K))&&(j=!0);if(!j&&Z){let K=Z.find((Q)=>this._linkAtPosition(Q.link,J));K&&(Y=!0,this._handleNewLink(K))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!Y)for(let K=0;K<this._activeProviderReplies.size;K++){let Q=this._activeProviderReplies.get(K)?.find((X)=>this._linkAtPosition(X.link,J));if(Q){Y=!0,this._handleNewLink(Q);break}}return Y}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp($){if(!this._currentLink)return;let J=this._positionFromMouseEvent($,this._element,this._mouseService);J&&this._mouseDownLink&&bX(this._mouseDownLink.link,this._currentLink.link)&&this._linkAtPosition(this._currentLink.link,J)&&this._currentLink.link.activate($,this._currentLink.link.text)}_clearCurrentLink($,J){!this._currentLink||!this._lastMouseEvent||(!$||!J||this._currentLink.link.range.start.y>=$&&this._currentLink.link.range.end.y<=J)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,x9(this._linkCacheDisposables),this._linkCacheDisposables.length=0)}_handleNewLink($){if(!this._lastMouseEvent)return;let J=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);J&&this._linkAtPosition($.link,J)&&(this._currentLink=$,this._currentLink.state={decorations:{underline:$.link.decorations===void 0?!0:$.link.decorations.underline,pointerCursor:$.link.decorations===void 0?!0:$.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,$.link,this._lastMouseEvent),$.link.decorations={},Object.defineProperties($.link.decorations,{pointerCursor:{get:()=>this._currentLink?.state?.decorations.pointerCursor,set:(Y)=>{this._currentLink?.state&&this._currentLink.state.decorations.pointerCursor!==Y&&(this._currentLink.state.decorations.pointerCursor=Y,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",Y))}},underline:{get:()=>this._currentLink?.state?.decorations.underline,set:(Y)=>{this._currentLink?.state&&this._currentLink?.state?.decorations.underline!==Y&&(this._currentLink.state.decorations.underline=Y,this._currentLink.state.isHovered&&this._fireUnderlineEvent($.link,Y))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((Y)=>{if(!this._currentLink)return;let Z=Y.start===0?0:Y.start+1+this._bufferService.buffer.ydisp,j=this._bufferService.buffer.ydisp+1+Y.end;if(this._currentLink.link.range.start.y>=Z&&this._currentLink.link.range.end.y<=j&&(this._clearCurrentLink(Z,j),this._lastMouseEvent)){let K=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);K&&this._askForLink(K,!1)}})))}_linkHover($,J,Y){this._currentLink?.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(J,!0),this._currentLink.state.decorations.pointerCursor&&$.classList.add("xterm-cursor-pointer")),J.hover&&J.hover(Y,J.text)}_fireUnderlineEvent($,J){let Y=$.range,Z=this._bufferService.buffer.ydisp,j=this._createLinkUnderlineEvent(Y.start.x-1,Y.start.y-Z-1,Y.end.x,Y.end.y-Z-1,void 0);(J?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(j)}_linkLeave($,J,Y){this._currentLink?.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(J,!1),this._currentLink.state.decorations.pointerCursor&&$.classList.remove("xterm-cursor-pointer")),J.leave&&J.leave(Y,J.text)}_linkAtPosition($,J){let Y=$.range.start.y*this._bufferService.cols+$.range.start.x,Z=$.range.end.y*this._bufferService.cols+$.range.end.x,j=J.y*this._bufferService.cols+J.x;return Y<=j&&j<=Z}_positionFromMouseEvent($,J,Y){let Z=Y.getCoords($,J,this._bufferService.cols,this._bufferService.rows);if(Z)return{x:Z[0],y:Z[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent($,J,Y,Z,j){return{x1:$,y1:J,x2:Y,y2:Z,cols:this._bufferService.cols,fg:j}}};R5=U0([k(1,_5),k(2,l8),k(3,i0),k(4,R4)],R5);function bX($,J){return $.text===J.text&&$.range.start.x===J.range.start.x&&$.range.start.y===J.range.start.y&&$.range.end.x===J.range.end.x&&$.range.end.y===J.range.end.y}var RX=class extends UX{constructor($={}){super($);this._linkifier=this._register(new T9),this.browser=u4,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this._register(new T9),this._onCursorMove=this._register(new L),this.onCursorMove=this._onCursorMove.event,this._onKey=this._register(new L),this.onKey=this._onKey.event,this._onRender=this._register(new L),this.onRender=this._onRender.event,this._onSelectionChange=this._register(new L),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this._register(new L),this.onTitleChange=this._onTitleChange.event,this._onBell=this._register(new L),this.onBell=this._onBell.event,this._onFocus=this._register(new L),this._onBlur=this._register(new L),this._onA11yCharEmitter=this._register(new L),this._onA11yTabEmitter=this._register(new L),this._onWillOpen=this._register(new L),this._setup(),this._decorationService=this._instantiationService.createInstance(OX),this._instantiationService.setService(x7,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(WQ),this._instantiationService.setService(R4,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(r1)),this._register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this._register(this._inputHandler.onRequestRefreshRows((J)=>this.refresh(J?.start??0,J?.end??this.rows-1))),this._register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this._register(this._inputHandler.onRequestReset(()=>this.reset())),this._register(this._inputHandler.onRequestWindowsOptionsReport((J)=>this._reportWindowsOptions(J))),this._register(this._inputHandler.onColor((J)=>this._handleColorEvent(J))),this._register(g0.forward(this._inputHandler.onCursorMove,this._onCursorMove)),this._register(g0.forward(this._inputHandler.onTitleChange,this._onTitleChange)),this._register(g0.forward(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this._register(g0.forward(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this._register(this._bufferService.onResize((J)=>this._afterResize(J.cols,J.rows))),this._register(X0(()=>{this._customKeyEventHandler=void 0,this.element?.parentNode?.removeChild(this.element)}))}get linkifier(){return this._linkifier.value}get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}_handleColorEvent($){if(this._themeService)for(let J of $){let Y,Z="";switch(J.index){case 256:Y="foreground",Z="10";break;case 257:Y="background",Z="11";break;case 258:Y="cursor",Z="12";break;default:Y="ansi",Z="4;"+J.index}switch(J.type){case 0:let j=Q0.toColorRGB(Y==="ansi"?this._themeService.colors.ansi[J.index]:this._themeService.colors[Y]);this.coreService.triggerDataEvent(`${D.ESC}]${Z};${zX(j)}${h4.ST}`);break;case 1:if(Y==="ansi")this._themeService.modifyColors((K)=>K.ansi[J.index]=b0.toColor(...J.color));else{let K=Y;this._themeService.modifyColors((Q)=>Q[K]=b0.toColor(...J.color))}break;case 2:this._themeService.restoreColor(J.index);break}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange($){$?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(O6,this)):this._accessibilityManager.clear()}_handleTextAreaFocus($){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(D.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){return this.textarea?.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(D.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let $=this.buffer.ybase+this.buffer.y,J=this.buffer.lines.get($);if(!J)return;let Y=Math.min(this.buffer.x,this.cols-1),Z=this._renderService.dimensions.css.cell.height,j=J.getWidth(Y),K=this._renderService.dimensions.css.cell.width*j,Q=this.buffer.y*this._renderService.dimensions.css.cell.height,X=Y*this._renderService.dimensions.css.cell.width;this.textarea.style.left=X+"px",this.textarea.style.top=Q+"px",this.textarea.style.width=K+"px",this.textarea.style.height=Z+"px",this.textarea.style.lineHeight=Z+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this._register(p(this.element,"copy",(J)=>{this.hasSelection()&&eZ(J,this._selectionService)}));let $=(J)=>$j(J,this.textarea,this.coreService,this.optionsService);this._register(p(this.textarea,"paste",$)),this._register(p(this.element,"paste",$)),d4?this._register(p(this.element,"mousedown",(J)=>{J.button===2&&U$(J,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this._register(p(this.element,"contextmenu",(J)=>{U$(J,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),f5&&this._register(p(this.element,"auxclick",(J)=>{J.button===1&&v4(J,this.textarea,this.screenElement)}))}_bindKeys(){this._register(p(this.textarea,"keyup",($)=>this._keyUp($),!0)),this._register(p(this.textarea,"keydown",($)=>this._keyDown($),!0)),this._register(p(this.textarea,"keypress",($)=>this._keyPress($),!0)),this._register(p(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this._register(p(this.textarea,"compositionupdate",($)=>this._compositionHelper.compositionupdate($))),this._register(p(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this._register(p(this.textarea,"input",($)=>this._inputEvent($),!0)),this._register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open($){if(!$)throw Error("Terminal requires a parent element.");if($.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this.element?.ownerDocument.defaultView&&this._coreBrowserService){this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView);return}this._document=$.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),$.appendChild(this.element);let J=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),J.appendChild(this._viewportElement),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._register(p(this.screenElement,"mousemove",(j)=>this.updateCursorStyle(j))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),J.appendChild(this.screenElement);let Y=this.textarea=this._document.createElement("textarea");this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",o1.get()),s4||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._register(this.optionsService.onSpecificOptionChange("disableStdin",()=>Y.readOnly=this.optionsService.rawOptions.disableStdin)),this.textarea.readOnly=this.optionsService.rawOptions.disableStdin,this._coreBrowserService=this._register(this._instantiationService.createInstance(VQ,this.textarea,$.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(c8,this._coreBrowserService),this._register(p(this.textarea,"focus",(j)=>this._handleTextAreaFocus(j))),this._register(p(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(q5,this._document,this._helperContainer),this._instantiationService.setService(N6,this._charSizeService),this._themeService=this._instantiationService.createInstance(B5),this._instantiationService.setService(k9,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(I6),this._instantiationService.setService(b4,this._characterJoinerService),this._renderService=this._register(this._instantiationService.createInstance(U5,this.rows,this.screenElement)),this._instantiationService.setService(l8,this._renderService),this._register(this._renderService.onRenderedViewportChange((j)=>this._onRender.fire(j))),this.onResize((j)=>this._renderService.resize(j.cols,j.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(V5,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(H5),this._instantiationService.setService(_5,this._mouseService);let Z=this._linkifier.value=this._register(this._instantiationService.createInstance(R5,this.screenElement));this.element.appendChild(J);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this._register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this._register(this.onBlur(()=>this._renderService.handleBlur())),this._register(this.onFocus(()=>this._renderService.handleFocus())),this._viewport=this._register(this._instantiationService.createInstance(X5,this.element,this.screenElement)),this._register(this._viewport.onRequestScrollLines((j)=>{super.scrollLines(j,!1),this.refresh(0,this.rows-1)})),this._selectionService=this._register(this._instantiationService.createInstance(I5,this.element,this.screenElement,Z)),this._instantiationService.setService(zj,this._selectionService),this._register(this._selectionService.onRequestScrollLines((j)=>this.scrollLines(j.amount,j.suppressScrollEvent))),this._register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this._register(this._selectionService.onRequestRedraw((j)=>this._renderService.handleSelectionChanged(j.start,j.end,j.columnSelectMode))),this._register(this._selectionService.onLinuxMouseSelection((j)=>{this.textarea.value=j,this.textarea.focus(),this.textarea.select()})),this._register(g0.any(this._onScroll.event,this._inputHandler.onScroll)(()=>{this._selectionService.refresh(),this._viewport?.queueSync()})),this._register(this._instantiationService.createInstance(z5,this.screenElement)),this._register(p(this.element,"mousedown",(j)=>this._selectionService.handleMouseDown(j))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(O6,this)),this._register(this.optionsService.onSpecificOptionChange("screenReaderMode",(j)=>this._handleScreenReaderModeOptionChange(j))),this.options.overviewRuler.width&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(U6,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRuler",(j)=>{!this._overviewRulerRenderer&&j&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this._register(this._instantiationService.createInstance(U6,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(W5,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let $=this,J=this.element;function Y(K){let Q=$._mouseService.getMouseReportCoords(K,$.screenElement);if(!Q)return!1;let X,V;switch(K.overrideType||K.type){case"mousemove":V=32,K.buttons===void 0?(X=3,K.button!==void 0&&(X=K.button<3?K.button:3)):X=K.buttons&1?0:K.buttons&4?1:K.buttons&2?2:3;break;case"mouseup":V=0,X=K.button<3?K.button:3;break;case"mousedown":V=1,X=K.button<3?K.button:3;break;case"wheel":if($._customWheelEventHandler&&$._customWheelEventHandler(K)===!1)return!1;let z=K.deltaY;if(z===0||$.coreMouseService.consumeWheelEvent(K,$._renderService?.dimensions?.device?.cell?.height,$._coreBrowserService?.dpr)===0)return!1;V=z<0?0:1,X=4;break;default:return!1}return V===void 0||X===void 0||X>4?!1:$.coreMouseService.triggerMouseEvent({col:Q.col,row:Q.row,x:Q.x,y:Q.y,button:X,action:V,ctrl:K.ctrlKey,alt:K.altKey,shift:K.shiftKey})}let Z={mouseup:null,wheel:null,mousedrag:null,mousemove:null},j={mouseup:(K)=>(Y(K),K.buttons||(this._document.removeEventListener("mouseup",Z.mouseup),Z.mousedrag&&this._document.removeEventListener("mousemove",Z.mousedrag)),this.cancel(K)),wheel:(K)=>(Y(K),this.cancel(K,!0)),mousedrag:(K)=>{K.buttons&&Y(K)},mousemove:(K)=>{K.buttons||Y(K)}};this._register(this.coreMouseService.onProtocolChange((K)=>{K?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(K)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),K&8?Z.mousemove||(J.addEventListener("mousemove",j.mousemove),Z.mousemove=j.mousemove):(J.removeEventListener("mousemove",Z.mousemove),Z.mousemove=null),K&16?Z.wheel||(J.addEventListener("wheel",j.wheel,{passive:!1}),Z.wheel=j.wheel):(J.removeEventListener("wheel",Z.wheel),Z.wheel=null),K&2?Z.mouseup||(Z.mouseup=j.mouseup):(this._document.removeEventListener("mouseup",Z.mouseup),Z.mouseup=null),K&4?Z.mousedrag||(Z.mousedrag=j.mousedrag):(this._document.removeEventListener("mousemove",Z.mousedrag),Z.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this._register(p(J,"mousedown",(K)=>{if(K.preventDefault(),this.focus(),!(!this.coreMouseService.areMouseEventsActive||this._selectionService.shouldForceSelection(K)))return Y(K),Z.mouseup&&this._document.addEventListener("mouseup",Z.mouseup),Z.mousedrag&&this._document.addEventListener("mousemove",Z.mousedrag),this.cancel(K)})),this._register(p(J,"wheel",(K)=>{if(!Z.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(K)===!1)return!1;if(!this.buffer.hasScrollback){if(K.deltaY===0)return!1;if($.coreMouseService.consumeWheelEvent(K,$._renderService?.dimensions?.device?.cell?.height,$._coreBrowserService?.dpr)===0)return this.cancel(K,!0);let Q=D.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(K.deltaY<0?"A":"B");return this.coreService.triggerDataEvent(Q,!0),this.cancel(K,!0)}}},{passive:!1}))}refresh($,J){this._renderService?.refreshRows($,J)}updateCursorStyle($){this._selectionService?.shouldColumnSelect($)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines($,J){this._viewport?this._viewport.scrollLines($):super.scrollLines($,J),this.refresh(0,this.rows-1)}scrollPages($){this.scrollLines($*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom($){$&&this._viewport?this._viewport.scrollToLine(this.buffer.ybase,!0):this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine($){let J=$-this._bufferService.buffer.ydisp;J!==0&&this.scrollLines(J)}paste($){B4($,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler($){this._customKeyEventHandler=$}attachCustomWheelEventHandler($){this._customWheelEventHandler=$}registerLinkProvider($){return this._linkProviderService.registerLinkProvider($)}registerCharacterJoiner($){if(!this._characterJoinerService)throw Error("Terminal must be opened first");let J=this._characterJoinerService.register($);return this.refresh(0,this.rows-1),J}deregisterCharacterJoiner($){if(!this._characterJoinerService)throw Error("Terminal must be opened first");this._characterJoinerService.deregister($)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker($){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+$)}registerDecoration($){return this._decorationService.registerDecoration($)}hasSelection(){return this._selectionService?this._selectionService.hasSelection:!1}select($,J,Y){this._selectionService.setSelection($,J,Y)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(!(!this._selectionService||!this._selectionService.hasSelection))return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){this._selectionService?.clearSelection()}selectAll(){this._selectionService?.selectAll()}selectLines($,J){this._selectionService?.selectLines($,J)}_keyDown($){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler($)===!1)return!1;let J=this.browser.isMac&&this.options.macOptionIsMeta&&$.altKey;if(!J&&!this._compositionHelper.keydown($))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(!0),!1;!J&&($.key==="Dead"||$.key==="AltGraph")&&(this._unprocessedDeadKey=!0);let Y=BX($,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle($),Y.type===3||Y.type===2){let Z=this.rows-1;return this.scrollLines(Y.type===2?-Z:Z),this.cancel($,!0)}if(Y.type===1&&this.selectAll(),this._isThirdLevelShift(this.browser,$)||(Y.cancel&&this.cancel($,!0),!Y.key)||$.key&&!$.ctrlKey&&!$.altKey&&!$.metaKey&&$.key.length===1&&$.key.charCodeAt(0)>=65&&$.key.charCodeAt(0)<=90)return!0;if(this._unprocessedDeadKey)return this._unprocessedDeadKey=!1,!0;if((Y.key===D.ETX||Y.key===D.CR)&&(this.textarea.value=""),this._onKey.fire({key:Y.key,domEvent:$}),this._showCursor(),this.coreService.triggerDataEvent(Y.key,!0),!this.optionsService.rawOptions.screenReaderMode||$.altKey||$.ctrlKey)return this.cancel($,!0);this._keyDownHandled=!0}_isThirdLevelShift($,J){let Y=$.isMac&&!this.options.macOptionIsMeta&&J.altKey&&!J.ctrlKey&&!J.metaKey||$.isWindows&&J.altKey&&J.ctrlKey&&!J.metaKey||$.isWindows&&J.getModifierState("AltGraph");return J.type==="keypress"?Y:Y&&(!J.keyCode||J.keyCode>47)}_keyUp($){this._keyDownSeen=!1,!(this._customKeyEventHandler&&this._customKeyEventHandler($)===!1)&&(DX($)||this.focus(),this.updateCursorStyle($),this._keyPressHandled=!1)}_keyPress($){let J;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler($)===!1)return!1;if(this.cancel($),$.charCode)J=$.charCode;else if($.which===null||$.which===void 0)J=$.keyCode;else if($.which!==0&&$.charCode!==0)J=$.which;else return!1;return!J||($.altKey||$.ctrlKey||$.metaKey)&&!this._isThirdLevelShift(this.browser,$)?!1:(J=String.fromCharCode(J),this._onKey.fire({key:J,domEvent:$}),this._showCursor(),this.coreService.triggerDataEvent(J,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,!0)}_inputEvent($){if($.data&&$.inputType==="insertText"&&(!$.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let J=$.data;return this.coreService.triggerDataEvent(J,!0),this.cancel($),!0}return!1}resize($,J){if($===this.cols&&J===this.rows){this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure();return}super.resize($,J)}_afterResize($,J){this._charSizeService?.measure()}clear(){if(!(this.buffer.ybase===0&&this.buffer.y===0)){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let $=1;$<this.rows;$++)this.buffer.lines.push(this.buffer.getBlankLine(x0));this._onScroll.fire({position:this.buffer.ydisp}),this.refresh(0,this.rows-1)}}reset(){this.options.rows=this.rows,this.options.cols=this.cols;let $=this._customKeyEventHandler;this._setup(),super.reset(),this._selectionService?.reset(),this._decorationService.reset(),this._customKeyEventHandler=$,this.refresh(0,this.rows-1)}clearTextureAtlas(){this._renderService?.clearTextureAtlas()}_reportFocus(){this.element?.classList.contains("focus")?this.coreService.triggerDataEvent(D.ESC+"[I"):this.coreService.triggerDataEvent(D.ESC+"[O")}_reportWindowsOptions($){if(this._renderService)switch($){case 0:let J=this._renderService.dimensions.css.canvas.width.toFixed(0),Y=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${D.ESC}[4;${Y};${J}t`);break;case 1:let Z=this._renderService.dimensions.css.cell.width.toFixed(0),j=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${D.ESC}[6;${j};${Z}t`);break}}cancel($,J){if(!(!this.options.cancelEvents&&!J))return $.preventDefault(),$.stopPropagation(),!1}};function DX($){return $.keyCode===16||$.keyCode===17||$.keyCode===18}var _X=class{constructor(){this._addons=[]}dispose(){for(let $=this._addons.length-1;$>=0;$--)this._addons[$].instance.dispose()}loadAddon($,J){let Y={instance:J,dispose:J.dispose,isDisposed:!1};this._addons.push(Y),J.dispose=()=>this._wrappedAddonDispose(Y),J.activate($)}_wrappedAddonDispose($){if($.isDisposed)return;let J=-1;for(let Y=0;Y<this._addons.length;Y++)if(this._addons[Y]===$){J=Y;break}if(J===-1)throw Error("Could not dispose an addon that has not been loaded");$.isDisposed=!0,$.dispose.apply($.instance),this._addons.splice(J,1)}},MX=class{constructor($){this._line=$}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell($,J){if(!($<0||$>=this._line.length))return J?(this._line.loadCell($,J),J):this._line.loadCell($,new I8)}translateToString($,J,Y){return this._line.translateToString($,J,Y)}},U4=class{constructor($,J){this._buffer=$,this.type=J}init($){return this._buffer=$,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine($){let J=this._buffer.lines.get($);if(J)return new MX(J)}getNullCell(){return new I8}},yX=class extends d{constructor($){super();this._core=$,this._onBufferChange=this._register(new L),this.onBufferChange=this._onBufferChange.event,this._normal=new U4(this._core.buffers.normal,"normal"),this._alternate=new U4(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}},wX=class{constructor($){this._core=$}registerCsiHandler($,J){return this._core.registerCsiHandler($,(Y)=>J(Y.toArray()))}addCsiHandler($,J){return this.registerCsiHandler($,J)}registerDcsHandler($,J){return this._core.registerDcsHandler($,(Y,Z)=>J(Y,Z.toArray()))}addDcsHandler($,J){return this.registerDcsHandler($,J)}registerEscHandler($,J){return this._core.registerEscHandler($,J)}addEscHandler($,J){return this.registerEscHandler($,J)}registerOscHandler($,J){return this._core.registerOscHandler($,J)}addOscHandler($,J){return this.registerOscHandler($,J)}},LX=class{constructor($){this._core=$}register($){this._core.unicodeService.register($)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion($){this._core.unicodeService.activeVersion=$}},EX=["cols","rows"],M8=0,$J=class extends d{constructor($){super(),this._core=this._register(new RX($)),this._addonManager=this._register(new _X),this._publicOptions={...this._core.options};let J=(Z)=>this._core.options[Z],Y=(Z,j)=>{this._checkReadonlyOptions(Z),this._core.options[Z]=j};for(let Z in this._core.options){let j={get:J.bind(this,Z),set:Y.bind(this,Z)};Object.defineProperty(this._publicOptions,Z,j)}}_checkReadonlyOptions($){if(EX.includes($))throw Error(`Option "${$}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new wX(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new LX(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this._register(new yX(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let $=this._core.coreService.decPrivateModes,J="none";switch(this._core.coreMouseService.activeProtocol){case"X10":J="x10";break;case"VT200":J="vt200";break;case"DRAG":J="drag";break;case"ANY":J="any";break}return{applicationCursorKeysMode:$.applicationCursorKeys,applicationKeypadMode:$.applicationKeypad,bracketedPasteMode:$.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:J,originMode:$.origin,reverseWraparoundMode:$.reverseWraparound,sendFocusMode:$.sendFocus,synchronizedOutputMode:$.synchronizedOutput,wraparoundMode:$.wraparound}}get options(){return this._publicOptions}set options($){for(let J in $)this._publicOptions[J]=$[J]}blur(){this._core.blur()}focus(){this._core.focus()}input($,J=!0){this._core.input($,J)}resize($,J){this._verifyIntegers($,J),this._core.resize($,J)}open($){this._core.open($)}attachCustomKeyEventHandler($){this._core.attachCustomKeyEventHandler($)}attachCustomWheelEventHandler($){this._core.attachCustomWheelEventHandler($)}registerLinkProvider($){return this._core.registerLinkProvider($)}registerCharacterJoiner($){return this._checkProposedApi(),this._core.registerCharacterJoiner($)}deregisterCharacterJoiner($){this._checkProposedApi(),this._core.deregisterCharacterJoiner($)}registerMarker($=0){return this._verifyIntegers($),this._core.registerMarker($)}registerDecoration($){return this._checkProposedApi(),this._verifyPositiveIntegers($.x??0,$.width??0,$.height??0),this._core.registerDecoration($)}hasSelection(){return this._core.hasSelection()}select($,J,Y){this._verifyIntegers($,J,Y),this._core.select($,J,Y)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines($,J){this._verifyIntegers($,J),this._core.selectLines($,J)}dispose(){super.dispose()}scrollLines($){this._verifyIntegers($),this._core.scrollLines($)}scrollPages($){this._verifyIntegers($),this._core.scrollPages($)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine($){this._verifyIntegers($),this._core.scrollToLine($)}clear(){this._core.clear()}write($,J){this._core.write($,J)}writeln($,J){this._core.write($),this._core.write(`\r
`,J)}paste($){this._core.paste($)}refresh($,J){this._verifyIntegers($,J),this._core.refresh($,J)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon($){this._addonManager.loadAddon(this,$)}static get strings(){return{get promptLabel(){return o1.get()},set promptLabel($){o1.set($)},get tooMuchOutput(){return n1.get()},set tooMuchOutput($){n1.set($)}}}_verifyIntegers(...$){for(M8 of $)if(M8===1/0||isNaN(M8)||M8%1!==0)throw Error("This API only accepts integers")}_verifyPositiveIntegers(...$){for(M8 of $)if(M8&&(M8===1/0||isNaN(M8)||M8%1!==0||M8<0))throw Error("This API only accepts positive integers")}};var PX=2,AX=1,JJ=class{activate($){this._terminal=$}dispose(){}fit(){let $=this.proposeDimensions();if(!$||!this._terminal||isNaN($.cols)||isNaN($.rows))return;let J=this._terminal._core;(this._terminal.rows!==$.rows||this._terminal.cols!==$.cols)&&(J._renderService.clear(),this._terminal.resize($.cols,$.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let $=this._terminal._core._renderService.dimensions;if($.css.cell.width===0||$.css.cell.height===0)return;let J=this._terminal.options.scrollback===0?0:this._terminal.options.overviewRuler?.width||14,Y=window.getComputedStyle(this._terminal.element.parentElement),Z=parseInt(Y.getPropertyValue("height")),j=Math.max(0,parseInt(Y.getPropertyValue("width"))),K=window.getComputedStyle(this._terminal.element),Q={top:parseInt(K.getPropertyValue("padding-top")),bottom:parseInt(K.getPropertyValue("padding-bottom")),right:parseInt(K.getPropertyValue("padding-right")),left:parseInt(K.getPropertyValue("padding-left"))},X=Q.top+Q.bottom,V=Q.right+Q.left,z=Z-X,G=j-V-J;return{cols:Math.max(PX,Math.floor(G/$.css.cell.width)),rows:Math.max(AX,Math.floor(z/$.css.cell.height))}}};var fX=class{constructor($,J,Y,Z={}){this._terminal=$,this._regex=J,this._handler=Y,this._options=Z}provideLinks($,J){let Y=kX.computeLink($,this._regex,this._terminal,this._handler);J(this._addCallbacks(Y))}_addCallbacks($){return $.map((J)=>(J.leave=this._options.leave,J.hover=(Y,Z)=>{if(this._options.hover){let{range:j}=J;this._options.hover(Y,Z,j)}},J))}};function TX($){try{let J=new URL($),Y=J.password&&J.username?`${J.protocol}//${J.username}:${J.password}@${J.host}`:J.username?`${J.protocol}//${J.username}@${J.host}`:`${J.protocol}//${J.host}`;return $.toLocaleLowerCase().startsWith(Y.toLocaleLowerCase())}catch{return!1}}var kX=class ${static computeLink(J,Y,Z,j){let K=new RegExp(Y.source,(Y.flags||"")+"g"),[Q,X]=$._getWindowedLineStrings(J-1,Z),V=Q.join(""),z,G=[];for(;z=K.exec(V);){let W=z[0];if(!TX(W))continue;let[q,H]=$._mapStrIdx(Z,X,0,z.index),[U,O]=$._mapStrIdx(Z,q,H,W.length);if(q===-1||H===-1||U===-1||O===-1)continue;let M={start:{x:H+1,y:q+1},end:{x:O,y:U+1}};G.push({range:M,text:W,activate:j})}return G}static _getWindowedLineStrings(J,Y){let Z,j=J,K=J,Q=0,X="",V=[];if(Z=Y.buffer.active.getLine(J)){let z=Z.translateToString(!0);if(Z.isWrapped&&z[0]!==" "){for(Q=0;(Z=Y.buffer.active.getLine(--j))&&Q<2048&&(X=Z.translateToString(!0),Q+=X.length,V.push(X),!(!Z.isWrapped||X.indexOf(" ")!==-1)););V.reverse()}for(V.push(z),Q=0;(Z=Y.buffer.active.getLine(++K))&&Z.isWrapped&&Q<2048&&(X=Z.translateToString(!0),Q+=X.length,V.push(X),X.indexOf(" ")===-1););}return[V,j]}static _mapStrIdx(J,Y,Z,j){let K=J.buffer.active,Q=K.getNullCell(),X=Z;for(;j;){let V=K.getLine(Y);if(!V)return[-1,-1];for(let z=X;z<V.length;++z){V.getCell(z,Q);let G=Q.getChars();if(Q.getWidth()&&(j-=G.length||1,z===V.length-1&&G==="")){let W=K.getLine(Y+1);W&&W.isWrapped&&(W.getCell(0,Q),Q.getWidth()===2&&(j+=1))}if(j<0)return[Y,z]}Y++,X=0}return[Y,X]}},SX=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function mX($,J){let Y=window.open();if(Y){try{Y.opener=null}catch{}Y.location.href=J}else console.warn("Opening link blocked as opener could not be cleared")}var YJ=class{constructor($=mX,J={}){this._handler=$,this._options=J}activate($){this._terminal=$;let J=this._options,Y=J.urlRegex||SX;this._linkProvider=this._terminal.registerLinkProvider(new fX(this._terminal,Y,this._handler,J))}dispose(){this._linkProvider?.dispose()}};var{defineProperty:CX,getOwnPropertyDescriptor:gX}=Object,hX=($,J,Y,Z)=>{for(var j=Z>1?void 0:Z?gX(J,Y):J,K=$.length-1,Q;K>=0;K--)(Q=$[K])&&(j=(Z?Q(J,Y,j):Q(j))||j);return Z&&j&&CX(J,Y,j),j},pX=($,J)=>(Y,Z)=>J(Y,Z,$),uX=class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function($){setTimeout(()=>{throw $.stack?ZJ.isErrorNoTelemetry($)?new ZJ($.message+`

`+$.stack):Error($.message+`

`+$.stack):$},0)}}addListener($){return this.listeners.push($),()=>{this._removeListener($)}}emit($){this.listeners.forEach((J)=>{J($)})}_removeListener($){this.listeners.splice(this.listeners.indexOf($),1)}setUnexpectedErrorHandler($){this.unexpectedErrorHandler=$}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError($){this.unexpectedErrorHandler($),this.emit($)}onUnexpectedExternalError($){this.unexpectedErrorHandler($)}},dX=new uX;function L6($){cX($)||dX.onUnexpectedError($)}var o5="Canceled";function cX($){return $ instanceof lX?!0:$ instanceof Error&&$.name===o5&&$.message===o5}var lX=class extends Error{constructor(){super(o5),this.name=this.message}},ZJ=class $ extends Error{constructor(J){super(J),this.name="CodeExpectedError"}static fromError(J){if(J instanceof $)return J;let Y=new $;return Y.message=J.message,Y.stack=J.stack,Y}static isErrorNoTelemetry(J){return J.name==="CodeExpectedError"}};function sX($,J,Y=0,Z=$.length){let j=Y,K=Z;for(;j<K;){let Q=Math.floor((j+K)/2);J($[Q])?j=Q+1:K=Q}return j-1}var aX=class ${constructor(J){this._array=J,this._findLastMonotonousLastIdx=0}findLastMonotonous(J){if($.assertInvariants){if(this._prevFindLastPredicate){for(let Z of this._array)if(this._prevFindLastPredicate(Z)&&!J(Z))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=J}let Y=sX(this._array,J,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=Y+1,Y===-1?void 0:this._array[Y]}};aX.assertInvariants=!1;var hJ;(($)=>{function J(K){return K<0}$.isLessThan=J;function Y(K){return K<=0}$.isLessThanOrEqual=Y;function Z(K){return K>0}$.isGreaterThan=Z;function j(K){return K===0}$.isNeitherLessOrGreaterThan=j,$.greaterThan=1,$.lessThan=-1,$.neitherLessOrGreaterThan=0})(hJ||={});function oX($,J){return(Y,Z)=>J($(Y),$(Z))}var nX=($,J)=>$-J,jJ=class ${constructor(J){this.iterate=J}forEach(J){this.iterate((Y)=>(J(Y),!0))}toArray(){let J=[];return this.iterate((Y)=>(J.push(Y),!0)),J}filter(J){return new $((Y)=>this.iterate((Z)=>J(Z)?Y(Z):!0))}map(J){return new $((Y)=>this.iterate((Z)=>Y(J(Z))))}some(J){let Y=!1;return this.iterate((Z)=>(Y=J(Z),!Y)),Y}findFirst(J){let Y;return this.iterate((Z)=>J(Z)?(Y=Z,!1):!0),Y}findLast(J){let Y;return this.iterate((Z)=>(J(Z)&&(Y=Z),!0)),Y}findLastMaxBy(J){let Y,Z=!0;return this.iterate((j)=>((Z||hJ.isGreaterThan(J(j,Y)))&&(Z=!1,Y=j),!0)),Y}};jJ.empty=new jJ(($)=>{});function iX($,J){let Y=Object.create(null);for(let Z of $){let j=J(Z),K=Y[j];K||(K=Y[j]=[]),K.push(Z)}return Y}var KJ,QJ,Oq=class{constructor($,J){this.toKey=J,this._map=new Map,this[KJ]="SetWithKey";for(let Y of $)this.add(Y)}get size(){return this._map.size}add($){let J=this.toKey($);return this._map.set(J,$),this}delete($){return this._map.delete(this.toKey($))}has($){return this._map.has(this.toKey($))}*entries(){for(let $ of this._map.values())yield[$,$]}keys(){return this.values()}*values(){for(let $ of this._map.values())yield $}clear(){this._map.clear()}forEach($,J){this._map.forEach((Y)=>$.call(J,Y,Y,this))}[(QJ=Symbol.iterator,KJ=Symbol.toStringTag,QJ)](){return this.values()}},rX=class{constructor(){this.map=new Map}add($,J){let Y=this.map.get($);Y||(Y=new Set,this.map.set($,Y)),Y.add(J)}delete($,J){let Y=this.map.get($);Y&&(Y.delete(J),Y.size===0&&this.map.delete($))}forEach($,J){let Y=this.map.get($);Y&&Y.forEach(J)}get($){return this.map.get($)||new Set}};function tX($,J){let Y=this,Z=!1,j;return function(){if(Z)return j;if(Z=!0,J)try{j=$.apply(Y,arguments)}finally{J()}else j=$.apply(Y,arguments);return j}}var pJ;(($)=>{function J(b){return b&&typeof b=="object"&&typeof b[Symbol.iterator]=="function"}$.is=J;let Y=Object.freeze([]);function Z(){return Y}$.empty=Z;function*j(b){yield b}$.single=j;function K(b){return J(b)?b:j(b)}$.wrap=K;function Q(b){return b||Y}$.from=Q;function*X(b){for(let P=b.length-1;P>=0;P--)yield b[P]}$.reverse=X;function V(b){return!b||b[Symbol.iterator]().next().done===!0}$.isEmpty=V;function z(b){return b[Symbol.iterator]().next().value}$.first=z;function G(b,P){let f=0;for(let u of b)if(P(u,f++))return!0;return!1}$.some=G;function W(b,P){for(let f of b)if(P(f))return f}$.find=W;function*q(b,P){for(let f of b)P(f)&&(yield f)}$.filter=q;function*H(b,P){let f=0;for(let u of b)yield P(u,f++)}$.map=H;function*U(b,P){let f=0;for(let u of b)yield*P(u,f++)}$.flatMap=U;function*O(...b){for(let P of b)yield*P}$.concat=O;function M(b,P,f){let u=f;for(let $0 of b)u=P(u,$0);return u}$.reduce=M;function*A(b,P,f=b.length){for(P<0&&(P+=b.length),f<0?f+=b.length:f>b.length&&(f=b.length);P<f;P++)yield b[P]}$.slice=A;function m(b,P=Number.POSITIVE_INFINITY){let f=[];if(P===0)return[f,b];let u=b[Symbol.iterator]();for(let $0=0;$0<P;$0++){let G0=u.next();if(G0.done)return[f,$.empty()];f.push(G0.value)}return[f,{[Symbol.iterator](){return u}}]}$.consume=m;async function E(b){let P=[];for await(let f of b)P.push(f);return Promise.resolve(P)}$.asyncToArray=E})(pJ||={});var eX=!1,p9=null,$z=class ${constructor(){this.livingDisposables=new Map}getDisposableData(J){let Y=this.livingDisposables.get(J);return Y||(Y={parent:null,source:null,isSingleton:!1,value:J,idx:$.idx++},this.livingDisposables.set(J,Y)),Y}trackDisposable(J){let Y=this.getDisposableData(J);Y.source||(Y.source=Error().stack)}setParent(J,Y){let Z=this.getDisposableData(J);Z.parent=Y}markAsDisposed(J){this.livingDisposables.delete(J)}markAsSingleton(J){this.getDisposableData(J).isSingleton=!0}getRootParent(J,Y){let Z=Y.get(J);if(Z)return Z;let j=J.parent?this.getRootParent(this.getDisposableData(J.parent),Y):J;return Y.set(J,j),j}getTrackedDisposables(){let J=new Map;return[...this.livingDisposables.entries()].filter(([,Y])=>Y.source!==null&&!this.getRootParent(Y,J).isSingleton).flatMap(([Y])=>Y)}computeLeakingDisposables(J=10,Y){let Z;if(Y)Z=Y;else{let V=new Map,z=[...this.livingDisposables.values()].filter((W)=>W.source!==null&&!this.getRootParent(W,V).isSingleton);if(z.length===0)return;let G=new Set(z.map((W)=>W.value));if(Z=z.filter((W)=>!(W.parent&&G.has(W.parent))),Z.length===0)throw Error("There are cyclic diposable chains!")}if(!Z)return;function j(V){function z(W,q){for(;W.length>0&&q.some((H)=>typeof H=="string"?H===W[0]:W[0].match(H));)W.shift()}let G=V.source.split(`
`).map((W)=>W.trim().replace("at ","")).filter((W)=>W!=="");return z(G,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),G.reverse()}let K=new rX;for(let V of Z){let z=j(V);for(let G=0;G<=z.length;G++)K.add(z.slice(0,G).join(`
`),V)}Z.sort(oX((V)=>V.idx,nX));let Q="",X=0;for(let V of Z.slice(0,J)){X++;let z=j(V),G=[];for(let W=0;W<z.length;W++){let q=z[W];q=`(shared with ${K.get(z.slice(0,W+1).join(`
`)).size}/${Z.length} leaks) at ${q}`;let H=K.get(z.slice(0,W).join(`
`)),U=iX([...H].map((O)=>j(O)[W]),(O)=>O);delete U[z[W]];for(let[O,M]of Object.entries(U))G.unshift(`    - stacktraces of ${M.length} other leaks continue with ${O}`);G.unshift(q)}Q+=`


==================== Leaking disposable ${X}/${Z.length}: ${V.value.constructor.name} ====================
${G.join(`
`)}
============================================================

`}return Z.length>J&&(Q+=`


... and ${Z.length-J} more leaking disposables

`),{leaks:Z,details:Q}}};$z.idx=0;function Jz($){p9=$}if(eX){let $="__is_disposable_tracked__";Jz(new class{trackDisposable(J){let Y=Error("Potentially leaked disposable").stack;setTimeout(()=>{J[$]||console.log(Y)},3000)}setParent(J,Y){if(J&&J!==G8.None)try{J[$]=!0}catch{}}markAsDisposed(J){if(J&&J!==G8.None)try{J[$]=!0}catch{}}markAsSingleton(J){}})}function C6($){return p9?.trackDisposable($),$}function g6($){p9?.markAsDisposed($)}function E7($,J){p9?.setParent($,J)}function Yz($,J){if(p9)for(let Y of $)p9.setParent(Y,J)}function uJ($){if(pJ.is($)){let J=[];for(let Y of $)if(Y)try{Y.dispose()}catch(Z){J.push(Z)}if(J.length===1)throw J[0];if(J.length>1)throw AggregateError(J,"Encountered errors while disposing of store");return Array.isArray($)?[]:$}else if($)return $.dispose(),$}function dJ(...$){let J=p0(()=>uJ($));return Yz($,J),J}function p0($){let J=C6({dispose:tX(()=>{g6(J),$()})});return J}var cJ=class ${constructor(){this._toDispose=new Set,this._isDisposed=!1,C6(this)}dispose(){this._isDisposed||(g6(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{uJ(this._toDispose)}finally{this._toDispose.clear()}}add(J){if(!J)return J;if(J===this)throw Error("Cannot register a disposable on itself!");return E7(J,this),this._isDisposed?$.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(J),J}delete(J){if(J){if(J===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(J),J.dispose()}}deleteAndLeak(J){J&&this._toDispose.has(J)&&(this._toDispose.delete(J),E7(J,null))}};cJ.DISABLE_DISPOSED_WARNING=!1;var h9=cJ,G8=class{constructor(){this._store=new h9,C6(this),E7(this._store,this)}dispose(){g6(this),this._store.dispose()}_register($){if($===this)throw Error("Cannot register a disposable on itself!");return this._store.add($)}};G8.None=Object.freeze({dispose(){}});var D7=class{constructor(){this._isDisposed=!1,C6(this)}get value(){return this._isDisposed?void 0:this._value}set value($){this._isDisposed||$===this._value||(this._value?.dispose(),$&&E7($,this),this._value=$)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,g6(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let $=this._value;return this._value=void 0,$&&E7($,null),$}},J2=typeof process<"u"&&"title"in process,A7=J2?"node":navigator.userAgent,Y2=J2?"node":navigator.platform,Zz=A7.includes("Firefox"),jz=A7.includes("Edge"),lJ=/^((?!chrome|android).)*safari/i.test(A7);function Kz(){if(!lJ)return 0;let $=A7.match(/Version\/(\d+)/);return $===null||$.length<2?0:parseInt($[1])}var Fq=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(Y2),Nq=["Windows","Win16","Win32","WinCE"].includes(Y2),xq=Y2.indexOf("Linux")>=0,bq=/\bCrOS\b/.test(A7),Qz="",T0=0,k0=0,S0=0,B0=0,B8={css:"#00000000",rgba:0},e0;(($)=>{function J(j,K,Q,X){return X!==void 0?`#${D9(j)}${D9(K)}${D9(Q)}${D9(X)}`:`#${D9(j)}${D9(K)}${D9(Q)}`}$.toCss=J;function Y(j,K,Q,X=255){return(j<<24|K<<16|Q<<8|X)>>>0}$.toRgba=Y;function Z(j,K,Q,X){return{css:$.toCss(j,K,Q,X),rgba:$.toRgba(j,K,Q,X)}}$.toColor=Z})(e0||={});var L7;(($)=>{function J(V,z){if(B0=(z.rgba&255)/255,B0===1)return{css:z.css,rgba:z.rgba};let G=z.rgba>>24&255,W=z.rgba>>16&255,q=z.rgba>>8&255,H=V.rgba>>24&255,U=V.rgba>>16&255,O=V.rgba>>8&255;T0=H+Math.round((G-H)*B0),k0=U+Math.round((W-U)*B0),S0=O+Math.round((q-O)*B0);let M=e0.toCss(T0,k0,S0),A=e0.toRgba(T0,k0,S0);return{css:M,rgba:A}}$.blend=J;function Y(V){return(V.rgba&255)===255}$.isOpaque=Y;function Z(V,z,G){let W=_9.ensureContrastRatio(V.rgba,z.rgba,G);if(W)return e0.toColor(W>>24&255,W>>16&255,W>>8&255)}$.ensureContrastRatio=Z;function j(V){let z=(V.rgba|255)>>>0;return[T0,k0,S0]=_9.toChannels(z),{css:e0.toCss(T0,k0,S0),rgba:z}}$.opaque=j;function K(V,z){return B0=Math.round(z*255),[T0,k0,S0]=_9.toChannels(V.rgba),{css:e0.toCss(T0,k0,S0,B0),rgba:e0.toRgba(T0,k0,S0,B0)}}$.opacity=K;function Q(V,z){return B0=V.rgba&255,K(V,B0*z/255)}$.multiplyOpacity=Q;function X(V){return[V.rgba>>24&255,V.rgba>>16&255,V.rgba>>8&255]}$.toColorRGB=X})(L7||={});var Xz;(($)=>{let J,Y;try{let j=document.createElement("canvas");j.width=1,j.height=1;let K=j.getContext("2d",{willReadFrequently:!0});K&&(J=K,J.globalCompositeOperation="copy",Y=J.createLinearGradient(0,0,1,1))}catch{}function Z(j){if(j.match(/#[\da-f]{3,8}/i))switch(j.length){case 4:return T0=parseInt(j.slice(1,2).repeat(2),16),k0=parseInt(j.slice(2,3).repeat(2),16),S0=parseInt(j.slice(3,4).repeat(2),16),e0.toColor(T0,k0,S0);case 5:return T0=parseInt(j.slice(1,2).repeat(2),16),k0=parseInt(j.slice(2,3).repeat(2),16),S0=parseInt(j.slice(3,4).repeat(2),16),B0=parseInt(j.slice(4,5).repeat(2),16),e0.toColor(T0,k0,S0,B0);case 7:return{css:j,rgba:(parseInt(j.slice(1),16)<<8|255)>>>0};case 9:return{css:j,rgba:parseInt(j.slice(1),16)>>>0}}let K=j.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(K)return T0=parseInt(K[1]),k0=parseInt(K[2]),S0=parseInt(K[3]),B0=Math.round((K[5]===void 0?1:parseFloat(K[5]))*255),e0.toColor(T0,k0,S0,B0);if(!J||!Y)throw Error("css.toColor: Unsupported css format");if(J.fillStyle=Y,J.fillStyle=j,typeof J.fillStyle!="string")throw Error("css.toColor: Unsupported css format");if(J.fillRect(0,0,1,1),[T0,k0,S0,B0]=J.getImageData(0,0,1,1).data,B0!==255)throw Error("css.toColor: Unsupported css format");return{rgba:e0.toRgba(T0,k0,S0,B0),css:j}}$.toColor=Z})(Xz||={});var t0;(($)=>{function J(Z){return Y(Z>>16&255,Z>>8&255,Z&255)}$.relativeLuminance=J;function Y(Z,j,K){let Q=Z/255,X=j/255,V=K/255,z=Q<=0.03928?Q/12.92:Math.pow((Q+0.055)/1.055,2.4),G=X<=0.03928?X/12.92:Math.pow((X+0.055)/1.055,2.4),W=V<=0.03928?V/12.92:Math.pow((V+0.055)/1.055,2.4);return z*0.2126+G*0.7152+W*0.0722}$.relativeLuminance2=Y})(t0||={});var _9;(($)=>{function J(Q,X){if(B0=(X&255)/255,B0===1)return X;let V=X>>24&255,z=X>>16&255,G=X>>8&255,W=Q>>24&255,q=Q>>16&255,H=Q>>8&255;return T0=W+Math.round((V-W)*B0),k0=q+Math.round((z-q)*B0),S0=H+Math.round((G-H)*B0),e0.toRgba(T0,k0,S0)}$.blend=J;function Y(Q,X,V){let z=t0.relativeLuminance(Q>>8),G=t0.relativeLuminance(X>>8);if(s8(z,G)<V){if(G<z){let H=Z(Q,X,V),U=s8(z,t0.relativeLuminance(H>>8));if(U<V){let O=j(Q,X,V),M=s8(z,t0.relativeLuminance(O>>8));return U>M?H:O}return H}let W=j(Q,X,V),q=s8(z,t0.relativeLuminance(W>>8));if(q<V){let H=Z(Q,X,V),U=s8(z,t0.relativeLuminance(H>>8));return q>U?W:H}return W}}$.ensureContrastRatio=Y;function Z(Q,X,V){let z=Q>>24&255,G=Q>>16&255,W=Q>>8&255,q=X>>24&255,H=X>>16&255,U=X>>8&255,O=s8(t0.relativeLuminance2(q,H,U),t0.relativeLuminance2(z,G,W));for(;O<V&&(q>0||H>0||U>0);)q-=Math.max(0,Math.ceil(q*0.1)),H-=Math.max(0,Math.ceil(H*0.1)),U-=Math.max(0,Math.ceil(U*0.1)),O=s8(t0.relativeLuminance2(q,H,U),t0.relativeLuminance2(z,G,W));return(q<<24|H<<16|U<<8|255)>>>0}$.reduceLuminance=Z;function j(Q,X,V){let z=Q>>24&255,G=Q>>16&255,W=Q>>8&255,q=X>>24&255,H=X>>16&255,U=X>>8&255,O=s8(t0.relativeLuminance2(q,H,U),t0.relativeLuminance2(z,G,W));for(;O<V&&(q<255||H<255||U<255);)q=Math.min(255,q+Math.ceil((255-q)*0.1)),H=Math.min(255,H+Math.ceil((255-H)*0.1)),U=Math.min(255,U+Math.ceil((255-U)*0.1)),O=s8(t0.relativeLuminance2(q,H,U),t0.relativeLuminance2(z,G,W));return(q<<24|H<<16|U<<8|255)>>>0}$.increaseLuminance=j;function K(Q){return[Q>>24&255,Q>>16&255,Q>>8&255,Q&255]}$.toChannels=K})(_9||={});function D9($){let J=$.toString(16);return J.length<2?"0"+J:J}function s8($,J){return $<J?(J+0.05)/($+0.05):($+0.05)/(J+0.05)}function R0($){if(!$)throw Error("value must not be falsy");return $}function Z2($){return 57508<=$&&$<=57558}function zz($){return 57520<=$&&$<=57527}function Vz($){return 57344<=$&&$<=63743}function Gz($){return 9472<=$&&$<=9631}function Wz($){return $>=128512&&$<=128591||$>=127744&&$<=128511||$>=128640&&$<=128767||$>=9728&&$<=9983||$>=9984&&$<=10175||$>=65024&&$<=65039||$>=129280&&$<=129535||$>=127462&&$<=127487}function qz($,J,Y,Z){return J===1&&Y>Math.ceil(Z*1.5)&&$!==void 0&&$>255&&!Wz($)&&!Z2($)&&!Vz($)}function sJ($){return Z2($)||Gz($)}function Hz(){return{css:{canvas:_6(),cell:_6()},device:{canvas:_6(),cell:_6(),char:{width:0,height:0,left:0,top:0}}}}function _6(){return{width:0,height:0}}function Uz($,J,Y=0){return($-(Math.round(J)*2-Y))%(Math.round(J)*2)}var h0=0,f0=0,E8=!1,a8=!1,M6=!1,Y8,T5=0,Iz=class{constructor($,J,Y,Z,j,K){this._terminal=$,this._optionService=J,this._selectionRenderModel=Y,this._decorationService=Z,this._coreBrowserService=j,this._themeService=K,this.result={fg:0,bg:0,ext:0}}resolve($,J,Y,Z){if(this.result.bg=$.bg,this.result.fg=$.fg,this.result.ext=$.bg&268435456?$.extended.ext:0,f0=0,h0=0,a8=!1,E8=!1,M6=!1,Y8=this._themeService.colors,T5=0,$.getCode()!==0&&$.extended.underlineStyle===4){let j=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));T5=J*Z%(Math.round(j)*2)}if(this._decorationService.forEachDecorationAtCell(J,Y,"bottom",(j)=>{j.backgroundColorRGB&&(f0=j.backgroundColorRGB.rgba>>8&16777215,a8=!0),j.foregroundColorRGB&&(h0=j.foregroundColorRGB.rgba>>8&16777215,E8=!0)}),M6=this._selectionRenderModel.isCellSelected(this._terminal,J,Y),M6){if(this.result.fg&67108864||(this.result.bg&50331648)!==0){if(this.result.fg&67108864)switch(this.result.fg&50331648){case 16777216:case 33554432:f0=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:f0=(this.result.fg&16777215)<<8|255;break;case 0:default:f0=this._themeService.colors.foreground.rgba}else switch(this.result.bg&50331648){case 16777216:case 33554432:f0=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:f0=(this.result.bg&16777215)<<8|255;break}f0=_9.blend(f0,(this._coreBrowserService.isFocused?Y8.selectionBackgroundOpaque:Y8.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}else f0=(this._coreBrowserService.isFocused?Y8.selectionBackgroundOpaque:Y8.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(a8=!0,Y8.selectionForeground&&(h0=Y8.selectionForeground.rgba>>8&16777215,E8=!0),sJ($.getCode())){if(this.result.fg&67108864&&(this.result.bg&50331648)===0)h0=(this._coreBrowserService.isFocused?Y8.selectionBackgroundOpaque:Y8.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(this.result.fg&67108864)switch(this.result.bg&50331648){case 16777216:case 33554432:h0=this._themeService.colors.ansi[this.result.bg&255].rgba;break;case 50331648:h0=(this.result.bg&16777215)<<8|255;break}else switch(this.result.fg&50331648){case 16777216:case 33554432:h0=this._themeService.colors.ansi[this.result.fg&255].rgba;break;case 50331648:h0=(this.result.fg&16777215)<<8|255;break;case 0:default:h0=this._themeService.colors.foreground.rgba}h0=_9.blend(h0,(this._coreBrowserService.isFocused?Y8.selectionBackgroundOpaque:Y8.selectionInactiveBackgroundOpaque).rgba&4294967040|128)>>8&16777215}E8=!0}}this._decorationService.forEachDecorationAtCell(J,Y,"top",(j)=>{j.backgroundColorRGB&&(f0=j.backgroundColorRGB.rgba>>8&16777215,a8=!0),j.foregroundColorRGB&&(h0=j.foregroundColorRGB.rgba>>8&16777215,E8=!0)}),a8&&(M6?f0=$.bg&-16777216&-134217729|f0|50331648:f0=$.bg&-16777216|f0|50331648),E8&&(h0=$.fg&-16777216&-67108865|h0|50331648),this.result.fg&67108864&&(a8&&!E8&&((this.result.bg&50331648)===0?h0=this.result.fg&-134217728|Y8.background.rgba>>8&16777215&16777215|50331648:h0=this.result.fg&-134217728|this.result.bg&67108863,E8=!0),!a8&&E8&&((this.result.fg&50331648)===0?f0=this.result.bg&-67108864|Y8.foreground.rgba>>8&16777215&16777215|50331648:f0=this.result.bg&-67108864|this.result.fg&67108863,a8=!0)),Y8=void 0,this.result.bg=a8?f0:this.result.bg,this.result.fg=E8?h0:this.result.fg,this.result.ext&=536870911,this.result.ext|=T5<<29&3758096384}},Bz=0.5,aJ=Zz||jz?"bottom":"ideographic",vz={"▀":[{x:0,y:0,w:8,h:4}],"▁":[{x:0,y:7,w:8,h:1}],"▂":[{x:0,y:6,w:8,h:2}],"▃":[{x:0,y:5,w:8,h:3}],"▄":[{x:0,y:4,w:8,h:4}],"▅":[{x:0,y:3,w:8,h:5}],"▆":[{x:0,y:2,w:8,h:6}],"▇":[{x:0,y:1,w:8,h:7}],"█":[{x:0,y:0,w:8,h:8}],"▉":[{x:0,y:0,w:7,h:8}],"▊":[{x:0,y:0,w:6,h:8}],"▋":[{x:0,y:0,w:5,h:8}],"▌":[{x:0,y:0,w:4,h:8}],"▍":[{x:0,y:0,w:3,h:8}],"▎":[{x:0,y:0,w:2,h:8}],"▏":[{x:0,y:0,w:1,h:8}],"▐":[{x:4,y:0,w:4,h:8}],"▔":[{x:0,y:0,w:8,h:1}],"▕":[{x:7,y:0,w:1,h:8}],"▖":[{x:0,y:4,w:4,h:4}],"▗":[{x:4,y:4,w:4,h:4}],"▘":[{x:0,y:0,w:4,h:4}],"▙":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"▚":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"▛":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"▜":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"▝":[{x:4,y:0,w:4,h:4}],"▞":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"▟":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\uD83E\uDF70":[{x:1,y:0,w:1,h:8}],"\uD83E\uDF71":[{x:2,y:0,w:1,h:8}],"\uD83E\uDF72":[{x:3,y:0,w:1,h:8}],"\uD83E\uDF73":[{x:4,y:0,w:1,h:8}],"\uD83E\uDF74":[{x:5,y:0,w:1,h:8}],"\uD83E\uDF75":[{x:6,y:0,w:1,h:8}],"\uD83E\uDF76":[{x:0,y:1,w:8,h:1}],"\uD83E\uDF77":[{x:0,y:2,w:8,h:1}],"\uD83E\uDF78":[{x:0,y:3,w:8,h:1}],"\uD83E\uDF79":[{x:0,y:4,w:8,h:1}],"\uD83E\uDF7A":[{x:0,y:5,w:8,h:1}],"\uD83E\uDF7B":[{x:0,y:6,w:8,h:1}],"\uD83E\uDF7C":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF7D":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7E":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\uD83E\uDF7F":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\uD83E\uDF80":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF81":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\uD83E\uDF82":[{x:0,y:0,w:8,h:2}],"\uD83E\uDF83":[{x:0,y:0,w:8,h:3}],"\uD83E\uDF84":[{x:0,y:0,w:8,h:5}],"\uD83E\uDF85":[{x:0,y:0,w:8,h:6}],"\uD83E\uDF86":[{x:0,y:0,w:8,h:7}],"\uD83E\uDF87":[{x:6,y:0,w:2,h:8}],"\uD83E\uDF88":[{x:5,y:0,w:3,h:8}],"\uD83E\uDF89":[{x:3,y:0,w:5,h:8}],"\uD83E\uDF8A":[{x:2,y:0,w:6,h:8}],"\uD83E\uDF8B":[{x:1,y:0,w:7,h:8}],"\uD83E\uDF95":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\uD83E\uDF96":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\uD83E\uDF97":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]},Oz={"░":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"▒":[[1,0],[0,0],[0,1],[0,0]],"▓":[[0,1],[1,1],[1,0],[1,1]]},Fz={"─":{1:"M0,.5 L1,.5"},"━":{3:"M0,.5 L1,.5"},"│":{1:"M.5,0 L.5,1"},"┃":{3:"M.5,0 L.5,1"},"┌":{1:"M0.5,1 L.5,.5 L1,.5"},"┏":{3:"M0.5,1 L.5,.5 L1,.5"},"┐":{1:"M0,.5 L.5,.5 L.5,1"},"┓":{3:"M0,.5 L.5,.5 L.5,1"},"└":{1:"M.5,0 L.5,.5 L1,.5"},"┗":{3:"M.5,0 L.5,.5 L1,.5"},"┘":{1:"M.5,0 L.5,.5 L0,.5"},"┛":{3:"M.5,0 L.5,.5 L0,.5"},"├":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"┣":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"┤":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"┫":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"┬":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"┳":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"┴":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"┻":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"┼":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"╋":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"╴":{1:"M.5,.5 L0,.5"},"╸":{3:"M.5,.5 L0,.5"},"╵":{1:"M.5,.5 L.5,0"},"╹":{3:"M.5,.5 L.5,0"},"╶":{1:"M.5,.5 L1,.5"},"╺":{3:"M.5,.5 L1,.5"},"╷":{1:"M.5,.5 L.5,1"},"╻":{3:"M.5,.5 L.5,1"},"═":{1:($,J)=>`M0,${0.5-J} L1,${0.5-J} M0,${0.5+J} L1,${0.5+J}`},"║":{1:($,J)=>`M${0.5-$},0 L${0.5-$},1 M${0.5+$},0 L${0.5+$},1`},"╒":{1:($,J)=>`M.5,1 L.5,${0.5-J} L1,${0.5-J} M.5,${0.5+J} L1,${0.5+J}`},"╓":{1:($,J)=>`M${0.5-$},1 L${0.5-$},.5 L1,.5 M${0.5+$},.5 L${0.5+$},1`},"╔":{1:($,J)=>`M1,${0.5-J} L${0.5-$},${0.5-J} L${0.5-$},1 M1,${0.5+J} L${0.5+$},${0.5+J} L${0.5+$},1`},"╕":{1:($,J)=>`M0,${0.5-J} L.5,${0.5-J} L.5,1 M0,${0.5+J} L.5,${0.5+J}`},"╖":{1:($,J)=>`M${0.5+$},1 L${0.5+$},.5 L0,.5 M${0.5-$},.5 L${0.5-$},1`},"╗":{1:($,J)=>`M0,${0.5+J} L${0.5-$},${0.5+J} L${0.5-$},1 M0,${0.5-J} L${0.5+$},${0.5-J} L${0.5+$},1`},"╘":{1:($,J)=>`M.5,0 L.5,${0.5+J} L1,${0.5+J} M.5,${0.5-J} L1,${0.5-J}`},"╙":{1:($,J)=>`M1,.5 L${0.5-$},.5 L${0.5-$},0 M${0.5+$},.5 L${0.5+$},0`},"╚":{1:($,J)=>`M1,${0.5-J} L${0.5+$},${0.5-J} L${0.5+$},0 M1,${0.5+J} L${0.5-$},${0.5+J} L${0.5-$},0`},"╛":{1:($,J)=>`M0,${0.5+J} L.5,${0.5+J} L.5,0 M0,${0.5-J} L.5,${0.5-J}`},"╜":{1:($,J)=>`M0,.5 L${0.5+$},.5 L${0.5+$},0 M${0.5-$},.5 L${0.5-$},0`},"╝":{1:($,J)=>`M0,${0.5-J} L${0.5-$},${0.5-J} L${0.5-$},0 M0,${0.5+J} L${0.5+$},${0.5+J} L${0.5+$},0`},"╞":{1:($,J)=>`M.5,0 L.5,1 M.5,${0.5-J} L1,${0.5-J} M.5,${0.5+J} L1,${0.5+J}`},"╟":{1:($,J)=>`M${0.5-$},0 L${0.5-$},1 M${0.5+$},0 L${0.5+$},1 M${0.5+$},.5 L1,.5`},"╠":{1:($,J)=>`M${0.5-$},0 L${0.5-$},1 M1,${0.5+J} L${0.5+$},${0.5+J} L${0.5+$},1 M1,${0.5-J} L${0.5+$},${0.5-J} L${0.5+$},0`},"╡":{1:($,J)=>`M.5,0 L.5,1 M0,${0.5-J} L.5,${0.5-J} M0,${0.5+J} L.5,${0.5+J}`},"╢":{1:($,J)=>`M0,.5 L${0.5-$},.5 M${0.5-$},0 L${0.5-$},1 M${0.5+$},0 L${0.5+$},1`},"╣":{1:($,J)=>`M${0.5+$},0 L${0.5+$},1 M0,${0.5+J} L${0.5-$},${0.5+J} L${0.5-$},1 M0,${0.5-J} L${0.5-$},${0.5-J} L${0.5-$},0`},"╤":{1:($,J)=>`M0,${0.5-J} L1,${0.5-J} M0,${0.5+J} L1,${0.5+J} M.5,${0.5+J} L.5,1`},"╥":{1:($,J)=>`M0,.5 L1,.5 M${0.5-$},.5 L${0.5-$},1 M${0.5+$},.5 L${0.5+$},1`},"╦":{1:($,J)=>`M0,${0.5-J} L1,${0.5-J} M0,${0.5+J} L${0.5-$},${0.5+J} L${0.5-$},1 M1,${0.5+J} L${0.5+$},${0.5+J} L${0.5+$},1`},"╧":{1:($,J)=>`M.5,0 L.5,${0.5-J} M0,${0.5-J} L1,${0.5-J} M0,${0.5+J} L1,${0.5+J}`},"╨":{1:($,J)=>`M0,.5 L1,.5 M${0.5-$},.5 L${0.5-$},0 M${0.5+$},.5 L${0.5+$},0`},"╩":{1:($,J)=>`M0,${0.5+J} L1,${0.5+J} M0,${0.5-J} L${0.5-$},${0.5-J} L${0.5-$},0 M1,${0.5-J} L${0.5+$},${0.5-J} L${0.5+$},0`},"╪":{1:($,J)=>`M.5,0 L.5,1 M0,${0.5-J} L1,${0.5-J} M0,${0.5+J} L1,${0.5+J}`},"╫":{1:($,J)=>`M0,.5 L1,.5 M${0.5-$},0 L${0.5-$},1 M${0.5+$},0 L${0.5+$},1`},"╬":{1:($,J)=>`M0,${0.5+J} L${0.5-$},${0.5+J} L${0.5-$},1 M1,${0.5+J} L${0.5+$},${0.5+J} L${0.5+$},1 M0,${0.5-J} L${0.5-$},${0.5-J} L${0.5-$},0 M1,${0.5-J} L${0.5+$},${0.5-J} L${0.5+$},0`},"╱":{1:"M1,0 L0,1"},"╲":{1:"M0,0 L1,1"},"╳":{1:"M1,0 L0,1 M0,0 L1,1"},"╼":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"╽":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"╾":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"╿":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"┍":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"┎":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"┑":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"┒":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"┕":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"┖":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"┙":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"┚":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"┝":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"┞":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"┟":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"┠":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"┡":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"┢":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"┥":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"┦":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"┧":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"┨":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"┩":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"┪":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"┭":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"┮":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"┯":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"┰":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"┱":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"┲":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"┵":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"┶":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"┷":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"┸":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"┹":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"┺":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"┽":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"┾":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"┿":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"╀":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"╁":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"╂":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"╃":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"╄":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"╅":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"╆":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"╇":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"╈":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"╉":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"╊":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"╌":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"╍":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"┄":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"┅":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"┈":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"┉":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"╎":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"╏":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"┆":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"┇":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"┊":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"┋":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"╭":{1:($,J)=>`M.5,1 L.5,${0.5+J/0.15*0.5} C.5,${0.5+J/0.15*0.5},.5,.5,1,.5`},"╮":{1:($,J)=>`M.5,1 L.5,${0.5+J/0.15*0.5} C.5,${0.5+J/0.15*0.5},.5,.5,0,.5`},"╯":{1:($,J)=>`M.5,0 L.5,${0.5-J/0.15*0.5} C.5,${0.5-J/0.15*0.5},.5,.5,0,.5`},"╰":{1:($,J)=>`M.5,0 L.5,${0.5-J/0.15*0.5} C.5,${0.5-J/0.15*0.5},.5,.5,1,.5`}},P7={"":{d:"M.3,1 L.03,1 L.03,.88 C.03,.82,.06,.78,.11,.73 C.15,.7,.2,.68,.28,.65 L.43,.6 C.49,.58,.53,.56,.56,.53 C.59,.5,.6,.47,.6,.43 L.6,.27 L.4,.27 L.69,.1 L.98,.27 L.78,.27 L.78,.46 C.78,.52,.76,.56,.72,.61 C.68,.66,.63,.67,.56,.7 L.48,.72 C.42,.74,.38,.76,.35,.78 C.32,.8,.31,.84,.31,.88 L.31,1 M.3,.5 L.03,.59 L.03,.09 L.3,.09 L.3,.655",type:0},"":{d:"M.7,.4 L.7,.47 L.2,.47 L.2,.03 L.355,.03 L.355,.4 L.705,.4 M.7,.5 L.86,.5 L.86,.95 L.69,.95 L.44,.66 L.46,.86 L.46,.95 L.3,.95 L.3,.49 L.46,.49 L.71,.78 L.69,.565 L.69,.5",type:0},"":{d:"M.25,.94 C.16,.94,.11,.92,.11,.87 L.11,.53 C.11,.48,.15,.455,.23,.45 L.23,.3 C.23,.25,.26,.22,.31,.19 C.36,.16,.43,.15,.51,.15 C.59,.15,.66,.16,.71,.19 C.77,.22,.79,.26,.79,.3 L.79,.45 C.87,.45,.91,.48,.91,.53 L.91,.87 C.91,.92,.86,.94,.77,.94 L.24,.94 M.53,.2 C.49,.2,.45,.21,.42,.23 C.39,.25,.38,.27,.38,.3 L.38,.45 L.68,.45 L.68,.3 C.68,.27,.67,.25,.64,.23 C.61,.21,.58,.2,.53,.2 M.58,.82 L.58,.66 C.63,.65,.65,.63,.65,.6 C.65,.58,.64,.57,.61,.56 C.58,.55,.56,.54,.52,.54 C.48,.54,.46,.55,.43,.56 C.4,.57,.39,.59,.39,.6 C.39,.63,.41,.64,.46,.66 L.46,.82 L.57,.82",type:0},"":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}};P7[""]=P7[""];P7[""]=P7[""];function Nz($,J,Y,Z,j,K,Q,X){let V=vz[J];if(V)return xz($,V,Y,Z,j,K),!0;let z=Oz[J];if(z)return bz($,z,Y,Z,j,K),!0;let G=Fz[J];if(G)return Rz($,G,Y,Z,j,K,X),!0;let W=P7[J];return W?(Dz($,W,Y,Z,j,K,Q,X),!0):!1}function xz($,J,Y,Z,j,K){for(let Q=0;Q<J.length;Q++){let X=J[Q],V=j/8,z=K/8;$.fillRect(Y+X.x*V,Z+X.y*z,X.w*V,X.h*z)}}var XJ=new Map;function bz($,J,Y,Z,j,K){let Q=XJ.get(J);Q||(Q=new Map,XJ.set(J,Q));let X=$.fillStyle;if(typeof X!="string")throw Error(`Unexpected fillStyle type "${X}"`);let V=Q.get(X);if(!V){let z=J[0].length,G=J.length,W=$.canvas.ownerDocument.createElement("canvas");W.width=z,W.height=G;let q=R0(W.getContext("2d")),H=new ImageData(z,G),U,O,M,A;if(X.startsWith("#"))U=parseInt(X.slice(1,3),16),O=parseInt(X.slice(3,5),16),M=parseInt(X.slice(5,7),16),A=X.length>7&&parseInt(X.slice(7,9),16)||1;else if(X.startsWith("rgba"))[U,O,M,A]=X.substring(5,X.length-1).split(",").map((m)=>parseFloat(m));else throw Error(`Unexpected fillStyle color format "${X}" when drawing pattern glyph`);for(let m=0;m<G;m++)for(let E=0;E<z;E++)H.data[(m*z+E)*4]=U,H.data[(m*z+E)*4+1]=O,H.data[(m*z+E)*4+2]=M,H.data[(m*z+E)*4+3]=J[m][E]*(A*255);q.putImageData(H,0,0),V=R0($.createPattern(W,null)),Q.set(X,V)}$.fillStyle=V,$.fillRect(Y,Z,j,K)}function Rz($,J,Y,Z,j,K,Q){$.strokeStyle=$.fillStyle;for(let[X,V]of Object.entries(J)){$.beginPath(),$.lineWidth=Q*Number.parseInt(X);let z;if(typeof V=="function"){let G=0.15/K*j;z=V(0.15,G)}else z=V;for(let G of z.split(" ")){let W=G[0],q=oJ[W];if(!q){console.error(`Could not find drawing instructions for "${W}"`);continue}let H=G.substring(1).split(",");!H[0]||!H[1]||q($,nJ(H,j,K,Y,Z,!0,Q))}$.stroke(),$.closePath()}}function Dz($,J,Y,Z,j,K,Q,X){let V=new Path2D;V.rect(Y,Z,j,K),$.clip(V),$.beginPath();let z=Q/12;$.lineWidth=X*z;for(let G of J.d.split(" ")){let W=G[0],q=oJ[W];if(!q){console.error(`Could not find drawing instructions for "${W}"`);continue}let H=G.substring(1).split(",");!H[0]||!H[1]||q($,nJ(H,j,K,Y,Z,!1,X,(J.leftPadding??0)*(z/2),(J.rightPadding??0)*(z/2)))}J.type===1?($.strokeStyle=$.fillStyle,$.stroke()):$.fill(),$.closePath()}function zJ($,J,Y=0){return Math.max(Math.min($,J),Y)}var oJ={C:($,J)=>$.bezierCurveTo(J[0],J[1],J[2],J[3],J[4],J[5]),L:($,J)=>$.lineTo(J[0],J[1]),M:($,J)=>$.moveTo(J[0],J[1])};function nJ($,J,Y,Z,j,K,Q,X=0,V=0){let z=$.map((G)=>parseFloat(G)||parseInt(G));if(z.length<2)throw Error("Too few arguments for instruction");for(let G=0;G<z.length;G+=2)z[G]*=J-X*Q-V*Q,K&&z[G]!==0&&(z[G]=zJ(Math.round(z[G]+0.5)-0.5,J,0)),z[G]+=Z+X*Q;for(let G=1;G<z.length;G+=2)z[G]*=Y,K&&z[G]!==0&&(z[G]=zJ(Math.round(z[G]+0.5)-0.5,Y,0)),z[G]+=j;return z}var VJ=class{constructor(){this._data={}}set($,J,Y){this._data[$]||(this._data[$]={}),this._data[$][J]=Y}get($,J){return this._data[$]?this._data[$][J]:void 0}clear(){this._data={}}},GJ=class{constructor(){this._data=new VJ}set($,J,Y,Z,j){this._data.get($,J)||this._data.set($,J,new VJ),this._data.get($,J).set(Y,Z,j)}get($,J,Y,Z){return this._data.get($,J)?.get(Y,Z)}clear(){this._data.clear()}},iJ=class{constructor(){this._tasks=[],this._i=0}enqueue($){this._tasks.push($),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process($){this._idleCallback=void 0;let J=0,Y=0,Z=$.timeRemaining(),j=0;for(;this._i<this._tasks.length;){if(J=performance.now(),this._tasks[this._i]()||this._i++,J=Math.max(1,performance.now()-J),Y=Math.max(J,Y),j=$.timeRemaining(),Y*1.5>j){Z-J<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(Z-J))}ms`),this._start();return}Z=j}this.clear()}},_z=class extends iJ{_requestCallback($){return setTimeout(()=>$(this._createDeadline(16)))}_cancelCallback($){clearTimeout($)}_createDeadline($){let J=performance.now()+$;return{timeRemaining:()=>Math.max(0,J-performance.now())}}},Mz=class extends iJ{_requestCallback($){return requestIdleCallback($)}_cancelCallback($){cancelIdleCallback($)}},yz=!J2&&"requestIdleCallback"in window?Mz:_z,C9=class ${constructor(){this.fg=0,this.bg=0,this.extended=new rJ}static toColorRGB(J){return[J>>>16&255,J>>>8&255,J&255]}static fromColorRGB(J){return(J[0]&255)<<16|(J[1]&255)<<8|J[2]&255}clone(){let J=new $;return J.fg=this.fg,J.bg=this.bg,J.extended=this.extended.clone(),J}isInverse(){return this.fg&67108864}isBold(){return this.fg&134217728}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:this.fg&268435456}isBlink(){return this.fg&536870912}isInvisible(){return this.fg&1073741824}isItalic(){return this.bg&67108864}isDim(){return this.bg&134217728}isStrikethrough(){return this.fg&2147483648}isProtected(){return this.bg&536870912}isOverline(){return this.bg&1073741824}getFgColorMode(){return this.fg&50331648}getBgColorMode(){return this.bg&50331648}isFgRGB(){return(this.fg&50331648)===50331648}isBgRGB(){return(this.bg&50331648)===50331648}isFgPalette(){return(this.fg&50331648)===16777216||(this.fg&50331648)===33554432}isBgPalette(){return(this.bg&50331648)===16777216||(this.bg&50331648)===33554432}isFgDefault(){return(this.fg&50331648)===0}isBgDefault(){return(this.bg&50331648)===0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(this.fg&50331648){case 16777216:case 33554432:return this.fg&255;case 50331648:return this.fg&16777215;default:return-1}}getBgColor(){switch(this.bg&50331648){case 16777216:case 33554432:return this.bg&255;case 50331648:return this.bg&16777215;default:return-1}}hasExtendedAttrs(){return this.bg&268435456}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(this.bg&268435456&&~this.extended.underlineColor)switch(this.extended.underlineColor&50331648){case 16777216:case 33554432:return this.extended.underlineColor&255;case 50331648:return this.extended.underlineColor&16777215;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return this.bg&268435456&&~this.extended.underlineColor?this.extended.underlineColor&50331648:this.getFgColorMode()}isUnderlineColorRGB(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===50331648:this.isFgRGB()}isUnderlineColorPalette(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===16777216||(this.extended.underlineColor&50331648)===33554432:this.isFgPalette()}isUnderlineColorDefault(){return this.bg&268435456&&~this.extended.underlineColor?(this.extended.underlineColor&50331648)===0:this.isFgDefault()}getUnderlineStyle(){return this.fg&268435456?this.bg&268435456?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}},rJ=class ${constructor(J=0,Y=0){this._ext=0,this._urlId=0,this._ext=J,this._urlId=Y}get ext(){return this._urlId?this._ext&-469762049|this.underlineStyle<<26:this._ext}set ext(J){this._ext=J}get underlineStyle(){return this._urlId?5:(this._ext&469762048)>>26}set underlineStyle(J){this._ext&=-469762049,this._ext|=J<<26&469762048}get underlineColor(){return this._ext&67108863}set underlineColor(J){this._ext&=-67108864,this._ext|=J&67108863}get urlId(){return this._urlId}set urlId(J){this._urlId=J}get underlineVariantOffset(){let J=(this._ext&3758096384)>>29;return J<0?J^4294967288:J}set underlineVariantOffset(J){this._ext&=536870911,this._ext|=J<<29&3758096384}clone(){return new $(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}},WJ=class ${constructor(J){this.element=J,this.next=$.Undefined,this.prev=$.Undefined}};WJ.Undefined=new WJ(void 0);var wz=globalThis.performance&&typeof globalThis.performance.now=="function",Lz=class ${static create(J){return new $(J)}constructor(J){this._now=wz&&J===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}},Ez=!1,qJ=!1,Pz=!1,r8;(($)=>{$.None=()=>G8.None;function J(B){if(Pz){let{onDidAddListener:v}=B,R=i5.create(),N=0;B.onDidAddListener=()=>{++N===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),R.print()),v?.()}}}function Y(B,v){return q(B,()=>{},0,void 0,!0,void 0,v)}$.defer=Y;function Z(B){return(v,R=null,N)=>{let x=!1,F;return F=B((_)=>{if(!x)return F?F.dispose():x=!0,v.call(R,_)},null,N),x&&F.dispose(),F}}$.once=Z;function j(B,v,R){return G((N,x=null,F)=>B((_)=>N.call(x,v(_)),null,F),R)}$.map=j;function K(B,v,R){return G((N,x=null,F)=>B((_)=>{v(_),N.call(x,_)},null,F),R)}$.forEach=K;function Q(B,v,R){return G((N,x=null,F)=>B((_)=>v(_)&&N.call(x,_),null,F),R)}$.filter=Q;function X(B){return B}$.signal=X;function V(...B){return(v,R=null,N)=>{let x=dJ(...B.map((F)=>F((_)=>v.call(R,_))));return W(x,N)}}$.any=V;function z(B,v,R,N){let x=R;return j(B,(F)=>(x=v(x,F),x),N)}$.reduce=z;function G(B,v){let R,N={onWillAddFirstListener(){R=B(x.fire,x)},onDidRemoveLastListener(){R?.dispose()}};v||J(N);let x=new Y0(N);return v?.add(x),x.event}function W(B,v){return v instanceof Array?v.push(B):v&&v.add(B),B}function q(B,v,R=100,N=!1,x=!1,F,_){let y,T,r,h=0,i,c={leakWarningThreshold:F,onWillAddFirstListener(){y=B((Z0)=>{h++,T=v(T,Z0),N&&!r&&(n.fire(T),T=void 0),i=()=>{let o=T;T=void 0,r=void 0,(!N||h>1)&&n.fire(o),h=0},typeof R=="number"?(clearTimeout(r),r=setTimeout(i,R)):r===void 0&&(r=0,queueMicrotask(i))})},onWillRemoveListener(){x&&h>0&&i?.()},onDidRemoveLastListener(){i=void 0,y.dispose()}};_||J(c);let n=new Y0(c);return _?.add(n),n.event}$.debounce=q;function H(B,v=0,R){return $.debounce(B,(N,x)=>N?(N.push(x),N):[x],v,void 0,!0,void 0,R)}$.accumulate=H;function U(B,v=(N,x)=>N===x,R){let N=!0,x;return Q(B,(F)=>{let _=N||!v(F,x);return N=!1,x=F,_},R)}$.latch=U;function O(B,v,R){return[$.filter(B,v,R),$.filter(B,(N)=>!v(N),R)]}$.split=O;function M(B,v=!1,R=[],N){let x=R.slice(),F=B((T)=>{x?x.push(T):y.fire(T)});N&&N.add(F);let _=()=>{x?.forEach((T)=>y.fire(T)),x=null},y=new Y0({onWillAddFirstListener(){F||(F=B((T)=>y.fire(T)),N&&N.add(F))},onDidAddFirstListener(){x&&(v?setTimeout(_):_())},onDidRemoveLastListener(){F&&F.dispose(),F=null}});return N&&N.add(y),y.event}$.buffer=M;function A(B,v){return(R,N,x)=>{let F=v(new E);return B(function(_){let y=F.evaluate(_);y!==m&&R.call(N,y)},void 0,x)}}$.chain=A;let m=Symbol("HaltChainable");class E{constructor(){this.steps=[]}map(B){return this.steps.push(B),this}forEach(B){return this.steps.push((v)=>(B(v),v)),this}filter(B){return this.steps.push((v)=>B(v)?v:m),this}reduce(B,v){let R=v;return this.steps.push((N)=>(R=B(R,N),R)),this}latch(B=(v,R)=>v===R){let v=!0,R;return this.steps.push((N)=>{let x=v||!B(N,R);return v=!1,R=N,x?N:m}),this}evaluate(B){for(let v of this.steps)if(B=v(B),B===m)break;return B}}function b(B,v,R=(N)=>N){let N=(...y)=>_.fire(R(...y)),x=()=>B.on(v,N),F=()=>B.removeListener(v,N),_=new Y0({onWillAddFirstListener:x,onDidRemoveLastListener:F});return _.event}$.fromNodeEventEmitter=b;function P(B,v,R=(N)=>N){let N=(...y)=>_.fire(R(...y)),x=()=>B.addEventListener(v,N),F=()=>B.removeEventListener(v,N),_=new Y0({onWillAddFirstListener:x,onDidRemoveLastListener:F});return _.event}$.fromDOMEventEmitter=P;function f(B){return new Promise((v)=>Z(B)(v))}$.toPromise=f;function u(B){let v=new Y0;return B.then((R)=>{v.fire(R)},()=>{v.fire(void 0)}).finally(()=>{v.dispose()}),v.event}$.fromPromise=u;function $0(B,v){return B((R)=>v.fire(R))}$.forward=$0;function G0(B,v,R){return v(R),B((N)=>v(N))}$.runAndSubscribe=G0;class m0{constructor(B,v){this._observable=B,this._counter=0,this._hasChanged=!1;let R={onWillAddFirstListener:()=>{B.addObserver(this)},onDidRemoveLastListener:()=>{B.removeObserver(this)}};v||J(R),this.emitter=new Y0(R),v&&v.add(this.emitter)}beginUpdate(B){this._counter++}handlePossibleChange(B){}handleChange(B,v){this._hasChanged=!0}endUpdate(B){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function S(B,v){return new m0(B,v).emitter.event}$.fromObservable=S;function u0(B){return(v,R,N)=>{let x=0,F=!1,_={beginUpdate(){x++},endUpdate(){x--,x===0&&(B.reportChanges(),F&&(F=!1,v.call(R)))},handlePossibleChange(){},handleChange(){F=!0}};B.addObserver(_),B.reportChanges();let y={dispose(){B.removeObserver(_)}};return N instanceof h9?N.add(y):Array.isArray(N)&&N.push(y),y}}$.fromObservableLight=u0})(r8||={});var n5=class ${constructor(J){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${J}_${$._idPool++}`,$.all.add(this)}start(J){this._stopWatch=new Lz,this.listenerCount=J}stop(){if(this._stopWatch){let J=this._stopWatch.elapsed();this.durations.push(J),this.elapsedOverall+=J,this.invocationCount+=1,this._stopWatch=void 0}}};n5.all=new Set,n5._idPool=0;var Az=n5,HJ=-1,tJ=class ${constructor(J,Y,Z=($._idPool++).toString(16).padStart(3,"0")){this._errorHandler=J,this.threshold=Y,this.name=Z,this._warnCountdown=0}dispose(){this._stacks?.clear()}check(J,Y){let Z=this.threshold;if(Z<=0||Y<Z)return;this._stacks||(this._stacks=new Map);let j=this._stacks.get(J.value)||0;if(this._stacks.set(J.value,j+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=Z*0.5;let[K,Q]=this.getMostFrequentStack(),X=`[${this.name}] potential listener LEAK detected, having ${Y} listeners already. MOST frequent listener (${Q}):`;console.warn(X),console.warn(K);let V=new Tz(X,K);this._errorHandler(V)}return()=>{let K=this._stacks.get(J.value)||0;this._stacks.set(J.value,K-1)}}getMostFrequentStack(){if(!this._stacks)return;let J,Y=0;for(let[Z,j]of this._stacks)(!J||Y<j)&&(J=[Z,j],Y=j);return J}};tJ._idPool=1;var fz=tJ,i5=class ${constructor(J){this.value=J}static create(){let J=Error();return new $(J.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},Tz=class extends Error{constructor($,J){super($),this.name="ListenerLeakError",this.stack=J}},kz=class extends Error{constructor($,J){super($),this.name="ListenerRefusalError",this.stack=J}},Sz=0,E6=class{constructor($){this.value=$,this.id=Sz++}},mz=2,Cz=($,J)=>{if($ instanceof E6)J($);else for(let Y=0;Y<$.length;Y++){let Z=$[Y];Z&&J(Z)}},P6;if(Ez){let $=[];setInterval(()=>{$.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn($.join(`
`)),$.length=0)},3000),P6=new FinalizationRegistry((J)=>{typeof J=="string"&&$.push(J)})}var Y0=class{constructor($){this._size=0,this._options=$,this._leakageMon=HJ>0||this._options?.leakWarningThreshold?new fz($?.onListenerError??L6,this._options?.leakWarningThreshold??HJ):void 0,this._perfMon=this._options?._profName?new Az(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(qJ){let $=this._listeners;queueMicrotask(()=>{Cz($,(J)=>J.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=($,J,Y)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let X=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(X);let V=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],z=new kz(`${X}. HINT: Stack shows most frequent listener (${V[1]}-times)`,V[0]);return(this._options?.onListenerError||L6)(z),G8.None}if(this._disposed)return G8.None;J&&($=$.bind(J));let Z=new E6($),j,K;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*0.2)&&(Z.stack=i5.create(),j=this._leakageMon.check(Z.stack,this._size+1)),qJ&&(Z.stack=K??i5.create()),this._listeners?this._listeners instanceof E6?(this._deliveryQueue??=new gz,this._listeners=[this._listeners,Z]):this._listeners.push(Z):(this._options?.onWillAddFirstListener?.(this),this._listeners=Z,this._options?.onDidAddFirstListener?.(this)),this._size++;let Q=p0(()=>{P6?.unregister(Q),j?.(),this._removeListener(Z)});if(Y instanceof h9?Y.add(Q):Array.isArray(Y)&&Y.push(Q),P6){let X=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),V=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(X);P6.register(Q,V?.[2]??X,Q)}return Q},this._event}_removeListener($){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let J=this._listeners,Y=J.indexOf($);if(Y===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,J[Y]=void 0;let Z=this._deliveryQueue.current===this;if(this._size*mz<=J.length){let j=0;for(let K=0;K<J.length;K++)J[K]?J[j++]=J[K]:Z&&(this._deliveryQueue.end--,j<this._deliveryQueue.i&&this._deliveryQueue.i--);J.length=j}}_deliver($,J){if(!$)return;let Y=this._options?.onListenerError||L6;if(!Y){$.value(J);return}try{$.value(J)}catch(Z){Y(Z)}}_deliverQueue($){let J=$.current._listeners;for(;$.i<$.end;)this._deliver(J[$.i++],$.value);$.reset()}fire($){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof E6)this._deliver(this._listeners,$);else{let J=this._deliveryQueue;J.enqueue(this,$,this._listeners.length),this._deliverQueue(J)}this._perfMon?.stop()}hasListeners(){return this._size>0}},gz=class{constructor(){this.i=-1,this.end=0}enqueue($,J,Y){this.i=0,this.end=Y,this.current=$,this.value=J}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},UJ={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},_7=2,M7,V9=class ${constructor(J,Y,Z){this._document=J,this._config=Y,this._unicodeService=Z,this._didWarmUp=!1,this._cacheMap=new GJ,this._cacheMapCombined=new GJ,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new C9,this._textureSize=512,this._onAddTextureAtlasCanvas=new Y0,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new Y0,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=eJ(J,this._config.deviceCellWidth*4+_7*2,this._config.deviceCellHeight+_7*2),this._tmpCtx=R0(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}get pages(){return this._pages}dispose(){this._tmpCanvas.remove();for(let J of this.pages)J.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){let J=new yz;for(let Y=33;Y<126;Y++)J.enqueue(()=>{if(!this._cacheMap.get(Y,0,0,0)){let Z=this._drawToCache(Y,0,0,0,!1,void 0);this._cacheMap.set(Y,0,0,0,Z)}})}beginFrame(){return this._requestClearModel}clearTexture(){if(!(this._pages[0].currentRow.x===0&&this._pages[0].currentRow.y===0)){for(let J of this._pages)J.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if($.maxAtlasPages&&this._pages.length>=Math.max(4,$.maxAtlasPages)){let Y=this._pages.filter((z)=>z.canvas.width*2<=($.maxTextureSize||4096)).sort((z,G)=>G.canvas.width!==z.canvas.width?G.canvas.width-z.canvas.width:G.percentageUsed-z.percentageUsed),Z=-1,j=0;for(let z=0;z<Y.length;z++)if(Y[z].canvas.width!==j)Z=z,j=Y[z].canvas.width;else if(z-Z===3)break;let K=Y.slice(Z,Z+4),Q=K.map((z)=>z.glyphs[0].texturePage).sort((z,G)=>z>G?1:-1),X=this.pages.length-K.length,V=this._mergePages(K,X);V.version++;for(let z=Q.length-1;z>=0;z--)this._deletePage(Q[z]);this.pages.push(V),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(V.canvas)}let J=new k5(this._document,this._textureSize);return this._pages.push(J),this._activePages.push(J),this._onAddTextureAtlasCanvas.fire(J.canvas),J}_mergePages(J,Y){let Z=J[0].canvas.width*2,j=new k5(this._document,Z,J);for(let[K,Q]of J.entries()){let X=K*Q.canvas.width%Z,V=Math.floor(K/2)*Q.canvas.height;j.ctx.drawImage(Q.canvas,X,V);for(let G of Q.glyphs)G.texturePage=Y,G.sizeClipSpace.x=G.size.x/Z,G.sizeClipSpace.y=G.size.y/Z,G.texturePosition.x+=X,G.texturePosition.y+=V,G.texturePositionClipSpace.x=G.texturePosition.x/Z,G.texturePositionClipSpace.y=G.texturePosition.y/Z;this._onRemoveTextureAtlasCanvas.fire(Q.canvas);let z=this._activePages.indexOf(Q);z!==-1&&this._activePages.splice(z,1)}return j}_deletePage(J){this._pages.splice(J,1);for(let Y=J;Y<this._pages.length;Y++){let Z=this._pages[Y];for(let j of Z.glyphs)j.texturePage--;Z.version++}}getRasterizedGlyphCombinedChar(J,Y,Z,j,K,Q){return this._getFromCacheMap(this._cacheMapCombined,J,Y,Z,j,K,Q)}getRasterizedGlyph(J,Y,Z,j,K,Q){return this._getFromCacheMap(this._cacheMap,J,Y,Z,j,K,Q)}_getFromCacheMap(J,Y,Z,j,K,Q,X){return M7=J.get(Y,Z,j,K),M7||(M7=this._drawToCache(Y,Z,j,K,Q,X),J.set(Y,Z,j,K,M7)),M7}_getColorFromAnsiIndex(J){if(J>=this._config.colors.ansi.length)throw Error("No color found for idx "+J);return this._config.colors.ansi[J]}_getBackgroundColor(J,Y,Z,j){if(this._config.allowTransparency)return B8;let K;switch(J){case 16777216:case 33554432:K=this._getColorFromAnsiIndex(Y);break;case 50331648:let Q=C9.toColorRGB(Y);K=e0.toColor(Q[0],Q[1],Q[2]);break;case 0:default:Z?K=L7.opaque(this._config.colors.foreground):K=this._config.colors.background;break}return this._config.allowTransparency||(K=L7.opaque(K)),K}_getForegroundColor(J,Y,Z,j,K,Q,X,V,z,G){let W=this._getMinimumContrastColor(J,Y,Z,j,K,Q,X,z,V,G);if(W)return W;let q;switch(K){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&z&&Q<8&&(Q+=8),q=this._getColorFromAnsiIndex(Q);break;case 50331648:let H=C9.toColorRGB(Q);q=e0.toColor(H[0],H[1],H[2]);break;case 0:default:X?q=this._config.colors.background:q=this._config.colors.foreground}return this._config.allowTransparency&&(q=L7.opaque(q)),V&&(q=L7.multiplyOpacity(q,Bz)),q}_resolveBackgroundRgba(J,Y,Z){switch(J){case 16777216:case 33554432:return this._getColorFromAnsiIndex(Y).rgba;case 50331648:return Y<<8;case 0:default:return Z?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(J,Y,Z,j){switch(J){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&j&&Y<8&&(Y+=8),this._getColorFromAnsiIndex(Y).rgba;case 50331648:return Y<<8;case 0:default:return Z?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(J,Y,Z,j,K,Q,X,V,z,G){if(this._config.minimumContrastRatio===1||G)return;let W=this._getContrastCache(z),q=W.getColor(J,j);if(q!==void 0)return q||void 0;let H=this._resolveBackgroundRgba(Y,Z,X),U=this._resolveForegroundRgba(K,Q,X,V),O=_9.ensureContrastRatio(H,U,this._config.minimumContrastRatio/(z?2:1));if(!O){W.setColor(J,j,null);return}let M=e0.toColor(O>>24&255,O>>16&255,O>>8&255);return W.setColor(J,j,M),M}_getContrastCache(J){return J?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(J,Y,Z,j,K,Q){let X=typeof J=="number"?String.fromCharCode(J):J;Q&&this._tmpCanvas.parentElement!==Q&&(this._tmpCanvas.style.display="none",Q.append(this._tmpCanvas));let V=Math.min(this._config.deviceCellWidth*Math.max(X.length,2)+_7*2,this._config.deviceMaxTextureSize);this._tmpCanvas.width<V&&(this._tmpCanvas.width=V);let z=Math.min(this._config.deviceCellHeight+_7*4,this._textureSize);if(this._tmpCanvas.height<z&&(this._tmpCanvas.height=z),this._tmpCtx.save(),this._workAttributeData.fg=Z,this._workAttributeData.bg=Y,this._workAttributeData.extended.ext=j,!!this._workAttributeData.isInvisible())return UJ;let G=!!this._workAttributeData.isBold(),W=!!this._workAttributeData.isInverse(),q=!!this._workAttributeData.isDim(),H=!!this._workAttributeData.isItalic(),U=!!this._workAttributeData.isUnderline(),O=!!this._workAttributeData.isStrikethrough(),M=!!this._workAttributeData.isOverline(),A=this._workAttributeData.getFgColor(),m=this._workAttributeData.getFgColorMode(),E=this._workAttributeData.getBgColor(),b=this._workAttributeData.getBgColorMode();if(W){let y=A;A=E,E=y;let T=m;m=b,b=T}let P=this._getBackgroundColor(b,E,W,q);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=P.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let f=G?this._config.fontWeightBold:this._config.fontWeight,u=H?"italic":"";this._tmpCtx.font=`${u} ${f} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=aJ;let $0=X.length===1&&Z2(X.charCodeAt(0)),G0=X.length===1&&zz(X.charCodeAt(0)),m0=this._getForegroundColor(Y,b,E,Z,m,A,W,q,G,sJ(X.charCodeAt(0)));this._tmpCtx.fillStyle=m0.css;let S=G0?0:_7*2,u0=!1;this._config.customGlyphs!==!1&&(u0=Nz(this._tmpCtx,X,S,S,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let B=!$0,v;if(typeof J=="number"?v=this._unicodeService.wcwidth(J):v=this._unicodeService.getStringCellWidth(J),U){this._tmpCtx.save();let y=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),T=y%2===1?0.5:0;if(this._tmpCtx.lineWidth=y,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())B=!1,this._tmpCtx.strokeStyle=`rgb(${C9.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{B=!1;let Z0=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&Z0<8&&(Z0+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(Z0).css}this._tmpCtx.beginPath();let r=S,h=Math.ceil(S+this._config.deviceCharHeight)-T-(K?y*2:0),i=h+y,c=h+y*2,n=this._workAttributeData.getUnderlineVariantOffset();for(let Z0=0;Z0<v;Z0++){this._tmpCtx.save();let o=r+Z0*this._config.deviceCellWidth,j0=r+(Z0+1)*this._config.deviceCellWidth,W8=o+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(o,h),this._tmpCtx.lineTo(j0,h),this._tmpCtx.moveTo(o,c),this._tmpCtx.lineTo(j0,c);break;case 3:let Z8=y<=1?c:Math.ceil(S+this._config.deviceCharHeight-y/2)-T,d0=y<=1?h:Math.ceil(S+this._config.deviceCharHeight+y/2)-T,l=new Path2D;l.rect(o,h,this._config.deviceCellWidth,c-h),this._tmpCtx.clip(l),this._tmpCtx.moveTo(o-this._config.deviceCellWidth/2,i),this._tmpCtx.bezierCurveTo(o-this._config.deviceCellWidth/2,d0,o,d0,o,i),this._tmpCtx.bezierCurveTo(o,Z8,W8,Z8,W8,i),this._tmpCtx.bezierCurveTo(W8,d0,j0,d0,j0,i),this._tmpCtx.bezierCurveTo(j0,Z8,j0+this._config.deviceCellWidth/2,Z8,j0+this._config.deviceCellWidth/2,i);break;case 4:let j8=n===0?0:n>=y?y*2-n:y-n;!(n>=y)===!1||j8===0?(this._tmpCtx.setLineDash([Math.round(y),Math.round(y)]),this._tmpCtx.moveTo(o+j8,h),this._tmpCtx.lineTo(j0,h)):(this._tmpCtx.setLineDash([Math.round(y),Math.round(y)]),this._tmpCtx.moveTo(o,h),this._tmpCtx.lineTo(o+j8,h),this._tmpCtx.moveTo(o+j8+y,h),this._tmpCtx.lineTo(j0,h)),n=Uz(j0-o,y,n);break;case 5:let f8=0.6,d9=0.3,W9=j0-o,T8=Math.floor(f8*W9),q9=Math.floor(d9*W9),y9=W9-T8-q9;this._tmpCtx.setLineDash([T8,q9,y9]),this._tmpCtx.moveTo(o,h),this._tmpCtx.lineTo(j0,h);break;case 1:default:this._tmpCtx.moveTo(o,h),this._tmpCtx.lineTo(j0,h);break}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!u0&&this._config.fontSize>=12&&!this._config.allowTransparency&&X!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let Z0=this._tmpCtx.measureText(X);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in Z0&&Z0.actualBoundingBoxDescent>0){this._tmpCtx.save();let o=new Path2D;o.rect(r,h-Math.ceil(y/2),this._config.deviceCellWidth*v,c-h+Math.ceil(y/2)),this._tmpCtx.clip(o),this._tmpCtx.lineWidth=this._config.devicePixelRatio*3,this._tmpCtx.strokeStyle=P.css,this._tmpCtx.strokeText(X,S,S+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(M){let y=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),T=y%2===1?0.5:0;this._tmpCtx.lineWidth=y,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(S,S+T),this._tmpCtx.lineTo(S+this._config.deviceCharWidth*v,S+T),this._tmpCtx.stroke()}if(u0||this._tmpCtx.fillText(X,S,S+this._config.deviceCharHeight),X==="_"&&!this._config.allowTransparency){let y=S5(this._tmpCtx.getImageData(S,S,this._config.deviceCellWidth,this._config.deviceCellHeight),P,m0,B);if(y)for(let T=1;T<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=P.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(X,S,S+this._config.deviceCharHeight-T),y=S5(this._tmpCtx.getImageData(S,S,this._config.deviceCellWidth,this._config.deviceCellHeight),P,m0,B),!!y);T++);}if(O){let y=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),T=this._tmpCtx.lineWidth%2===1?0.5:0;this._tmpCtx.lineWidth=y,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(S,S+Math.floor(this._config.deviceCharHeight/2)-T),this._tmpCtx.lineTo(S+this._config.deviceCharWidth*v,S+Math.floor(this._config.deviceCharHeight/2)-T),this._tmpCtx.stroke()}this._tmpCtx.restore();let R=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),N;if(this._config.allowTransparency?N=hz(R):N=S5(R,P,m0,B),N)return UJ;let x=this._findGlyphBoundingBox(R,this._workBoundingBox,V,G0,u0,S),F,_;for(;;){if(this._activePages.length===0){let y=this._createNewPage();F=y,_=y.currentRow,_.height=x.size.y;break}F=this._activePages[this._activePages.length-1],_=F.currentRow;for(let y of this._activePages)x.size.y<=y.currentRow.height&&(F=y,_=y.currentRow);for(let y=this._activePages.length-1;y>=0;y--)for(let T of this._activePages[y].fixedRows)T.height<=_.height&&x.size.y<=T.height&&(F=this._activePages[y],_=T);if(x.size.x>this._textureSize){this._overflowSizePage||(this._overflowSizePage=new k5(this._document,this._config.deviceMaxTextureSize),this.pages.push(this._overflowSizePage),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(this._overflowSizePage.canvas)),F=this._overflowSizePage,_=this._overflowSizePage.currentRow,_.x+x.size.x>=F.canvas.width&&(_.x=0,_.y+=_.height,_.height=0);break}if(_.y+x.size.y>=F.canvas.height||_.height>x.size.y+2){let y=!1;if(F.currentRow.y+F.currentRow.height+x.size.y>=F.canvas.height){let T;for(let r of this._activePages)if(r.currentRow.y+r.currentRow.height+x.size.y<r.canvas.height){T=r;break}if(T)F=T;else if($.maxAtlasPages&&this._pages.length>=$.maxAtlasPages&&_.y+x.size.y<=F.canvas.height&&_.height>=x.size.y&&_.x+x.size.x<=F.canvas.width)y=!0;else{let r=this._createNewPage();F=r,_=r.currentRow,_.height=x.size.y,y=!0}}y||(F.currentRow.height>0&&F.fixedRows.push(F.currentRow),_={x:0,y:F.currentRow.y+F.currentRow.height,height:x.size.y},F.fixedRows.push(_),F.currentRow={x:0,y:_.y+_.height,height:0})}if(_.x+x.size.x<=F.canvas.width)break;_===F.currentRow?(_.x=0,_.y+=_.height,_.height=0):F.fixedRows.splice(F.fixedRows.indexOf(_),1)}return x.texturePage=this._pages.indexOf(F),x.texturePosition.x=_.x,x.texturePosition.y=_.y,x.texturePositionClipSpace.x=_.x/F.canvas.width,x.texturePositionClipSpace.y=_.y/F.canvas.height,x.sizeClipSpace.x/=F.canvas.width,x.sizeClipSpace.y/=F.canvas.height,_.height=Math.max(_.height,x.size.y),_.x+=x.size.x,F.ctx.putImageData(R,x.texturePosition.x-this._workBoundingBox.left,x.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,x.size.x,x.size.y),F.addGlyph(x),F.version++,x}_findGlyphBoundingBox(J,Y,Z,j,K,Q){Y.top=0;let X=j?this._config.deviceCellHeight:this._tmpCanvas.height,V=j?this._config.deviceCellWidth:Z,z=!1;for(let G=0;G<X;G++){for(let W=0;W<V;W++){let q=G*this._tmpCanvas.width*4+W*4+3;if(J.data[q]!==0){Y.top=G,z=!0;break}}if(z)break}Y.left=0,z=!1;for(let G=0;G<Q+V;G++){for(let W=0;W<X;W++){let q=W*this._tmpCanvas.width*4+G*4+3;if(J.data[q]!==0){Y.left=G,z=!0;break}}if(z)break}Y.right=V,z=!1;for(let G=Q+V-1;G>=Q;G--){for(let W=0;W<X;W++){let q=W*this._tmpCanvas.width*4+G*4+3;if(J.data[q]!==0){Y.right=G,z=!0;break}}if(z)break}Y.bottom=X,z=!1;for(let G=X-1;G>=0;G--){for(let W=0;W<V;W++){let q=G*this._tmpCanvas.width*4+W*4+3;if(J.data[q]!==0){Y.bottom=G,z=!0;break}}if(z)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:Y.right-Y.left+1,y:Y.bottom-Y.top+1},sizeClipSpace:{x:Y.right-Y.left+1,y:Y.bottom-Y.top+1},offset:{x:-Y.left+Q+(j||K?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-Y.top+Q+(j||K?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}},k5=class{constructor($,J,Y){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],Y)for(let Z of Y)this._glyphs.push(...Z.glyphs),this._usedPixels+=Z._usedPixels;this.canvas=eJ($,J,J),this.ctx=R0(this.canvas.getContext("2d",{alpha:!0}))}get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph($){this._glyphs.push($),this._usedPixels+=$.size.x*$.size.y}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}};function S5($,J,Y,Z){let j=J.rgba>>>24,K=J.rgba>>>16&255,Q=J.rgba>>>8&255,X=Y.rgba>>>24,V=Y.rgba>>>16&255,z=Y.rgba>>>8&255,G=Math.floor((Math.abs(j-X)+Math.abs(K-V)+Math.abs(Q-z))/12),W=!0;for(let q=0;q<$.data.length;q+=4)$.data[q]===j&&$.data[q+1]===K&&$.data[q+2]===Q||Z&&Math.abs($.data[q]-j)+Math.abs($.data[q+1]-K)+Math.abs($.data[q+2]-Q)<G?$.data[q+3]=0:W=!1;return W}function hz($){for(let J=0;J<$.data.length;J+=4)if($.data[J+3]>0)return!1;return!0}function eJ($,J,Y){let Z=$.createElement("canvas");return Z.width=J,Z.height=Y,Z}function pz($,J,Y,Z,j,K,Q,X){let V={foreground:K.foreground,background:K.background,cursor:B8,cursorAccent:B8,selectionForeground:B8,selectionBackgroundTransparent:B8,selectionBackgroundOpaque:B8,selectionInactiveBackgroundTransparent:B8,selectionInactiveBackgroundOpaque:B8,overviewRulerBorder:B8,scrollbarSliderBackground:B8,scrollbarSliderHoverBackground:B8,scrollbarSliderActiveBackground:B8,ansi:K.ansi.slice(),contrastCache:K.contrastCache,halfContrastCache:K.halfContrastCache};return{customGlyphs:j.customGlyphs,devicePixelRatio:Q,deviceMaxTextureSize:X,letterSpacing:j.letterSpacing,lineHeight:j.lineHeight,deviceCellWidth:$,deviceCellHeight:J,deviceCharWidth:Y,deviceCharHeight:Z,fontFamily:j.fontFamily,fontSize:j.fontSize,fontWeight:j.fontWeight,fontWeightBold:j.fontWeightBold,allowTransparency:j.allowTransparency,drawBoldTextInBrightColors:j.drawBoldTextInBrightColors,minimumContrastRatio:j.minimumContrastRatio,colors:V}}function IJ($,J){for(let Y=0;Y<$.colors.ansi.length;Y++)if($.colors.ansi[Y].rgba!==J.colors.ansi[Y].rgba)return!1;return $.devicePixelRatio===J.devicePixelRatio&&$.customGlyphs===J.customGlyphs&&$.lineHeight===J.lineHeight&&$.letterSpacing===J.letterSpacing&&$.fontFamily===J.fontFamily&&$.fontSize===J.fontSize&&$.fontWeight===J.fontWeight&&$.fontWeightBold===J.fontWeightBold&&$.allowTransparency===J.allowTransparency&&$.deviceCharWidth===J.deviceCharWidth&&$.deviceCharHeight===J.deviceCharHeight&&$.drawBoldTextInBrightColors===J.drawBoldTextInBrightColors&&$.minimumContrastRatio===J.minimumContrastRatio&&$.colors.foreground.rgba===J.colors.foreground.rgba&&$.colors.background.rgba===J.colors.background.rgba}function uz($){return($&50331648)===16777216||($&50331648)===33554432}var v8=[];function $Y($,J,Y,Z,j,K,Q,X,V){let z=pz(Z,j,K,Q,J,Y,X,V);for(let q=0;q<v8.length;q++){let H=v8[q],U=H.ownedBy.indexOf($);if(U>=0){if(IJ(H.config,z))return H.atlas;H.ownedBy.length===1?(H.atlas.dispose(),v8.splice(q,1)):H.ownedBy.splice(U,1);break}}for(let q=0;q<v8.length;q++){let H=v8[q];if(IJ(H.config,z))return H.ownedBy.push($),H.atlas}let G=$._core,W={atlas:new V9(document,z,G.unicodeService),config:z,ownedBy:[$]};return v8.push(W),W.atlas}function BJ($){for(let J=0;J<v8.length;J++){let Y=v8[J].ownedBy.indexOf($);if(Y!==-1){v8[J].ownedBy.length===1?(v8[J].atlas.dispose(),v8.splice(J,1)):v8[J].ownedBy.splice(Y,1);break}}}var y6=600,dz=class{constructor($,J){this._renderCallback=$,this._coreBrowserService=J,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval($=y6){this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout(()=>{if(this._animationTimeRestarted){let J=y6-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,J>0){this._restartInterval(J);return}}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=this._coreBrowserService.window.setInterval(()=>{if(this._animationTimeRestarted){let J=y6-(Date.now()-this._animationTimeRestarted);this._animationTimeRestarted=void 0,this._restartInterval(J);return}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},y6)},$)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._coreBrowserService.window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}};function vJ($,J,Y){let Z=new J.ResizeObserver((j)=>{let K=j.find((V)=>V.target===$);if(!K)return;if(!("devicePixelContentBoxSize"in K)){Z?.disconnect(),Z=void 0;return}let Q=K.devicePixelContentBoxSize[0].inlineSize,X=K.devicePixelContentBoxSize[0].blockSize;Q>0&&X>0&&Y(Q,X)});try{Z.observe($,{box:["device-pixel-content-box"]})}catch{Z.disconnect(),Z=void 0}return p0(()=>Z?.disconnect())}function cz($){return $>65535?($-=65536,String.fromCharCode(($>>10)+55296)+String.fromCharCode($%1024+56320)):String.fromCharCode($)}var OJ=class $ extends C9{constructor(){super(...arguments);this.content=0,this.fg=0,this.bg=0,this.extended=new rJ,this.combinedData=""}static fromCharData(J){let Y=new $;return Y.setFromCharData(J),Y}isCombined(){return this.content&2097152}getWidth(){return this.content>>22}getChars(){return this.content&2097152?this.combinedData:this.content&2097151?cz(this.content&2097151):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):this.content&2097151}setFromCharData(J){this.fg=J[0],this.bg=0;let Y=!1;if(J[1].length>2)Y=!0;else if(J[1].length===2){let Z=J[1].charCodeAt(0);if(55296<=Z&&Z<=56319){let j=J[1].charCodeAt(1);56320<=j&&j<=57343?this.content=(Z-55296)*1024+j-56320+65536|J[2]<<22:Y=!0}else Y=!0}else this.content=J[1].charCodeAt(0)|J[2]<<22;Y&&(this.combinedData=J[1],this.content=2097152|J[2]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}},JY=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]);function YY($,J,Y){let Z=R0($.createProgram());if($.attachShader(Z,R0(FJ($,$.VERTEX_SHADER,J))),$.attachShader(Z,R0(FJ($,$.FRAGMENT_SHADER,Y))),$.linkProgram(Z),$.getProgramParameter(Z,$.LINK_STATUS))return Z;console.error($.getProgramInfoLog(Z)),$.deleteProgram(Z)}function FJ($,J,Y){let Z=R0($.createShader(J));if($.shaderSource(Z,Y),$.compileShader(Z),$.getShaderParameter(Z,$.COMPILE_STATUS))return Z;console.error($.getShaderInfoLog(Z)),$.deleteShader(Z)}function lz($,J){let Y=Math.min($.length*2,J),Z=new Float32Array(Y);for(let j=0;j<$.length;j++)Z[j]=$[j];return Z}var sz=class{constructor($){this.texture=$,this.version=-1}},az=`#version 300 es
layout (location = 0) in vec2 a_unitquad;
layout (location = 1) in vec2 a_cellpos;
layout (location = 2) in vec2 a_offset;
layout (location = 3) in vec2 a_size;
layout (location = 4) in float a_texpage;
layout (location = 5) in vec2 a_texcoord;
layout (location = 6) in vec2 a_texsize;

uniform mat4 u_projection;
uniform vec2 u_resolution;

out vec2 v_texcoord;
flat out int v_texpage;

void main() {
  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_texpage = int(a_texpage);
  v_texcoord = a_texcoord + a_unitquad * a_texsize;
}`;function oz($){let J="";for(let Y=1;Y<$;Y++)J+=` else if (v_texpage == ${Y}) { outColor = texture(u_texture[${Y}], v_texcoord); }`;return`#version 300 es
precision lowp float;

in vec2 v_texcoord;
flat in int v_texpage;

uniform sampler2D u_texture[${$}];

out vec4 outColor;

void main() {
  if (v_texpage == 0) {
    outColor = texture(u_texture[0], v_texcoord);
  } ${J}
}`}var G9=11,m9=G9*Float32Array.BYTES_PER_ELEMENT,nz=2,I0=0,z0,m5=0,y7=0,iz=class extends G8{constructor($,J,Y,Z){super();this._terminal=$,this._gl=J,this._dimensions=Y,this._optionsService=Z,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)]};let j=this._gl;V9.maxAtlasPages===void 0&&(V9.maxAtlasPages=Math.min(32,R0(j.getParameter(j.MAX_TEXTURE_IMAGE_UNITS))),V9.maxTextureSize=R0(j.getParameter(j.MAX_TEXTURE_SIZE))),this._program=R0(YY(j,az,oz(V9.maxAtlasPages))),this._register(p0(()=>j.deleteProgram(this._program))),this._projectionLocation=R0(j.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=R0(j.getUniformLocation(this._program,"u_resolution")),this._textureLocation=R0(j.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=j.createVertexArray(),j.bindVertexArray(this._vertexArrayObject);let K=new Float32Array([0,0,1,0,0,1,1,1]),Q=j.createBuffer();this._register(p0(()=>j.deleteBuffer(Q))),j.bindBuffer(j.ARRAY_BUFFER,Q),j.bufferData(j.ARRAY_BUFFER,K,j.STATIC_DRAW),j.enableVertexAttribArray(0),j.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);let X=new Uint8Array([0,1,2,3]),V=j.createBuffer();this._register(p0(()=>j.deleteBuffer(V))),j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,V),j.bufferData(j.ELEMENT_ARRAY_BUFFER,X,j.STATIC_DRAW),this._attributesBuffer=R0(j.createBuffer()),this._register(p0(()=>j.deleteBuffer(this._attributesBuffer))),j.bindBuffer(j.ARRAY_BUFFER,this._attributesBuffer),j.enableVertexAttribArray(2),j.vertexAttribPointer(2,2,j.FLOAT,!1,m9,0),j.vertexAttribDivisor(2,1),j.enableVertexAttribArray(3),j.vertexAttribPointer(3,2,j.FLOAT,!1,m9,2*Float32Array.BYTES_PER_ELEMENT),j.vertexAttribDivisor(3,1),j.enableVertexAttribArray(4),j.vertexAttribPointer(4,1,j.FLOAT,!1,m9,4*Float32Array.BYTES_PER_ELEMENT),j.vertexAttribDivisor(4,1),j.enableVertexAttribArray(5),j.vertexAttribPointer(5,2,j.FLOAT,!1,m9,5*Float32Array.BYTES_PER_ELEMENT),j.vertexAttribDivisor(5,1),j.enableVertexAttribArray(6),j.vertexAttribPointer(6,2,j.FLOAT,!1,m9,7*Float32Array.BYTES_PER_ELEMENT),j.vertexAttribDivisor(6,1),j.enableVertexAttribArray(1),j.vertexAttribPointer(1,2,j.FLOAT,!1,m9,9*Float32Array.BYTES_PER_ELEMENT),j.vertexAttribDivisor(1,1),j.useProgram(this._program);let z=new Int32Array(V9.maxAtlasPages);for(let G=0;G<V9.maxAtlasPages;G++)z[G]=G;j.uniform1iv(this._textureLocation,z),j.uniformMatrix4fv(this._projectionLocation,!1,JY),this._atlasTextures=[];for(let G=0;G<V9.maxAtlasPages;G++){let W=new sz(R0(j.createTexture()));this._register(p0(()=>j.deleteTexture(W.texture))),j.activeTexture(j.TEXTURE0+G),j.bindTexture(j.TEXTURE_2D,W.texture),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texImage2D(j.TEXTURE_2D,0,j.RGBA,1,1,0,j.RGBA,j.UNSIGNED_BYTE,new Uint8Array([255,0,0,255])),this._atlasTextures[G]=W}j.enable(j.BLEND),j.blendFunc(j.SRC_ALPHA,j.ONE_MINUS_SRC_ALPHA),this.handleResize()}beginFrame(){return this._atlas?this._atlas.beginFrame():!0}updateCell($,J,Y,Z,j,K,Q,X,V){this._updateCell(this._vertices.attributes,$,J,Y,Z,j,K,Q,X,V)}_updateCell($,J,Y,Z,j,K,Q,X,V,z){if(I0=(Y*this._terminal.cols+J)*G9,Z===0||Z===void 0){$.fill(0,I0,I0+G9-1-nz);return}this._atlas&&(X&&X.length>1?z0=this._atlas.getRasterizedGlyphCombinedChar(X,j,K,Q,!1,this._terminal.element):z0=this._atlas.getRasterizedGlyph(Z,j,K,Q,!1,this._terminal.element),m5=Math.floor((this._dimensions.device.cell.width-this._dimensions.device.char.width)/2),j!==z&&z0.offset.x>m5?(y7=z0.offset.x-m5,$[I0]=-(z0.offset.x-y7)+this._dimensions.device.char.left,$[I0+1]=-z0.offset.y+this._dimensions.device.char.top,$[I0+2]=(z0.size.x-y7)/this._dimensions.device.canvas.width,$[I0+3]=z0.size.y/this._dimensions.device.canvas.height,$[I0+4]=z0.texturePage,$[I0+5]=z0.texturePositionClipSpace.x+y7/this._atlas.pages[z0.texturePage].canvas.width,$[I0+6]=z0.texturePositionClipSpace.y,$[I0+7]=z0.sizeClipSpace.x-y7/this._atlas.pages[z0.texturePage].canvas.width,$[I0+8]=z0.sizeClipSpace.y):($[I0]=-z0.offset.x+this._dimensions.device.char.left,$[I0+1]=-z0.offset.y+this._dimensions.device.char.top,$[I0+2]=z0.size.x/this._dimensions.device.canvas.width,$[I0+3]=z0.size.y/this._dimensions.device.canvas.height,$[I0+4]=z0.texturePage,$[I0+5]=z0.texturePositionClipSpace.x,$[I0+6]=z0.texturePositionClipSpace.y,$[I0+7]=z0.sizeClipSpace.x,$[I0+8]=z0.sizeClipSpace.y),this._optionsService.rawOptions.rescaleOverlappingGlyphs&&qz(Z,V,z0.size.x,this._dimensions.device.cell.width)&&($[I0+2]=(this._dimensions.device.cell.width-1)/this._dimensions.device.canvas.width))}clear(){let $=this._terminal,J=$.cols*$.rows*G9;this._vertices.count!==J?this._vertices.attributes=new Float32Array(J):this._vertices.attributes.fill(0);let Y=0;for(;Y<this._vertices.attributesBuffers.length;Y++)this._vertices.count!==J?this._vertices.attributesBuffers[Y]=new Float32Array(J):this._vertices.attributesBuffers[Y].fill(0);this._vertices.count=J,Y=0;for(let Z=0;Z<$.rows;Z++)for(let j=0;j<$.cols;j++)this._vertices.attributes[Y+9]=j/$.cols,this._vertices.attributes[Y+10]=Z/$.rows,Y+=G9}handleResize(){let $=this._gl;$.useProgram(this._program),$.viewport(0,0,$.canvas.width,$.canvas.height),$.uniform2f(this._resolutionLocation,$.canvas.width,$.canvas.height),this.clear()}render($){if(!this._atlas)return;let J=this._gl;J.useProgram(this._program),J.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;let Y=this._vertices.attributesBuffers[this._activeBuffer],Z=0;for(let j=0;j<$.lineLengths.length;j++){let K=j*this._terminal.cols*G9,Q=this._vertices.attributes.subarray(K,K+$.lineLengths[j]*G9);Y.set(Q,Z),Z+=Q.length}J.bindBuffer(J.ARRAY_BUFFER,this._attributesBuffer),J.bufferData(J.ARRAY_BUFFER,Y.subarray(0,Z),J.STREAM_DRAW);for(let j=0;j<this._atlas.pages.length;j++)this._atlas.pages[j].version!==this._atlasTextures[j].version&&this._bindAtlasPageTexture(J,this._atlas,j);J.drawElementsInstanced(J.TRIANGLE_STRIP,4,J.UNSIGNED_BYTE,0,Z/G9)}setAtlas($){this._atlas=$;for(let J of this._atlasTextures)J.version=-1}_bindAtlasPageTexture($,J,Y){$.activeTexture($.TEXTURE0+Y),$.bindTexture($.TEXTURE_2D,this._atlasTextures[Y].texture),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texImage2D($.TEXTURE_2D,0,$.RGBA,$.RGBA,$.UNSIGNED_BYTE,J.pages[Y].canvas),$.generateMipmap($.TEXTURE_2D),this._atlasTextures[Y].version=J.pages[Y].version}setDimensions($){this._dimensions=$}},rz=class{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update($,J,Y,Z=!1){if(this.selectionStart=J,this.selectionEnd=Y,!J||!Y||J[0]===Y[0]&&J[1]===Y[1]){this.clear();return}let j=$.buffers.active.ydisp,K=J[1]-j,Q=Y[1]-j,X=Math.max(K,0),V=Math.min(Q,$.rows-1);if(X>=$.rows||V<0){this.clear();return}this.hasSelection=!0,this.columnSelectMode=Z,this.viewportStartRow=K,this.viewportEndRow=Q,this.viewportCappedStartRow=X,this.viewportCappedEndRow=V,this.startCol=J[0],this.endCol=Y[0]}isCellSelected($,J,Y){return this.hasSelection?(Y-=$.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?J>=this.startCol&&Y>=this.viewportCappedStartRow&&J<this.endCol&&Y<=this.viewportCappedEndRow:J<this.startCol&&Y>=this.viewportCappedStartRow&&J>=this.endCol&&Y<=this.viewportCappedEndRow:Y>this.viewportStartRow&&Y<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&Y===this.viewportStartRow&&J>=this.startCol&&J<this.endCol||this.viewportStartRow<this.viewportEndRow&&Y===this.viewportEndRow&&J<this.endCol||this.viewportStartRow<this.viewportEndRow&&Y===this.viewportStartRow&&J>=this.startCol):!1}};function tz(){return new rz}var m6=4,A6=1,f6=2,C5=3,ez=2147483648,$V=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection=tz()}resize($,J){let Y=$*J*m6;Y!==this.cells.length&&(this.cells=new Uint32Array(Y),this.lineLengths=new Uint32Array(J))}clear(){this.cells.fill(0,0),this.lineLengths.fill(0,0)}},JV=`#version 300 es
layout (location = 0) in vec2 a_position;
layout (location = 1) in vec2 a_size;
layout (location = 2) in vec4 a_color;
layout (location = 3) in vec2 a_unitquad;

uniform mat4 u_projection;

out vec4 v_color;

void main() {
  vec2 zeroToOne = a_position + (a_unitquad * a_size);
  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);
  v_color = a_color;
}`,YV=`#version 300 es
precision lowp float;

in vec4 v_color;

out vec4 outColor;

void main() {
  outColor = v_color;
}`,i8=8,g5=i8*Float32Array.BYTES_PER_ELEMENT,ZV=20*i8,NJ=class{constructor(){this.attributes=new Float32Array(ZV),this.count=0}},o8=0,xJ=0,bJ=0,RJ=0,DJ=0,_J=0,MJ=0,jV=class extends G8{constructor($,J,Y,Z){super();this._terminal=$,this._gl=J,this._dimensions=Y,this._themeService=Z,this._vertices=new NJ,this._verticesCursor=new NJ;let j=this._gl;this._program=R0(YY(j,JV,YV)),this._register(p0(()=>j.deleteProgram(this._program))),this._projectionLocation=R0(j.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=j.createVertexArray(),j.bindVertexArray(this._vertexArrayObject);let K=new Float32Array([0,0,1,0,0,1,1,1]),Q=j.createBuffer();this._register(p0(()=>j.deleteBuffer(Q))),j.bindBuffer(j.ARRAY_BUFFER,Q),j.bufferData(j.ARRAY_BUFFER,K,j.STATIC_DRAW),j.enableVertexAttribArray(3),j.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);let X=new Uint8Array([0,1,2,3]),V=j.createBuffer();this._register(p0(()=>j.deleteBuffer(V))),j.bindBuffer(j.ELEMENT_ARRAY_BUFFER,V),j.bufferData(j.ELEMENT_ARRAY_BUFFER,X,j.STATIC_DRAW),this._attributesBuffer=R0(j.createBuffer()),this._register(p0(()=>j.deleteBuffer(this._attributesBuffer))),j.bindBuffer(j.ARRAY_BUFFER,this._attributesBuffer),j.enableVertexAttribArray(0),j.vertexAttribPointer(0,2,j.FLOAT,!1,g5,0),j.vertexAttribDivisor(0,1),j.enableVertexAttribArray(1),j.vertexAttribPointer(1,2,j.FLOAT,!1,g5,2*Float32Array.BYTES_PER_ELEMENT),j.vertexAttribDivisor(1,1),j.enableVertexAttribArray(2),j.vertexAttribPointer(2,4,j.FLOAT,!1,g5,4*Float32Array.BYTES_PER_ELEMENT),j.vertexAttribDivisor(2,1),this._updateCachedColors(Z.colors),this._register(this._themeService.onChangeColors((z)=>{this._updateCachedColors(z),this._updateViewportRectangle()}))}renderBackgrounds(){this._renderVertices(this._vertices)}renderCursor(){this._renderVertices(this._verticesCursor)}_renderVertices($){let J=this._gl;J.useProgram(this._program),J.bindVertexArray(this._vertexArrayObject),J.uniformMatrix4fv(this._projectionLocation,!1,JY),J.bindBuffer(J.ARRAY_BUFFER,this._attributesBuffer),J.bufferData(J.ARRAY_BUFFER,$.attributes,J.DYNAMIC_DRAW),J.drawElementsInstanced(this._gl.TRIANGLE_STRIP,4,J.UNSIGNED_BYTE,0,$.count)}handleResize(){this._updateViewportRectangle()}setDimensions($){this._dimensions=$}_updateCachedColors($){this._bgFloat=this._colorToFloat32Array($.background),this._cursorFloat=this._colorToFloat32Array($.cursor)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.device.cell.width,this._terminal.rows*this._dimensions.device.cell.height,this._bgFloat)}updateBackgrounds($){let J=this._terminal,Y=this._vertices,Z=1,j,K,Q,X,V,z,G,W,q,H,U;for(j=0;j<J.rows;j++){for(Q=-1,X=0,V=0,z=!1,K=0;K<J.cols;K++)G=(j*J.cols+K)*m6,W=$.cells[G+A6],q=$.cells[G+f6],H=!!(q&67108864),(W!==X||q!==V&&(z||H))&&((X!==0||z&&V!==0)&&(U=Z++*i8,this._updateRectangle(Y,U,V,X,Q,K,j)),Q=K,X=W,V=q,z=H);(X!==0||z&&V!==0)&&(U=Z++*i8,this._updateRectangle(Y,U,V,X,Q,J.cols,j))}Y.count=Z}updateCursor($){let J=this._verticesCursor,Y=$.cursor;if(!Y||Y.style==="block"){J.count=0;return}let Z,j=0;(Y.style==="bar"||Y.style==="outline")&&(Z=j++*i8,this._addRectangleFloat(J.attributes,Z,Y.x*this._dimensions.device.cell.width,Y.y*this._dimensions.device.cell.height,Y.style==="bar"?Y.dpr*Y.cursorWidth:Y.dpr,this._dimensions.device.cell.height,this._cursorFloat)),(Y.style==="underline"||Y.style==="outline")&&(Z=j++*i8,this._addRectangleFloat(J.attributes,Z,Y.x*this._dimensions.device.cell.width,(Y.y+1)*this._dimensions.device.cell.height-Y.dpr,Y.width*this._dimensions.device.cell.width,Y.dpr,this._cursorFloat)),Y.style==="outline"&&(Z=j++*i8,this._addRectangleFloat(J.attributes,Z,Y.x*this._dimensions.device.cell.width,Y.y*this._dimensions.device.cell.height,Y.width*this._dimensions.device.cell.width,Y.dpr,this._cursorFloat),Z=j++*i8,this._addRectangleFloat(J.attributes,Z,(Y.x+Y.width)*this._dimensions.device.cell.width-Y.dpr,Y.y*this._dimensions.device.cell.height,Y.dpr,this._dimensions.device.cell.height,this._cursorFloat)),J.count=j}_updateRectangle($,J,Y,Z,j,K,Q){if(Y&67108864)switch(Y&50331648){case 16777216:case 33554432:o8=this._themeService.colors.ansi[Y&255].rgba;break;case 50331648:o8=(Y&16777215)<<8;break;case 0:default:o8=this._themeService.colors.foreground.rgba}else switch(Z&50331648){case 16777216:case 33554432:o8=this._themeService.colors.ansi[Z&255].rgba;break;case 50331648:o8=(Z&16777215)<<8;break;case 0:default:o8=this._themeService.colors.background.rgba}$.attributes.length<J+4&&($.attributes=lz($.attributes,this._terminal.rows*this._terminal.cols*i8)),xJ=j*this._dimensions.device.cell.width,bJ=Q*this._dimensions.device.cell.height,RJ=(o8>>24&255)/255,DJ=(o8>>16&255)/255,_J=(o8>>8&255)/255,MJ=1,this._addRectangle($.attributes,J,xJ,bJ,(K-j)*this._dimensions.device.cell.width,this._dimensions.device.cell.height,RJ,DJ,_J,MJ)}_addRectangle($,J,Y,Z,j,K,Q,X,V,z){$[J]=Y/this._dimensions.device.canvas.width,$[J+1]=Z/this._dimensions.device.canvas.height,$[J+2]=j/this._dimensions.device.canvas.width,$[J+3]=K/this._dimensions.device.canvas.height,$[J+4]=Q,$[J+5]=X,$[J+6]=V,$[J+7]=z}_addRectangleFloat($,J,Y,Z,j,K,Q){$[J]=Y/this._dimensions.device.canvas.width,$[J+1]=Z/this._dimensions.device.canvas.height,$[J+2]=j/this._dimensions.device.canvas.width,$[J+3]=K/this._dimensions.device.canvas.height,$[J+4]=Q[0],$[J+5]=Q[1],$[J+6]=Q[2],$[J+7]=Q[3]}_colorToFloat32Array($){return new Float32Array([($.rgba>>24&255)/255,($.rgba>>16&255)/255,($.rgba>>8&255)/255,($.rgba&255)/255])}},KV=class extends G8{constructor($,J,Y,Z,j,K,Q,X){super();this._container=J,this._alpha=j,this._coreBrowserService=K,this._optionsService=Q,this._themeService=X,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${Y}-layer`),this._canvas.style.zIndex=Z.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._register(this._themeService.onChangeColors((V)=>{this._refreshCharAtlas($,V),this.reset($)})),this._register(p0(()=>{this._canvas.remove()}))}_initCanvas(){this._ctx=R0(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur($){}handleFocus($){}handleCursorMove($){}handleGridChanged($,J,Y){}handleSelectionChanged($,J,Y,Z=!1){}_setTransparency($,J){if(J===this._alpha)return;let Y=this._canvas;this._alpha=J,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,Y),this._refreshCharAtlas($,this._themeService.colors),this.handleGridChanged($,0,$.rows-1)}_refreshCharAtlas($,J){this._deviceCharWidth<=0&&this._deviceCharHeight<=0||(this._charAtlas=$Y($,this._optionsService.rawOptions,J,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr,2048),this._charAtlas.warmUp())}resize($,J){this._deviceCellWidth=J.device.cell.width,this._deviceCellHeight=J.device.cell.height,this._deviceCharWidth=J.device.char.width,this._deviceCharHeight=J.device.char.height,this._deviceCharLeft=J.device.char.left,this._deviceCharTop=J.device.char.top,this._canvas.width=J.device.canvas.width,this._canvas.height=J.device.canvas.height,this._canvas.style.width=`${J.css.canvas.width}px`,this._canvas.style.height=`${J.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas($,this._themeService.colors)}_fillBottomLineAtCells($,J,Y=1){this._ctx.fillRect($*this._deviceCellWidth,(J+1)*this._deviceCellHeight-this._coreBrowserService.dpr-1,Y*this._deviceCellWidth,this._coreBrowserService.dpr)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells($,J,Y,Z){this._alpha?this._ctx.clearRect($*this._deviceCellWidth,J*this._deviceCellHeight,Y*this._deviceCellWidth,Z*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect($*this._deviceCellWidth,J*this._deviceCellHeight,Y*this._deviceCellWidth,Z*this._deviceCellHeight))}_fillCharTrueColor($,J,Y,Z){this._ctx.font=this._getFont($,!1,!1),this._ctx.textBaseline=aJ,this._clipCell(Y,Z,J.getWidth()),this._ctx.fillText(J.getChars(),Y*this._deviceCellWidth+this._deviceCharLeft,Z*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_clipCell($,J,Y){this._ctx.beginPath(),this._ctx.rect($*this._deviceCellWidth,J*this._deviceCellHeight,Y*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont($,J,Y){let Z=J?$.options.fontWeightBold:$.options.fontWeight;return`${Y?"italic":""} ${Z} ${$.options.fontSize*this._coreBrowserService.dpr}px ${$.options.fontFamily}`}},QV=class extends KV{constructor($,J,Y,Z,j,K,Q){super(Y,$,"link",J,!0,j,K,Q),this._register(Z.onShowLinkUnderline((X)=>this._handleShowLinkUnderline(X))),this._register(Z.onHideLinkUnderline((X)=>this._handleHideLinkUnderline(X)))}resize($,J){super.resize($,J),this._state=void 0}reset($){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let $=this._state.y2-this._state.y1-1;$>0&&this._clearCells(0,this._state.y1+1,this._state.cols,$),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline($){if($.fg===257?this._ctx.fillStyle=this._themeService.colors.background.css:$.fg!==void 0&&uz($.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[$.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,$.y1===$.y2)this._fillBottomLineAtCells($.x1,$.y1,$.x2-$.x1);else{this._fillBottomLineAtCells($.x1,$.y1,$.cols-$.x1);for(let J=$.y1+1;J<$.y2;J++)this._fillBottomLineAtCells(0,J,$.cols);this._fillBottomLineAtCells(0,$.y2,$.x2)}this._state=$}_handleHideLinkUnderline($){this._clearCurrentLink()}},N8=typeof window=="object"?window:globalThis,r5=class{constructor(){this.mapWindowIdToZoomLevel=new Map,this._onDidChangeZoomLevel=new Y0,this.onDidChangeZoomLevel=this._onDidChangeZoomLevel.event,this.mapWindowIdToZoomFactor=new Map,this._onDidChangeFullscreen=new Y0,this.onDidChangeFullscreen=this._onDidChangeFullscreen.event,this.mapWindowIdToFullScreen=new Map}getZoomLevel(J){return this.mapWindowIdToZoomLevel.get(this.getWindowId(J))??0}setZoomLevel(J,Y){if(this.getZoomLevel(Y)===J)return;let Z=this.getWindowId(Y);this.mapWindowIdToZoomLevel.set(Z,J),this._onDidChangeZoomLevel.fire(Z)}getZoomFactor(J){return this.mapWindowIdToZoomFactor.get(this.getWindowId(J))??1}setZoomFactor(J,Y){this.mapWindowIdToZoomFactor.set(this.getWindowId(Y),J)}setFullscreen(J,Y){if(this.isFullscreen(Y)===J)return;let Z=this.getWindowId(Y);this.mapWindowIdToFullScreen.set(Z,J),this._onDidChangeFullscreen.fire(Z)}isFullscreen(J){return!!this.mapWindowIdToFullScreen.get(this.getWindowId(J))}getWindowId(J){return J.vscodeWindowId}};r5.INSTANCE=new r5;var ZY=r5;function XV($,J,Y){typeof J=="string"&&(J=$.matchMedia(J)),J.addEventListener("change",Y)}var Rq=ZY.INSTANCE.onDidChangeZoomLevel,Dq=ZY.INSTANCE.onDidChangeFullscreen,u9=typeof navigator=="object"?navigator.userAgent:"",_q=u9.indexOf("Firefox")>=0,h5=u9.indexOf("AppleWebKit")>=0,zV=u9.indexOf("Chrome")>=0,VV=!zV&&u9.indexOf("Safari")>=0,Mq=u9.indexOf("Electron/")>=0,yq=u9.indexOf("Android")>=0,T6=!1;if(typeof N8.matchMedia=="function"){let $=N8.matchMedia("(display-mode: standalone) or (display-mode: window-controls-overlay)"),J=N8.matchMedia("(display-mode: fullscreen)");T6=$.matches,XV(N8,$,({matches:Y})=>{T6&&J.matches||(T6=Y)})}function GV(){return T6}var g9="en",t5=!1,e5=!1,k6=!1,WV=!1,jY=!1,KY=!1,qV=!1,HV=!1,UV=!1,IV=!1,w6,S6=g9,yJ=g9,BV,n8,e8=globalThis,V8;typeof e8.vscode<"u"&&typeof e8.vscode.process<"u"?V8=e8.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(V8=process);var QY=typeof V8?.versions?.electron=="string",vV=QY&&V8?.type==="renderer";if(typeof V8=="object"){t5=V8.platform==="win32",e5=V8.platform==="darwin",k6=V8.platform==="linux",WV=k6&&!!V8.env.SNAP&&!!V8.env.SNAP_REVISION,qV=QY,UV=!!V8.env.CI||!!V8.env.BUILD_ARTIFACTSTAGINGDIRECTORY,w6=g9,S6=g9;let $=V8.env.VSCODE_NLS_CONFIG;if($)try{let J=JSON.parse($);w6=J.userLocale,yJ=J.osLocale,S6=J.resolvedLanguage||g9,BV=J.languagePack?.translationsConfigFile}catch{}jY=!0}else typeof navigator=="object"&&!vV?(n8=navigator.userAgent,t5=n8.indexOf("Windows")>=0,e5=n8.indexOf("Macintosh")>=0,HV=(n8.indexOf("Macintosh")>=0||n8.indexOf("iPad")>=0||n8.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,k6=n8.indexOf("Linux")>=0,IV=n8?.indexOf("Mobi")>=0,KY=!0,S6=globalThis._VSCODE_NLS_LANGUAGE||g9,w6=navigator.language.toLowerCase(),yJ=w6):console.error("Unable to resolve platform.");var p5=0;e5?p5=1:t5?p5=3:k6&&(p5=2);var u5=jY,OV=KY&&typeof e8.importScripts=="function",wq=OV?e8.origin:void 0,P8=n8,X9=S6,FV;(($)=>{function J(){return X9}$.value=J;function Y(){return X9.length===2?X9==="en":X9.length>=3?X9[0]==="e"&&X9[1]==="n"&&X9[2]==="-":!1}$.isDefaultVariant=Y;function Z(){return X9==="en"}$.isDefault=Z})(FV||={});var NV=typeof e8.postMessage=="function"&&!e8.importScripts,xV=(()=>{if(NV){let $=[];e8.addEventListener("message",(Y)=>{if(Y.data&&Y.data.vscodeScheduleAsyncWork)for(let Z=0,j=$.length;Z<j;Z++){let K=$[Z];if(K.id===Y.data.vscodeScheduleAsyncWork){$.splice(Z,1),K.callback();return}}});let J=0;return(Y)=>{let Z=++J;$.push({id:Z,callback:Y}),e8.postMessage({vscodeScheduleAsyncWork:Z},"*")}}return($)=>setTimeout($)})(),bV=!!(P8&&P8.indexOf("Chrome")>=0),Lq=!!(P8&&P8.indexOf("Firefox")>=0),Eq=!!(!bV&&P8&&P8.indexOf("Safari")>=0),Pq=!!(P8&&P8.indexOf("Edg/")>=0),Aq=!!(P8&&P8.indexOf("Android")>=0),z9=typeof navigator=="object"?navigator:{},fq={clipboard:{writeText:u5||document.queryCommandSupported&&document.queryCommandSupported("copy")||!!(z9&&z9.clipboard&&z9.clipboard.writeText),readText:u5||!!(z9&&z9.clipboard&&z9.clipboard.readText)},keyboard:u5||GV()?0:z9.keyboard||VV?1:2,touch:"ontouchstart"in N8||z9.maxTouchPoints>0,pointerEvents:N8.PointerEvent&&(("ontouchstart"in N8)||navigator.maxTouchPoints>0)},j2=class{constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define($,J){this._keyCodeToStr[$]=J,this._strToKeyCode[J.toLowerCase()]=$}keyCodeToStr($){return this._keyCodeToStr[$]}strToKeyCode($){return this._strToKeyCode[$.toLowerCase()]||0}},d5=new j2,wJ=new j2,LJ=new j2,Tq=Array(230),RV;(($)=>{function J(X){return d5.keyCodeToStr(X)}$.toString=J;function Y(X){return d5.strToKeyCode(X)}$.fromString=Y;function Z(X){return wJ.keyCodeToStr(X)}$.toUserSettingsUS=Z;function j(X){return LJ.keyCodeToStr(X)}$.toUserSettingsGeneral=j;function K(X){return wJ.strToKeyCode(X)||LJ.strToKeyCode(X)}$.fromUserSettings=K;function Q(X){if(X>=98&&X<=113)return null;switch(X){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return d5.keyCodeToStr(X)}$.toElectronAccelerator=Q})(RV||={});var XY=Object.freeze(function($,J){let Y=setTimeout($.bind(J),0);return{dispose(){clearTimeout(Y)}}}),DV;(($)=>{function J(Y){return Y===$.None||Y===$.Cancelled||Y instanceof _V?!0:!Y||typeof Y!="object"?!1:typeof Y.isCancellationRequested=="boolean"&&typeof Y.onCancellationRequested=="function"}$.isCancellationToken=J,$.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:r8.None}),$.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:XY})})(DV||={});var _V=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?XY:(this._emitter||(this._emitter=new Y0),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},kq=Symbol("MicrotaskDelay"),MV,c5;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?c5=($,J)=>{xV(()=>{if(Y)return;let Z=Date.now()+15;J(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,Z-Date.now())}}))});let Y=!1;return{dispose(){Y||(Y=!0)}}}:c5=($,J,Y)=>{let Z=$.requestIdleCallback(J,typeof Y=="number"?{timeout:Y}:void 0),j=!1;return{dispose(){j||(j=!0,$.cancelIdleCallback(Z))}}},MV=($)=>c5(globalThis,$)})();var yV;(($)=>{async function J(Z){let j,K=await Promise.all(Z.map((Q)=>Q.then((X)=>X,(X)=>{j||(j=X)})));if(typeof j<"u")throw j;return K}$.settled=J;function Y(Z){return new Promise(async(j,K)=>{try{await Z(j,K)}catch(Q){K(Q)}})}$.withAsyncBody=Y})(yV||={});var EJ=class ${static fromArray(J){return new $((Y)=>{Y.emitMany(J)})}static fromPromise(J){return new $(async(Y)=>{Y.emitMany(await J)})}static fromPromises(J){return new $(async(Y)=>{await Promise.all(J.map(async(Z)=>Y.emitOne(await Z)))})}static merge(J){return new $(async(Y)=>{await Promise.all(J.map(async(Z)=>{for await(let j of Z)Y.emitOne(j)}))})}constructor(J,Y){this._state=0,this._results=[],this._error=null,this._onReturn=Y,this._onStateChanged=new Y0,queueMicrotask(async()=>{let Z={emitOne:(j)=>this.emitOne(j),emitMany:(j)=>this.emitMany(j),reject:(j)=>this.reject(j)};try{await Promise.resolve(J(Z)),this.resolve()}catch(j){this.reject(j)}finally{Z.emitOne=void 0,Z.emitMany=void 0,Z.reject=void 0}})}[Symbol.asyncIterator](){let J=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(J<this._results.length)return{done:!1,value:this._results[J++]};if(this._state===1)return{done:!0,value:void 0};await r8.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(J,Y){return new $(async(Z)=>{for await(let j of J)Z.emitOne(Y(j))})}map(J){return $.map(this,J)}static filter(J,Y){return new $(async(Z)=>{for await(let j of J)Y(j)&&Z.emitOne(j)})}filter(J){return $.filter(this,J)}static coalesce(J){return $.filter(J,(Y)=>!!Y)}coalesce(){return $.coalesce(this)}static async toPromise(J){let Y=[];for await(let Z of J)Y.push(Z);return Y}toPromise(){return $.toPromise(this)}emitOne(J){this._state===0&&(this._results.push(J),this._onStateChanged.fire())}emitMany(J){this._state===0&&(this._results=this._results.concat(J),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(J){this._state===0&&(this._state=2,this._error=J,this._onStateChanged.fire())}};EJ.EMPTY=EJ.fromArray([]);function wV($){return 55296<=$&&$<=56319}function PJ($){return 56320<=$&&$<=57343}function LV($,J){return($-55296<<10)+(J-56320)+65536}function EV($){return K2($,0)}function K2($,J){switch(typeof $){case"object":return $===null?t8(349,J):Array.isArray($)?AV($,J):fV($,J);case"string":return zY($,J);case"boolean":return PV($,J);case"number":return t8($,J);case"undefined":return t8(937,J);default:return t8(617,J)}}function t8($,J){return(J<<5)-J+$|0}function PV($,J){return t8($?433:863,J)}function zY($,J){J=t8(149417,J);for(let Y=0,Z=$.length;Y<Z;Y++)J=t8($.charCodeAt(Y),J);return J}function AV($,J){return J=t8(104579,J),$.reduce((Y,Z)=>K2(Z,Y),J)}function fV($,J){return J=t8(181387,J),Object.keys($).sort().reduce((Y,Z)=>(Y=zY(Z,Y),K2($[Z],Y)),J)}function l5($,J,Y=32){let Z=Y-J,j=~((1<<Z)-1);return($<<J|(j&$)>>>Z)>>>0}function AJ($,J=0,Y=$.byteLength,Z=0){for(let j=0;j<Y;j++)$[J+j]=Z}function TV($,J,Y="0"){for(;$.length<J;)$=Y+$;return $}function w7($,J=32){return $ instanceof ArrayBuffer?Array.from(new Uint8Array($)).map((Y)=>Y.toString(16).padStart(2,"0")).join(""):TV(($>>>0).toString(16),J/4)}var kV=class ${constructor(){this._h0=1732584193,this._h1=4023233417,this._h2=2562383102,this._h3=271733878,this._h4=3285377520,this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(J){let Y=J.length;if(Y===0)return;let Z=this._buff,j=this._buffLen,K=this._leftoverHighSurrogate,Q,X;for(K!==0?(Q=K,X=-1,K=0):(Q=J.charCodeAt(0),X=0);;){let V=Q;if(wV(Q))if(X+1<Y){let z=J.charCodeAt(X+1);PJ(z)?(X++,V=LV(Q,z)):V=65533}else{K=Q;break}else PJ(Q)&&(V=65533);if(j=this._push(Z,j,V),X++,X<Y)Q=J.charCodeAt(X);else break}this._buffLen=j,this._leftoverHighSurrogate=K}_push(J,Y,Z){return Z<128?J[Y++]=Z:Z<2048?(J[Y++]=192|(Z&1984)>>>6,J[Y++]=128|(Z&63)>>>0):Z<65536?(J[Y++]=224|(Z&61440)>>>12,J[Y++]=128|(Z&4032)>>>6,J[Y++]=128|(Z&63)>>>0):(J[Y++]=240|(Z&1835008)>>>18,J[Y++]=128|(Z&258048)>>>12,J[Y++]=128|(Z&4032)>>>6,J[Y++]=128|(Z&63)>>>0),Y>=64&&(this._step(),Y-=64,this._totalLen+=64,J[0]=J[64],J[1]=J[65],J[2]=J[66]),Y}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),w7(this._h0)+w7(this._h1)+w7(this._h2)+w7(this._h3)+w7(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,AJ(this._buff,this._buffLen),this._buffLen>56&&(this._step(),AJ(this._buff));let J=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(J/4294967296),!1),this._buffDV.setUint32(60,J%4294967296,!1),this._step()}_step(){let J=$._bigBlock32,Y=this._buffDV;for(let W=0;W<64;W+=4)J.setUint32(W,Y.getUint32(W,!1),!1);for(let W=64;W<320;W+=4)J.setUint32(W,l5(J.getUint32(W-12,!1)^J.getUint32(W-32,!1)^J.getUint32(W-56,!1)^J.getUint32(W-64,!1),1),!1);let Z=this._h0,j=this._h1,K=this._h2,Q=this._h3,X=this._h4,V,z,G;for(let W=0;W<80;W++)W<20?(V=j&K|~j&Q,z=1518500249):W<40?(V=j^K^Q,z=1859775393):W<60?(V=j&K|j&Q|K&Q,z=2400959708):(V=j^K^Q,z=3395469782),G=l5(Z,5)+V+X+z+J.getUint32(W*4,!1)&4294967295,X=Q,Q=K,K=l5(j,30),j=Z,Z=G;this._h0=this._h0+Z&4294967295,this._h1=this._h1+j&4294967295,this._h2=this._h2+K&4294967295,this._h3=this._h3+Q&4294967295,this._h4=this._h4+X&4294967295}};kV._bigBlock32=new DataView(new ArrayBuffer(320));var{registerWindow:Sq,getWindow:SV,getDocument:mq,getWindows:Cq,getWindowsCount:gq,getWindowId:fJ,getWindowById:hq,hasWindow:pq,onDidRegisterWindow:uq,onWillUnregisterWindow:dq,onDidUnregisterWindow:cq}=function(){let $=new Map,J={window:N8,disposables:new h9};$.set(N8.vscodeWindowId,J);let Y=new Y0,Z=new Y0,j=new Y0;function K(Q,X){return(typeof Q=="number"?$.get(Q):void 0)??(X?J:void 0)}return{onDidRegisterWindow:Y.event,onWillUnregisterWindow:j.event,onDidUnregisterWindow:Z.event,registerWindow(Q){if($.has(Q.vscodeWindowId))return G8.None;let X=new h9,V={window:Q,disposables:X.add(new h9)};return $.set(Q.vscodeWindowId,V),X.add(p0(()=>{$.delete(Q.vscodeWindowId),Z.fire(Q)})),X.add($2(Q,gV.BEFORE_UNLOAD,()=>{j.fire(Q)})),Y.fire(V),X},getWindows(){return $.values()},getWindowsCount(){return $.size},getWindowId(Q){return Q.vscodeWindowId},hasWindow(Q){return $.has(Q)},getWindowById:K,getWindow(Q){let X=Q;if(X?.ownerDocument?.defaultView)return X.ownerDocument.defaultView.window;let V=Q;return V?.view?V.view.window:N8},getDocument(Q){return SV(Q).document}}}(),mV=class{constructor($,J,Y,Z){this._node=$,this._type=J,this._handler=Y,this._options=Z||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}};function $2($,J,Y,Z){return new mV($,J,Y,Z)}var CV,TJ,s5=class{constructor($,J=0){this._runner=$,this.priority=J,this._canceled=!1}dispose(){this._canceled=!0}execute(){if(!this._canceled)try{this._runner()}catch($){L6($)}}static sort($,J){return J.priority-$.priority}};(function(){let $=new Map,J=new Map,Y=new Map,Z=new Map,j=(K)=>{Y.set(K,!1);let Q=$.get(K)??[];for(J.set(K,Q),$.set(K,[]),Z.set(K,!0);Q.length>0;)Q.sort(s5.sort),Q.shift().execute();Z.set(K,!1)};TJ=(K,Q,X=0)=>{let V=fJ(K),z=new s5(Q,X),G=$.get(V);return G||(G=[],$.set(V,G)),G.push(z),Y.get(V)||(Y.set(V,!0),K.requestAnimationFrame(()=>j(V))),z},CV=(K,Q,X)=>{let V=fJ(K);if(Z.get(V)){let z=new s5(Q,X),G=J.get(V);return G||(G=[],J.set(V,G)),G.push(z),z}else return TJ(K,Q,X)}})();var kJ=class ${constructor(J,Y){this.width=J,this.height=Y}with(J=this.width,Y=this.height){return J!==this.width||Y!==this.height?new $(J,Y):this}static is(J){return typeof J=="object"&&typeof J.height=="number"&&typeof J.width=="number"}static lift(J){return J instanceof $?J:new $(J.width,J.height)}static equals(J,Y){return J===Y?!0:!J||!Y?!1:J.width===Y.width&&J.height===Y.height}};kJ.None=new kJ(0,0);var lq=new class{constructor(){this.mutationObservers=new Map}observe($,J,Y){let Z=this.mutationObservers.get($);Z||(Z=new Map,this.mutationObservers.set($,Z));let j=EV(Y),K=Z.get(j);if(K)K.users+=1;else{let Q=new Y0,X=new MutationObserver((z)=>Q.fire(z));X.observe($,Y);let V=K={users:1,observer:X,onDidMutate:Q.event};J.add(p0(()=>{V.users-=1,V.users===0&&(Q.dispose(),X.disconnect(),Z?.delete(j),Z?.size===0&&this.mutationObservers.delete($))})),Z.set(j,K)}return K.onDidMutate}},gV={CLICK:"click",AUXCLICK:"auxclick",DBLCLICK:"dblclick",MOUSE_UP:"mouseup",MOUSE_DOWN:"mousedown",MOUSE_OVER:"mouseover",MOUSE_MOVE:"mousemove",MOUSE_OUT:"mouseout",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_WHEEL:"wheel",POINTER_UP:"pointerup",POINTER_DOWN:"pointerdown",POINTER_MOVE:"pointermove",POINTER_LEAVE:"pointerleave",CONTEXT_MENU:"contextmenu",WHEEL:"wheel",KEY_DOWN:"keydown",KEY_PRESS:"keypress",KEY_UP:"keyup",LOAD:"load",BEFORE_UNLOAD:"beforeunload",UNLOAD:"unload",PAGE_SHOW:"pageshow",PAGE_HIDE:"pagehide",PASTE:"paste",ABORT:"abort",ERROR:"error",RESIZE:"resize",SCROLL:"scroll",FULLSCREEN_CHANGE:"fullscreenchange",WK_FULLSCREEN_CHANGE:"webkitfullscreenchange",SELECT:"select",CHANGE:"change",SUBMIT:"submit",RESET:"reset",FOCUS:"focus",FOCUS_IN:"focusin",FOCUS_OUT:"focusout",BLUR:"blur",INPUT:"input",STORAGE:"storage",DRAG_START:"dragstart",DRAG:"drag",DRAG_ENTER:"dragenter",DRAG_LEAVE:"dragleave",DRAG_OVER:"dragover",DROP:"drop",DRAG_END:"dragend",ANIMATION_START:h5?"webkitAnimationStart":"animationstart",ANIMATION_END:h5?"webkitAnimationEnd":"animationend",ANIMATION_ITERATION:h5?"webkitAnimationIteration":"animationiteration"},hV=/([\w\-]+)?(#([\w\-]+))?((\.([\w\-]+))*)/;function VY($,J,Y,...Z){let j=hV.exec(J);if(!j)throw Error("Bad use of emmet");let K=j[1]||"div",Q;return $!=="http://www.w3.org/1999/xhtml"?Q=document.createElementNS($,K):Q=document.createElement(K),j[3]&&(Q.id=j[3]),j[4]&&(Q.className=j[4].replace(/\./g," ").trim()),Y&&Object.entries(Y).forEach(([X,V])=>{typeof V>"u"||(/^on\w+$/.test(X)?Q[X]=V:X==="selected"?V&&Q.setAttribute(X,"true"):Q.setAttribute(X,V))}),Q.append(...Z),Q}function pV($,J,...Y){return VY("http://www.w3.org/1999/xhtml",$,J,...Y)}pV.SVG=function($,J,...Y){return VY("http://www.w3.org/2000/svg",$,J,...Y)};var uV=class extends G8{constructor($,J,Y,Z,j,K,Q,X,V){super();this._terminal=$,this._characterJoinerService=J,this._charSizeService=Y,this._coreBrowserService=Z,this._coreService=j,this._decorationService=K,this._optionsService=Q,this._themeService=X,this._cursorBlinkStateManager=new D7,this._charAtlasDisposable=this._register(new D7),this._observerDisposable=this._register(new D7),this._model=new $V,this._workCell=new OJ,this._workCell2=new OJ,this._rectangleRenderer=this._register(new D7),this._glyphRenderer=this._register(new D7),this._onChangeTextureAtlas=this._register(new Y0),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new Y0),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new Y0),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onRequestRedraw=this._register(new Y0),this.onRequestRedraw=this._onRequestRedraw.event,this._onContextLoss=this._register(new Y0),this.onContextLoss=this._onContextLoss.event,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas");let z={antialias:!1,depth:!1,preserveDrawingBuffer:V};if(this._gl=this._canvas.getContext("webgl2",z),!this._gl)throw Error("WebGL2 not supported "+this._gl);this._register(this._themeService.onChangeColors(()=>this._handleColorChange())),this._cellColorResolver=new Iz(this._terminal,this._optionsService,this._model.selection,this._decorationService,this._coreBrowserService,this._themeService),this._core=this._terminal._core,this._renderLayers=[new QV(this._core.screenElement,2,this._terminal,this._core.linkifier,this._coreBrowserService,Q,this._themeService)],this.dimensions=Hz(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._updateCursorBlink(),this._register(Q.onOptionChange(()=>this._handleOptionsChanged())),this._deviceMaxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._register($2(this._canvas,"webglcontextlost",(G)=>{console.log("webglcontextlost event received"),G.preventDefault(),this._contextRestorationTimeout=setTimeout(()=>{this._contextRestorationTimeout=void 0,console.warn("webgl context not restored; firing onContextLoss"),this._onContextLoss.fire(G)},3000)})),this._register($2(this._canvas,"webglcontextrestored",(G)=>{console.warn("webglcontextrestored event received"),clearTimeout(this._contextRestorationTimeout),this._contextRestorationTimeout=void 0,BJ(this._terminal),this._initializeWebGLState(),this._requestRedrawViewport()})),this._observerDisposable.value=vJ(this._canvas,this._coreBrowserService.window,(G,W)=>this._setCanvasDevicePixelDimensions(G,W)),this._register(this._coreBrowserService.onWindowChange((G)=>{this._observerDisposable.value=vJ(this._canvas,G,(W,q)=>this._setCanvasDevicePixelDimensions(W,q))})),this._core.screenElement.appendChild(this._canvas),[this._rectangleRenderer.value,this._glyphRenderer.value]=this._initializeWebGLState(),this._isAttached=this._core.screenElement.isConnected,this._register(p0(()=>{for(let G of this._renderLayers)G.dispose();this._canvas.parentElement?.removeChild(this._canvas),BJ(this._terminal)}))}get textureAtlas(){return this._charAtlas?.pages[0].canvas}_handleColorChange(){this._refreshCharAtlas(),this._clearModel(!0)}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._terminal.cols,this._terminal.rows))}handleResize($,J){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows);for(let Y of this._renderLayers)Y.resize(this._terminal,this.dimensions);this._canvas.width=this.dimensions.device.canvas.width,this._canvas.height=this.dimensions.device.canvas.height,this._canvas.style.width=`${this.dimensions.css.canvas.width}px`,this._canvas.style.height=`${this.dimensions.css.canvas.height}px`,this._core.screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._core.screenElement.style.height=`${this.dimensions.css.canvas.height}px`,this._rectangleRenderer.value?.setDimensions(this.dimensions),this._rectangleRenderer.value?.handleResize(),this._glyphRenderer.value?.setDimensions(this.dimensions),this._glyphRenderer.value?.handleResize(),this._refreshCharAtlas(),this._clearModel(!1)}handleCharSizeChanged(){this.handleResize(this._terminal.cols,this._terminal.rows)}handleBlur(){for(let $ of this._renderLayers)$.handleBlur(this._terminal);this._cursorBlinkStateManager.value?.pause(),this._requestRedrawViewport()}handleFocus(){for(let $ of this._renderLayers)$.handleFocus(this._terminal);this._cursorBlinkStateManager.value?.resume(),this._requestRedrawViewport()}handleSelectionChanged($,J,Y){for(let Z of this._renderLayers)Z.handleSelectionChanged(this._terminal,$,J,Y);this._model.selection.update(this._core,$,J,Y),this._requestRedrawViewport()}handleCursorMove(){for(let $ of this._renderLayers)$.handleCursorMove(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation()}_handleOptionsChanged(){this._updateDimensions(),this._refreshCharAtlas(),this._updateCursorBlink()}_initializeWebGLState(){return this._rectangleRenderer.value=new jV(this._terminal,this._gl,this.dimensions,this._themeService),this._glyphRenderer.value=new iz(this._terminal,this._gl,this.dimensions,this._optionsService),this.handleCharSizeChanged(),[this._rectangleRenderer.value,this._glyphRenderer.value]}_refreshCharAtlas(){if(this.dimensions.device.char.width<=0&&this.dimensions.device.char.height<=0){this._isAttached=!1;return}let $=$Y(this._terminal,this._optionsService.rawOptions,this._themeService.colors,this.dimensions.device.cell.width,this.dimensions.device.cell.height,this.dimensions.device.char.width,this.dimensions.device.char.height,this._coreBrowserService.dpr,this._deviceMaxTextureSize);this._charAtlas!==$&&(this._onChangeTextureAtlas.fire($.pages[0].canvas),this._charAtlasDisposable.value=dJ(r8.forward($.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),r8.forward($.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas))),this._charAtlas=$,this._charAtlas.warmUp(),this._glyphRenderer.value?.setAtlas(this._charAtlas)}_clearModel($){this._model.clear(),$&&this._glyphRenderer.value?.clear()}clearTextureAtlas(){this._charAtlas?.clearTexture(),this._clearModel(!0),this._requestRedrawViewport()}clear(){this._clearModel(!0);for(let $ of this._renderLayers)$.reset(this._terminal);this._cursorBlinkStateManager.value?.restartBlinkAnimation(),this._updateCursorBlink()}renderRows($,J){if(!this._isAttached)if(this._core.screenElement?.isConnected&&this._charSizeService.width&&this._charSizeService.height)this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0;else return;for(let Y of this._renderLayers)Y.handleGridChanged(this._terminal,$,J);!this._glyphRenderer.value||!this._rectangleRenderer.value||(this._glyphRenderer.value.beginFrame()?(this._clearModel(!0),this._updateModel(0,this._terminal.rows-1)):this._updateModel($,J),this._rectangleRenderer.value.renderBackgrounds(),this._glyphRenderer.value.render(this._model),(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible)&&this._rectangleRenderer.value.renderCursor())}_updateCursorBlink(){this._coreService.decPrivateModes.cursorBlink??this._terminal.options.cursorBlink?this._cursorBlinkStateManager.value=new dz(()=>{this._requestRedrawCursor()},this._coreBrowserService):this._cursorBlinkStateManager.clear(),this._requestRedrawCursor()}_updateModel($,J){let Y=this._core,Z=this._workCell,j,K,Q,X,V,z,G=0,W=!0,q,H,U,O,M,A,m,E,b;$=SJ($,Y.rows-1,0),J=SJ(J,Y.rows-1,0);let P=this._coreService.decPrivateModes.cursorStyle??Y.options.cursorStyle??"block",f=this._terminal.buffer.active.baseY+this._terminal.buffer.active.cursorY,u=f-Y.buffer.ydisp,$0=Math.min(this._terminal.buffer.active.cursorX,Y.cols-1),G0=-1,m0=this._coreService.isCursorInitialized&&!this._coreService.isCursorHidden&&(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible);this._model.cursor=void 0;let S=!1;for(K=$;K<=J;K++)for(Q=K+Y.buffer.ydisp,X=Y.buffer.lines.get(Q),this._model.lineLengths[K]=0,U=f===Q,G=0,V=this._characterJoinerService.getJoinedCharacters(Q),E=0;E<Y.cols;E++){if(j=this._cellColorResolver.result.bg,X.loadCell(E,Z),E===0&&(j=this._cellColorResolver.result.bg),z=!1,W=E>=G,q=E,V.length>0&&E===V[0][0]&&W){H=V.shift();let u0=this._model.selection.isCellSelected(this._terminal,H[0],Q);for(m=H[0]+1;m<H[1];m++)W&&=u0===this._model.selection.isCellSelected(this._terminal,m,Q);W&&=!U||$0<H[0]||$0>=H[1],W?(z=!0,Z=new dV(Z,X.translateToString(!0,H[0],H[1]),H[1]-H[0]),q=H[1]-1):G=H[1]}if(O=Z.getChars(),M=Z.getCode(),m=(K*Y.cols+E)*m6,this._cellColorResolver.resolve(Z,E,Q,this.dimensions.device.cell.width),m0&&Q===f&&(E===$0&&(this._model.cursor={x:$0,y:u,width:Z.getWidth(),style:this._coreBrowserService.isFocused?P:Y.options.cursorInactiveStyle,cursorWidth:Y.options.cursorWidth,dpr:this._devicePixelRatio},G0=$0+Z.getWidth()-1),E>=$0&&E<=G0&&(this._coreBrowserService.isFocused&&P==="block"||this._coreBrowserService.isFocused===!1&&Y.options.cursorInactiveStyle==="block")&&(this._cellColorResolver.result.fg=50331648|this._themeService.colors.cursorAccent.rgba>>8&16777215,this._cellColorResolver.result.bg=50331648|this._themeService.colors.cursor.rgba>>8&16777215)),M!==0&&(this._model.lineLengths[K]=E+1),!(this._model.cells[m]===M&&this._model.cells[m+A6]===this._cellColorResolver.result.bg&&this._model.cells[m+f6]===this._cellColorResolver.result.fg&&this._model.cells[m+C5]===this._cellColorResolver.result.ext)&&(S=!0,O.length>1&&(M|=ez),this._model.cells[m]=M,this._model.cells[m+A6]=this._cellColorResolver.result.bg,this._model.cells[m+f6]=this._cellColorResolver.result.fg,this._model.cells[m+C5]=this._cellColorResolver.result.ext,A=Z.getWidth(),this._glyphRenderer.value.updateCell(E,K,M,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,O,A,j),z)){for(Z=this._workCell,E++;E<=q;E++)b=(K*Y.cols+E)*m6,this._glyphRenderer.value.updateCell(E,K,0,0,0,0,Qz,0,0),this._model.cells[b]=0,this._model.cells[b+A6]=this._cellColorResolver.result.bg,this._model.cells[b+f6]=this._cellColorResolver.result.fg,this._model.cells[b+C5]=this._cellColorResolver.result.ext;E--}}S&&this._rectangleRenderer.value.updateBackgrounds(this._model),this._rectangleRenderer.value.updateCursor(this._model)}_updateDimensions(){!this._charSizeService.width||!this._charSizeService.height||(this.dimensions.device.char.width=Math.floor(this._charSizeService.width*this._devicePixelRatio),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*this._devicePixelRatio),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._terminal.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._terminal.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/this._devicePixelRatio),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/this._devicePixelRatio),this.dimensions.css.cell.height=this.dimensions.device.cell.height/this._devicePixelRatio,this.dimensions.css.cell.width=this.dimensions.device.cell.width/this._devicePixelRatio)}_setCanvasDevicePixelDimensions($,J){this._canvas.width===$&&this._canvas.height===J||(this._canvas.width=$,this._canvas.height=J,this._requestRedrawViewport())}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}_requestRedrawCursor(){let $=this._terminal.buffer.active.cursorY;this._onRequestRedraw.fire({start:$,end:$})}},dV=class extends C9{constructor($,J,Y){super();this.content=0,this.combinedData="",this.fg=$.fg,this.bg=$.bg,this.combinedData=J,this._width=Y}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData($){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}};function SJ($,J,Y=0){return Math.max(Math.min($,J),Y)}var mJ="di$target",CJ="di$dependencies",a5=new Map;function A8($){if(a5.has($))return a5.get($);let J=function(Y,Z,j){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");cV(J,Y,j)};return J._id=$,a5.set($,J),J}function cV($,J,Y){J[mJ]===J?J[CJ].push({id:$,index:Y}):(J[CJ]=[{id:$,index:Y}],J[mJ]=J)}var sq=A8("BufferService"),aq=A8("CoreMouseService"),oq=A8("CoreService"),nq=A8("CharsetService"),iq=A8("InstantiationService"),rq=A8("LogService"),lV=A8("OptionsService"),tq=A8("OscLinkService"),eq=A8("UnicodeService"),$H=A8("DecorationService"),sV={trace:0,debug:1,info:2,warn:3,error:4,off:5},aV="xterm.js: ",gJ=class extends G8{constructor($){super();this._optionsService=$,this._logLevel=5,this._updateLogLevel(),this._register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),GY=this}get logLevel(){return this._logLevel}_updateLogLevel(){this._logLevel=sV[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams($){for(let J=0;J<$.length;J++)typeof $[J]=="function"&&($[J]=$[J]())}_log($,J,Y){this._evalLazyOptionalParams(Y),$.call(console,(this._optionsService.options.logger?"":aV)+J,...Y)}trace($,...J){this._logLevel<=0&&this._log(this._optionsService.options.logger?.trace.bind(this._optionsService.options.logger)??console.log,$,J)}debug($,...J){this._logLevel<=1&&this._log(this._optionsService.options.logger?.debug.bind(this._optionsService.options.logger)??console.log,$,J)}info($,...J){this._logLevel<=2&&this._log(this._optionsService.options.logger?.info.bind(this._optionsService.options.logger)??console.info,$,J)}warn($,...J){this._logLevel<=3&&this._log(this._optionsService.options.logger?.warn.bind(this._optionsService.options.logger)??console.warn,$,J)}error($,...J){this._logLevel<=4&&this._log(this._optionsService.options.logger?.error.bind(this._optionsService.options.logger)??console.error,$,J)}};gJ=hX([pX(0,lV)],gJ);var GY;function oV($){GY=$}var WY=class extends G8{constructor($){if(lJ&&Kz()<16){let J={antialias:!1,depth:!1,preserveDrawingBuffer:!0};if(!document.createElement("canvas").getContext("webgl2",J))throw Error("Webgl2 is only supported on Safari 16 and above")}super();this._preserveDrawingBuffer=$,this._onChangeTextureAtlas=this._register(new Y0),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this._register(new Y0),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=this._register(new Y0),this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._onContextLoss=this._register(new Y0),this.onContextLoss=this._onContextLoss.event}activate($){let J=$._core;if(!$.element){this._register(J.onWillOpen(()=>this.activate($)));return}this._terminal=$;let{coreService:Y,optionsService:Z}=J,j=J,K=j._renderService,Q=j._characterJoinerService,X=j._charSizeService,V=j._coreBrowserService,z=j._decorationService,G=j._logService,W=j._themeService;oV(G),this._renderer=this._register(new uV($,Q,X,V,Y,z,Z,W,this._preserveDrawingBuffer)),this._register(r8.forward(this._renderer.onContextLoss,this._onContextLoss)),this._register(r8.forward(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this._register(r8.forward(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),this._register(r8.forward(this._renderer.onRemoveTextureAtlasCanvas,this._onRemoveTextureAtlasCanvas)),K.setRenderer(this._renderer),this._register(p0(()=>{if(this._terminal._core._store._isDisposed)return;let q=this._terminal._core._renderService;q.setRenderer(this._terminal._core._createRenderer()),q.handleResize($.cols,$.rows)}))}get textureAtlas(){return this._renderer?.textureAtlas}clearTextureAtlas(){this._renderer?.clearTextureAtlas()}};class Q2{feedIds=[K0.TERMINAL_OUTPUT];collapsible=!1;terminal=null;fitAddon=null;resizeObserver=null;connection;resizeDebounceId=null;deckManager=null;constructor($){this.connection=$}setDeckManager($){this.deckManager=$}mount($){let J=getComputedStyle(document.documentElement).getPropertyValue("--background").trim(),Y=getComputedStyle(document.documentElement).getPropertyValue("--foreground").trim();this.terminal=new $J({cursorBlink:!0,fontFamily:"'Menlo', 'Monaco', 'Courier New', monospace",fontSize:14,theme:{background:J,foreground:Y}}),this.fitAddon=new JJ,this.terminal.loadAddon(this.fitAddon),this.terminal.loadAddon(new YJ),this.terminal.open($);try{let Z=new WY;Z.onContextLoss(()=>{Z.dispose(),console.log("tugdeck: WebGL context lost, falling back to canvas")}),this.terminal.loadAddon(Z),console.log("tugdeck: WebGL renderer activated")}catch{console.log("tugdeck: WebGL not available, using canvas renderer")}this.resizeObserver=new ResizeObserver(()=>{if(this.deckManager?.isDragging)return;if(this.resizeDebounceId!==null)cancelAnimationFrame(this.resizeDebounceId);this.resizeDebounceId=requestAnimationFrame(()=>{if(this.fitAddon)this.fitAddon.fit();this.resizeDebounceId=null})}),this.resizeObserver.observe($),this.terminal.onData((Z)=>{let j=new TextEncoder().encode(Z);this.connection.send(K0.TERMINAL_INPUT,j)}),this.terminal.onResize(({cols:Z,rows:j})=>{let K=r6(Z,j);this.connection.send(K.feedId,K.payload)})}onFrame($,J){if($===K0.TERMINAL_OUTPUT&&this.terminal)this.terminal.write(J)}onResize($,J){if(this.deckManager?.isDragging)return;if(this.fitAddon&&this.terminal){this.fitAddon.fit();let Y=r6(this.terminal.cols,this.terminal.rows);this.connection.send(Y.feedId,Y.payload)}}destroy(){if(this.resizeDebounceId!==null)cancelAnimationFrame(this.resizeDebounceId),this.resizeDebounceId=null;if(this.resizeObserver)this.resizeObserver.disconnect(),this.resizeObserver=null;if(this.terminal)this.terminal.dispose(),this.terminal=null,this.fitAddon=null}}var nV=100;class X2{feedIds=[K0.FILESYSTEM];container=null;header=null;eventList=null;mount($){this.container=$,this.container.classList.add("files-card"),this.header=document.createElement("div"),this.header.className="card-header",this.header.textContent="Files",this.container.appendChild(this.header),this.eventList=document.createElement("div"),this.eventList.className="event-list",this.container.appendChild(this.eventList)}onFrame($,J){if($!==K0.FILESYSTEM||!this.eventList)return;if(J.length===0)return;let Y=new TextDecoder().decode(J),Z;try{Z=JSON.parse(Y)}catch{console.error("files-card: failed to parse FsEvent payload");return}let j=this.eventList,K=j.scrollHeight-j.scrollTop-j.clientHeight<8;for(let Q of Z){let X=document.createElement("div");X.className=`event-entry event-${Q.kind.toLowerCase()}`;let V=document.createElement("span");V.className="event-icon",V.appendChild(this.iconForKind(Q.kind));let z=document.createElement("span");z.className="event-label",z.textContent=this.labelForEvent(Q),X.appendChild(V),X.appendChild(z),j.appendChild(X)}while(j.children.length>nV)j.removeChild(j.firstChild);if(K)j.scrollTop=j.scrollHeight}onResize($,J){}destroy(){if(this.container)this.container.innerHTML="",this.container=null,this.header=null,this.eventList=null}iconForKind($){switch($){case"Created":return v0(Q1,{width:14,height:14});case"Modified":return v0(K1,{width:14,height:14});case"Removed":return v0(h7,{width:14,height:14});case"Renamed":return v0(X1,{width:14,height:14});default:return v0(h7,{width:14,height:14})}}labelForEvent($){if($.kind==="Renamed")return`${$.from} → ${$.to}`;return $.path??""}}class z2{feedIds=[K0.GIT];container=null;header=null;content=null;mount($){this.container=$,this.container.classList.add("git-card"),this.header=document.createElement("div"),this.header.className="card-header",this.header.textContent="Git",this.container.appendChild(this.header),this.content=document.createElement("div"),this.content.className="git-content",this.container.appendChild(this.content)}onFrame($,J){if($!==K0.GIT||!this.content)return;if(J.length===0)return;let Y=new TextDecoder().decode(J),Z;try{Z=JSON.parse(Y)}catch{console.error("git-card: failed to parse GitStatus payload");return}this.render(Z)}onResize($,J){}destroy(){if(this.container)this.container.innerHTML="",this.container=null,this.header=null,this.content=null}render($){if(!this.content)return;this.content.innerHTML="";let J=document.createElement("div");J.className="branch-section";let Y=v0(z1,{width:14,height:14});Y.style.color="var(--muted-foreground)",J.appendChild(Y);let Z=document.createElement("span");if(Z.className="branch-badge",Z.textContent=$.branch,J.appendChild(Z),$.ahead>0||$.behind>0){let j=document.createElement("span");j.className="ahead-behind";let K=[];if($.ahead>0)K.push(`↑${$.ahead}`);if($.behind>0)K.push(`↓${$.behind}`);j.textContent=K.join(" "),J.appendChild(j)}if(this.content.appendChild(J),$.head_message){let j=document.createElement("div");j.className="head-message",j.textContent=$.head_message,this.content.appendChild(j)}if($.staged.length>0)this.renderFileSection("Staged","staged",$.staged);if($.unstaged.length>0)this.renderFileSection("Unstaged","unstaged",$.unstaged);if($.untracked.length>0)this.renderUntrackedSection($.untracked);if($.staged.length===0&&$.unstaged.length===0&&$.untracked.length===0){let j=document.createElement("div");j.className="clean-status",j.textContent="Clean working tree",this.content.appendChild(j)}}renderFileSection($,J,Y){if(!this.content)return;let Z=document.createElement("div");Z.className=`file-section ${J}`;let j=document.createElement("div");j.className="section-title",j.textContent=`${$} (${Y.length})`,Z.appendChild(j);for(let K of Y){let Q=document.createElement("div");Q.className="file-entry";let X=document.createElement("span");X.className="file-status";let V=J==="staged"?v0(J1,{width:14,height:14}):v0(Z1,{width:14,height:14});X.appendChild(V);let z=document.createElement("span");z.className="file-path",z.textContent=K.path,Q.appendChild(X),Q.appendChild(z),Z.appendChild(Q)}this.content.appendChild(Z)}renderUntrackedSection($){if(!this.content)return;let J=document.createElement("div");J.className="file-section untracked";let Y=document.createElement("div");Y.className="section-title",Y.textContent=`Untracked (${$.length})`,J.appendChild(Y);for(let Z of $){let j=document.createElement("div");j.className="file-entry";let K=document.createElement("span");K.className="file-status",K.appendChild(v0(Y1,{width:14,height:14}));let Q=document.createElement("span");Q.className="file-path",Q.textContent=Z,j.appendChild(K),j.appendChild(Q),J.appendChild(j)}this.content.appendChild(J)}}function V2($){return getComputedStyle(document.documentElement).getPropertyValue($).trim()}class qY{values=[];canvas;ctx;color;bufferSize;constructor($,J=60,Y){this.canvas=$,this.ctx=$.getContext("2d"),this.color=Y,this.bufferSize=J}push($){if(this.values.push($),this.values.length>this.bufferSize)this.values.shift();this.draw()}draw(){let $=this.canvas.width,J=this.canvas.height;if(this.ctx.clearRect(0,0,$,J),this.values.length<2)return;let Y=Math.min(...this.values),Z=Math.max(...this.values);if(Z===Y)Y=Z-0.5,Z=Z+0.5;let j=Z-Y;this.ctx.beginPath(),this.ctx.strokeStyle=this.color,this.ctx.lineWidth=1.5;let K=$/(this.bufferSize-1);for(let Q=0;Q<this.values.length;Q++){let X=Q*K,V=J-(this.values[Q]-Y)/j*J;if(Q===0)this.ctx.moveTo(X,V);else this.ctx.lineTo(X,V)}this.ctx.stroke()}resize($,J){this.canvas.width=$,this.canvas.height=J,this.draw()}}class h6{container;nameSpan;valueSpan;sparkline;canvas;constructor($,J,Y=60,Z){this.container=document.createElement("div"),this.container.className="stat-sub-card";let j=document.createElement("div");j.className="stat-header";let K=document.createElement("span");if(K.style.display="flex",K.style.alignItems="center",K.style.gap="4px",Z)K.appendChild(v0(Z,{width:12,height:12}));this.nameSpan=document.createElement("span"),this.nameSpan.className="stat-name",this.nameSpan.textContent=$,K.appendChild(this.nameSpan),this.valueSpan=document.createElement("span"),this.valueSpan.className="stat-value",this.valueSpan.textContent="--",j.appendChild(K),j.appendChild(this.valueSpan),this.canvas=document.createElement("canvas"),this.canvas.className="sparkline-canvas",this.canvas.width=300,this.canvas.height=32,this.sparkline=new qY(this.canvas,Y,J),this.container.appendChild(j),this.container.appendChild(this.canvas)}mount($){$.appendChild(this.container)}updateValue($,J=!1){if(this.valueSpan.textContent=$,J)this.valueSpan.classList.add("stat-na");else this.valueSpan.classList.remove("stat-na")}pushSparkline($){this.sparkline.push($)}resize(){let $=this.canvas.clientWidth,J=32;this.sparkline.resize($,32)}getElement(){return this.container}}class G2{feedIds=[K0.STATS,K0.STATS_PROCESS_INFO,K0.STATS_TOKEN_USAGE,K0.STATS_BUILD_STATUS];container=null;content=null;processInfo=null;tokenUsage=null;buildStatus=null;mount($){this.container=$,this.container.classList.add("stats-card");let J=document.createElement("div");J.className="card-header",J.textContent="Stats",this.container.appendChild(J),this.content=document.createElement("div"),this.content.className="stats-content",this.container.appendChild(this.content),this.processInfo=new h6("CPU / Memory",V2("--chart-1"),60,e6),this.processInfo.mount(this.content),this.tokenUsage=new h6("Token Usage",V2("--chart-2"),60,j1),this.tokenUsage.mount(this.content),this.buildStatus=new h6("Build Status",V2("--chart-3"),60,V1),this.buildStatus.mount(this.content)}onFrame($,J){if(J.length===0)return;let Y=new TextDecoder().decode(J),Z;try{Z=JSON.parse(Y)}catch(j){console.error("Stats card: failed to parse JSON payload",j);return}switch($){case K0.STATS_PROCESS_INFO:this.handleProcessInfo(Z);break;case K0.STATS_TOKEN_USAGE:this.handleTokenUsage(Z);break;case K0.STATS_BUILD_STATUS:this.handleBuildStatus(Z);break;case K0.STATS:break}}handleProcessInfo($){if(!this.processInfo)return;let J=$.cpu_percent?.toFixed(1)??"0.0",Y=$.memory_mb?.toFixed(0)??"0";this.processInfo.updateValue(`CPU: ${J}%  Mem: ${Y}MB`),this.processInfo.pushSparkline($.cpu_percent??0)}handleTokenUsage($){if(!this.tokenUsage)return;if($===null||$.total_tokens===null){this.tokenUsage.updateValue("N/A",!0),this.tokenUsage.pushSparkline(0);return}let J=$.total_tokens??0,Y=$.context_window_percent?.toFixed(1)??"0.0";this.tokenUsage.updateValue(`${J} tokens (${Y}%)`,!1),this.tokenUsage.pushSparkline(J)}handleBuildStatus($){if(!this.buildStatus)return;let J=$.status??"idle";this.buildStatus.updateValue(J,!1),this.buildStatus.pushSparkline(J==="building"?1:0)}onResize($,J){if(this.processInfo)this.processInfo.resize();if(this.tokenUsage)this.tokenUsage.resize();if(this.buildStatus)this.buildStatus.resize()}destroy(){if(this.container)this.container.innerHTML="",this.container=null;this.content=null,this.processInfo=null,this.tokenUsage=null,this.buildStatus=null}}var iV=`ws://${window.location.host}/ws`,p6=new t6(iV),HY=document.getElementById("deck-container");if(!HY)throw Error("deck-container element not found");var M9=new G1(HY,p6),UY=new P1(p6);UY.setDeckManager(M9);M9.addCard(UY,"conversation");var IY=new Q2(p6);IY.setDeckManager(M9);M9.addCard(IY,"terminal");M9.addCard(new z2,"git");M9.addCard(new X2,"files");M9.addCard(new G2,"stats");p6.connect();console.log("tugdeck initialized");
